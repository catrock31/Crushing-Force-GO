; KFM's constants and state file.
; There are comments scattered through this file, so you may like to
; take a look if would like to learn more about the cns.

[Data]
;Amount of life to start with
life = 1100
power = 5000
;attack power (more is stronger)
attack = 100
;defensive power (more is stronger)
defence = 100
;Percentage to increase defense everytime player is knocked down
fall.defence_up = 50
;Time which player lies down for, before getting up
liedown.time = 60
;Number of points for juggling
airjuggle = 30
;Default hit spark number for HitDefs
sparkno = 2
;Default guard spark number
guard.sparkno = 40
;1 to enable echo on KO
KO.echo = 0
;Volume offset (negative for softer)
volume = 0
;Variables with this index and above will not have their values
;reset to 0 between rounds or matches. There are 60 int variables,
;indexed from 0 to 59, and 40 float variables, indexed from 0 to 39.
;If omitted, then it defaults to 60 and 40 for integer and float
;variables repectively, meaning that none are persistent, i.e. all
;are reset. If you want your variables to persist between matches,
;you need to override state 5900 from common1.cns.
IntPersistIndex = 60
FloatPersistIndex = 40

[Size]
xscale = 1.2           ;Horizontal scaling factor.
yscale = 1.2           ;Vertical scaling factor.
ground.back = 250     ;Player width (back, ground)
ground.front = 220    ;Player width (front, ground)
air.back = 48        ;Player width (back, air)
air.front = 48       ;Player width (front, air)
height = 480        ;Height of player (for opponent to jump over)
attack.dist = 640    ;Default attack distance
proj.attack.dist = 360 ;Default attack distance for projectiles
proj.doscale = 0     ;Set to 1 to scale projectiles too
head.pos = -14, -560 ;Approximate position of head
mid.pos = -6, -254  ;Approximate position of midsection
shadowoffset = 0     ;Number of pixels to vertically offset the shadow
draw.offset = 0,0    ;Player drawing offset in pixels (x, y). Recommended 0,0

[Velocity]
walk.fwd  = 10      ;Walk forward
walk.back = -6     ;Walk backward
run.fwd  = 28, 0   ;Run forward (x, y)
run.back = -18,-10.0 ;Hop backward (x, y)
jump.neu = 0,-38   ;Neutral jumping velocity (x, y)
jump.back = -12,-33.6 ;Jump back Speed (x, y)
jump.fwd = 10,-33.6     ;Jump forward Speed (x, y)
runjump.back = -10.2,-16.5 ;Running jump speeds (opt)
runjump.fwd = 20,-16.5    ;.
airjump.neu = 0,-34    ;.
airjump.back = -10.2      ;Air jump speeds (opt)
airjump.fwd = 10          ;.
air.gethit.groundrecover = -.6,-14    ;Velocity for ground recovery state (x, y) **MUGEN 1.0**
air.gethit.airrecover.mul = .5,.2     ;Multiplier for air recovery velocity (x, y) **MUGEN 1.0**
air.gethit.airrecover.add = 0,-18     ;Velocity offset for air recovery (x, y) **MUGEN 1.0**
air.gethit.airrecover.back = -4       ;Extra x-velocity for holding back during air recovery **MUGEN 1.0**
air.gethit.airrecover.fwd = 0         ;Extra x-velocity for holding forward during air recovery **MUGEN 1.0**
air.gethit.airrecover.up = -8         ;Extra y-velocity for holding up during air recovery **MUGEN 1.0**
air.gethit.airrecover.down = 6        ;Extra y-velocity for holding down during air recovery **MUGEN 1.0**

[Movement]
airjump.num = 0      ;Number of air jumps allowed (opt)
airjump.height = 140 ;Minimum distance from ground before you can air jump (opt)
yaccel = 1.76         ;Vertical acceleration
stand.friction = .775 ;Friction coefficient when standing
crouch.friction = .76 ;Friction coefficient when crouching
stand.friction.threshold = 8          ;If player's speed drops below this threshold while standing, stop his movement **MUGEN 1.0**
crouch.friction.threshold = .2        ;If player's speed drops below this threshold while crouching, stop his movement **MUGEN 1.0**
air.gethit.groundlevel = 100          ;Y-position at which a falling player is considered to hit the ground **MUGEN 1.0**
air.gethit.groundrecover.ground.threshold = -80 ;Y-position below which falling player can use the recovery command **MUGEN 1.0**
air.gethit.groundrecover.groundlevel = 40   ;Y-position at which player in the ground recovery state touches the ground **MUGEN 1.0**
air.gethit.airrecover.threshold = -4  ;Y-velocity above which player may use the air recovery command **MUGEN 1.0**
air.gethit.airrecover.yaccel = 1.4    ;Vertical acceleration for player in the air recovery state **MUGEN 1.0**
air.gethit.trip.groundlevel = 60      ;Y-position at which player in the tripped state touches the ground **MUGEN 1.0**
down.bounce.offset = 0, 80            ;Offset for player bouncing off the ground (x, y) **MUGEN 1.0**
down.bounce.yaccel = 1.6              ;Vertical acceleration for player bouncing off the ground **MUGEN 1.0**
down.bounce.groundlevel = 48          ;Y-position at which player bouncing off the ground touches the ground again **MUGEN 1.0**
down.friction.threshold = .2          ;If the player's speed drops below this threshold while lying down, stop his movement **MUGEN 1.0**

;Default language victory quotes **MUGEN 1.0**
;The default language victory quotes must be implemented in English.
[Quotes]
; Up to 100 victory quotes can be specified per language (victory0 - victory99)
victory1 = "You will either not see me coming, or won't be able to take your eyes off me."
victory2 = "Crushing you was absolutely delightful."
victory3 = "Don't waste my time, if I can do all this, you can at least put up an effort."
victory4 = "You broke too easily! I wanted to make this last."
victory5 = "I'm probably the biggest ninja you'll ever run into."
victory6 = "You'd be suprised how many don't see me coming..."
victory7 = "What's wrong with my outfit? It doesn't make any noise..."

; Jumbo elephant, her brother
victory8 = "See how fast elephants can be, brother? Maybe you'll train to be less sluggish next time."
victory9 = "You shouldn't have ever doubted me, Jumbo."
victory10 = "You could do so much more if you invested in some speed."

; Jiggly bunny, no acquaintance
victory11 = "Nice to see another big girl who's embraced speed as an attribute."
Victory12 = "You bunnies are awfully quick, but that's all you've got."
Victory13 = "Didn't expect someone my size to be so agile, did you?"

; Bertha hippo, former best friends, learned a technique from her
Victory14 = "You're strong, Bertha, but I know you're holding back."
victory15 = "We could have teamed up, Bertha. A shame you're too soft."
Victory16 = "You could be so much more if you let go of your petty morals, Bertha."

; Katrina crocodile, no acquaintance - appreciates her bust size
Victory17 = "I bet you never notice anything low and directly in front of you."
Victory18 = "I'm not really feeling your intimidation crocs."
Victory19 = "Unfortunately, the rest of your body couldn't keep up with your chest size."

;Aroma skunk, thinks she's gross
Victory20 = "I thought I smelled a sweet scent but then once the battle started it was unbearable."
Victory21 = "Get back up! I'm still going to need you to supply me with gas bombs."
Victory22 = "Your Poison is so annoying and gross.  I prefer to not make you an enemy."

;Enorma pig, doesn't like being shot at
Victory23 = "I already decided to crush you after the first shot."
Victory24 = "My body is the only weapon I need. How does it feel to need so much and still lose?"
Victory25 = "Guns can never compare to my agility, pig."

;Lardo rat, gross smelly rat
Victory26 = "You'd better hope I didn't catch your nasty scent from crushing you! "
Victory27 = "You're a long way from the sewers, you filthy vermin."
Victory28 = "You can't eat me, let alone reach me, you disgusting rat."

;Zafta giraffe, she's shorter than her and is outranged.
Victory29 = "Your reach is ridiculous, but you're going to need more mass on those legs to get results."
Victory30 = "Your height doesn't beat my width, giraffe."
Victory31 = "You may outrange me, but I knew you would be prepared for how I move!"

;Makuyama, sumo bear quite powerful
Victory32 = "You're strength rivals my brother's.  But I can beat him too."
Victory33 = "You're strength is scary, I never thought I'd be thrown out of the air like that."
Victory34 = "Ha!  I just crushed a bear and it was a lot easier than I thought."

;Pastilla, taur witch
Victory35 = "Your magic will not be enough to protect you!"
Victory36 = "Shrink me all you want. I'll crush your bones no matter what!"
victory37 = "Poison techniques like yours are downright disrespectful, get out of my sight!"

;Jumba, herself, sister? clone?
Victory38 = "I have to admit, my own speed is quite impressive!"
Victory39 = "You're movements were a joy to watch although you will still not beat me."
Victory40 = "I'll never hold back, not even against myself!"

;Twiggi, super skinny lesbian with a girlfriend that looks just like Jumba in shape.
Victory41 = "You have poor fighting skills, but fantastic taste in partners."
Victory42 = "I guess you really do break like a twig, huh?"
Victory43 = "I take it your girlfriend is used to peeling you out of craters?"

;Ra Lord, snake man
Victory44 = "Guess who has a new leather mawashi and isn't afraid of puny fangs? This girl!"
victory45 = "I'm gonna enjoy stomping you out, snake."
Victory46 = "Good luck slithering away when I crush you into an accordion."

; Violet
Victory47 = "It's a pleasure to spar with you, Violet."
victory48 = "You're an expert in your craft, Violet. I've hardly got a scratch on my outfit!"
victory49 = "The outfit you designed for me is hardly concealing, but damn I love how it feels.."

; Battu
Victory50 = "I don't care how cute you are, rodents just disturb me."
Victory51 = "Even with gravity manipulation, you'll still end up squashed beneath me!"
victory52 = "I can crush you like any other rodent, how disappointing..."

; Julian
victory53 = "You hippos sure know how to flaunt it, but I can tell it's all show."
victory54 = "You already saw rainbows and now your seeing stars."
victory55 = "I wonder if your cameras could catch you underneath me..."

; Rapid
victory56 = "I LOVE crushing the tiny ones, the fact that your Bertha's mate just makes it even more satisfying."
victory57 = "All that training I did to get as fast as I am and then I see how you move. Its really frustrating, which is why it's so satisfying to squash you."
victory58 = "I know you're one of those types that enjoys being sat on.  So I'll just have to be much worse on you."

; Noah
victory59 = "Shoot me again, I wanna use the anger to motivate me to grind you into a stain."
victory60 = "Beasts, Demons, Deities its nice to know they all flatten under me."
victory61 = "If you ever wanna be in an ass crater again, please feel free to challenge me."

;vs Guy
Victory70 = "I think I use your techniques better than you do."
victory71 = "If I crush you like that again, it'll probably be your final fight!"
victory72 = "Conflict aside, you look good in red."

;vs Mai
victory73 = "You're an inspiration to female ninjas, but you're a lot smaller than I expected."
victory74 = "Have to say, I ought to look into an outfit like yours one day."
victory75 = "I can respect your unique style of using fans, but I don't need weapons."

;vs TMNT Leo
victory76 = "If you're the leader of your brothers, then you may as well retreat now."
victory77 = "Your skills are quite apparent, but technique alone isn't enough to move mountains like me."
victory78 = "What a lot of good those letter openers did you. I'm unarmed!"

;vs TMNT Raph
victory79 = "Throwing a tantrum isn't going to help you against me!"
victory80 = "I guess I'd be angry if my only weapons were glorified kitchen forks too."
victory81 = "That hot-headed nature of yours is just going to get that shell of yours crushed."

;vs TMNT Don
victory82 = "Everyone has a plan until they're crushed beneath loads of ass, huh?"
victory83 = "What kind of ninja obsesses over technology and engineering anyway?"
victory84 = "You snapped a lot like your twig of a staff would!"

;vs TMNT Mike
victory85 = "That's what you get for not taking this seriously!"
victory86 = "You talk too much. I'm glad sitting on you can shut you up!"
victory87 = "Crack another joke, and I'll crack your shell instead, turtle."

;vs Akai
victory88 = "How did you get your speed!?  I've trained for so long and I think I'm the peak of elephant speed. But then I see a big body speedster and I wonder if I can go further."
Victory89 = "You're that femboi that works for my brother.  My brother clearly has good taste."
Victory90 = "I like your style Akai, but get in my way and I'll treat you like a personal seat."

;vs Andy
Victory91 = "Flaunting Durability is a good way to make me sit on you.  I enjoyed crushing you so much."
victory92 = "The durable ones get me.  I loved hearing your metal bend and your bones break under me."
victory93 = "I don't hide behind tools since I don't need to.  My body is the only weapon I need and it overwhelmed your high tech."

;Vs Montana
Victory94 = "All those wings and yet you didn't have the common sense to fly away from this fight."
Victory95 = "I've crushed witches like you before don't think your magic could intimidate me."
victory96 = "Crushing your moth body is far too easy with my mass, but you got good taste with the butt droping techniques."

;Vs Texas
Victory97 = "Crushing you Texas has been a desire of mine for a while now.  But bonding the outlaws of Gold Springs with my mobs should be bring you a whole slew of new nightmares."
Victory98 = "Please try to stop me again.  I love crushing the small ones like you more when they think they  have authority."
Victory99 = "Half of my ass is bigger than your entire body and I'm still coming down on you full-weight." 

;Alternate language victory quotes (optional).
;0 or more alternate language sections may be added, preceded by the
;ISO 639-1 code followed by a ".", e.g. "[ja.Quotes]".
;See language setting in mugen.cfg.
[ja.Quotes]
victory1 = "カンフー突き手を破らぬ限り、お前に勝ち目はない！"
victory2 = "十年早いんだぞ"
victory3 = "お前は見覚えがあるな。テレビにでも…？"
victory4 = "お前の動きは見破りやすすぎる。　なに、カンフー突き手が覚えたいんだと？　素人には無理だぞ"
victory5 = "ふー。　いい汗だった"
victory6 = "もっと強い相手に挑戦したい"
victory7 = "なんだと！彼女はここにもいないと？"

;---------------------------------------------------------------------------
; Variable usage:
; This is a record of the variables that KFM uses. Keeping a record of your
; variable usage helps you avoid careless mistakes later.
; var(1)  - Used in kfm.cmd for combo condition (updated every tick)
; var(2)  - Used in Kung Fu Throw (state 800) to remember if fwd was being
;           held (remembered from state 800 through state 810).
; fvar(12) - Run stop inhibitor

;---------------------------------------------------------------------------
; Lose by Time Over
; CNS difficulty: basic
[Statedef 170]
type = S
ctrl = 0
anim = 170
velset = 0,0

[State 170, 1]
type = NotHitBy
trigger1 = 1
value = SCA
time = 1

;---------------------------------------------------------------------------
; Win state decider
; CNS difficulty: basic
[Statedef 180]
type = S

[State 180, 1]
type = ChangeState
trigger1 = Time = 0
value = 181

;---------------------------------------------------------------------------
; Win pose 1 - Bow
; CNS difficulty: basic
[Statedef 181]
type = S
ctrl = 0
anim = 181
velset = 0,0

[state 181 width]
type = width
trigger1 = 1
edge = 180,180

[state 181, spr priority]
type = sprpriority
trigger1 = 1
value = -2
persistent = 1

[state 181, changeanim]
type = changeanim
trigger1 = anim = 181
trigger1 = time > 40
value = 182

[state 181, announce]
type = playsnd
triggerall = teammode = single
trigger1 = time = 10
trigger1 = life != lifemax
value = S180,1

[state 181, announce]
type = playsnd
triggerall = teammode = single
trigger1 = time = 10
trigger1 = life = lifemax
value = S180,1

[State 181, 1]
type = NotHitBy
trigger1 = 1
value = SCA
time = 1

;---------------------------------------------------------------------------
; Introduction
; CNS difficulty: basic
[Statedef 191]
type = S
ctrl = 0
anim = 190
velset = 0,0
sprpriority = -2

[state 191, version]
type = explod
trigger1 = time = 0
anim = ifelse(facing = -1,9101,9100)
scale = 1,1
postype = Back
pos = ifelse(facing =1, 20, 157),360 ; Nice!
ontop = 1

[State 191, 1] ;Freeze animation until PreIntro is over
type = ChangeAnim
trigger1 = RoundState = 0
value = 190

;[state 191, pos add]
;type = posadd
;trigger1 = time = 0
;x = 120

[state 191, explod]
type = explod
trigger1 = time = 3
id = 191
postype = p1
pos = 0,0
sprpriority = -3
anim = 191
scale = 1.4,0.25


[State 191, 2]
type = AssertSpecial
trigger1 = 1
flag = Intro

[State 191, 3] ;Change to stand state when done
type = ChangeState
trigger1 = time > 140
value = 192

;---------------------------------------------------------------------------
;Jump off
[statedef 192]
type = A
physics = N
anim = 41

[state 192, velset]
type = velset
trigger1 = time = 0
y = -24

[State 1921, 2]
type = AssertSpecial
trigger1 = 1
flag = Intro

;[state 192, end]
;type = changestate
;trigger1 = animtime = 0
;value = 0

;[state 192, posadd]
;type = posadd
;trigger1 = animelemtime(4) = 0
;x = -30

;[state 192, posadd]
;type = posadd
;trigger1 = animelemtime(5) = 0
;x = -30

;[state 192, posadd]
;type = posadd
;trigger1 = animelemtime(9) = 0
;x = -60

[state 192, gravity]
type = gravity
trigger1 = pos y < -1

[state 192, changeanim]
type = changeanim
trigger1 = anim = 41
trigger1 = vel y > 0
value = 44

[state 192, changestate]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 193

;--------------------------------------------------------------------------------
;Landing and ready
[statedef 193]
type = S
physics = S
anim = 47
velset = 0,0

[state 193, posset]
type = posset
trigger1 = time = 0
y = 0

;[state 192, modifyexplod]
;type = modifyexplod
;trigger1 = time = 3
;id = 191
;scale = 1,1

[State 193, 4]
type = EnvShake
trigger1 = time = 0
time = ifelse(var(15)=1,24,18)
ampl = ifelse(var(15)=1,-18,-12)
freq = 100
phase = 100


[state 193, 4]
type = playsnd
trigger1 = time = 0
value = S20,0


[state 193, front foot front dust]
type = explod
trigger1 = time = 0
anim = F120
pos = 320,0
scale = 2, 2

[state 193, front foot back dust]
type = explod
trigger1 = time = 0
anim = F120
pos = 170,0
scale = 2, 2


[state 193, backfoot front dust]
type = explod
trigger1 = time = 0
anim = F120
pos = -150,10
scale = 2, 2
ownpal = 1

[state 193,back foot back dust]
type = explod
trigger1 = time = 0
anim = F120
pos = -300,10
scale = 2, 2
ownpal = 1

[State 193, 2]
type = AssertSpecial
trigger1 = 1
flag = Intro

[state 193, changestate]
type = changestate
trigger1 = animtime = 0
value = 0


;---------------------------------------------------------------------------
; Taunt
; CNS difficulty: easy
[Statedef 195]
type = S
ctrl = 0
anim = 195
velset = 0,0
movetype = I
physics = S
sprpriority = 2

[State 195, 1]
type = CtrlSet
trigger1 = Time = 40
value = 1

[State 195, 2]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1


;---------------------------------------------------------------------------
; 1st Jab
; CNS difficulty: easy
[Statedef 200]
type    = S                      ;State-type: S-stand, C-crouch, A-air, L-liedown
movetype= A                      ;Move-type: A-attack, I-idle, H-gethit
physics = S                      ;Physics: S-stand, C-crouch, A-air
juggle  = 1                      ;Number of air juggle points move takes
;Commonly-used controllers:
velset = 0,0                     ;Set velocity (x,y) (Def: no change)
ctrl = 0                         ;Set ctrl (Def: no change)
anim = 200                       ;Change animation (Def: no change)
poweradd = 10                    ;Power to add (Def: 0)
sprpriority = 2                  ;Set p1's sprite layering priority to 2 (in front)

[State 200, 1]
type = HitDef
trigger1 = AnimElem = 3
attr = S, NA                     ;Attribute: Standing, Normal Attack
damage = 20, 0                   ;Damage that move inflicts, guard damage
animtype = Light                 ;Animation type: Light, Medium, Heavy, Back (def: Light)
guardflag = MA                   ;Flags on how move is to be guarded against
hitflag = MAF                    ;Flags of conditions that move can hit
priority = 3, Hit                ;Attack priority: 0 (least) to 7 (most), 4 default
;Hit/Miss/Dodge type (Def: Hit)
pausetime = 8, 8                 ;Time attacker pauses, time opponent shakes
sparkno = 0                      ;Spark anim no (Def: set above)
sparkxy = -40, -304              ;X-offset for the "hit spark" rel. to p2,
;Y-offset for the spark rel. to p1
hitsound = S5000,0                  ;Sound to play on hit
guardsound = S120,0              ;Sound to play on guard
ground.type = High               ;Type: High, Low, Trip (def: Normal)
ground.slidetime = 14            ;Time that the opponent slides back
ground.hittime  = 14             ;Time opponent is in hit state
ground.velocity = -14            ;Velocity at which opponent is pushed
airguard.velocity = -7.6,-3.2    ;Guard velocity in air (def: (air.xvel*1.5, air.yvel/2))
air.type = High                  ;Type: High, Low, Trip (def: same as ground.type)
air.velocity = -4,-12          ;X-velocity at which opponent is pushed,
;Y-velocity at which opponent is pushed
air.hittime = 15                 ;Time before opponent regains control in air
guard.velocity = -16
guard.slidetime = 14
guard.hittime = 14
fall.recovertime = 30

[State 200, 2]
type = PlaySnd
trigger1 = Time = 1
value = 0, 0

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -9
persistent = 0
ignorehitpause = 1

[State 200, 3]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
; 2nd Jab
; CNS difficulty: easy
[Statedef 201]
type    = S                     
movetype= A                      
physics = S                      
juggle  = 1                      
velset = 0,0                     
ctrl = 0                        
anim = 201                       
poweradd = 10                    
sprpriority = 2                 

[State 201, 1]
type = HitDef
trigger1 = AnimElem = 3
attr = S, NA                    
damage = 20, 0                  
animtype = Light                 
guardflag = MA                   
hitflag = MAF                   
priority = 3, Hit                
pausetime = 8, 8                
sparkno = 0                    
sparkxy = -40, -304              
hitsound = S5000,0                 
guardsound = S120,06                
ground.type = High               
ground.slidetime = 17             
ground.hittime  = 17             
ground.velocity = -14            
airguard.velocity = -7.6,-3.2    
air.type = High                  
air.velocity = -4,-12  
air.hittime = 15
guard.velocity = -16
guard.slidetime = 14
guard.hittime = 14 
fall.recovertime = 30            

[State 201, 2]
type = PlaySnd
trigger1 = Time = 1
value = 0, 0

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -9
persistent = 0
ignorehitpause = 1

[State 200, 3]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
; Standing Strong
; CNS difficulty: easy
[Statedef 205]
type    = S                     
movetype= A                      
physics = S                      
juggle  = 1                      
velset = 0,0                     
ctrl = 0                        
anim = 205                       
poweradd = 10                    
sprpriority = 2                 

[State 205, 1]
type = HitDef
trigger1 = AnimElem = 3
attr = S, NA                    
damage = 50, 5                  
animtype = Light                 
guardflag = MA                   
hitflag = MAF                   
priority = 3, Hit                
pausetime = 8, 8                
sparkno = 2                    
sparkxy = -40, -304              
hitsound = S5000, 1                 
guardsound = S120,0               
ground.type = High               
ground.slidetime = 16             
ground.hittime  = 16            
ground.velocity = -14           
airguard.velocity = -7.6,-3.2    
air.type = High                  
air.velocity = -4,-12  
air.hittime = 15               
guard.velocity = -17
guard.slidetime = 14
guard.hittime = 14
guard.kill = 0
fall.recovertime = 30


[State 201, 2]
type = PlaySnd
trigger1 = Time = 1
value = 0, 0

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -6
persistent = 0
ignorehitpause = 1

[state 205, Not Active]
type = statetypeset
trigger1 = animelemtime(5) = 0
movetype = I

[State 200, 3]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------

[Statedef 210]
type    = S
movetype= A
physics = S
juggle  = 4
poweradd= 30
ctrl = 0
velset = 0,0
anim = 210
sprpriority = -1

[State 210, Width]
type = Width
trigger1 = (AnimElemTime (2) >= 0) && (AnimElemTime (7) < 0)
value = 15,0

[State 210, 1]
type = PlaySnd
trigger1 = animelemtime(4) = 0
value = S20, 0

[State 52, 4]
type = EnvShake
trigger1 = animelemtime(4) = 0
time = 12
ampl = -12
freq = 80
phase = 80

[State 210, 2]
type = HitDef
trigger1 = AnimElem = 5
attr = S, NA
animtype  = heavy
damage    = 85,9
guardflag = MA
pausetime = 10,10
sparkno = 2
sparkxy = -40,-280
hitsound   = 5,3
guardsound = S120,0
ground.type = High
ground.slidetime = floor(fvar(12)*29)
ground.hittime  = floor(fvar(12)*29)
ground.velocity = -20
air.velocity = -12,-12
forcenofall = 1
guard.velocity = -30
guard.slidetime = 17
guard.hittime = 17
guard.kill = 0
fall.recovertime = 30

[state 210, hitstun decay]
type = varadd
trigger1 = movehit
trigger1 = fvar(12) > 0
fvar(12) = -0.05
ignorehitpause = 1
persistent = 0

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -3
persistent = 0
ignorehitpause = 1

[state 210, Not Active]
type = statetypeset
trigger1 = animelemtime(6) = 0
movetype = I

[State 210, 5]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
; Standing light kick
; CNS difficulty: easy
[Statedef 230]
type    = S
movetype= A
physics = S
juggle  = 4
poweradd= 11
ctrl = 0
velset = 0,0
anim = 230
sprpriority = 2

[State 230, 1]
type = PlaySnd
trigger1 = Time = 2
value = 0, 1

[State 230, 2]
type = HitDef
trigger1 = Time = 0
attr = S, NA
animtype  = Medium
damage    = 30
guardflag = MA
pausetime = 7,7
sparkno = 0
sparkxy = -40,-148
hitsound   = 5,1
guardsound = S120,0
ground.type = Low
ground.slidetime = 20
ground.hittime  = 20
ground.velocity = -20
air.velocity = -10,-14
guard.hittime = 18
guard.slidetime = 18
fall.recovertime = 30

[state 230, posadd]
type = posadd
trigger1 = animelem = 2
x = 80

[state 230, posadd]
type = posadd
trigger1 = animelem = 3
x = 60

[state 230, posadd]
type = posadd
trigger1 = animelem = 4
x = 60

[state 230, posadd]
type = posadd
trigger1 = animelem = 7
x = -120

[state 230, posadd]
type = posadd
trigger1 = animtime = 0
x = -80

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -9
persistent = 0
ignorehitpause = 1


[State 230, 3]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
; Standing strong kick
; CNS difficulty: easy
[Statedef 240]
type    = S
movetype= A
physics = S
poweradd= 30
ctrl = 0
velset = 0,0
anim = 240
sprpriority = -2

[State 240, 1]
type = PlaySnd
trigger1 = Time = 2
value = 0, 1

[State 240, 2]
type = HitDef
trigger1 = Time = 0
attr = S, NA
animtype  = back
damage    = 90,9
guardflag = MA
pausetime = 12,12
sparkno = 3
p1sprpriority = -2
sparkxy = -40,-240
hitsound   = S5000,2
guardsound = S120,0
ground.type = high
ground.slidetime = 14
ground.hittime  = 17
ground.velocity = -28,-8
air.velocity = -28,-6
yaccel = 0.8
fall = 1
fall.recover = 1
fall.recovertime = 60
guard.velocity = -27
guard.hittime = 13
guard.slidetime = 13
airguard.velocity = -12,-2
guard.kill = 0
fall.recovertime = 30

[state 240, layering]
type = sprPriority
trigger1 = animelem = 6
value = 2

[state 230, posadd]
type = posadd
trigger1 = animelem = 4
x = 180

[state 230, velset]
type = veladd
trigger1 = animelem = 4
x = 5

[state 230, posadd]
type = posadd
trigger1 = animelem = 7
x = -180

[State 52, 4]
type = EnvShake
trigger1 = animelemtime(8) = 0
time = 12
ampl = -12
freq = 80
phase = 80

[State 210, 1]
type = PlaySnd
trigger1 = animelemtime(8) = 0
value = S20, 0

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -3
persistent = 0
ignorehitpause = 1

[state 240, Not Active]
type = statetypeset
trigger1 = animelemtime(6) = 0
movetype = I



[State 240, 4]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
; High Kick
; CNS difficulty: easy
[Statedef 245]
type    = S
movetype= A
physics = S
poweradd= 30
ctrl = 0
velset = 0,0
sprpriority = 2



;===========
;Armor start
;===========
[state 245, anim]
type = changeanim
trigger1 = anim != 245
value = 245

[state 245, armor counter]
type = varset
trigger1 = time = 0
trigger1 = Var(21) = 1
V = 20
value = 3

[state 245, excess armor check]
type = varset
trigger1 = var(20) > 3
var(20) = 3
persistent = 1
ignorehitpause = 1

[state 245, armor intiator turn off]
type = varset
trigger1 = time = 1
V = 21
value = 0

;determine what frame
[state 245, remember frame]
type = varset
trigger1 = time <= 0
v = 22
value = animelemno(0)
ignorehitpause = 1

;delay effect
[state 245, delay]
type = changeanim 
trigger1 = var(31) < floor(gethitvar(hittime)*0.5)
value = anim
elem = var(22)

[state 245, freeze location]
type = posfreeze
trigger1 = var(31) < floor(gethitvar(hittime)*0.5)
value = 1
;--------------------------

[state 245, still take damage]
type = lifeadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) != 0
value = floor(-gethitvar(damage)*0.75)
persistent = 1

[state 245, armor count down]
type = varadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) > 0
V = 20
value = - 1
persistent = 1

[state 245, Unstoppable]
type = hitoverride
triggerall = animelemtime(6) < 0
trigger1 = Life > 1
trigger1 = Var(20) > 0
attr = A, AA, AP
stateno = 245
time = 1
persistent = 1

[State 245, flash red]
type = PalFX
trigger1 = Time = 0
trigger1 = gethitvar(damage) != 0
time = 7
add = 100,0,0
IgnoreHitPause = 1
;--------------------------------------------------------------------------------


[State 245, 1]
type = PlaySnd
trigger1 = Time = 2
value = 0, 1

[State 245, 2]
type = HitDef
trigger1 = Time = 0
attr = S, NA
animtype  = back
damage    = 90,ifelse(enemynear,statetype = A,27,9)
guardflag = MA
pausetime = 18,18
sparkno = 3
sparkxy = -40,-240
Hitsound = S5000, 2
guardsound = S120,0
ground.type = high
ground.slidetime = 14
ground.hittime  = 16
air.hittime = 40
ground.velocity = -2,-52
air.velocity = -2,-44
forcenofall = 1
fall = 0
p2facing = 1
fall.recover = 1
fall.recovertime = 60
guard.velocity = -18
guard.hittime = 23
guard.slidetime = 23
airguard.velocity = -15,-10
airguard.hittime = 32
guard.kill = 0
fall.recovertime = 30

[state 245, jump out]
type = changestate
triggerall = statetype = S
triggerall = movehit
trigger1 = command = "holdup"
trigger2 = ailevel
value = 42
ctrl = 0

[state 245, Rise]
type = statetypeset
trigger1 = animelemtime(4) = 0
statetype = A
physics = N

[state 245, Rise]
type = veladd
trigger1 = animelemtime(4) = 0
y = -12
x = 8

[state 245, gravity]
type = gravity
trigger1 = pos y < -1

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -9
persistent = 0
ignorehitpause = 1

[state 245, Not Active]
type = statetypeset
trigger1 = animelemtime(6) = 0
movetype = I


[State 245, 4]
type = ChangeState
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 246
;---------------------------------------------------------------------------
;Landing
[statedef 246]
type = S
movetype = I
physics = S
ctrl = 0
anim = 246
movehitpersist = 1

[state 246, landing]
type = velset
trigger1 = time = 0
y = 0

[state 246, on ground]
type = posset
trigger1 = time = 0
y = 0

[state 245, jump out]
type = changestate
triggerall = statetype = S
triggerall = movehit
trigger1 = command = "holdup"
trigger2 = ailevel
value = 42
ctrl = 0

[State 106, 4]
type = EnvShake
trigger1 = time = 0
time = 12
ampl = 12


[State 100, footstep]
type = PlaySnd
trigger1 = time = 1
value = S20,0

[state 246, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
;Overhead Stomp
[Statedef 250]
type    = S
movetype= A
physics = S
poweradd= 30
ctrl = 0
velset = 0,0
sprpriority = 2

[state 250, anim]
type = changeanim
trigger1 = anim != 250
value = 250

[state 250, width]
type = width
trigger1 = animelemtime(6) >= 0
value = 0,80
persistent = 1


[State 250, 1]
type = PlaySnd
trigger1 = animelemtime(4) = 0
value = S250, 0

[State 250, 2]
type = HitDef
trigger1 = animelemtime(8) >=0 && animelemtime(10) < 0
persistent = 0
attr = S, NA
animtype  = Heavy
damage    = 110,11
guardflag = HA
hitflag = MAF
pausetime = 14,14
sparkno = 3
id = 250
nochainid = 1400
sparkxy = -40,-240
Hitsound = S5000, 2
guardsound = S120,0
ground.type = high
ground.slidetime = 14
ground.hittime  = 17
ground.velocity = -2,60
air.velocity = -2,60
fall = 1
fall.recover = 1
fall.recovertime = 60
down.bounce = 1
fall.xvelocity = -1
fall.yvelocity = -20
guard.velocity = -45
guard.hittime = 19
guard.slidetime = 19
airguard.velocity = -30, 8
airguard.hittime = 30
guard.kill = 0

[State 250, 2]
type = HitDef
trigger1 =  animelem = 10
persistent = 0
attr = S, NA
animtype  = back
damage    = 120,10
guardflag = 
hitflag = FD
pausetime = 14,14
sparkno = 3
id = 251
p2stateno = 660
sparkxy = -40,-240
Hitsound = S5000, 2
guardsound = S120,0
ground.type = high
ground.slidetime = 14
ground.hittime  = 17
ground.velocity = -26,-8
air.velocity = -20,-6
fall = 1
fall.recover = 1
fall.recovertime = 60
guard.velocity = -27
guard.hittime = 12
guard.slidetime = 12
airguard.velocity = -12,-2
guard.kill = 0

[state 250, targetstate]
type = targetstate
trigger1 = movehit
trigger1 = numtarget(250)
trigger1 = hitpausetime = 13
trigger1 = var(8) > 0
value = 680
ignorehitpause = 1
persistent = 0

[state 250, ground bounce limiter]
type = varadd
trigger1 = movehit
trigger1 = numtarget(250)
v = 8
value = -1
ignorehitpause = 1
persistent = 0


;=============================
; Positioning
;=============================

[state 250, posadd]
type = posadd
triggerall = p2bodydist  x >= 80
trigger1 = animelem = 2
x = 80

[state 250, posadd]
type = veladd
triggerall = p2bodydist  x < 80
trigger1 = animelemtime(2) > 0 && animelemtime(4) < 0
x = 4

[state 250, posadd]
type = posadd
triggerall = p2bodydist  x >= 80
trigger1 = animelem = 3
x = 80

[state 250, posadd]
type = posadd
triggerall = p2bodydist  x >= 90
trigger1 = animelem = 7
x = 90

[state 250, posadd]
type = veladd
triggerall = p2bodydist  x < 90
trigger1 = animelemtime(7) > 0 && animelemtime(10) < 0
x = 6

[state 250, posadd]
type = posadd
triggerall = p2bodydist  x >= 120
trigger1 = animelem = 8
x = 120

[state 250, posadd]
type = posadd
triggerall = p2bodydist  x >= 60
trigger1 = animelem = 9
x = 60

;=======================================
; end
;=======================================

[state 250, anim]
type = changeanim
trigger1 = anim != 250
value = 250

[state 250, armor counter]
type = varset
triggerall = prevstateno != 250
trigger1 = time = 0
;trigger1 = Var(21) = 1
;trigger1 = var(20) > 2
V = 20
value = 3

[state 250, excess armor check]
type = varset
trigger1 = var(20) > 3
var(20) = 3
persistent = 1
ignorehitpause = 1

[state 250, armor intiator turn off]
type = varset
triggerall = prevstateno != 250
trigger1 = time = 1
V = 21
value = 0

;determine what frame
[state 250, remember frame]
type = varset
trigger1 = time <= 0
v = 22
value = animelemno(0)
ignorehitpause = 1

;delay effect
[state 250, delay]
type = changeanim 
trigger1 = var(31) < floor(gethitvar(hittime)*1.1)
value = anim
elem = var(22)

[state 250, freeze location]
type = posfreeze
trigger1 = var(31) < floor(gethitvar(hittime)*1.1)
value = 1
;--------------------------

[state 250, still take damage]
type = lifeadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) != 0
value = floor(-gethitvar(damage)*0.75)
persistent = 1

[state 250, armor count down]
type = varadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) > 0
V = 20
value = - 1
persistent = 1

[state 250, Unstoppable]
type = hitoverride
triggerall = gethitvar(groundtype) != 3
triggerall = animelemtime(11) < 0
triggerall = alive
trigger1 = Var(20) > 0
attr = SCA, AA, AP
stateno = 250
time = 1
persistent = 1

[State 250, flash red]
type = PalFX
trigger1 = Time = 0
trigger1 = gethitvar(damage) != 0
time = 7
add = 100,0,0
IgnoreHitPause = 1
;--------------------------------------------------------------------------------

[State 250, 4]
type = EnvShake
trigger1 = animelemtime(10) = 0
time = 32
ampl = -24
freq = 80
phase = 80

[state 1005, land fx]
type = explod
trigger1 = animelemtime(10) = 0
anim = 2000
bindtime = 1
id = 2000
pos = 260, 10
removetime = -2
sprpriority = 4
scale = 2.25,2.25
ownpal = 1

[state 1005, land fx]
type = explod
trigger1 = animelemtime(10) = 0
anim = 2001
bindtime = 1
id = 2001
pos = 260, 10
removetime = -2
sprpriority = -2
scale = 2.25,2.25
ownpal = 1

[state 651, fx]
type = explod
trigger1 = animelemtime(10) = 0
anim = F61
pos = 210,8
scale = 3,3
ownpal = 1

[State 250, 1]
type = PlaySnd
trigger1 = animelemtime(10) = 0
value = S5100, 0

[State 250, 1]
type = PlaySnd
trigger1 = animelemtime(10) = 0
value = S5100, 0

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -9
persistent = 0
ignorehitpause = 1

[state 250, Not Active]
type = statetypeset
trigger1 = animelemtime(11) = 0
movetype = I


[State 250, 4]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1


;---------------------------------------------------------------------------
;Crouching light punch
; CNS difficulty: easy
; Description: Simple crouching attack. The HitDef's guardflag parameter
;     is set to "L", meaning that the move can only be guarded low
;     (crouching), and not by standing or jumping opponents.
;     Like for all light attacks, it's a good idea to keep the slidetime
;     and hittime parameters at a smaller number, so the opponent isn't
;     stunned for too long. For all crouching attacks you have to
;     remember to set the attr parameter to indicate that it is crouching
;     attack. In this case, "C, NA" stands for "crouching, normal attack".
;     The HitDef's priority is set at 3, instead of the default of 4,
;     so this attack has a lower priority than most others, meaning
;     KFM will get hit instead of trading hits with his opponent if
;     their attack collision boxes (Clsn1) intersect each other's Clsn2
;     boxes at the same time.
[Statedef 400]
type    = C
movetype= A
physics = C
juggle  = 5
poweradd= 8
ctrl = 0
anim = 400
sprpriority = 2

[State 400, 1]
type = PlaySnd
trigger1 = Time = 1
value = 0, 0

[State 400, 2]
type = HitDef
trigger1 = Time = 0
attr = C, NA
damage    = 25
priority  = 3
animtype  = Light
hitflag = MAF
guardflag = L
pausetime = 10,11
sparkno = 0
sparkxy = -40,-168
Hitsound = S5000, 0
guardsound = S120,0
ground.type = Low
ground.slidetime = 13
ground.hittime  = 13
ground.velocity = -16
air.velocity = -10,-8
guard.hittime = 13
guard.slidetime = 13
guard.velocity = -18
fall.recovertime = 30

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -9
persistent = 0
ignorehitpause = 1

[State 400, 4]
type = ChangeState
trigger1 = AnimTime = 0
value = 11
ctrl = 1

;---------------------------------------------------------------------------
;Crouching strong punch
; CNS difficulty: easy
; Description: This is a 2-hit move. It is done by having two HitDefs
;     triggered, one for each frame of animation that hits.
;     Notice how the first hit cannot be guarded by an opponent in the
;     air, because of the "M" in the guardflag, meaning it can only
;     be guarded "middle". The second hit has an "MA" guardflag, so
;     it can be guarded both on the ground and in the air.
[Statedef 410]
type    = C
movetype= A
physics = C
juggle  = 6
poweradd= 25
ctrl = 0
anim = 410
sprpriority = 2

[State 410, 2]
type = PlaySnd
trigger1 = animelemTime(4) = 0
value = S610, 0

[state 410, launcher limiter]
type = varadd
trigger1 = movehit
var(11) = -1
persistent = 0
ignorehitpause = 1

;This is the second hit, triggered on the 4th element of animation.
[State 410, 3]
type = HitDef
trigger1 = !movecontact
attr = C, NA
damage    = 80
animtype  = up
hitflag = MAF
guardflag = MA
pausetime = 18,18
sparkno = 3
sparkxy = -40,-332
Hitsound = S5000, 2
guardsound = S120,0
ground.type = High
ground.slidetime = 60
ground.hittime  = 60
air.hittime = 60
ground.velocity = -2,ifelse(var(11) > 0,-38,-8)
air.velocity = -2,ifelse(var(11) > 0,-36,-6)
guard.velocity = -18
guard.hittime = 22
guard.slidetime = 22
airguard.velocity = -12,-8
fall = ifelse(var(11) > 0,0,1)
fall.recovertime = 45

[state 410, jump out]
type = changestate
triggerall = movehit
trigger1 = command = "holdup"
trigger2 = ailevel
value = 42
ctrl = 0

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -9
persistent = 0
ignorehitpause = 1

[state 410, Not Active]
type = statetypeset
trigger1 = animelemtime(6) = 0
movetype = I

[State 410, 4]
type = ChangeState
trigger1 = AnimTime = 0
value = 11
ctrl = 1

;---------------------------------------------------------------------------
;Crouching light kick
; CNS difficulty: easy
[Statedef 430]
type    = C
movetype= A
physics = C
juggle  = 5
poweradd= 11
ctrl = 0
anim = 430
sprpriority = 2

[State 430, 1]
type = PlaySnd
trigger1 = Time = 1
value = 0, 0

[State 430, 2]
type = HitDef
trigger1 = Time = 0
attr = C, NA
damage    = ifelse(enemynear,statetype = L, 15,30)
animtype  = medium
hitflag = MAFD
guardflag = LA
nochainid = 1400
pausetime = 12,12
sparkno = 2
sparkxy = -40,-32
hitsound   = S5000,1
guardsound = S120,0
ground.type = low
ground.slidetime = 17
ground.hittime  = 17
ground.velocity = -16
air.velocity = -12,-6
air.fall = 1
down.velocity = -14,0
guard.hittime = 13
guard.slidetime = 13
fall.recovertime = 30




[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -9
persistent = 0
ignorehitpause = 1

[State 430, 3]
type = ChangeState
trigger1 = AnimTime = 0
value = 11
ctrl = 1

;---------------------------------------------------------------------------
;Crouch Strong Kick
; CNS difficulty: easy
; Description: This move uses "Trip" for the "ground.type" parameter in
;     its HitDef. It's a special type that puts the opponent in a tripped
;     animation as he falls. Also, the hitflag parameter in the HitDef
;     is set to "MAFD". The "D" indicates that a downed opponent can be
;     hit by the attack.
[Statedef 440]
type    = C
movetype= A
physics = C
juggle  = 7
poweradd= 35
ctrl = 0
anim = 440
sprpriority = 2

[State 440, 2]
type = PlaySnd
trigger1 = Time = 2
value = 0, 2

[state 440, width]
type = width
trigger1 = animelemtime(2) >= 0 && animelemtime(10) < 0 
player = 240,0
ignorehitpause = 1

[State 440, 3]
type = HitDef
trigger1 = Time = 0
attr = C, NA
damage    = ifelse(enemynear,statetype = L,45,ifelse(enemynear,statetype = A, 45, 90))
hitflag = MAFD
guardflag = L
pausetime = 12,12
sparkno = 1
nochainid = 1400
sparkxy = -20,-40
hitsound   = S5000,1
guardsound = S120,0
ground.type = Trip
ground.slidetime = 12
ground.hittime  = 17
ground.velocity = -8,-14
air.velocity = -8,-14
guard.hittime = 10 ;-12 bad recovery: High reach
guard.slidetime = 10 
guard.velocity = -40
fall = 1
fall.recover = 0
fall.recovertime = 60
guard.kill = 0
down.velocity = -80,0
fall.recovertime = 30


[state 440, attack dist]
type = attackdist
trigger1 = 1
value = 500


[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -3
persistent = 0
ignorehitpause = 1

[state 440, Not Active]
type = statetypeset
trigger1 = animelemtime(4) = 0
movetype = I

[State 440, 4]
type = ChangeState
trigger1 = AnimTime = 0
value = 11
ctrl = 1

;---------------------------------------------------------------------------
;Jump Light Punch
; CNS difficulty: easy
[Statedef 600]
type    = A
movetype= A
physics = A
poweradd= 5
ctrl = 0
anim = 600
sprpriority = 2

[State 600, 1]
type = PlaySnd
trigger1 = Time = 1
value = 0, 0

[State 600, 2]
type = HitDef
trigger1 = Time = 0
attr = A, NA
damage    = 20
guardflag = HA
priority = 3
pausetime = 8,8
sparkno = 0
sparkxy = -40,-232
Hitsound = S5000, 0
guardsound = S120,0
ground.type = High
ground.slidetime = 12
ground.hittime  = 12
ground.velocity = -16
air.velocity = -6,-12
air.hittime = 14
airguard.velocity = -10,-2
fall.recovertime = 30

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -9
persistent = 0
ignorehitpause = 1

[State 600, 3]
type = changestate
trigger1 = animtime = 0
ctrl = 1
value = 50

;---------------------------------------------------------------------------
;Jump Strong Punch
; CNS difficulty: easy
[Statedef 610]
type    = A
movetype= A
physics = A
poweradd= 30
ctrl = 0
anim = 610
sprpriority = -2

[State 610, 2]
type = PlaySnd
trigger1 = animelemTime(4) = 0
value = S610, 0

[state 610, sprpriority]
type = sprpriority
trigger1 = animelemtime(8) = 0
value = -2
ignorehitpause

[State 610, 3]
type = HitDef
trigger1 = Time = 0
persistent = 0
attr = A, NA
damage = 80
guardflag = HA
hitflag = MAF
priority = 4
pausetime = 12,14
guard.pausetime = 8,8
sparkno = 3
sparkxy = -40,-220
Hitsound = S5000, 2
guardsound = S120,0
p1sprpriority = -2
animtype = Med
ground.type = High
ground.slidetime = 24
ground.hittime  = 24
air.hittime = 24
ground.velocity = -21
air.velocity = -35,50
guard.velocity = -24
airguard.velocity = -18,-2
guard.hittime = 18
guard.slidetime = 18
down.bounce = 1
fall.yvelocity = -10
fall.xvelocity = -4
air.fall = 1
fall.recover = 0
fall.recovertime = 60
envshake.ampl = -8
envshake.time = 14
envshake.freq = 80

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -3
persistent = 0
ignorehitpause = 1

[state 610, Not Active]
type = statetypeset
trigger1 = animelemtime(8) = 0
movetype = I


[state 610, end]
type = changestate
trigger1 = animtime = 0
value = 50
ctrl = 1

;---------------------------------------------------------------------------
;Jump Light Kick
; CNS difficulty: easy
[Statedef 630]
type    = A
movetype= A
physics = A
poweradd= 10
ctrl = 0
anim = 630
sprpriority = 2

[State 630, 1]
type = PlaySnd
trigger1 = Time = 1
value = 0, 0

[State 630, 2]
type = HitDef
trigger1 = Time = 0
attr = A, NA
damage = 30
guardflag = HA
priority = 3
pausetime = 8,8
sparkno = 1
sparkxy = -20,-140
Hitsound = S5000, 0
guardsound = S120,0
ground.type = High
animtype = medium
ground.slidetime = 18
ground.hittime  = 18
ground.velocity = -16
air.velocity = -4,-12
air.hittime = 22
guard.hittime = 18
guard.slidetime = 18
guard.velocity = -20
airguard.velocity = -14,-2
fall.recovertime = 30

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -9
persistent = 0
ignorehitpause = 1

[state 630, end]
type = changestate
trigger1 = animtime = 0
value = 50
ctrl = 1

;---------------------------------------------------------------------------

;Dive Kick
; CNS difficulty: easy
[Statedef 635]
type    = A
movetype= A
physics = N
poweradd= 10
ctrl = 0
anim = 635
sprpriority = 2
velset = 0,0
facep2 = 1

;[state 635, changestate]
;type = changestate
;trigger1 = time = 0
;trigger1 = vel x < 0
;value = 630

[State 635, 1]
type = PlaySnd
trigger1 = Time = 1
value = 0, 0

[state 635, velset]
type = velset
trigger1 = animelemtime(2) = 0
x = 16
y = 24

[state 635, gravity]
type = gravity
trigger1 = animelemtime(2) > 0

[State 635, 2]
type = HitDef
trigger1 = Time = 0
attr = A, NA
damage = 60,6
hitflag = MAFD
guardflag = HA
priority = 3
pausetime = 6,8
guard.pausetime = 8,8
sparkno = 2
nochainid = 1400
sparkxy = -20,-140
hitsound   = S5000,1
guardsound = S120,0
ground.type = high
animtype = medium
ground.slidetime = 32
ground.hittime  = 32
ground.velocity = -16
air.velocity = -2,-20
air.hittime = 36
guard.hittime = 18
guard.slidetime = 18
guard.velocity = -22
guard.cornerpush.veloff = -80
air.fall = 0
air.hittime = 35
down.velocity = ifelse(var(8) > 1, 0, -24),ifelse(var(8) > 1, -28, 0)
fall.recovertime = 60
guard.kill = 0

[state 635, groundbounce limiter]
type = varadd
trigger1 = movehit
trigger1 = enemynear,statetype = L
var(8) = -1
ignorehitpause = 1

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -9
persistent = 0
ignorehitpause = 1

[state 635, end]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > 60
value = 52

;---------------------------------------------------------------------------
;Jump Strong Kick
; CNS difficulty: easy
[Statedef 640]
type    = A
movetype= A
physics = A
poweradd= 30
ctrl = 0
anim = 640
sprpriority = 2

[state 640, wall bounce check]
type = varadd
trigger1 = movehit
trigger1 = enemynear,statetype = A
var(7) = -1
ignorehitpause = 1
persistent = 0

[State 640, 2]
type = PlaySnd
trigger1 = Time = 2
value = 0, 1

[state 640, veladd]
type = veladd
trigger1 = animelem = 3
trigger1 = vel x > 0
x = 8
persistent = 1

[State 640, 3]
type = HitDef
trigger1 = animelem = 4
attr = A, NA
damage    = 90,9
guardflag = HA
priority = 4
id = 640
nochainid = 640
pausetime = 14,14
guard.pausetime = 14,14
sparkno = 3
sparkxy = -40,-160
Hitsound = S5000, 2
guardsound = S120,0
animtype = heavy
ground.type = High
ground.slidetime = 334
ground.hittime  = 34
ground.velocity = -24
air.hittime = 34
air.velocity = -80,ifelse(var(7) > 1, -12, 12)
guard.velocity = -27
airguard.velocity = -27,4
envshake.freq = 80
envshake.ampl = 8
envshake.time = 12
guard.kill = 0
air.fall = 1
fall.recovertime = 30


[State 640, 3]
type = HitDef
trigger1 = animelemtime(5) >= 0 && animelemtime(8) < 0
trigger1 = !moveguarded
attr = A, NA
damage    = 60,6
persistent = 0
guardflag = HA
priority = 4
id = 641
nochainid = 640,641
pausetime = 8,8
sparkno = 2
sparkxy = -40,-160
hitsound   = 5,3
guardsound = S120,0
animtype = heavy
ground.type = High
ground.slidetime = 24
ground.hittime  = 24
ground.velocity = -25
air.velocity = -30,-12
guard.velocity = -34
airguard.velocity = -18,-6
envshake.freq = 80
envshake.ampl = 8
envshake.time = 12
guard.kill = 0
fall.recovertime = 30


[state 640, bounce]
type = targetstate
trigger1 = movehit
trigger1 = enemy,statetype = A
trigger1 = NumTarget(640)
trigger1 = var(7) > 0
trigger1 = hitpausetime = 13
ignorehitpause = 1
value = 675
id = 640



[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -6
persistent = 0
ignorehitpause = 1

[state 640, Not Active]
type = statetypeset
trigger1 = animelemtime(6) = 0
movetype = I

[state 640, end]
type = changestate
trigger1 = animtime = 0
value = 50
ctrl = 1

;---------------------------------------------------------------------------
;Butt Drop
[statedef 650]
type    = A
movetype= A
physics = N
poweradd= 80
ctrl = 0
sprpriority = 2


[state 650, animation]
type = changeanim
trigger1 = anim != 650
value = 650

[state 650, armor counter]
type = varset
trigger1 = time = 0
trigger1 = Var(21) = 1
V = 20
value = 1

[state 240, armor intiator turn off]
type = varset
trigger1 = time = 1
V = 21
value = 0

[state 650, invun]
type = nothitby
trigger1 = time < 16
trigger1 = prevstateno = 1070
value = SCA

[State 1020, Blink Yellow]
type = PalFX
trigger1 = time%2
trigger1 = prevstateno = 1070
time = 1
add = 150,75,0 ;32,16,0
sinadd = 64,32,5,3
ignorehitpause

;=================================
;-      Damage Set
;=================================

;Out of range, moreso Max damage
;Out of Range
[state 650, damage set]
type = varset
trigger1 = ceil(pos y) <= -1200 
trigger1 = time = 0
var(14) = 1300

;Out of Range
[state 650, damage set]
type = varset
trigger1 = ceil(pos y) <= -750 && ceil(pos y) > -1200
trigger1 = time = 0
var(14) = 480

; Peak Super Jump w/ Wall Jump
[state 650, damage set]
type = varset
trigger1 = ceil(pos y) <= -615  && ceil(pos y) > -750
trigger1 = time = 0
var(14) = 240

; Peak Super Jump
[state 650, damage set]
type = varset
trigger1 = ceil(pos y) <= -590  && ceil(pos y) > -615
trigger1 = time = 0
var(14) = 240

; Super Jump
[state 650, damage set]
type = varset
trigger1 = ceil(pos y) <= -425 && ceil(pos y) > -590
trigger1 = time = 0
var(14) = 220

; Peak Normal Jump
[state 650, damage set]
type = varset
trigger1 = ceil(pos y) <= -350 && ceil(pos y) > -425
trigger1 = time = 0
var(14) = 200


; small Normal Jump
[state 650, damage set]
type = varset
trigger1 = ceil(pos y) <= 0 && ceil(pos y) > -350
trigger1 = time = 0
var(14) = 180

;-----------------------

[state 640, armor count down]
type = varadd
trigger1 = gethitvar(damage) != 0
V = 20
value = -1
persistent = 1

[state 650, still take damage]
type = lifeadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) != 0
value = floor(-gethitvar(damage)*0.75)
persistent = 1
ignorehitpause

[state 650, Unstoppable]
type = hitoverride
trigger1 = Life > 1
trigger1 = var(20) > 0
attr = SCA, AA, AP
stateno = 650
time = 1
persistent = 1
ignorehitpause

;[State -2, Super Jump Indicator]
;type = helper
;triggerall = !numhelper(4000)
;name = "WARNING"
;helpertype = normal
;trigger1 = time = 0
;trigger1 = pos y < -220
;persistent = 0
;stateno = 4000
;ID = 4000
;ownpal = 1

[State 650, flash red]
type = PalFX
trigger1 = Time = 0
trigger1 = gethitvar(damage) != 0
time = 7
add = 150,0,0
IgnoreHitPause = 1

[State 650, 3]
type = HitDef
trigger1 = !movecontact || !movereversed
trigger1 = !numtarget(800)
persistent = 0
attr = A, SA
damage    = ifelse(enemy,movetype = H,floor(var(14)*0.75),var(14)) ,floor(Var(14)*0.2)
guardflag = MA
hitflag = MAFD
id = 650
getpower = floor(var(14) * 0.75)
givepower = floor(var(14))
nochainid = 650,1400
priority = 4
pausetime = 0,0
sparkno = 3
sparkxy = 0,0
Hitsound = S5000, 2
guardsound = S120,0
animtype = heavy
ground.type = high
ground.slidetime = 22
ground.hittime  = 22
ground.velocity = 0
air.velocity = 0,0
down.hittime = 60
guard.velocity = -120            
guard.hittime = 45
guard.slidetime = 45
airguard.velocity = -30,10
airguard.hittime = 35
guard.cornerpush.veloff = -120
guard.dist = 640
fall.recovertime = 30


;determine what frame
[state 650, remember frame]
type = varset
trigger1 = time <= 0
v = 22
value = animelemno(0)
ignorehitpause = 1

;delay effect
[state 650, delay]
type = changeanim 
trigger1 = var(31) < floor(gethitvar(hittime)*0.8)
value = anim
elem = var(22)

[state 650, freeze location]
type = posfreeze
trigger1 = var(31) < floor(gethitvar(hittime)*0.8)
value = 1
;--------------------------

[state 650, enemy state]
type = targetstate
triggerall = vel y > 0
trigger1 = movehit
trigger1 = enemy,statetype != A
value = 660

;Ride down mechanic
[state 650, Ride down]
type = targetbind
trigger1 = movehit
trigger1 = enemy,statetype = A
pos = 0, -20

[state 650, state of ride down]
type = targetstate
trigger1 = movehit
trigger1 = enemy,statetype = A
value = 655
;----------------------------------------------

;[state 650, targetstate]
;type = targetstate
;trigger1 = movehit
;trigger1 = enemy,statetype = A
;trigger1 = var(8) > 0
;trigger1 = p2bodydist x >= 30
;trigger2 = movehit
;trigger2 = enemy,statetype != A
;trigger2 = var(8) > 0
;trigger2 = p2bodydist x>= 30
;ignorehitpause = 1
;value = 685

[state 650, limiter]
type = varadd
trigger1 = movehit
trigger1 = enemy,statetype = A
trigger1 = p2bodydist x >= 30
var(8) = -1
ignorehitpause = 1
persistent = 0


[state 650, aim]
type = veladd
triggerall = !movecontact
trigger1 = command = "holdfwd"
trigger1 = ailevel = 0
x = 0.3
persistent = 1

[state 650, aim]
type = veladd
triggerall = !movecontact
trigger1 = command = "holdback"
trigger1 = ailevel = 0
x = -0.3
persistent = 1

[state 650, gravity]
type = gravity
trigger1 = time > 3

[state 650, playerpush]
type = playerpush
trigger1 = 1
value = 0

[state 650, combo damage]
type = varadd
trigger1 = movehit
v = 18
value = -3

[state 650, end]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 651

;--------------------------------------------------------------------------
; 1st Landing
[statedef 651]
type    = C
movetype= A
physics = N

[state 651, anim]
type = changeanim
trigger1 = time = 0
value = 651

[state 651, Crater]
type = explod
trigger1 = time = 0
trigger1 = !numexplod(2030)
anim = 2030
id = 2030
pos = 0,0
scale = const(size.xscale)*1,const(size.yscale)*1
sprpriority = -4

[state 651, Rubble]
type = explod
trigger1 = time = 0
trigger1 = !numexplod(2035)
anim = 2035
id = 2035
pos = 0,0
scale = const(size.xscale)*1,const(size.yscale)*1
sprpriority = -3



;Custom Dust
[state 651, explod]
type = explod
trigger1 = time = 0
anim = 2000
pos = 30,0
scale = const(size.xscale)*3.5,const(size.yscale)*2.5
ontop = 1
ownpal = 1

[state 651, fx]
type = explod
trigger1 = time = 0
anim = F61
pos = 0,0
scale = 8,4
ownpal = 1


[state 651, explod]
type = explod
trigger1 = time = 0
anim = 2001
pos = 30,0
scale =  const(size.xscale)*3.5,const(size.yscale)*2.5
sprpriority = -4
ownpal = 1
; -------------------

[state 651, snd]
type = playsnd
trigger1 = time = 0
value =S5100,0

[state 651, snd]
type = playsnd
trigger1 = time = 0
value =S5100,0

[state 651, pos]
type = posset
trigger1 = time = 0
y = 0

[state 651, playerpush]
type = playerpush
trigger1 = 1
value = 0

[State 651, 3]
type = HitDef
trigger1 = Time = 0
attr = A, NA
damage    = var(14) 
getpower = 120
guardflag = 
hitflag = FD
nochainid = 1400
priority = 4
pausetime = 12,12
sparkno = 1
sparkxy = -10,-40
hitsound   = 5,3
guardsound = S120,0
animtype = Med
p2stateno = 660
ground.type = High
ground.slidetime = 12
ground.hittime  = 15
ground.velocity = 0
air.velocity = 0,0

[state 651, vel]
type = velset
trigger1 = time = 0
y = 0
x = 0

[state 651, earthquakes]
type = envshake
trigger1 = time = 0
time = 24
ampl = -24
freq = 60
phase = 60

;[state 651, earthquakes]
;type = envshake
;trigger1 = time = 0
;trigger1 = var(15) = 1 
;time = 48
;ampl = -32
;freq = 75
;phase = 75


[state 651, end]
type = changestate
trigger1 = animtime = 0
value = 652

;--------------------------------------------------------------------------
;Bounce
[statedef 652]
type    = A
movetype= I
physics = N

[state 652, anim]
type = changeanim
trigger1 = time = 0
value = 652

[state 652, playerpush]
type = playerpush
trigger1 = 1
value = 0


[state 652, velset]
type = velset
trigger1 = time = 0
y = -12

[state 652, gravity]
type = gravity
trigger1 = time > 2

[state 652, end]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 653

;--------------------------------------------------------------------------
;Landing Rest
[statedef 653]
type    = C
movetype= I
physics = N

[state 653, anim]
type = changeanim
trigger1 = time = 0
value = 653

[state 653, posset]
type = posset
trigger1 = time = 0
y = 0

[state 653, playerpush]
type = playerpush
trigger1 = 1
value = 0


[state 653, velset]
type = velset
trigger1 = time = 0
y = 0
x = 0

[state 653, snd]
type = playsnd
trigger1 = time = 0
value =S5100,0

[state 653, earthquakes]
type = envshake
trigger1 = time = 0
time = 15
ampl = 12
freq = 100
phase = 100

[state 653, grind]
type = changestate
triggerall = animelemtime(5) >= 0  && animelemtime(5) < 8
triggerall = p2bodydist x = [-350,10]
triggerall = (numtarget(650)) || numtarget(1051) || numtarget(1061) || numtarget(1071)
trigger1 = command = "AddOn" 
trigger2 = ailevel
value = 654

[state 653, end]
type = changestate
trigger1 = animtime = 0
value = 656
 
;---------------------------------------------------------------------------
;Grind add on
[statedef 654]
type = C
movetype = A
physics = C
anim = 654

[state 654, nothitby]
type = nothitby
trigger1 = 1
value = SCA
ignorehitpause = 1

[state 654, targetstate]
type = targetstate
trigger1 = numtarget(650) || numtarget(1051) || numtarget(1061) || numtarget(1071)
trigger1 = time = 0
value = 661

;[state 654, targetlifeadd]
;type = lifeadd
;trigger1 = power >= 3000
;value = 1
;persistent = 6

[state 52, front foot front dust]
type = explod
trigger1 = animelemtime(3) >= 0 && animelemtime(5) < 0
trigger2 = animelemtime(8) >= 0 && animelemtime(11) < 0
anim = F120
pos = -320,-10
scale = 2, 2
vel = -2,-1
sprpriority = 4
persistent =3

[state 654, playsnd]
type = playsnd
trigger1 = animelemtime(3) = 0
trigger2 = animelemtime(8) = 8
value = S654,0




[state 654, targetlifeadd]
type = targetlifeadd
trigger1 = numtarget(650) || numtarget(1051) || numtarget(1061) || numtarget(1071)
value = floor(fvar(10)*-2)
persistent = 6

[state 654, poweradd]
type = poweradd
trigger1 = time < 60
trigger1 = power != powermax
persistent = 6
value = 50

[state 654, poweradd]
type = lifeadd
trigger1 = time < 60
persistent = 6
value = ifelse(power != powermax, 3, 6)

[state 654, poweradd]
type = targetpoweradd
trigger1 = time <  60
persistent = 6
value = 10

[state 654, end]
type = changestate
trigger1 = time > 80
value = 656

;---------------------------------------------------------------------------
;Rode down
[statedef 655]
type = A
movetype = H
physics = N

[state 655, anim]
type = changeanim2
trigger1 = time = 0
value = 655

[State 655, 2]
type = changeState
trigger1 = !gethitvar(isbound)
value = 660


;-----------| Butt recovery |----------------------------------------------
;Front Facing recovery
[statedef 656]
type = C
movetype = I
physics = C
velset = 0,0

[state 656, player push]
type = playerpush
trigger1 = 1
value = 0

[state 656, nothitby]
type = nothitby
trigger1 = prevstateno = 654
value = SCA
ignorehitpause = 1


[state 656, anim]
type = changeanim
trigger1 = time = 0
value = 656

[state 656, velset]
type = velset
trigger1 = animelem = 3
trigger2 = animelem = 4
x = -25

[state 656, posadd]
type = posadd
trigger1 = animelemtime(5) = 0
x = -80

[state 656, velset]
type = velset
trigger1 = animelem = 9
x = -40

[state 656, velset]
type = velset
trigger1 = animelemtime(4) = 11
x = 0

;[state 656, velset]
;type = velset
;trigger1 = animelem = 10
;trigger2 = animelem = 11
;x = -10

[state 656, end]
type = changestate
trigger1 = animtime = 0
ctrl = 1
value = 0

;-----------| Butt recovery |----------------------------------------------
;Back facing recovery
[statedef 657]
type = C
movetype = I
physics = C
velset = 0,0
sprpriority = -3

[state 657, nothitby]
type = nothitby
trigger1 = prevstateno = 1090
value = SCA
ignorehitpause = 1

[state 657, player push]
type = playerpush
trigger1 = 1
value = 0

[state 1067, Butt cheek]
type = explod
trigger1 = time = 0
anim = 6570
postype = p1
pos = 0,0
id = 657
bindtime = -1
removeongethit = 1
removetime = -2
sprpriority = 3
scale = const(size.xscale),const(size.yscale)

[state 657, sprpriority]
type = sprpriority
trigger1 = animelem = 2
value = 3
ignorehitpause = 1

[state 657, anim]
type = changeanim
trigger1 = time = 0
value = 657

[state 657, velset]
type = velset
trigger1 = animelem = 2
trigger2 = animelem = 3
x = -25

[state 657, posadd]
type = posadd
trigger1 = animelemtime(4) = 0
x = -80

[state 657, velset]
type = velset
trigger1 = animelem = 6
x = -40

[state 657, velset]
type = velset
trigger1 = animelemtime(4) = 8
x = 0

[state 657, end]
type = changestate
trigger1 = animtime = 0
ctrl = 1
value = 0





;===========================================================================
;---------------------------Crushed State-----------------------------------
;===========================================================================
; Initial Crushed state
[statedef 660]
type    = L
movetype= H
physics = N
ctrl = 0
velset = 0,0

[state 660, 1]
type = changeanim
trigger1 = time = 0
trigger1 = selfanimexist(5888) =0
value = 5110

[state 660, 1]
type = changeanim
trigger1 = time = 0
trigger1 = selfanimexist(5888) =1
value = 5888

[State 660, flatten]
type = AngleDraw
trigger1 = time > 0
trigger1 = anim != 5888
value = 0
scale = 1.3,0.1

[state 660, on ground]
type = posset
trigger1 = 1
y = 0

[state 660, passthrough]
type = playerpush
trigger1 = 1
value = 0
time = 600

[State 660, Width]
type = Width
trigger1 = time > 0
value = 0,0

[state 660, invunerable]
type = nothitby
trigger1 = 1
value = SCA



[State 660, 5]
type = PosSet
trigger1 = Time = 0
y = 0

[State 660, 7]
type = GameMakeAnim
trigger1 = Time = 0
trigger1 = !SysVar(0)
value = 60 + (sysvar(1) > 5) + (sysvar(1) > 14)
pos = 0, 0
under = sysvar(1) <= 10

[State 660, 8]
type = VelSet
trigger1 = Time = 0
y = 0


[State 660, 11] ;If just died
type = ChangeState
triggerall = !alive && p2stateno = 0 && roundstate = 3
trigger1 = AnimTime = 0 
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground frame
trigger3 = Anim = [5110,5119]
value = 5150

;[State 660, 12]
;type = VarSet
;trigger1 = SysVar(0)
;trigger1 = Time = 0
;sysvar(0) = 0

[State 660, 13] ;Friction
type = VelMul
trigger1 = 1
x = 0.85

[State 660, 14]
type = ForceFeedback
trigger1 = alive
trigger1 = Time = 0
time = 8
ampl = 240
waveform = sine

[State 660, 15]
type = ForceFeedback
trigger1 = !alive
trigger1 = Time = 0
ampl = 200, 7, -.467
time = 30
waveform = sine

[state 1108, nothitby]
type = nothitby
trigger1 = time = 130
value = SCA
time = 4

[State 660, get up]
type = selfstate
trigger1 = life >= 1
trigger1 = time > 130 ;95
value = 5120

[state 660, flat death]
type = changestate
trigger1 = !alive
trigger1 = time > 130
value = 5150

;---------------------------------------------------------------------------
;Grinded on Crush State
[statedef 661]
type    = L
movetype= H
physics = N
ctrl = 0
velset = 0,0

[state 661, 1]
type = changeanim2
trigger1 = time = 0
trigger1 = prevstateno != 660
value = 1081

[state 660, 1]
type = changeanim
trigger1 = time = 0
trigger1 = prevstateno = 660
value = 5110

[State 661, flatten]
type = AngleDraw
trigger1 = time > 0
value = 0
scale = 1.3,0.1

[state 661, on ground]
type = posset
trigger1 = 1
y = 0

[state 660, invunerable]
type = nothitby
trigger1 = 1
value = SCA

[state 661, passthrough]
type = playerpush
trigger1 = 1
value = 0
time = 600

[State 661, Width]
type = Width
trigger1 = time > 0
value = 0,0

[State 661, 5]
type = PosSet
trigger1 = Time = 0
y = 0

;[State 661, Var] ;Get fall velocity
;type = VarSet
;trigger1 = Time = 0
;trigger1 = GetHitVar(fall.yvel) != 0
;sysvar(1) = floor(vel y)

;[State 661, 6]
;type = PlaySnd
;trigger1 = Time = 0
;trigger1 = !SysVar(0)
;value = F7, 0 ;Hit ground
;value = F7, (sysvar(1) > 5) + (sysvar(1) > 14)
;persistent = 0

[State 661, 7]
type = GameMakeAnim
trigger1 = Time = 0
trigger1 = !SysVar(0)
value = 60 + (sysvar(1) > 5) + (sysvar(1) > 14)
pos = 0, 0
under = sysvar(1) <= 10

[State 661, 8]
type = VelSet
trigger1 = Time = 0
y = 0

[State 661, 13] ;Friction
type = VelMul
trigger1 = 1
x = 0.85

[State 661, 14]
type = ForceFeedback
trigger1 = alive
trigger1 = Time = 0
time = 8
ampl = 240
waveform = sine

[state 1108, nothitby]
type = nothitby
trigger1 = time = 130
value = SCA
time = 4

[State 661, 15]
type = ForceFeedback
trigger1 = !alive
trigger1 = Time = 0
ampl = 200, 7, -.467
time = 30
waveform = sine

[State 661, get up]
type = selfstate
trigger1 = life >= 1
trigger1 = time > 130
value = 5120

[state 660, flat death]
type = changestate
trigger1 = !alive
trigger1 = time > 130
value = 5150

;---------------------------------------------------------------------------
;Grinded on FAce crush state
[statedef 662]
type    = L
movetype= H
physics = N
ctrl = 0
velset = 0,0

[state 661, 1]
type = changeanim2
trigger1 = time = 0
trigger1 = prevstateno != 660
value = 1081

[state 660, 1]
type = changeanim
trigger1 = time = 0
trigger1 = prevstateno = 660
value = 5110

[State 661, flatten]
type = AngleDraw
trigger1 = time > 0
value = 0
scale = 1.3,0.1

[state 661, on ground]
type = posset
trigger1 = 1
y = 0

[state 660, invunerable]
type = nothitby
trigger1 = 1
value = SCA

[state 661, passthrough]
type = playerpush
trigger1 = 1
value = 0
time = 600

[State 661, Width]
type = Width
trigger1 = time > 0
value = 0,0

[State 661, 5]
type = PosSet
trigger1 = Time = 0
y = 0

;[State 661, Var] ;Get fall velocity
;type = VarSet
;trigger1 = Time = 0
;trigger1 = GetHitVar(fall.yvel) != 0
;sysvar(1) = floor(vel y)

;[State 661, 6]
;type = PlaySnd
;trigger1 = Time = 0
;trigger1 = !SysVar(0)
;value = F7, 0 ;Hit ground
;value = F7, (sysvar(1) > 5) + (sysvar(1) > 14)
;persistent = 0

[State 661, 7]
type = GameMakeAnim
trigger1 = Time = 0
trigger1 = !SysVar(0)
value = 60 + (sysvar(1) > 5) + (sysvar(1) > 14)
pos = 0, 0
under = sysvar(1) <= 10

[State 661, 8]
type = VelSet
trigger1 = Time = 0
y = 0

[State 661, 13] ;Friction
type = VelMul
trigger1 = 1
x = 0.85

[State 661, 14]
type = ForceFeedback
trigger1 = alive
trigger1 = Time = 0
time = 8
ampl = 240
waveform = sine

[state 1108, nothitby]
type = nothitby
trigger1 = time = 130
value = SCA
time = 4

[State 661, 15]
type = ForceFeedback
trigger1 = !alive
trigger1 = Time = 0
ampl = 200, 7, -.467
time = 30
waveform = sine

[State 661, get up]
type = selfstate
trigger1 = life >= 1
trigger1 = time > 130
value = 5120

[state 660, flat death]
type = changestate
trigger1 = !alive
trigger1 = time > 130
value = 5150

;---------------------------------------------------------------------------
;brief crush state
[statedef 663]
type    = L
movetype= H
physics = N
ctrl = 0
velset = 0,0

[state 663, 1]
type = changeanim
trigger1 = time = 0
value = 5110

[State 663, flatten]
type = AngleDraw
trigger1 = time > 0
value = 0
scale = 1.3,0.1

[state 663, on ground]
type = posset
trigger1 = 1
y = 0

[state 663, passthrough]
type = playerpush
trigger1 = 1
value = 0
time = 600

[State 663, Width]
type = Width
trigger1 = time > 0
value = 0,0

[state 663, invunerable]
type = nothitby
trigger1 = 1
value = SCA

[State 663, 5]
type = PosSet
trigger1 = Time = 0
y = 0

[State 663, 8]
type = VelSet
trigger1 = Time = 0
y = 0


[State 660, 14]
type = ForceFeedback
trigger1 = alive
trigger1 = Time = 0
time = 8
ampl = 240
waveform = sine

[State 660, 15]
type = ForceFeedback
trigger1 = !alive
trigger1 = Time = 0
ampl = 200, 7, -.467
time = 30
waveform = sine

[state 1108, nothitby]
type = nothitby
trigger1 = time = 80
value = SCA
time = 4

[State 660, get up]
type = selfstate
trigger1 = life >= 1
trigger1 = time > 80 ;95
value = 5120

[state 660, flat death]
type = changestate
trigger1 = !alive
trigger1 = time > 80
value = 5150

;---------------------------------------------------------------------------
;Super Laydown and wait for it
[statedef 665]
type    = L
movetype= H
physics = N
ctrl = 0
velset = 0,0

[state 665, 1]
type = changeanim
trigger1 = time = 0
value = 5110

[State 665, flatten]
type = AngleDraw
trigger1 = time > 0  && time <40
value = 0
scale = 1.2,0.25

[state 665, on ground]
type = posset
trigger1 = 1
y = 0

[state 665, passthrough]
type = playerpush
trigger1 = 1
value = 0


[State 665, Width]
type = Width
trigger1 = time > 0
value = 0,0

[State 665, 5]
type = PosSet
trigger1 = Time = 0
y = 0

;[State 661, Var] ;Get fall velocity
;type = VarSet
;trigger1 = Time = 0
;trigger1 = GetHitVar(fall.yvel) != 0
;sysvar(1) = floor(vel y)

;[State 665, 6]
;type = PlaySnd
;trigger1 = Time = 0
;trigger1 = !SysVar(0)
;value = F7, 0 ;Hit ground
;value = F7, (sysvar(1) > 5) + (sysvar(1) > 14)
;persistent = 0

[State 665, 7]
type = GameMakeAnim
trigger1 = Time = 0
trigger1 = !SysVar(0)
value = 60 + (sysvar(1) > 5) + (sysvar(1) > 14)
pos = 0, 0
under = sysvar(1) <= 10

[State 665, 8]
type = VelSet
trigger1 = Time = 0
y = 0

[State 665, 9] ;For hit up type
type = ChangeAnim
persistent = 0
triggerall = anim = [5171,5179]
triggerall = SelfAnimExist(5110 + (anim % 10))
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground anim
value = 5110 + (anim % 10)

[State 665, 10] ;For normal
type = ChangeAnim
persistent = 0
triggerall = Anim != [5111,5119]
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground frame
value = 5110

[State 665, 11] ;If just died
type = ChangeState
triggerall = !alive && p2stateno = 0 && roundstate = 3
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground frame
trigger3 = Anim = [5110,5119]
value = 5150

;[State 661, 12]
;type = VarSet
;trigger1 = SysVar(0)
;trigger1 = Time = 0
;sysvar(0) = 0

[State 665, 13] ;Friction
type = VelMul
trigger1 = 1
x = 0.85

[State 665, 14]
type = ForceFeedback
trigger1 = alive
trigger1 = Time = 0
time = 8
ampl = 240
waveform = sine

[State 665, 15]
type = ForceFeedback
trigger1 = !alive
trigger1 = Time = 0
ampl = 200, 7, -.467
time = 30
waveform = sine

[state 665, hitby]
type = Nothitby
trigger1 = time < 185
value = SCA
ignorehitpause = 1

[State 665, get up]
type = selfstate
trigger1 = life >= 1
trigger1 = time > 300
value = 5120

[state 660, flat death]
type = changestate
trigger1 = !alive
trigger1 = time > 40
value = 5150
;---------------------------------------------------------------------------
;---------------------------------------------------------------------------
;===========================================================================
;------------------------------Wall Bounce State
;===========================================================================
[statedef 670]
type = A
movetype = H
physics = N

[State 672, Stop moving]
type = PosFreeze
trigger1 = 1
x = 1
y = 1

[state 670]
type = changeanim
trigger1 = time = 0
value = 5030
ignorehitpause = 1

[state 670, changestate]
type = changestate
trigger1 = hitshakeover
value = 671
;------------------------------------------------------------------------

[statedef 671]
type    = A
movetype= H
physics = N

[state 671, anim]
type = changeanim
trigger1 = anim != 5030
value = 5030

[State 670, Velocity]
type = velset
trigger1 = Time = 0
x = facing * gethitvar(xvel)
y = gethitvar(yvel)

[State 670, Gravity]
type = veladd
trigger1 = 1
y = 1.05

;[State 670, No scroll]
;type = ScreenBound
;triggerall = Pos y < -15
;trigger1 = BackEdgeBodyDist < 65
;trigger2 = FrontEdgeBodyDist < 65
;value = 1
;movecamera = 0,1

[State 670, Hit wall]
type = ChangeState
triggerall = Pos y < 0
trigger1 = BackEdgeBodyDist <= 20
trigger2 = FrontEdgeBodyDist <= 20
value = 672

[State 670, Hit ground]
type = SelfState
trigger1 = (Vel y > 0) && (Pos y >= 0)
value = 5100

;---------------------------------------------------------------------------
;Hit wall - part 2 bounce off wall
[statedef 672]
type    = A
movetype= H
physics = N

[State 672, Turn]
type = Turn
trigger1 = (Time = 0) && (FrontEdgeBodyDist <= 30)

[State 672, Pos]
type = PosAdd
trigger1 = Time = 0
x = 15 - BackEdgeBodyDist

[State 672, Stop moving]
type = PosFreeze
trigger1 = 1
x = 1
y = 1

[State 672, No scroll]
type = ScreenBound
trigger1 = 1
value = 1
movecamera = 0,1

[State 672, Spark]
type = Explod
trigger1 = Time = 1
anim = F72
pos = 0,const(size.mid.pos.y)
postype = p1
sprpriority = 3
ownpal = 1

[state 672, anim]
type = changeanim
trigger1 = anim != 5030
value = 5030

[State 672, Sound]
type = PlaySnd
trigger1 = Time = 1
value = F7,0

[State 672, State]
type = ChangeState
trigger1 = time = 10
value = 673
;--------------------------------------------------------------------------
;wall bounce - part 3 fall toward ground
[Statedef 673]
type    = A
movetype= H
physics = N

[State 673, Vel Y]
type = VelSet
trigger1 = Time = 0
y = -18

[State 673, Vel X]
type = VelSet
trigger1 = Time = 0
x = ceil(abs(p2dist x *0.02))

[State 673, Turn]
type = Turn
trigger1 = (Time = 0) && (BackEdgeDist < 30)

[State 672, Gravity]
type = VelAdd
trigger1 = 1
y = 1.05

;[state 673, gravity]
;type = gravity
;trigger1 = 1

[State 673, Anim 5050] ;Self falling animation
type = ChangeAnim
trigger1 = Time = 0
trigger1 = !SelfAnimExist(5052)
value = 5050

[State 673, Anim 5052] ;Self falling animation (diagup type)
type = ChangeAnim
trigger1 = Time = 0
trigger1 = SelfAnimExist(5052)
value = 5052

[State 673, Anim 5060] ;Coming down - normal
type = ChangeAnim
trigger1 = Vel Y > -2
trigger1 = Anim = 5050
trigger1 = SelfAnimExist(5060)
persistent = 0
value = 5060

[State 673, Anim 5062] ;Coming down - diagup type
type = ChangeAnim
trigger1 = Vel Y > -2
trigger1 = Anim = 5052
trigger1 = SelfAnimExist(5062)
persistent = 0
value = 5062

[State 673, Hit ground]
type = SelfState
trigger1 = (Vel y > 0) && (Pos y >= 0)
value = 5100

;============================================================================
; Neutral Wall Bounce
;============================================================================
[statedef 675]
type = A
movetype = H
physics = N

[State 675, Stop moving]
type = PosFreeze
trigger1 = 1
x = 1
y = 1

[state 675]
type = changeanim
trigger1 = time = 0
value = 5030
ignorehitpause = 1

[state 675, changestate]
type = changestate
trigger1 = hitshakeover
value = 676
;------------------------------------------------------------------------

[statedef 676]
type    = A
movetype= H
physics = N

[state 676, anim]
type = changeanim
trigger1 = anim != 5030
value = 5030

[State 676, Velocity]
type = velset
trigger1 = Time = 0
x = facing * gethitvar(xvel)
y = gethitvar(yvel)

[State 676, Gravity]
type = gravity
trigger1 = 1


;[State 670, No scroll]
;type = ScreenBound
;triggerall = Pos y < -15
;trigger1 = BackEdgeBodyDist < 65
;trigger2 = FrontEdgeBodyDist < 65
;value = 1
;movecamera = 0,1

[State 676, Hit wall]
type = ChangeState
triggerall = Pos y < 0
trigger1 = BackEdgeBodyDist <= 20
trigger2 = FrontEdgeBodyDist <= 20
value = 677

[State 676, Hit ground]
type = SelfState
trigger1 = (Vel y > 0) && (Pos y >= 0)
value = 5100

;---------------------------------------------------------------------------
;Hit wall - part 2 bounce off wall
[statedef 677]
type    = A
movetype= H
physics = N

[State 677, Turn]
type = Turn
trigger1 = (Time = 0) && (FrontEdgeBodyDist <= 30)

[State 677, Pos]
type = PosAdd
trigger1 = Time = 0
x = 15 - BackEdgeBodyDist

[State 677, Stop moving]
type = PosFreeze
trigger1 = 1
x = 1
y = 1

[State 677, No scroll]
type = ScreenBound
trigger1 = 1
value = 1
movecamera = 0,1

[State 677, Spark]
type = Explod
trigger1 = Time = 1
anim = F72
pos = 0,const(size.mid.pos.y)
postype = p1
sprpriority = 3
ownpal = 1

[state 677, anim]
type = changeanim
trigger1 = anim != 5030
value = 5030

[State 677, Sound]
type = PlaySnd
trigger1 = Time = 1
value = F7,0

[State 677, State]
type = ChangeState
trigger1 = time = 10
value = 678
;--------------------------------------------------------------------------
;wall bounce - part 3 fall toward ground
[Statedef 678]
type    = A
movetype= H
physics = N

[State 678, Vel Y]
type = VelSet
trigger1 = Time = 0
y = -12

[State 678, Vel X]
type = VelSet
trigger1 = Time = 0
x = 4

[State 678, Turn]
type = Turn
trigger1 = (Time = 0) && (BackEdgeDist < 30)

[State 672, Gravity]
type = gravity
trigger1 = 1


;[state 678, gravity]
;type = gravity
;trigger1 = 1

[State 678, Anim 5050] ;Self falling animation
type = ChangeAnim
trigger1 = Time = 0
trigger1 = !SelfAnimExist(5052)
value = 5050

[State 678, Anim 5052] ;Self falling animation (diagup type)
type = ChangeAnim
trigger1 = Time = 0
trigger1 = SelfAnimExist(5052)
value = 5052

[State 678, Anim 5060] ;Coming down - normal
type = ChangeAnim
trigger1 = Vel Y > -2
trigger1 = Anim = 5050
trigger1 = SelfAnimExist(5060)
persistent = 0
value = 5060

[State 678, Anim 5062] ;Coming down - diagup type
type = ChangeAnim
trigger1 = Vel Y > -2
trigger1 = Anim = 5052
trigger1 = SelfAnimExist(5062)
persistent = 0
value = 5062

[State 678, Hit ground]
type = SelfState
trigger1 = (Vel y > 0) && (Pos y >= 0)
value = 5100

;-----------------------------------------------------------------------------
;Ground Bounce
;-----------------------------------------------------------------------------
;Hit Freeze small
[statedef 680]
type = A
movetype = H
physics = N

[State 680, Stop moving]
type = PosFreeze
trigger1 = 1
x = 1
y = 1

[state 680, posadd]
type = posadd
trigger1 = time = 0
y = -20

[state 680]
type = changeanim
trigger1 = time = 0
value = 5035
ignorehitpause = 1

[state 680, changestate]
type = changestate
trigger1 = hitshakeover
value = 681

;-----------------------------------------------------------------------------
;Soft Ground bounce - Going down
[statedef 681]
;Custom Hit state, ground bounce
type = A
movetype = H
physics = N


[state 681, velocity]
type = velset ;hitvelset
trigger1 = time = 0
y = 60

[state 681, anim]
type = changeanim
trigger1 = time = 0
value = 5061


[state 681, stop x]
type = velmul
trigger1 = time = 0
x = 0.25


[state 681]
type = veladd
trigger1 = 1
y = 1.05

[state 681, changestate]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 682

;-----------------------------------------------------------------------------
;Ground Bounce - Impact / bouncing
[statedef 682]
type = A
movetype = H
physics = N
anim = 5100

[state 682, impact]
type = velset
trigger1 = time = 0
y = 0
x = 0

[State 682, 8]
type = Explod
trigger1 = Time = 0
anim = F62 
pos = 0, 0
ontop = 1
scale = 1.7, 0.5
persistent = 0
ownpal = 1
persistent = 0

[State 682, 10]
type = PlaySnd
trigger1 = Time = 0
value = F7,2
persistent = 0

[state 682, shake]
type = envshake
trigger1 = time = 0
ampl = 5
freq = 50
phase = 50
time = 10
persistent = 0

[state 682, impact 2]
type = posset
trigger1 = time = 0
y = 0

[state 682, end]
type = changestate
trigger1 = animtime = 0
value = 683
;-----------------------------------------------
[statedef 683]
type = A
movetype = H
physics = N
anim = 5160

[state 683, bounce]
type = velset
trigger1 = time = 1
y = -32

[state 683, gravity]
type = veladd
trigger1 = time > 1
y = 1.05

[state 683, down]
type = selfstate
trigger1 = time >= 2 
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 5110
;--------------------------------------------------------------------------


;Hit Freeze big
[statedef 685]
type = A
movetype = H
physics = N

[State 685, Stop moving]
type = PosFreeze
trigger1 = 1
x = 1
y = 1

[state 685]
type = changeanim
trigger1 = time = 0
value = 5030
ignorehitpause = 1

[state 685, changestate]
type = changestate
trigger1 = hitshakeover
value = 686
;---------------------------------------------------------------------------
;Hard Ground bounce - going down
[statedef 686]
;Custom Hit state, ground bounce
type = A
movetype = H
physics = N


[state 686, anim]
type = changeanim
trigger1 = time = 0
value = 5160

[state 686, velocity]
type = hitvelset
trigger1 = time = 0
y = 60
x = -8


[state 686, stop x]
type = velmul
trigger1 = time = 0
x = 0


[state 686]
type = veladd
trigger1 = 1
y = 1.05

[state 686, changestate]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 687

;-----------------------------------------------------------------------------
;Hard Ground Bounce - Impact/bounce
[statedef 687]
type = A
movetype = H
physics = N
anim = 5160

[state 687, impact]
type = velset
trigger1 = time = 0
y = 0

[State 687, 8]
type = Explod
trigger1 = Time = 0
anim = F62 
pos = 0, 0
ontop = 1
scale = 2, 1
persistent = 0
ownpal = 1

[State 687, 10]
type = PlaySnd
trigger1 = Time = 0
value = F7,2
persistent = 0

[state 687, shake]
type = envshake
trigger1 = time = 0
ampl = 5
freq = 50
phase = 50
time = 10

[state 687, impact 2]
type = posset
trigger1 = time = 0
y = 0

[state 687, bounce]
type = velset
trigger1 = time = 1
y = -20

[state 687, gravity]
type = veladd
trigger1 = time > 1
y = 1.05

[state 687, down]
type = selfstate
trigger1 = time >= 2 
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 5100

;---------------------------------------------------------------------------



;---------------------------------------------------------------------------
;Jumba Hip Toss - Normal version
[Statedef 800]
type    = S
movetype= A
physics = S
juggle  = 0
velset = 0,0
ctrl = 0
anim = 800
sprpriority = -2


[State 800, 1]
type = HitDef
triggerall = p2movetype != A
Trigger1 = Time = 0
attr = S, NT         
hitflag = M-          
priority = 1, Miss    
sparkno = -1          
p1sprpriority = 1     
id = 800                      
p1facing = 1
p2facing = 1          
p1stateno = 810       
p2stateno = 820       
guard.dist = 0        
fall = 1              
fall.yvelocity = -24
fall.recover = 0

[State 800, 1]
type = HitDef
triggerall = p2movetype = A
Trigger1 = Time = 0
attr = S, NT         
hitflag = M-          
priority = 1, Miss    
sparkno = -1          
p1sprpriority = 1     
id = 800                      
p1facing = 1
p2facing = 1          
p1stateno = 810       
p2stateno = 822       
guard.dist = 0        
fall = 1              
fall.yvelocity = -24
fall.recover = 0


[State 800, 2]
type = ChangeState
Trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
;Jumba Hip Toss - Comboed version
[Statedef 801]
type    = S
movetype= A
physics = S
juggle  = 0
velset = 0,0
ctrl = 0
anim = 801
sprpriority = -2


[State 800, 1]
type = HitDef
Trigger1 = Time = 0
attr = S, NT         
hitflag = MA
guardflag = MA          
priority = 1, Miss    
sparkno = -1          
p1sprpriority = 1                          
p1facing = 1
p2facing = 1          
p1stateno = 811       
p2stateno = 820       
guard.dist = 0        
fall = 1              
fall.yvelocity = -24
fall.recover = 0


[State 800, 2]
type = ChangeState
Trigger1 = AnimTime = 0
value = 0
ctrl = 1
;---------------------------------------------------------------------------
;Grab Escape - p2
[statedef 805]
type = A
movetype = H
physics = S
ctrl = 0
facep2 = 1
sprpriority = 4

[state 805, anim]
type = changeanim
trigger1 = time = 0
trigger1 = SelfAnimExist(805)
value = 805

[state 805, anim]
type = changeanim
trigger1 = time = 0
trigger1 = !selfanimexist(805)
value = 120

;[state 1400, dim]
;type = bgpalfx
;trigger1 = time = 0
;time = 8
;mul = 200,200,200

;[state 805, freeze]
;type = pause
;trigger1 = time = 0
;time = 8
;endcmdbuftime = 8

;[state 805, sound]
;type = playsnd
;trigger1 = time = 0
;value = S805,0

[state 805, pos y]
type = posset
trigger1 = time = 0
y = 0

[state 805, velset]
type = velset
trigger1 = time = 10
x= -32

[state 805, nothitby]
type = nothitby
trigger1 = 1
value = SCA

[state 805, end]
type = selfstate
trigger1 = time = 35
value = 0
ctrl = 1

;---------------------------------------------------------------------------
;Grab Escape - p1
[statedef 806]
type = A
movetype = H
physics = S
ctrl = 0

[state 805, anim]
type = changeanim
trigger1 = time = 0
trigger1 = SelfAnimExist(130)
value = 130

[state 805, anim]
type = changeanim
trigger1 = time = 0
trigger1 = !selfanimexist(805)
value = 130

[state 1400, dim]
type = bgpalfx
trigger1 = time = 0
time = 8
mul = 200,200,200

[state 805, freeze]
type = pause
trigger1 = time = 0
time = 12
endcmdbuftime = 8

[state 805, sound]
type = playsnd
trigger1 = time = 0
value = S805,0

[state 805, pos y]
type = posset
trigger1 = time = 0
y = 0

[state 805, turn]
type = turn
trigger1 = prevstateno = 820
trigger1 = time = 0
persistent = 0
ignorehitpause

[state 805, velset]
type = velset
trigger1 = time = 10
x= -32

[state 805, nothitby]
type = nothitby
trigger1 = 1
value = SCA

[state 805, end]
type = selfstate
trigger1 = time = 35
value = 0
ctrl = 1


;---------------------------------------------------------------------------
;Hip Toss - Normal Version
[Statedef 810]
type    = S
movetype= A
physics = N
anim = 810
poweradd = 0


[state 810, tech]
type = changestate
triggerall = numtarget
trigger1 = target(800),stateno = 805
value = 806
persistent = 1

[State 810, Holding fwd?]
type = VarSet
trigger1 = Time = 0
var(2) = command = "holdback"

[State 810, Grab Sound]
type = PlaySnd
trigger1 = time = 0
value = 1, 1

[State 810, Width]
type = Width
trigger1 = 1
edge = 300,300

[State 810, Throw Sound]
type = PlaySnd
trigger1 = AnimElem = 7
value = 800, 0

;====================================
;  Grab Positioning
;====================================
[State 810, Bind 1]
type = TargetBind
trigger1 = AnimElemTime(2) < 0
pos = 230, -500

[State 810, Bind 2]
type = TargetBind
trigger1 = AnimElemTime(2) >= 0 && AnimElemTime(3) < 0
pos = -180, -520

[State 810, Bind 3]
type = TargetBind
trigger1 = AnimElemTime(3) >= 0 && AnimElemTime(4) < 0
pos = -250, -550

[State 810, Bind 4]
type = TargetBind
trigger1 = AnimElemTime(4) >= 0 && AnimElemTime(5) < 0
pos = -280, -530

[State 810, Bind 5]
type = TargetBind
trigger1 = AnimElemTime(5) >= 0 && AnimElemTime(6) < 0
pos = -160, -540

[State 810, Bind 6]
type = TargetBind
trigger1 = AnimElemTime(6) >= 0 && AnimElemTime(7) < 0
pos = 20, -700

[State 810, Bind 7]
type = TargetBind
trigger1 = AnimElemTime(7) >= 0 && AnimElemTime(8) < 0
pos = 150, -720

[State 810, Bind 8]
type = TargetBind
trigger1 = AnimElemTime(8) >= 0 && AnimElemTime(9) < 0
pos = 500, -600

[State 810, Bind 9]
type = TargetBind
trigger1 = AnimElemTime(9) >= 0 && AnimElemTime(10) < 0
pos = 380, -10

;[State 810, Bind 10]
;type = TargetBind
;trigger1 = AnimElemTime(10) >= 0 && AnimElemTime(11) < 0
;pos = -56, -360

;=========================================
;End Positioning
;=========================================

[State 810, holdfwd - Turn 2] ;If was holding fwd before, turn now
type = Turn
trigger1 = var(2)
trigger1 = AnimElem = 2

[State 810, holdfwd - Pos 2] ;If was holding fwd before, move a little
type = PosAdd
trigger1 = var(2)
trigger1 = AnimElem = 2
x = -148

[State 810, holdfwd - Turn Target 2] ;If was holding fwd before, turn target too
type = TargetFacing
trigger1 = var(2)
trigger1 = AnimElem = 2
value = -1

;------------------------------
[State 52, 4]
type = EnvShake
trigger1 = animelem = 10
time = 21
ampl = -12
freq = 80
phase = 80

[state 52, 4]
type = playsnd
trigger1 = animelem = 10
value = S5100,0

[state 810, sprpriority]
type = sprPriority
trigger1 = animelem = 8
value = 3

;--------------------------------

[state 651, explod]
type = explod
trigger1 = animelem = 10
anim = 2000
pos = 380,0
scale = const(size.xscale)*2.5,const(size.yscale)*2
ontop = 1
ownpal = 1

[state 651, fx]
type = explod
trigger1 = animelem = 10
anim = F61
pos = 380,0
scale = 4,2
ownpal = 1


[state 651, explod]
type = explod
trigger1 = animelem = 10
anim = 2001
pos = 380,0
scale =  const(size.xscale)*2.5,const(size.yscale)*2
sprpriority = -4
ownpal = 1
; -------------------



[State 810, Hurt 11]
type = TargetLifeAdd
trigger1 = AnimElem = 9
value = -140

[state 810, Poweradd]
type = targetpoweradd
trigger1 = time = 0
value = (enemynear,powermax / 1000) * 23 


[State 810, Throw 11]
type = TargetState
trigger1 = AnimElemtime(9) = 1
value = 821

[State 810, Turn 12]
type = Turn
trigger1 = AnimElem = 12

[State 810, Pos 15]
type = PosAdd
trigger1 = AnimElem = 15
x = -40

[state x, combo damage score]
type = varadd
trigger1 = animtime = 0
v = 18
value = -18
persistent = 0
ignorehitpause = 1

[State 810, State End]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
;Hip Toss - Comboed Version
[Statedef 811]
type    = S
movetype= A
physics = N
anim = 810
poweradd = 0

; Here a variable, var(2), is used to remember whether or not the
; player was holding forward at the start of the state. This variable
; is checked later on to turn KFM around if necessary.
[State 810, Holding fwd?]
type = VarSet
trigger1 = Time = 0
var(2) = 1

[State 810, Grab Sound]
type = PlaySnd
trigger1 = time = 0
value = 1, 1

[State 810, Width]
type = Width
trigger1 = 1
edge = 300,300

[State 810, Throw Sound]
type = PlaySnd
trigger1 = AnimElem = 7
value = 800, 0

;====================================
;  Grab Positioning
;====================================
[State 810, Bind 1]
type = TargetBind
trigger1 = AnimElemTime(2) < 0
pos = 220, -480

[State 810, Bind 2]
type = TargetBind
trigger1 = AnimElemTime(2) >= 0 && AnimElemTime(3) < 0
pos = -80, -480

[State 810, Bind 3]
type = TargetBind
trigger1 = AnimElemTime(3) >= 0 && AnimElemTime(4) < 0
pos = -110, -500

[State 810, Bind 4]
type = TargetBind
trigger1 = AnimElemTime(4) >= 0 && AnimElemTime(5) < 0
pos = -120, -530

[State 810, Bind 5]
type = TargetBind
trigger1 = AnimElemTime(5) >= 0 && AnimElemTime(6) < 0
pos = -60, -540

[State 810, Bind 6]
type = TargetBind
trigger1 = AnimElemTime(6) >= 0 && AnimElemTime(7) < 0
pos = 40, -550

[State 810, Bind 7]
type = TargetBind
trigger1 = AnimElemTime(7) >= 0 && AnimElemTime(8) < 0
pos = 140, -640

[State 811, Bind 8]
type = TargetBind
trigger1 = AnimElemTime(8) >= 0 && AnimElemTime(9) < 0
pos = 500, -600

[State 811, Bind 9]
type = TargetBind
trigger1 = AnimElemTime(9) >= 0 && AnimElemTime(10) < 0
pos = 320, -10

;[State 810, Bind 10]
;type = TargetBind
;trigger1 = AnimElemTime(10) >= 0 && AnimElemTime(11) < 0
;pos = -56, -360

;=========================================
;End Positioning
;=========================================

[State 811, holdfwd - Turn 2] ;If was holding fwd before, turn now
type = Turn
trigger1 = var(2)
trigger1 = AnimElem = 2

[State 811, holdfwd - Pos 2] ;If was holding fwd before, move a little
type = PosAdd
trigger1 = var(2)
trigger1 = AnimElem = 2
x = -148

[State 811, holdfwd - Turn Target 2] ;If was holding fwd before, turn target too
type = TargetFacing
trigger1 = var(2)
trigger1 = AnimElem = 2
value = -1

;------------------------------
[State 811, 4]
type = EnvShake
trigger1 = animelem = 10
time = 21
ampl = -12
freq = 80
phase = 80

[state 811, 4]
type = playsnd
trigger1 = animelem = 10
value = S5100,0

[state 811, sprpriority]
type = sprPriority
trigger1 = animelem = 8
value = 3

;--------------------------------

[state 651, explod]
type = explod
trigger1 = animelem = 10
anim = 2000
pos = 380,0
scale = const(size.xscale)*2.5,const(size.yscale)*2
ontop = 1
ownpal = 1

[state 651, fx]
type = explod
trigger1 = animelem = 10
anim = F61
pos = 380,0
scale = 4,2
ownpal = 1


[state 651, explod]
type = explod
trigger1 = animelem = 10
anim = 2001
pos = 380,0
scale =  const(size.xscale)*2.5,const(size.yscale)*2
sprpriority = -4
ownpal = 1
; -------------------



[State 811, Hurt 11]
type = TargetLifeAdd
trigger1 = AnimElem = 9
value = floor(fvar(10)*-80)

[State 811, Throw 11]
type = TargetState
trigger1 = AnimElemtime(9) = 1
value = 821

[State 811, Turn 12]
type = Turn
trigger1 = AnimElem = 12

[State 811, Pos 15]
type = PosAdd
trigger1 = AnimElem = 15
x = -40

[state x, combo damage score]
type = varadd
trigger1 = animtime = 0
v = 18
value = -27
persistent = 0
ignorehitpause = 1

[State 811, State End]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1



;---------------------------------------------------------------------------
;Techable Thrown
[Statedef 820]
type    = A
movetype= H
physics = N
velset = 0,0
sprpriority = 2

[state 820, screenbound]
type = screenbound
trigger1 = 1
value = 0
movecamera = 0,0

[state 820, tech throw]
type = changestate
triggerall = time < 12
triggerall = p2stateno != 801 
triggerall = p2stateno != 811
trigger1 = ailevel = 0
trigger1 = command = "holdfwd" || command = "holdback"
trigger1 = command = "y" || command = "b" || command = "z" || command = "c"
trigger2 = command = "x" && command = "a"
trigger3 = ailevel > 4 
trigger3 = random < (ailevel * ifelse(ailevel>7,1,3))
value = 805

[State 820, 1]
type = ChangeAnim2
Trigger1 = Time = 0
value = 820

[State 820, 2]
type = SelfState
trigger1 = !gethitvar(isbound)
value = 5050

;---------------------------------------------------------------------------
;Untechable Thrown

[Statedef 822]
type    = A
movetype= H
physics = N
velset = 0,0
sprpriority = 2

[state 820, screenbound]
type = screenbound
trigger1 = 1
value = 0
movecamera = 0,0

[State 820, 1]
type = ChangeAnim2
Trigger1 = Time = 0
value = 820

[State 820, 2]
type = SelfState
trigger1 = !gethitvar(isbound)
value = 5050

;---------------------------------------------------------------------------
;Thrown by Kung Fu Throw - thrown into the air
; (a custom gethit state)
; Description: This state has the opponent flying through the air and
;     falling down onto the ground. The SelfState controller sets the
;     opponent back using to his own state file when he his the ground.
;     Controllers 821,2 and 821,3 allow the opponent to recover by
;     hitting his recovery command when he is falling.
[Statedef 821]
type    = A
movetype= H
physics = N
velset = -10,2
poweradd = 40

[state 821, turn]
type = turn
trigger1 = time = 0


[State 821, 1] ;Gravity
type = VelAdd
Trigger1 = 1
y = 1.6

[State 821, 2] ; Recover near ground (use ChangeState)
type = ChangeState
triggerall = Vel Y > 0
triggerall = Pos Y >= -80
triggerall = alive
triggerall = CanRecover
trigger1 = Command = "recovery"
value = 5200 ;HITFALL_RECOVER

[State 821, 3] ; Recover in mid air (use SelfState)
type = SelfState
triggerall = Vel Y > 0
triggerall = alive
triggerall = CanRecover
trigger1 = Command = "recovery"
value = 5210 ;HITFALL_AIRRECOVER

[State 821, 4] ;Hit ground
type = changestate
trigger1 = Vel Y > 0
trigger1 = pos y > -vel y
value = 823 ;Hit ground

;-----------------------------------------------------------------------------
;Ground Bounce - Impact / bouncing
[statedef 823]
type = L
movetype = H
physics = N
anim = 5100

[state 823, impact]
type = velset
trigger1 = time = 0
y = 0
x = 0

[State 823, 8]
type = Explod
trigger1 = Time = 0
anim = F62 
pos = 0, 0
ontop = 1
scale = 1.7, 0.5
persistent = 0
ownpal = 1
persistent = 0

[State 823, 10]
type = PlaySnd
trigger1 = Time = 0
value = F7,2
persistent = 0

[state 823, shake]
type = envshake
trigger1 = time = 0
ampl = 5
freq = 50
phase = 50
time = 10
persistent = 0

[state 823, impact 2]
type = posset
trigger1 = time = 0
y = 0

[state 823, end]
type = changestate
trigger1 = time = 8
value = 824
;-----------------------------------------------
[statedef 824]
type = A
movetype = H
physics = N
anim = 5160

[state 824, bounce]
type = velset
trigger1 = time = 1
y = -15

[state 824, gravity]
type = veladd
trigger1 = time > 1
y = 1.05

[state 824, down]
type = selfstate
trigger1 = time >= 2 
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 5110
;--------------------------------------------------------------------------

;---------------------------------------------------------------------------
;Jumba Hip Toss - Normal version
[Statedef 830]
type    = A
movetype= A
physics = A
ctrl = 0
anim = 830
sprpriority = -2


[State 830, 1]
type = HitDef
triggerall = p2movetype != A
Trigger1 = var(37) > 0
attr = A, NT         
hitflag = A-          
priority = 1, Miss    
sparkno = -1          
p1sprpriority = 1     
id = 800                      
p1facing = 1
p2facing = 1          
p1stateno = 840       
p2stateno = 850       
guard.dist = 0        
fall = 1              
fall.yvelocity = -24
fall.recover = 0

[State 830, 1]
type = HitDef
triggerall = p2movetype = A
Trigger1 = var(37) > 0
attr = A, NT         
hitflag = A-          
priority = 1, Miss    
sparkno = -1          
p1sprpriority = 1     
id = 800                      
p1facing = 1
p2facing = 1          
p1stateno = 840       
p2stateno = 852       
guard.dist = 0        
fall = 1              
fall.yvelocity = -24
fall.recover = 0


[State 800, 2]
type = ChangeState
Trigger1 = AnimTime = 0
value = 50
ctrl = 1

;--------------------------------------------------------------------------
;Grab Escape - p2
[statedef 835]
type = A
movetype = H
physics = N
ctrl = 0

[state 835, playerpush]
type = playerpush
trigger1 = 1
value = 0

[state 835, posset]
type = posset
trigger1 = time = 0
y = enemynear,pos y 
persistent = 0
ignorehitpause = 1

[state 835, changeanim]
type = changeanim
trigger1 = time = 0
value = ifelse(animexist(46), 46, 43)

;[state 1400, dim]
;type = bgpalfx
;trigger1 = time = 0
;time = 8
;mul = 200,200,200

;[state 805, freeze]
;type = pause
;trigger1 = time = 0
;time = 8
;endcmdbuftime = 8

;[state 805, sound]
;type = playsnd
;trigger1 = time = 0
;value = S805,0

[state 835, targetfacing]
type = targetfacing
trigger1 = time = 0
value = -1
persistent = 1

[state 835, velset]
type = velset
trigger1 = time = 1
x= -12
y= -2

[state 835, gravity]
type = gravity
trigger1 = time > 0

[state 835, nothitby]
type = nothitby
trigger1 = 1
value = SCA

[state 835, end1]
type = selfstate
trigger1 = time >= 30
value = 50
ctrl = 1

[state 835, end]
type = selfstate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 52

;--------------------------------------------------------------------------
;Grab Escape - p1
[statedef 836]
type = A
movetype = H
physics = N
anim = 43
ctrl = 0

[state 836, anim]
type = changeanim
trigger1 = vel y > 5
trigger1 = anim != 46
value = 46

[state 836, targetbind]
type = targetbind
trigger1 = time = 0
pos = 300,0

[state 1400, dim]
type = bgpalfx
trigger1 = time = 0
time = 12
mul = 200,200,200

[state 805, freeze]
type = pause
trigger1 = time = 0
time = 12
endcmdbuftime = 8

[state 805, sound]
type = playsnd
trigger1 = time = 0
value = S805,0

[state 835, targetfacing]
type = targetfacing
trigger1 = time = 0
value = -1
persistent = 1

[state 835, velset]
type = velset
trigger1 = time = 1
x= -12
y= -2

[state 835, gravity]
type = veladd
trigger1 = time > 0
y = 1.25

[state 835, nothitby]
type = nothitby
trigger1 = 1
value = SCA

[state 835, end1]
type = selfstate
trigger1 = time >= 29
value = 50
ctrl = 1

[state 835, end]
type = selfstate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 52

;---------------------------------------------------------------------------
;Hip Toss - Normal Version
[Statedef 840]
type    = A
movetype= A
physics = N
anim = 840
poweradd = 0

[state 840, velmul]
type = velmul
trigger1 = time = 0
x = 0.1
y = 0.1

[state 840, limiter]
type = varadd
trigger1 = time = 0
var(37) = -1
ignorehitpause = 1
persistent = 0

[state 840, tech]
type = changestate
triggerall = numtarget
trigger1 = target(800),stateno = 835
value = 836
persistent = 1

[State 840, Holding fwd?]
type = VarSet
trigger1 = Time = 0
var(2) = command = "holdback"

[State 840, Grab Sound]
type = PlaySnd
trigger1 = time = 0
value = 1, 1

[State 840, Width]
type = Width
trigger1 = 1
edge = 300,300

[State 840, Throw Sound]
type = PlaySnd
trigger1 = AnimElem = 7
value = 800, 0

;====================================
;  Grab Positioning
;====================================
[State 840, Bind 1]
type = TargetBind
trigger1 = AnimElemTime(2) < 0
pos = 230, -500

[State 840, Bind 2]
type = TargetBind
trigger1 = AnimElemTime(2) >= 0 && AnimElemTime(3) < 0
pos = -180, -520

[State 840, Bind 3]
type = TargetBind
trigger1 = AnimElemTime(3) >= 0 && AnimElemTime(4) < 0
pos = -250, -550

[State 840, Bind 4]
type = TargetBind
trigger1 = AnimElemTime(4) >= 0 && AnimElemTime(5) < 0
pos = -280, -530

[State 840, Bind 5]
type = TargetBind
trigger1 = AnimElemTime(5) >= 0 && AnimElemTime(6) < 0
pos = -160, -540

[State 840, Bind 6]
type = TargetBind
trigger1 = AnimElemTime(6) >= 0 && AnimElemTime(7) < 0
pos = 20, -700

[State 840, Bind 7]
type = TargetBind
trigger1 = AnimElemTime(7) >= 0 
pos = 150, -720

[state 840, jump]
type = velset
trigger1 = animelemtime(5) = 0
x = 4
y = -20

[state 840, gravity]
type = veladd
trigger1 = animelemtime(5) > 0
y = 1.25

[state 840, spike]
type = veladd
trigger1 = animelemtime(7) = 0
y = 20
persistent = 0


;[State 810, Bind 10]
;type = TargetBind
;trigger1 = AnimElemTime(10) >= 0 && AnimElemTime(11) < 0
;pos = -56, -360

;=========================================
;End Positioning
;=========================================

[State 840, holdfwd - Turn 2] ;If was holding fwd before, turn now
type = Turn
trigger1 = var(2)
trigger1 = AnimElem = 2

[State 840, holdfwd - Pos 2] ;If was holding fwd before, move a little
type = PosAdd
trigger1 = var(2)
trigger1 = AnimElem = 2
x = -148

[State 840, holdfwd - Turn Target 2] ;If was holding fwd before, turn target too
type = TargetFacing
trigger1 = var(2)
trigger1 = AnimElem = 2
value = -1









[state 840, Poweradd]
type = targetpoweradd
trigger1 = time = 0
value = (enemynear,powermax / 1000) * 23 


[State 840, Turn 12]
type = Turn
trigger1 = AnimElem = 12

[State 840, Pos 15]
type = PosAdd
trigger1 = AnimElem = 15
x = -40

[State 840, State End]
type = ChangeState
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 841

;-----------------------------------------------------------------------------
;End of throw
[statedef 841]
type = S
movetype = A
physics = S
anim = 841

[state 841, targetstate]
type = targetstate
trigger1 = time = 0
value = 853
id = 800

[State 840, Bind 8]
type = TargetBind
trigger1 =  AnimElemTime(2) < 0
pos = 500, -600

[State 840, Bind 9]
type = TargetBind
trigger1 = AnimElemTime(2) >= 0 && AnimElemTime(2) < 1
pos = 380, -10

[State 840, Hurt 11]
type = TargetLifeAdd
trigger1 = AnimElemtime(2) = 1
value = ceil(fvar(10) * -150)

[State 840, Throw 11]
type = TargetState
trigger1 = AnimElemtime(2) = 1
value = 851

[state 841, velset]
type = velset
trigger1 = time = 0
x = 0
y = 0

[state 841, posset]
type = posset
trigger1 = time = 0
y = 0


[state 841, explod]
type = explod
trigger1 = animelem = 3
anim = 2000
pos = 380,0
scale = const(size.xscale)*2.5,const(size.yscale)*2
ontop = 1
ownpal = 1

[state 841, fx]
type = explod
trigger1 = animelem = 3
anim = F61
pos = 380,0
scale = 4,2
ownpal = 1

[state 841, explod]
type = explod
trigger1 = animelem = 3
anim = 2001
pos = 380,0
scale =  const(size.xscale)*2.5,const(size.yscale)*2
sprpriority = -4
ownpal = 1

[State 841, 4]
type = EnvShake
trigger1 = time = 0
time = 24
ampl = -18


[State 841, 4]
type = EnvShake
trigger1 = animelem = 3
time = 21
ampl = -12

[state 841, snd]
type = playsnd
trigger1 = time = 0
value = S20,0


[state 841, 4]
type = playsnd
trigger1 = animelem = 3
value = S5100,0

[state 841, sprpriority]
type = sprPriority
trigger1 = animelem = 1
value = 3

[state 841, combo scaling]
type = varadd
trigger1 = animtime = 0
var(18) = -18
ignorehitpause = 1
persistent = 0

[state 841, End]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
;Techable Thrown
[Statedef 850]
type    = A
movetype= H
physics = N
velset = 0,0
sprpriority = 2

[state 850, screenbound]
type = screenbound
trigger1 = 1
value = 0
movecamera = 0,0

[state 820, tech throw]
type = changestate
triggerall = time < 12
triggerall = p2stateno != 801 
triggerall = p2stateno != 811
trigger1 = ailevel = 0
trigger1 = command = "holdfwd" || command = "holdback"
trigger1 = command = "y" || command = "b" || command = "z" || command = "c"
trigger2 = command = "x" && command = "a"
trigger3 = ailevel > 4 
trigger3 = random < (ailevel * ifelse(ailevel>7,1,3))
value = 835

[State 820, 1]
type = ChangeAnim2
Trigger1 = Time = 0
value = 850

[State 820, 2]
type = SelfState
trigger1 = !gethitvar(isbound)
value = 5050

;---------------------------------------------------------------------------
;Untechable Thrown

[Statedef 852]
type    = A
movetype= H
physics = N
velset = 0,0
sprpriority = 2

[state 850, screenbound]
type = screenbound
trigger1 = 1
value = 0
movecamera = 0,0

[State 850, 1]
type = ChangeAnim2
Trigger1 = Time = 0
value = 850

[State 850, 2]
type = SelfState
trigger1 = !gethitvar(isbound)
value = 5050

;---------------------------------------------------------------------------
;Thrown by Kung Fu Throw - thrown into the air
; (a custom gethit state)
; Description: This state has the opponent flying through the air and
;     falling down onto the ground. The SelfState controller sets the
;     opponent back using to his own state file when he his the ground.
;     Controllers 821,2 and 821,3 allow the opponent to recover by
;     hitting his recovery command when he is falling.
[Statedef 851]
type    = A
movetype= H
physics = N
poweradd = 40

[state 851, posset]
type = posset
trigger1 = time = 0
y = 0

[state 851, velset]
type = velset
trigger1 = time = 0
x = 0
y = 0

[state 851, turn]
type = turn
trigger1 = time = 0

[state 851, changeanim]
type = changeanim
trigger1 = time = 0
value = 5100

[state 851, changeanim]
type = changeanim
trigger1 = time = 8
value = 5061

[state 851, selfstate]
type = velset
trigger1 = time = 8
y = -30

[state 851, selfstate]
type = selfstate
trigger1 = time = 9
value = 5050

[State 851, 1] ;Gravity
type = VelAdd
Trigger1 = time > 8
y = 0.8



[State 851, 4] ;Hit ground
type = SelfState
trigger1 = time > 8
trigger1 = Vel Y > 0
trigger1 = Pos Y >= 0
value = 5100 ;Hit ground
;---------------------------------------------------------------------------
[statedef 853]
type = A
movetype = H

[state 853, changeanim2]
type = changeanim2
trigger1 = time = 0
value = 851


;---------------------------------------------------------------------------
;Jumba Rush
[statedef 1000]
type = S
movetype = A
physics = S
ctrl = 0




;===========
;Armor start
;===========
[state 1000, animation]
type = changeanim
trigger1 = anim != 1000
value = 1000

[state 1000, poweradd]
type = poweradd
trigger1 = time = 0
trigger1 = var(21) = 1
value = 65
ignorehitpause = 1

[state 1000, armor counter]
type = varset
trigger1 = time = 0
trigger1 = Var(21) = 1
V = 20
value = 2

[state 1000, excess armor check]
type = varset
trigger1 = var(20) > 2
var(20) = 2
persistent = 1
ignorehitpause = 1

[state 1000, armor intiator turn off]
type = varset
trigger1 = time = 1
V = 21
value = 0

;determine what frame
[state 1000, remember frame]
type = varset
trigger1 = time <= 0
v = 22
value = animelemno(0)
ignorehitpause = 1

;delay effect
[state 1000, delay]
type = changeanim 
trigger1 = var(31) < floor(gethitvar(hittime)*0.8)
value = anim
elem = var(22)

[state 1000, freeze location]
type = posfreeze
trigger1 = var(31) < floor(gethitvar(hittime)*0.8)
value = 1
;--------------------------

[state 1000, still take damage]
type = lifeadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) != 0
value = floor(-gethitvar(damage)*0.75)
persistent = 1

[state 1000, armor count down]
type = varadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) > 0
V = 20
value = - 1
persistent = 1

[state 1000, Unstoppable]
type = hitoverride
trigger1 = Alive
trigger1 = Var(20) > 0
attr = SCA, AA, AP
stateno = 1000
time = 1
persistent = 1

[State 1000, flash red]
type = PalFX
trigger1 = Time = 0
trigger1 = gethitvar(damage) != 0
time = 7
add = 100,0,0
IgnoreHitPause = 1
;--------------------------------------------------------------------------------

[STATE 1002, nothitby]
type = nothitby
trigger1 = 1
value = ,NT

[State 1000, 1]
type = VelSet
trigger1 = 1
x = const(velocity.run.fwd.x)*1.15

[State 1000, Shockwave]
type = explod
anim = F61
trigger1 = animelemtime(4) = 0 
pos = 125, 0
scale = const(size.xscale),const(size.yscale)
persistent = 1

[State 1000, Shockwave]
type = explod
anim = F61
trigger1 = animelemtime(8) = 0 
pos = 85, 5
scale = const(size.xscale),const(size.yscale)
persistent = 1

[State 1000, 4]
type = EnvShake
trigger1 = animElemtime(4) = 0
trigger2 = animElemtime(8) = 0
time = 12
ampl = -18
freq = 80
phase = 80

[State 1000, footstep]
type = PlaySnd
trigger1 = AnimElemtime(4) = 0
trigger2 = animelemtime(8) = 0
value = S20,0

[state 100, no block]
type = assertspecial
trigger1 = var(20) != 10
flag = nostandguard
flag2 = nocrouchguard
ignorehitpause = 1


[State 100, 2] ;Prevent run from canceling into walk
type = AssertSpecial
trigger1 = 1
flag = NoWalk

[State 100, 3] ;Prevent from turning
type = AssertSpecial
trigger1 = 1
flag = NoAutoTurn

[state x, combo damage score]
type = varadd
trigger1 = time = 0
v = 18
value = -9
persistent = 0
ignorehitpause = 1

[State 100, 4]
type = ChangeState
trigger1 = time > 90
trigger2 = animelemtime(2) > 0
trigger2 = command = "x" || command = "holdback"
trigger2 = !ailevel
value = 1001

[State 100, 4]
type = ChangeState
trigger1 = animelemtime(2) > 0
trigger1 = command = "a"
trigger1 = !ailevel
value = 1002

[State 100, 4]
type = ChangeState
trigger1 = animelemtime(2) > 0
trigger1 = command = "b" || command = "holdb"
trigger1 = !ailevel
value = 1003

[State 100, 4]
type = ChangeState
trigger1 = animelemtime(2) > 0
trigger1 = command = "y" || command = "holdy"
trigger1 = !ailevel
value = 1006

;---------------------------------------------------------------------------
; Stop
[statedef 1001]
type = S
movetype = I
physics = S
anim = 1001

[state 52, front foot front dust]
type = explod
trigger1 = 1
anim = F120
pos = 440,0
scale = 2, 2
persistent = 4
sprpriority = 3

[state 1001, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1
;-----------------------------------------------------------------------------
;Slide
[statedef 1002]
type = C
movetype = A
physics = C
anim = 1002

;[state 1002, skid]
;type = statetypeset
;trigger1 = time = 0
;physics = C

[state 1002, veladd]
type = veladd
trigger1 = animelemtime(1) >= 0 && animelemtime(3) < 0
x = 3.28

[STATE 1002, nothitby]
type = nothitby
trigger1 = time < 12
value = ,AT


[state 1002, attackdist]
type = attackdist
trigger1 = 1
value = 430

[state 52, front foot front dust]
type = explod
trigger1 = animelemtime(2) > 0 && animelemtime(3) < 10
anim = F120
pos = 440,0
scale = 4, 4
persistent = 4
sprpriority = 3

[State 1002, 1]
type = HitDef
trigger1 = AnimElem = 2
attr = S, SA                    
damage = ifelse(enemynear,statetype != L,120,60),12                 
animtype = Heavy                
guardflag = L                   
hitflag = MAFD                   
priority = 3, Hit                
pausetime = 10, 10                
sparkno = 2                    
sparkxy = -40, -304              
hitsound = 5, 3                 
guardsound = S120,0                
ground.type = Trip               
ground.slidetime = 18             
ground.hittime  = 18             
ground.velocity = -12,-24           
airguard.velocity = -8,-20    
air.type = High    
down.velocity = -90,0              
air.velocity = -8,-16  
air.hittime = 30
guard.hittime = 14
guard.velocity = -18
guard.slidetime = 14
fall = 1
fall.recover = 0
fall.recovertime = 60 
guard.dist = 720 

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -3
persistent = 0
ignorehitpause = 1

[state 1002, Not Active]
type = statetypeset
trigger1 = animelemtime(3) = 0
movetype = I


[state 1002, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------

;Over head Stomp Rise
[statedef 1003]
type = A
movetype = A
physics = S
anim = 1003
ctrl = 0

[state 1002, skid]
type = velmul
trigger1 = time = 0
x = 0.5

[state 1002, skid]
type = statetypeset
trigger1 = animelemtime(3) = 0
physics = N
statetype = A

[state 1002, nothitby]
type = nothitby
trigger1 = time < 16
value = SC,AP,AT,AA



[state 1002, Jump options]
type = velset
triggerall = animelemtime(3) = 0
trigger1 = !ailevel
trigger1 = command = "holdback"
trigger1 = command != "holdfwd"
trigger2 = ailevel
trigger2 = p2bodydist x < 50
x = 8

[state 1002, Jump options]
type = velset
triggerall = animelemtime(3) = 0
trigger1 = !ailevel
trigger1 = command = "holdfwd"
trigger1 = command != "holdback"
trigger2 = ailevel
trigger2 = p2bodydist x > 300
x = 16

[state 1002, Jump options]
type = velset
triggerall = animelemtime(3) = 0
trigger1 = !ailevel
trigger1 = command != "holdfwd"
trigger1 = command != "holdback"
trigger2 = ailevel
trigger2 = p2bodydist x = [51,299]
x = 12

[state 1002, Jump]
type = velset
trigger1 = animelemtime(3) = 0
x = 16
y = -42 ;-38

[state 1002, veladd]
type = veladd
triggerall = animelemtime(3) > 0
trigger1 = ailevel = 0
trigger1 = command = "holdfwd"
trigger2 = ailevel
trigger2 = p2dist x > 0
x = 0.35

[state 1002, veladd]
type = veladd
triggerall = animelemtime(3) > 0
trigger1 = ailevel = 0
trigger1 = command = "holdback"
trigger2 = ailevel
trigger2 = p2dist x < 0
x = -0.6

[state 1002, gravity]
type = veladd
trigger1 = animelemtime(3) > 1
y = 3.5 ;-3

[state 1002, end]
type = changestate
trigger1 = vel y > 2
value = 1004

;---------------------------------------------------------------------------
;Overhead Stomp Fall
[statedef 1004]
type = A
movetype = A
physics = N
anim = 1004


[State 1004, 3]
type = HitDef
trigger1 = vel y > 0
trigger1 = !movecontact || !movereversed
persistent = 4
attr = A, SA
id = 1004
nochainid = 1004
damage    = 150,45
guardflag = HA
hitflag = MAF
priority = 4
pausetime = 0,0
sparkno = 3
sparkxy = 0,0
Hitsound = S5000, 2
guardsound = S120,0
animtype = heavy
ground.type = high
ground.slidetime = 20
ground.hittime  = 20
ground.velocity = 0
air.velocity = 0,0
down.hittime = 60
guard.velocity = -40            
guard.hittime = 16
guard.slidetime = 16
airguard.velocity = -10,-20
airguard.hittime = 40
guard.cornerpush.veloff = -120
guard.dist = 640

[state 10x4, vel stop]
type = velmul
trigger1 = movehit
x = 0
ignorehitpause

[state 10x4, on top]
type = posadd
trigger1 = movehit
x = p2dist x
ignorehitpause
persistent = 0


[state 1004, enemy state]
type = targetstate
triggerall = vel y > 0
trigger1 = movehit
trigger1 = enemy,statetype != A
value = 663

;Ride down mechanic
[state 1004, Ride down]
type = targetbind
trigger1 = movehit
trigger1 = enemy,statetype = A
pos = 0, -20

[state 1004, state of ride down]
type = targetstate
trigger1 = movehit
trigger1 = enemy,statetype = A
value = 655
;----------------------------------------------

[state 1004, gravity]
type = Veladd
trigger1 = 1
y = 4.5;3.5

[state 1004, playerpush]
type = playerpush
trigger1 = 1
value = 0

[state 1004, veladd]
type = veladd
trigger1 = ailevel = 0
trigger1 = command = "holdfwd"
trigger2 = ailevel
trigger2 = p2dist x > 0
x = 0.35

[state 1004, veladd]
type = veladd
trigger1 = ailevel = 0
trigger1 = command = "holdback"
trigger2 = ailevel
trigger2 = p2dist x < 0
x = -0.6

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -6
persistent = 0
ignorehitpause = 1

[state 1004, end]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 1005

;---------------------------------------------------------------------------
;Overhead Stomp Land
[statedef 1005]
type = S
movetype = A
physics = S
anim = 1005

[State 1005, 3]
type = HitDef
trigger1 = time = 0
attr = A, SA
damage    = 200 
guardflag = 
hitflag = FD
id = 1005
nochainid = 1004
priority = 4
pausetime = 12,12
sparkno = 1
sparkxy = -10,-40
hitsound   = 5,3
guardsound = S120,0
animtype = Med
p2stateno = 663
ground.type = High
ground.slidetime = 12
ground.hittime  = 15
ground.velocity = 0
air.velocity = 0,0

[state 1005, 4]
type = playsnd
trigger1 = time = 0
value = S5100,0

[state 1005, 4]
type = playsnd
trigger1 = time = 0
value = S5100,0

[state 1005, stop]
type = velset
trigger1 = time = 0
x = 0
y = 0

[state 1005, posset]
type = posset
trigger1 = time = 0
y = 0

[State 1005, 4]
type = EnvShake
trigger1 = time = 0
time = 24
ampl = -32
freq = 70
phase = 70
ignorehitpause = 1

[state 1005, land fx]
type = explod
trigger1 = time = 0
anim = 2000
bindtime = 1
id = 2000
pos = 0, 10
removetime = -2
sprpriority = 2
scale = 2.5,4
ownpal = 1

[state 1005, land fx]
type = explod
trigger1 = time = 0
anim = 2001
bindtime = 1
id = 2001
pos = 0, 10
removetime = -2
sprpriority = -2
scale = 2.5,4
ownpal = 1

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -3
persistent = 0
ignorehitpause = 1

[state 1005, Not Active]
type = statetypeset
trigger1 = animelemtime(2) = 0
movetype = I


[state 1005, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
;Hip Check
[statedef 1006]
type = S
movetype = A
physics = N
sprpriority = -2

[state 1006, anim]
type = changeanim
trigger1 = anim != 1006
value = 1006

[STATE 100X, nothitby]
type = nothitby
trigger1 = time < 12
value = ,AT

;-----------------
;Armor
;-----------------

;one hit of armor
[state 1006, armor counter]
type = varset
trigger1 = time = 0
trigger1 = Var(21) = 1
trigger2 = var(20) > 3
V = 20
value = 3
persistent = 0
ignorehitpause = 1

[state 1006, armor intiator turn off]
type = varset
trigger1 = time = 1
V = 21
value = 0
persistent = 0
ignorehitpause = 1

[state 1006, still take damage]
type = lifeadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) > 0
value = floor(-gethitvar(damage)*0.75)
persistent = 1
ignorehitpause = 1

[state 1006, armor count down]
type = varadd
trigger1 = gethitvar(damage) != 0
V = 20
value = -1
persistent = 1
ignorehitpause = 1

;----------------------------------------------
;determine what frame
[state 1006, remember frame]
type = varset
trigger1 = time <= 0
v = 22
value = animelemno(0)
ignorehitpause = 1

;delay effect
[state 1006, delay]
type = changeanim 
trigger1 = var(32) < floor(gethitvar(hittime)*0.5)
value = anim
elem = var(22)

[state 1006, posfreeze]
type = posfreeze
trigger1 = var(32) < floor(gethitvar(hittime)*0.5)
value = 1
;-------------------------------------------------


[state 1006, Unstoppable]
type = hitoverride
triggerall = gethitvar(groundtype) != 3
triggerall = animelemtime(7) < 0
trigger1 = Life > 1
trigger1 = Var(20) > 0
attr = SCA, AA, AP
stateno = 1006
time = 1
persistent = 1
ignorehitpause = 1

[State 1006, flash red]
type = PalFX
trigger1 = Time = 0
trigger1 = gethitvar(damage) != 0
time = 7
add = 100,0,0
IgnoreHitPause = 1
;--------------------------
;armor end
;--------------------------

[state 1006, statetypeset]
type = statetypeset
trigger1 = animelemtime(3) = 0
physics = S
ignorehitpause = 1

[state 1006, veladd]
type = veladd
trigger1 = animelemtime(5) = 0
trigger1 = prevstateno != stateno  
x = 20
ignorehitpause = 1

[state 1006, velset]
type = velset
trigger1 = animelemtime(7) = 8
x = 0
ignorehitpause = 1


[State 1006, 3]
type = HitDef
trigger1 = !movecontact || !movereversed
persistent = 0
attr = S, SA
damage    = 150,30
guardflag = MA
hitflag = MAF
priority = 2
id = 1006
nochainid = 1006
pausetime = 16,16
sparkno = 3
p1sprpriority = -1
p2sprpriority = 1
sparkxy = 0,-300
hitsound   = S1006,0
guardsound = S120,0
animtype = heavy
ground.type = high
ground.slidetime = 24
ground.hittime  = 24
ground.velocity = -60,-24
air.velocity = -50,-24
guard.velocity = -62         
guard.hittime = 28
guard.slidetime = 28
airguard.velocity = -45,6
airguard.hittime = 28
guard.cornerpush.veloff = -30
envshake.ampl = -12
envshake.time = 18
guard.dist = 640
fall = 1

[state 1006, wall splat]
type = targetstate
trigger1 = movehit
trigger1 = hitpausetime = 15
trigger1 = var(7) > 0
value = 675
ignorehitpause = 1

[state 1002, Butt cheek]
type = explod
trigger1 = animelemtime(6)=0
trigger1 = numexplod(1006) = 0
anim = 1036
postype = p1
pos = 0,0
id = 1006
bindtime = -1
removeongethit = 1
removetime = -2
sprpriority = 3
scale = const(size.xscale),const(size.yscale)
ignorehitpause = 0

[state 52, front foot front dust]
type = explod
trigger1 = animelemtime(4) >= 0 && animelemtime(5) < 0
anim = F120
pos = -30,0
scale = 4, 4
persistent = 4
sprpriority = 3

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -3
persistent = 0
ignorehitpause = 1

[state 1006, Not Active]
type = statetypeset
trigger1 = animelemtime(7) = 0
movetype = I



[state 1006, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
;Heavy Jumba Rush
[statedef 1010]
type = S
movetype = I
physics = S
ctrl = 0

;===========
;Armor start
;===========
[state 1010, animation]
type = changeanim
trigger1 = anim != 1010
value = 1010

[state 1010, poweradd]
type = poweradd
trigger1 = time = 0
trigger1 = var(21) = 1
value = 65
ignorehitpause = 1

[state 1010, armor counter]
type = varset
trigger1 = time = 0
trigger1 = Var(21) = 1
V = 20
value = 1

[state 1010, excess armor check]
type = varset
trigger1 = var(20) > 1
var(20) = 1
persistent = 1
ignorehitpause = 1

[state 1010, armor intiator turn off]
type = varset
trigger1 = time = 1
V = 21
value = 0

;determine what frame
[state 1010, remember frame]
type = varset
trigger1 = time <= 0
v = 22
value = animelemno(0)
ignorehitpause = 1

;delay effect
[state 1010, delay]
type = changeanim 
trigger1 = var(31) < floor(gethitvar(hittime)*0.5)
value = anim
elem = var(22)

[state 1010, freeze location]
type = posfreeze
trigger1 = var(31) < floor(gethitvar(hittime)*0.5)
value = 1
;--------------------------

[state 1010, still take damage]
type = lifeadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) != 0
value = floor(-gethitvar(damage)*0.75)
persistent = 1

[state 1010, armor count down]
type = varadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) > 0
V = 20
value = - 1
persistent = 1

[state 1010, Unstoppable]
type = hitoverride
trigger1 = alive
trigger1 = Var(20) > 0
attr = SCA, AA, AP
stateno = 1010
time = 1
persistent = 1

[State 1010, flash red]
type = PalFX
trigger1 = gethitvar(damage) != 0
time = 7
add = 100,0,0
IgnoreHitPause = 1
;--------------------------------------------------------------------------------


[STATE 1012, nothitby]
type = nothitby
trigger1 = 1
value = ,NT

[State 1010, 1]
type = VelSet
trigger1 = 1
x = const(velocity.run.fwd.x)*1.3

[State 1010, Shockwave]
type = explod
anim = F61
trigger1 = animelemtime(4) = 0 
pos = 125, 0
scale = const(size.xscale),const(size.yscale)
persistent = 1

[State 1010, Shockwave]
type = explod
anim = F61
trigger1 = animelemtime(8) = 0 
pos = 85, 5
scale = const(size.xscale),const(size.yscale)
persistent = 1

[State 1010, 4]
type = EnvShake
trigger1 = animElemtime(4) = 0
trigger2 = animElemtime(8) = 0
time = 12
ampl = -18
freq = 80
phase = 80

[State 1010, footstep]
type = PlaySnd
trigger1 = AnimElemtime(4) = 0
trigger2 = animelemtime(8) = 0
value = S20,0

[state 1010, no block]
type = assertspecial
trigger1 = var(20) != 10
flag = nostandguard
flag2 = nocrouchguard
ignorehitpause = 1


[State 1010, 2] ;Prevent run from canceling into walk
type = AssertSpecial
trigger1 = 1
flag = NoWalk

[State 1010, 3] ;Prevent from turning
type = AssertSpecial
trigger1 = 1
flag = NoAutoTurn

[state x, combo damage score]
type = varadd
trigger1 = time = 0
v = 18
value = -9
persistent = 0
ignorehitpause = 1

[State 1010, 4]
type = ChangeState
trigger1 = time > 90
trigger2 = animelemtime(2) > 0
trigger2 = command = "x" || command = "holdback"
trigger2 = !ailevel
value = 1011

[State 1010, 4]
type = ChangeState
trigger1 = animelemtime(2) > 0
trigger1 = command = "a"
trigger1 = !ailevel
value = 1012

[State 1010, 4]
type = ChangeState
trigger1 = animelemtime(2) > 0
trigger1 = command = "b" || command = "holdb"
trigger1 = !ailevel
value = 1013

[State 1010, 4]
type = ChangeState
trigger1 = animelemtime(2) > 0
trigger1 = command = "y" || command = "holdy"
trigger1 = !ailevel
value = 1016

;---------------------------------------------------------------------------
; Stop
[statedef 1011]
type = S
movetype = I
physics = S
anim = 1011

[state 1011, front foot front dust]
type = explod
trigger1 = 1
anim = F120
pos = 440,0
scale = 2, 2
persistent = 4
sprpriority = 3

[state 1011, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1
;-----------------------------------------------------------------------------
;Slide
[statedef 1012]
type = C
movetype = A
physics = C
anim = 1012

[state 1012, Not Active]
type = statetypeset
trigger1 = animelemtime(3) = 0
movetype = I

[STATE 1012, nothitby]
type = nothitby
trigger1 = time < 12
value = ,AT

[state 1002, veladd]
type = veladd
trigger1 = animelemtime(1) >= 0 && animelemtime(3) < 0
x = 4.1

[state 1012, attackdist]
type = attackdist
trigger1 = 1
value = 430

[state 1012, front foot front dust]
type = explod
trigger1 = animelemtime(2) > 0 && animelemtime(3) < 10
anim = F120
pos = 440,0
scale = 4, 4
persistent = 4
sprpriority = 3

[State 1012, 1]
type = HitDef
trigger1 = AnimElem = 2
attr = S, SA                    
damage = ifelse(enemynear,statetype != L,130,65),13                  
animtype = Heavy                
guardflag = L                   
hitflag = MAFD                   
priority = 3, Hit                
pausetime = 10, 10                
sparkno = 2                    
sparkxy = -40, -304              
hitsound = 5, 3                 
guardsound = S120,0                
ground.type = Trip               
ground.slidetime = 18             
ground.hittime  = 18             
ground.velocity = -12,-24           
airguard.velocity = -8,-20   
air.type = High    
down.velocity = -90,0              
air.velocity = -8,-16  
air.hittime = 35
guard.hittime = 14
guard.velocity = -14
guard.slidetime = 14
fall = 1
fall.recover = 0
fall.recovertime = 60 
guard.dist = 720

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -3
persistent = 0
ignorehitpause = 1


[state 1012, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------

;Over head Stomp Rise
[statedef 1013]
type = S
movetype = A
physics = S
anim = 1003
ctrl = 0

[state 1013, skid]
type = velmul
trigger1 = time = 0
x = 0.5

[state 1013, skid]
type = statetypeset
trigger1 = animelemtime(3) = 0
physics = N
statetype = A

[state 1002, nothitby]
type = nothitby
trigger1 = time < 16
value = SC,AT,AP,AA


[state 1013, Jump]
type = velset
trigger1 = animelemtime(3) = 0
x = 16
y = -42

[state 1013, veladd]
type = veladd
triggerall = animelemtime(3) > 0
trigger1 = ailevel = 0
trigger1 = command = "holdfwd"
trigger2 = ailevel
trigger2 = p2bodydist x > 0
x = 0.35

[state 1013, veladd]
type = veladd
triggerall = animelemtime(3) > 0
trigger1 = ailevel = 0
trigger1 = command = "holdback"
trigger2 = ailevel
trigger2 = p2bodydist x < 0
x = -0.6

[state 1013, gravity]
type = veladd
trigger1 = animelemtime(3) > 1
y = 3.5

[state 1013, end]
type = changestate
trigger1 = vel y > 2
value = 1014

;---------------------------------------------------------------------------
;Overhead Stomp Fall
[statedef 1014]
type = A
movetype = A
physics = N
anim = 1004


[State 1014, 3]
type = HitDef
trigger1 = vel y > 0
trigger1 = !movecontact || !movereversed
persistent = 4
attr = A, SA
id = 1004
nochainid = 1004
damage    = 180,54
guardflag = HA
hitflag = MAF
priority = 4
pausetime = 0,0
sparkno = 3
sparkxy = 0,0
Hitsound = S5000, 2
guardsound = S120,0
animtype = heavy
ground.type = high
ground.slidetime = 16
ground.hittime  = 16
ground.velocity = 0
air.velocity = 0,0
down.hittime = 60
guard.velocity = -36            
guard.hittime = 16
guard.slidetime = 16
airguard.velocity = -10,-20
airguard.hittime = 40
guard.cornerpush.veloff = -120
guard.dist = 640

[state 10x4, vel stop]
type = velmul
trigger1 = movehit
x = 0
ignorehitpause


[state 1014, enemy state]
type = targetstate
triggerall = vel y > 0
trigger1 = movehit
trigger1 = enemy,statetype != A
value = 663

;Ride down mechanic
[state 1014, Ride down]
type = targetbind
trigger1 = movehit
trigger1 = enemy,statetype = A
pos = 0, -20

[state 1014, state of ride down]
type = targetstate
trigger1 = movehit
trigger1 = enemy,statetype = A
value = 655
;----------------------------------------------

[state 1014, gravity]
type = Veladd
trigger1 = 1
y = 4.5

[state 1014, playerpush]
type = playerpush
trigger1 = 1
value = 0

[state 1014, veladd]
type = veladd
trigger1 = ailevel = 0
trigger1 = command = "holdfwd"
trigger2 = ailevel
trigger2 = p2dist x > 0
x = 0.35

[state 1014, veladd]
type = veladd
trigger1 = ailevel = 0
trigger1 = command = "holdback"
trigger2 = ailevel
trigger2 = p2dist x < 0
x = -0.6

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -6
persistent = 0
ignorehitpause = 1

[state 1014, end]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 1015

;---------------------------------------------------------------------------
;Overhead Stomp Land
[statedef 1015]
type = S
movetype = A
physics = S
anim = 1015

[State 1015, 3]
type = HitDef
trigger1 = time = 0
attr = A, SA
damage    = 200 
guardflag = 
hitflag = FD
nochainid = 1014
id = 1015
priority = 4
pausetime = 12,12
sparkno = 1
sparkxy = -10,-40
hitsound   = 5,3
guardsound = S120,0
animtype = Med
p2stateno = 663
ground.type = High
ground.slidetime = 12
ground.hittime  = 15
ground.velocity = 0
air.velocity = 0,0

[state 1015, 4]
type = playsnd
trigger1 = time = 0
value = S5100,0

[state 1015, 4]
type = playsnd
trigger1 = time = 0
value = S5100,0

[state 1015, stop]
type = velset
trigger1 = time = 0
x = 0
y = 0

[state 1015, posset]
type = posset
trigger1 = time = 0
y = 0

[State 1015, 4]
type = EnvShake
trigger1 = time = 0
time = 24
ampl = -32
freq = 70
phase = 70
ignorehitpause = 1

[state 1015, land fx]
type = explod
trigger1 = time = 0
anim = 2000
bindtime = 1
id = 2000
pos = 0, 10
removetime = -2
sprpriority = 2
scale = 2.5,4
ownpal = 1

[state 1015, land fx]
type = explod
trigger1 = time = 0
anim = 2001
bindtime = 1
id = 2001
pos = 0, 10
removetime = -2
sprpriority = -2
scale = 2.5,4
ownpal = 1

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -3
persistent = 0
ignorehitpause = 1

[state 1015, Not Active]
type = statetypeset
trigger1 = animelemtime(2) = 0
movetype = I



[state 1015, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
;Hip Check
[statedef 1016]
type = S
movetype = A
physics = N
sprpriority = -2

[state 1016, anim]
type = changeanim
trigger1 = anim != 1016
value = 1016

[STATE 1012, nothitby]
type = nothitby
trigger1 = time < 12
value = ,AT

;-----------------
;Armor
;-----------------

;two hit of armor
[state 1016, armor counter]
type = varset
trigger1 = time = 0
trigger1 = Var(21) = 1
trigger2 = var(20) > 3
V = 20
value = 3
persistent = 0
ignorehitpause = 1

[state 1016, armor intiator turn off]
type = varset
trigger1 = time = 1
V = 21
value = 0
persistent = 0
ignorehitpause = 1

[state 1016, still take damage]
type = lifeadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) > 0
value = floor(-gethitvar(damage)*0.75)
persistent = 1
ignorehitpause = 1

[state 1016, armor count down]
type = varadd
trigger1 = gethitvar(damage) != 0
V = 20
value = -1
persistent = 1
ignorehitpause = 1

;determine what frame
[state 1016, remember frame]
type = varset
trigger1 = time <= 0
v = 22
value = animelemno(0)
ignorehitpause = 1

;delay effect
[state 1016, delay]
type = changeanim 
trigger1 = var(32) < floor(gethitvar(hittime)*0.5)
value = anim
elem = var(22)

[state 1016, posfreeze]
type = posfreeze
trigger1 = var(32) < floor(gethitvar(hittime)*0.5)
value = 1
;--------------------------


[state 1016, Unstoppable]
type = hitoverride
triggerall = gethitvar(groundtype) != 3
triggerall = animelemtime(7) < 0
trigger1 = Life > 1
trigger1 = Var(20) > 0
attr = SCA, AA, AP
stateno = 1016
time = 1
persistent = 1
ignorehitpause = 1

[State 1016, flash red]
type = PalFX
trigger1 = Time = 0
trigger1 = gethitvar(damage) != 0
time = 7
add = 100,0,0
IgnoreHitPause = 1
;--------------------------
;armor end
;--------------------------

[state 1016, statetypeset]
type = statetypeset
trigger1 = animelemtime(3) = 0
physics = S
ignorehitpause = 1

[state 1016, veladd]
type = veladd
trigger1 = animelemtime(5) = 0
trigger1 = prevstateno != stateno
x = 20
persistent = 0
ignorehitpause = 1

[state 1016, velset]
type = velset
trigger1 = animelemtime(7) = 8
x = 0
ignorehitpause = 1


[State 1016, 3]
type = HitDef
trigger1 = !movecontact || !movereversed
persistent = 0
attr = S, SA
damage    = 180,36
guardflag = MA
hitflag = MAF
priority = 2
id = 1016
nochainid = 1016
pausetime = 16,16
sparkno = 3
p1sprpriority = -1
p2sprpriority = 1
sparkxy = 0,-300
hitsound   = S1006,0
guardsound = S120,0
animtype = heavy
ground.type = high
ground.slidetime = 24
ground.hittime  = 24
ground.velocity = -70,-24
air.velocity = -65,-24
guard.velocity = -58         
guard.hittime = 28
guard.slidetime = 28
airguard.velocity = -40,6
airguard.hittime = 26
guard.cornerpush.veloff = -30
envshake.ampl = -12
envshake.time = 18
guard.dist = 640
fall = 1

[state 1006, wall splat]
type = targetstate
trigger1 = movehit
trigger1 = hitpausetime = 15
trigger1 = var(7) > 0
value = 675
ignorehitpause = 1

[state 1002, Butt cheek]
type = explod
trigger1 = animelemtime(6)=0
trigger1 = numexplod(1016) = 0
anim = 1036
postype = p1
pos = 0,0
id = 1016
bindtime = -1
removeongethit = 1
removetime = -2
sprpriority = 3
scale = const(size.xscale),const(size.yscale)
ignorehitpause = 0

[state 1016, front foot front dust]
type = explod
trigger1 = animelemtime(4) >= 0 && animelemtime(5) < 0
anim = F120
pos = -30,0
scale = 4, 4
persistent = 4
sprpriority = 3

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -3
persistent = 0
ignorehitpause = 1

[state 1016, Not Active]
type = statetypeset
trigger1 = animelemtime(7) = 0
movetype = I



[state 1016, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
;EX Jumba Rush
[statedef 1020]
type = S
movetype = I
physics = S
ctrl = 0
anim = 1029


[State 1020, 1]
type = VelSet
trigger1 = 1
x = const(velocity.run.fwd.x)*2

[STATE 1002, nothitby]
type = nothitby
trigger1 = 1
value = ,NT

[state 1020, poweradd]
type = poweradd
;triggerall = prevstateno != 1020
;triggerall = var(21) = 1
trigger1 = time = 0
value = -500
persistent = 0
ignorehitpause = 1

[state x, combo damage score]
type = varadd
trigger1 = time = 0
v = 18
value = -9
persistent = 0
ignorehitpause = 1

[State 1020, Blink Yellow]
type = PalFX
trigger1 = time%2
time = 1
add = 150,75,0 ;32,16,0
sinadd = 64,32,5,3
ignorehitpause

[state 1029, end]
type = changestate
trigger1 = animtime = 0
value = 1029

;--------------------------------------------------------------------------
;Jumba Rush EX
[statedef 1029]
type = S
movetype = I
physics = S
ctrl = 0

;===========
;Armor start
;===========
[state 1029, animation]
type = changeanim
trigger1 = anim != 1020
value = 1020

[state 1029, armor counter]
type = varset
trigger1 = time = 0
trigger1 = Var(21) = 1
V = 20
value = 2

[state 1029, excess armor check]
type = varset
trigger1 = var(20) > 2
var(20) = 2
persistent = 1
ignorehitpause = 1

[state 1029, armor intiator turn off]
type = varset
trigger1 = time = 1
V = 21
value = 0

;determine what frame
[state 1029, remember frame]
type = varset
trigger1 = time <= 0
v = 22
value = animelemno(0)
ignorehitpause = 1

;delay effect
[state 1029, delay]
type = changeanim 
trigger1 = var(31) < floor(gethitvar(hittime)*0.2)
value = anim
elem = var(22)

[state 1029, freeze location]
type = posfreeze
trigger1 = var(31) < floor(gethitvar(hittime)*0.2)
value = 1
;--------------------------

[state 1029, still take damage]
type = lifeadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) != 0
value = floor(-gethitvar(damage))
persistent = 1

[state 1029, armor count down]
type = varadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) > 0
V = 20
value = - 1
persistent = 1

[state 1029, Unstoppable]
type = hitoverride
trigger1 = Alive
trigger1 = Var(20) > 0
attr = SCA, AA, AP
stateno = 1029
time = 1
persistent = 1

[State 1029, flash red]
type = PalFX
trigger1 = Time = 0
trigger1 = gethitvar(damage) != 0
time = 7
add = 100,0,0
IgnoreHitPause = 1
;--------------------------------------------------------------------------------


[State 1029, 1]
type = VelSet
trigger1 = 1
x = const(velocity.run.fwd.x)*1.45

[State 1029, Blink Yellow]
type = PalFX
trigger1 = time%2
trigger1 = time < 24
time = 1
add = 150,75,0 ;32,16,0
sinadd = 64,32,5,3
ignorehitpause


[State 1029, Shockwave]
type = explod
anim = F61
trigger1 = animelemtime(4) = 0 
pos = 125, 0
scale = const(size.xscale),const(size.yscale)
persistent = 1

[State 1029, Shockwave]
type = explod
anim = F61
trigger1 = animelemtime(8) = 0 
pos = 85, 5
scale = const(size.xscale),const(size.yscale)
persistent = 1

[State 1029, 4]
type = EnvShake
trigger1 = animElemtime(4) = 0
trigger2 = animElemtime(8) = 0
time = 12
ampl = -18
freq = 80
phase = 80

[State 1029, footstep]
type = PlaySnd
trigger1 = AnimElemtime(4) = 0
trigger2 = animelemtime(8) = 0
value = S20,0

[state 1029, no block]
type = assertspecial
trigger1 = var(20) != 10
flag = nostandguard
flag2 = nocrouchguard
ignorehitpause = 1


[State 1029, 2] ;Prevent run from canceling into walk
type = AssertSpecial
trigger1 = 1
flag = NoWalk

[State 1029, 3] ;Prevent from turning
type = AssertSpecial
trigger1 = 1
flag = NoAutoTurn

[State 1029, 4]
type = ChangeState
trigger1 = time > 90
trigger2 = animelemtime(2) > 0
trigger2 = command = "x" || command = "holdback"
trigger2 = !ailevel
value = 1021

[State 1029, 4]
type = ChangeState
trigger1 = animelemtime(2) > 0
trigger1 = command = "a"
trigger1 = !ailevel
value = 1022

[State 1029, 4]
type = ChangeState
trigger1 = animelemtime(2) > 0
trigger1 = command = "b"  || command = "holdb"
trigger1 = !ailevel
value = 1023

[State 1029, 4]
type = ChangeState
trigger1 = animelemtime(2) > 0
trigger1 = command = "y" || command = "holdy"
trigger1 = !ailevel
value = 1026




;---------------------------------------------------------------------------
; Stop
[statedef 1021]
type = S
movetype = I
physics = S
anim = 1001

[state 1021, front foot front dust]
type = explod
trigger1 = 1
anim = F120
pos = 440,0
scale = 2, 2
persistent = 4
sprpriority = 3

[state 1021, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1
;-----------------------------------------------------------------------------
;Slide
[statedef 1022]
type = C
movetype = A
physics = C

[state 1022, Not Active]
type = statetypeset
trigger1 = animelemtime(3) = 0
movetype = I

[STATE 1002, nothitby]
type = nothitby
trigger1 = time < 12
value = ,AT

;===========
;Armor start
;===========
[state 1029, animation]
type = changeanim
trigger1 = anim != 1022
value = 1022

;determine what frame
[state 1029, remember frame]
type = varset
trigger1 = time <= 0
v = 22
value = animelemno(0)
ignorehitpause = 1

;delay effect
[state 1029, delay]
type = changeanim 
trigger1 = var(31) < floor(gethitvar(hittime)*0.2)
value = anim
elem = var(22)

[state 1029, freeze location]
type = posfreeze
trigger1 = var(31) < floor(gethitvar(hittime)*0.2)
value = 1
;--------------------------

[state 1029, still take damage]
type = lifeadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) != 0
value = floor(-gethitvar(damage))
persistent = 1

[state 1029, armor count down]
type = varadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) > 0
V = 20
value = -1
persistent = 1

[state 1029, Unstoppable]
type = hitoverride
trigger1 = Life > 1
trigger1 = Var(20) > 0
attr = SCA, AA, AP
stateno = 1022
time = 1
persistent = 1

[State 1029, flash red]
type = PalFX
trigger1 = Time = 0
trigger1 = gethitvar(damage) != 0
time = 7
add = 100,0,0
IgnoreHitPause = 1
;--------------------------------------------------------------------------------

[state 1002, veladd]
type = veladd
trigger1 = animelemtime(1) >= 0 && animelemtime(3) < 0
x = 4.92

[state 1022, attackdist]
type = attackdist
trigger1 = 1
value = 430

[state 1022, front foot front dust]
type = explod
trigger1 = animelemtime(2) > 0 && animelemtime(3) < 10
anim = F120
pos = 440,0
scale = 4, 4
persistent = 4
sprpriority = 3

[State 1022, 1]
type = HitDef
trigger1 = AnimElem = 2
attr = S, SA
persistent = 0              
damage = ifelse(enemynear,statetype != L,80,40),8                  
animtype = Heavy                
guardflag = L
id = 1022                   
hitflag = MAFD                   
priority = 3, Hit                
pausetime = 10, 10
getpower = 0                
sparkno = 2                    
sparkxy = -40, -304              
hitsound = 5, 3                 
guardsound = S120,0                
ground.type = Trip               
ground.slidetime = 18             
ground.hittime  = 18             
ground.velocity = ifelse(var(6) > 1, 2, -12),ifelse(var(6) > 1, -40, -12)           
airguard.velocity = -8,-20 
airguard.hittime = 35   
air.type = High    
down.velocity = ifelse(var(6) > 1, 0, -90),ifelse(var(6) > 1, -40, 0)              
air.velocity = ifelse(var(6) > 1, 2, -12),ifelse(var(6) > 1, -36, -12)  
air.hittime = 22
guard.hittime = 12
guard.velocity = -18
guard.slidetime = 12
fall = 1
fall.recover = 0
fall.recovertime = 45 
guard.dist = 720  

[state 1022, Slide launch limiter]
type = varadd
trigger1 = movehit
var(6) = -1
ignorehitpause = 1
persistent = 0

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -9
persistent = 0
ignorehitpause = 1


[state 1022, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------

;Over head Stomp Rise
[statedef 1023]
type = S
movetype = A
physics = S
anim = 1003
ctrl = 0

[state 1023, skid]
type = velmul
trigger1 = time = 0
x = 0.5

[state 1023, skid]
type = statetypeset
trigger1 = animelemtime(3) = 0
physics = N
statetype = A

[state 1002, nothitby]
type = nothitby
trigger1 = time < 16
value = SC,AA,AP,AT

[state 1023, Jump]
type = velset
trigger1 = animelemtime(3) = 0
x = 16
y = -42

[state 1023, veladd]
type = veladd
triggerall = animelemtime(3) > 0
trigger1 = ailevel = 0
trigger1 = command = "holdfwd"
trigger2 = ailevel
trigger2 = p2dist x > 0
x = 0.45

[state 1023, veladd]
type = veladd
triggerall = animelemtime(3) > 0
trigger1 = ailevel = 0
trigger1 = command = "holdback"
trigger2 = ailevel
trigger2 = p2dist x < 0
x = -0.8

[state 1023, gravity]
type = veladd
trigger1 = animelemtime(3) > 1
y = 3

[state 1023, end]
type = changestate
trigger1 = vel y > 2
value = 1024

;---------------------------------------------------------------------------
;Overhead Stomp Fall
[statedef 1024]
type = A
movetype = A
physics = N
anim = 1004

[state 1024, nothitby]
type = nothitby
trigger1 = 1
value = ,AP

[State 1024, Blink Yellow]
type = PalFX
trigger1 = time%2
time = 1
add = 150,75,0 ;32,16,0
sinadd = 64,32,5,3
ignorehitpause

[state 1024, limiter]
type = varadd
trigger1 = movehit
ignorehitpause = 1
persistent = 0
v = 8
value = - 1

[State 1024, 3]
type = HitDef
trigger1 = vel y > 0
trigger1 = !movecontact || !movereversed
persistent = 0
attr = A, SA
id = 1004
damage    = 160,32
guardflag = HA
hitflag = MAF
getpower = 0
priority = 4
pausetime = 7,14
sparkno = 3
sparkxy = 0,0
Hitsound = S5000, 2
guardsound = S120,0
animtype = heavy
ground.type = high
ground.slidetime = 16
ground.hittime  = 16
ground.velocity = ifelse(var(8) > 1, 0, -12),ifelse(var(8) > 1, 60, 60)
air.velocity = ifelse(var(8) > 1, 0, -12),ifelse(var(8) > 1, 60, 60)
guard.velocity = -30            
guard.hittime = 12
guard.slidetime = 12
airguard.velocity = -10,-20
airguard.hittime = 40
guard.cornerpush.veloff = -120
guard.dist = 640
down.bounce
fall.xvelocity = -6
fall.yvelocity = -12
fall = 1
fall.recovertime = 45


[state 10x4, vel stop]
type = velmul
trigger1 = movehit
x = 0
ignorehitpause


[state 1024, enemy state]
type = targetstate
triggerall = vel y > 0
trigger1 = movehit
trigger1 = var(8) > 0
trigger1 = hitpausetime = 7
ignorehitpause = 1
persistent = 0
value = 681

[state 1024, gravity]
type = Veladd
trigger1 = 1
y = 4.5

[state 1024, playerpush]
type = playerpush
trigger1 = 1
value = 0

[state 1024, veladd]
type = veladd
trigger1 = ailevel = 0
trigger1 = command = "holdfwd"
trigger2 = ailevel
trigger2 = p2dist x > 0
x = 0.45

[state 1024, veladd]
type = veladd
trigger1 = ailevel = 0
trigger1 = command = "holdback"
trigger2 = ailevel
trigger2 = p2dist x < 0
x = -0.8

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -9
persistent = 0
ignorehitpause = 1

[state 1024, end]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 1025

;---------------------------------------------------------------------------
;Overhead Stomp Land
[statedef 1025]
type = S
movetype = A
physics = S
anim = 1025

[State 1025, Blink Yellow]
type = PalFX
trigger1 = time%2
time = 1
add = 150,75,0 ;32,16,0
sinadd = 64,32,5,3
ignorehitpause

[State 1025, 3]
type = HitDef
trigger1 = time = 0
attr = A, SA
damage    = 240 
guardflag = 
hitflag = FD
getpower = 0
priority = 4
pausetime = 12,12
sparkno = 1
sparkxy = -10,-40
hitsound   = 5,3
guardsound = S120,0
animtype = Med
p2stateno = 661
ground.type = High
ground.slidetime = 12
ground.hittime  = 15
ground.velocity = 0
air.velocity = 0,0

[state 1025, 4]
type = playsnd
trigger1 = time = 0
value = S5100,0

[state 1025, 4]
type = playsnd
trigger1 = time = 0
value = S5100,0

[state 1025, stop]
type = velset
trigger1 = time = 0
x = 0
y = 0

[state 1025, posset]
type = posset
trigger1 = time = 0
y = 0

[State 1025, 4]
type = EnvShake
trigger1 = time = 0
time = 24
ampl = -32
freq = 70
phase = 70
ignorehitpause = 1

[state 1025, land fx]
type = explod
trigger1 = time = 0
anim = 2000
bindtime = 1
id = 2000
pos = 0, 10
removetime = -2
sprpriority = 2
scale = 2.5,4
ownpal = 1

[state 1025, land fx]
type = explod
trigger1 = time = 0
anim = 2001
bindtime = 1
id = 2001
pos = 0, 10
removetime = -2
sprpriority = -2
scale = 2.5,4
ownpal = 1

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -9
persistent = 0
ignorehitpause = 1

[state 1025, Not Active]
type = statetypeset
trigger1 = animelemtime(2) = 0
movetype = I

[state 1025, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
;Hip Check
[statedef 1026]
type = S
movetype = A
physics = N
sprpriority = -2

[state 1026, anim]
type = changeanim
trigger1 = anim != 1026
value = 1026

[STATE 1002, nothitby]
type = nothitby
trigger1 = time < 12
value = ,AT


;-----------------
;Armor
;-----------------

;two more hit of armor
[state 1026, armor counter]
type = varadd
triggerall = prevstateno != 1026
trigger1 = time = 0
V = 20
value = 3
persistent = 0
ignorehitpause = 1

[state 1026, still take damage]
type = lifeadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) > 0
value = floor(-gethitvar(damage)*0.75)
persistent = 1
ignorehitpause = 1

[state 1026, armor count down]
type = varadd
trigger1 = gethitvar(damage) != 0
V = 20
value = - 1
persistent = 1
ignorehitpause = 1

;determine what frame
[state 1026, remember frame]
type = varset
trigger1 = time <= 0
v = 22
value = animelemno(0)
ignorehitpause = 1

;delay effect
[state 1026, delay]
type = changeanim 
trigger1 = var(32) < floor(gethitvar(hittime)*0.5)
value = anim
elem = var(22)

[state 1026, posfreeze]
type = posfreeze
trigger1 = var(32) < floor(gethitvar(hittime)*0.5)
value = 1
;--------------------------


[state 1026, Unstoppable]
type = hitoverride
triggerall = animelemtime(7) < 0
trigger1 = Life > 1
trigger1 = Var(20) > 0
attr = SCA, AA, AP
stateno = 1026
time = 1
persistent = 1
ignorehitpause = 1

[State 1026, flash red]
type = PalFX
trigger1 = Time = 0
trigger1 = gethitvar(damage) != 0
time = 7
add = 100,0,0
IgnoreHitPause = 1
;--------------------------
;armor end
;--------------------------

[state 1026, statetypeset]
type = statetypeset
trigger1 = animelemtime(3) = 0
physics = S
ignorehitpause = 1

[state 1026, veladd]
type = veladd
trigger1 = animelemtime(5) = 0
trigger1 = prevstateno != stateno
x = 20
persistent = 0
ignorehitpause = 1

[state 1026, velset]
type = velset
trigger1 = animelemtime(7) = 8
x = 0


[State 1026, 3]
type = HitDef
trigger1 = !movecontact || !movereversed
persistent = 0
attr = S, SA
damage    = 160,48
guardflag = MA
hitflag = MAF
priority = 2
id = 1026
nochainid = 1026
getpower = 0
pausetime = 16,16
sparkno = 3
p1sprpriority = -1
p2sprpriority = 1
sparkxy = 0,-300
hitsound   = S1006,0
guardsound = S120,0
animtype = heavy
ground.type = high
ground.slidetime = 24
ground.hittime  = 24
ground.velocity = -80,ifelse(var(7) > 1, -32, -4)
air.velocity = -80,ifelse(var(7) > 1, -24, -4)
guard.velocity = -45         
guard.hittime = 14
guard.slidetime = 14
airguard.velocity = -40,2
airguard.hittime = 26
guard.cornerpush.veloff = -30
envshake.ampl = -12
envshake.time = 18
guard.dist = 640
p2facing = 1
fall = 1
down.bounce = ifelse(var(7) > 1, 0, 1) 
fall.xvelocity = ifelse(var(7) > 1, 0, -60)
fall.yvelocity = ifelse(var(7) > 1, 0, -20)
fall.recover = 0

[state 1002, Butt cheek]
type = explod
trigger1 = animelemtime(6)=0
trigger1 = numexplod(1026) = 0
anim = 1036
postype = p1
pos = 0,0
id = 1026
bindtime = -1
removeongethit = 1
removetime = -2
sprpriority = 2
scale = const(size.xscale),const(size.yscale)
ignorehitpause = 0

[state 1026, varadd]
type = varadd
trigger1 = movehit
var(7) = -1
ignorehitpause = 1
persistent = 0


[state 1026, targetstate]
type = targetstate
trigger1 = movehit
trigger1 = var(7) > 0
trigger1 = hitpausetime = 15
ignorehitpause = 1
value = 670

[state 1026, front foot front dust]
type = explod
trigger1 = animelemtime(4) >= 0 && animelemtime(5) < 0
anim = F120
pos = -30,0
scale = 4, 4
persistent = 4
sprpriority = 3
ownpal = 1

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -9
persistent = 0
ignorehitpause = 1

[state 1026, Not Active]
type = statetypeset
trigger1 = animelemtime(7) = 0
movetype = I



[state 1026, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
;Jumba Flip  Via Wall
[statedef 1040]
type = A
movetype = I
physics = N
anim = 1040
ctrl = 0

[state 1040, after image]
type = afterimage
trigger1 = time = 0
time = 60
length = 4
framegap = 4
timegap = 2
trans = none

[state 1040, playerpush]
type = playerpush
trigger1 = time < 30
value = 0

[state 1040, gravity]
type = gravity
trigger1 = pos y < -1

[state 1040, nothitby]
type = nothitby
trigger1 = time < 27
value = ,AP

[state 1040, playsnd]
type = playsnd
trigger1 = animelemtime(3) = 0
value = S41,0

[state 1040, playsnd]
type = playsnd
trigger1 = animelemtime(7) = 0
value = S1050,0
persistent = 1

[state 1040, damageset]
type = varset
trigger1 = time = 0
v = 14
value = 200

[state 1040, steering]
type = veladd
triggerall = animelemtime(3) > 0
triggerall = vel x < const(velocity.jump.fwd.x)
trigger1 = command = "holdfwd"
trigger1 = !ailevel
trigger2 = p2dist x > 40
trigger2 = ailevel
x = const(velocity.jump.fwd.x)*0.2

[state 1040, steering]
type = veladd
triggerall = animelemtime(3) > 0
triggerall = vel x > const(velocity.jump.back.x)
trigger1 = command = "holdback"
trigger1 = !ailevel
trigger2 = p2dist x < 40
trigger2 = ailevel
x = const(velocity.jump.back.x)*0.2

[state 1040, Grab Attempt]
type = changestate
trigger1 = time > 14
value = 1042

[state 1040, End]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 1069

;---------------------------------------------------------------------------
;Flip Grab
[statedef 1042]
type = A
movetype = A
physics = N
anim = 1042
sprpriority = -2

[state 1042, gravity]
type = gravity
trigger1 = 1

[state 1042, nothitby]
type = nothitby
trigger1 = time < 36
value = ,AP

[state 50, steering]
type = veladd
trigger1 = command = "holdfwd"
trigger1 = vel x < const(velocity.jump.fwd.x)*0.5
x = const(velocity.jump.fwd.x)*0.1

[state 50, steering]
type = veladd
trigger1 = command = "holdback"
trigger1 = vel x > const(velocity.jump.back.x)*0.5
x = const(velocity.jump.back.x)*0.1


[State 1042, 1]
type = HitDef
Trigger1 = Time = 0
persistent = 0
attr = S, ST         
hitflag = HA-          
priority = 1, Miss    
sparkno = -1          
p1sprpriority = -1
p2sprpriority = 1   
id = 1045                      
p1facing = 1
p2facing = 1          
p1stateno = 1055       
p2stateno = 1080       
guard.dist = 0        
fall = 1              
fall.recover = 0

[state 1042, Butt cheek]
type = explod
trigger1 = animelemtime(2)=0
anim = 1053
postype = p1
pos = 0,0
id = 1053
bindtime = -1
removeongethit = 1
removetime = -2
sprpriority = 4
scale = const(size.xscale),const(size.yscale)

[state 1042, End]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 1049


;---------------------------------------------------------------------------
; Landing from flip
[statedef 1049]
type = C
movetype = I
physics = C
ctrl = 0

[state 1049, anim]
type = changeanim
trigger1 = time = 0
value = 1058

[state 1049, velset]
type = velset
trigger1 = time = 0
y = 0

[state 1049, posset]
type = posset
trigger1 = time = 0
y = 0

[State 1059, 4]
type = EnvShake
trigger1 = time = 0
time = 24
ampl = -18
freq = 100
phase = 100

[state 1059, land fx]
type = explod
trigger1 = time = 0
anim = 2000
bindtime = 1
id = 2000
pos = 0, 10
removetime = -2
sprpriority = 2
scale = 3,2.5
ownpal = 1

[state 1059, land fx]
type = explod
trigger1 = time = 0
anim = 2001
bindtime = 1
id = 2001
pos = 0, 10
removetime = -2
sprpriority = -2
scale = 3,2.5
ownpal = 1

[state 1059, 4]
type = playsnd
trigger1 = time = 0
value = S5100,0

[state 1059, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1


;---------------------------------------------------------------------------
;Jumba Flip
[statedef 1050]
type = S
movetype = I
physics = S
anim = 1050
ctrl = 0

[state 1060, after image]
type = afterimage
trigger1 = time = 0
time = 60
length = 4
framegap = 4
timegap = 2
trans = none

[state 1060, playerpush]
type = playerpush
trigger1 = time < 60
value = 0

[state 1050, gravity]
type = gravity
trigger1 = pos y < -1

[state 1050, physics]
type = statetypeset
trigger1 = animelemtime(3) = 0
physics = N
statetype = A

[state 1050, playsnd]
type = playsnd
trigger1 = animelemtime(3) = 0
value = S41,0

[state 1050, damageset]
type = varset
trigger1 = time = 0
v = 14
value = 200

[state 1060, nothitby]
type = nothitby
trigger1 = animelemtime(3) >= 0
value = ,AP

[state 1050, playsnd]
type = playsnd
trigger1 = animelemtime(7) = 0
value = S1050,0
persistent = 1

[state 1050, velset]
type = velset
trigger1 = animelemtime(3) = 0
x = 12
y = -45

[state 1050, steering]
type = veladd
triggerall = animelemtime(3) > 0
triggerall = vel x < 6
trigger1 = command = "holdfwd"
trigger1 = ailevel = 0
trigger2 = p2bodydist x > 40
trigger2 = ailevel 
x = 0.6

[state 1050, steering]
type = veladd
triggerall = animelemtime(3) > 0
triggerall = vel x > -3
trigger1 = command = "holdback"
trigger1 = !ailevel
trigger2 = p2bodydist x < 40
trigger2 = ailevel
x = -0.6

[state 1050, butt drop]
type = changestate
triggerall = animelemtime(3) > 0
trigger1 = command = "b"
trigger1 = !ailevel
value = 1051

[state 1050, Grab Attempt]
type = changestate
triggerall = animelemtime(3) > 0
trigger1 = command = "y" 
trigger1 = !ailevel
value = 1052

[state 1050, Dive Kick]
type = changestate
triggerall = animelemtime(3) > 0
trigger1 = command = "a"
trigger1 = !ailevel
value = 635

[state 1050, Escape]
type = changestate
triggerall = animelemtime(3) > 0
trigger1 = command = "x"
trigger1 = !ailevel
value = 1054


[state 1050, End]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 1059


;---------------------------------------------------------------------------
;Butt Drop
[statedef 1051]
type    = A
movetype= A
physics = N
poweradd= 80
ctrl = 0
sprpriority = 2
velset = 0,0


[state 1051, animation]
type = changeanim
trigger1 = anim != 650
value = 650

[state 1051, armor counter]
type = varset
trigger1 = time = 0
trigger1 = Var(21) = 1
V = 20
value = 1

[state 1051, armor intiator turn off]
type = varset
trigger1 = time = 1
V = 21
value = 0

[state 1051, armor count down]
type = varadd
trigger1 = gethitvar(damage) != 0
V = 20
value = -1
persistent = 1

[state 1051, still take damage]
type = lifeadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) != 0
value = floor(-gethitvar(damage)*0.75)
persistent = 1
ignorehitpause

[state 1051, Unstoppable]
type = hitoverride
trigger1 = Life > 1
trigger1 = var(20) > 0
attr = SCA, AA, AP
stateno = 650
time = 1
persistent = 1
ignorehitpause

[State 1051, flash red]
type = PalFX
trigger1 = Time = 0
trigger1 = gethitvar(damage) != 0
time = 7
add = 150,0,0
IgnoreHitPause = 1

[State 1051, 3]
type = HitDef
trigger1 = vel y > 0
trigger1 = !movecontact || !movereversed
persistent = 0
attr = A, SA
damage    = 200,40
guardflag = HA
hitflag = MAFD
id = 1051
nochainid = 1051
priority = 4
pausetime = 0,0
sparkno = 3
sparkxy = 0,0
Hitsound = S5000, 2
guardsound = S120,0
animtype = heavy
ground.type = high
ground.slidetime = 22
ground.hittime  = 22
ground.velocity = 0
air.velocity = 0,0
down.hittime = 60
guard.velocity = -30            
guard.hittime = 30
guard.slidetime = 30
airguard.velocity = -10,10
airguard.hittime = 35
guard.cornerpush.veloff = -120
guard.dist = 200


;determine what frame
[state 1051, remember frame]
type = varset
trigger1 = time <= 0
v = 22
value = animelemno(0)
ignorehitpause = 1

;delay effect
[state 1051, delay]
type = changeanim 
trigger1 = var(31) < floor(gethitvar(hittime)*0.8)
value = anim
elem = var(22)

[state 1051, freeze location]
type = posfreeze
trigger1 = var(31) < floor(gethitvar(hittime)*0.8)
value = 1
;--------------------------

[state 1051, enemy state]
type = targetstate
triggerall = vel y > 0
trigger1 = movehit
trigger1 = enemy,statetype != A
value = 660

;Ride down mechanic
[state 1051, Ride down]
type = targetbind
trigger1 = movehit
trigger1 = enemy,statetype = A
pos = 0, -20

[state 1051, state of ride down]
type = targetstate
trigger1 = movehit
trigger1 = enemy,statetype = A
value = 655

[state 1051, gravity]
type = veladd
trigger1 = animelemtime(4) > 0
y = 7.5

[state 1051, playerpush]
type = playerpush
trigger1 = 1
value = 0

[state 1051, combo damage]
type = varadd
trigger1 = movehit
v = 18
value = -3

[state 1051, end]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 651

;--------------------------------------------------------------------------
[statedef 1052]
type = A
movetype = A
physics = N
anim = 1052
poweradd = 100
sprpriority = -2

[state 1052, gravity]
type = gravity
trigger1 = 1

[State 1052, 1]
type = HitDef
Trigger1 = Time = 0
attr = S, ST         
hitflag = HA-   
getpower = 0       
priority = 1, Miss    
sparkno = -1          
p1sprpriority = -1
p2sprpriority = 1   
id = 1055                      
p1facing = 1
p2facing = 1          
p1stateno = 1055       
p2stateno = 1080       
guard.dist = 0        
fall = 1              
fall.recover = 0

[state 1002, Butt cheek]
type = explod
trigger1 = animelemtime(2)=0
anim = 1053
postype = p1
pos = 0,0
id = 1053
bindtime = -1
removeongethit = 1
removetime = -2
sprpriority = 4
scale = const(size.xscale),const(size.yscale)

[state 1050, End]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 1059

;--------------------------------------------------------------------------
;Escape
[statedef 1054]
type = A
movetype = I
physics = N
anim = 1054

[state 1054, velset]
type = velset
trigger1 = time = 0
x = 0
y = 0

[state 1054, EX refund]
type = poweradd
triggerall = prevstateno = 1070
trigger1 = time = 3
value = 500
persistent = 0

[State 1054, Blink Yellow]
type = PalFX
trigger1 = time%2
trigger1 = time < 8
time = 1
add = 100,100,100 ;32,16,0
sinadd = 64,64,64,3
ignorehitpause

[state 1054, veladd]
type = veladd
trigger1 = animelemtime(3) > 0
y = 10

[state 1054, end]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 1059


;---------------------------------------------------------------------------
;Facesit Grab
[Statedef 1055]
type    = S
movetype= A
physics = N
anim = 1055
sprpriority = -1

[state 1055, Butt cheek]
type = explod
trigger1 = time = 0
anim = 1085
postype = p1
pos = 0,0
id = 1085
bindtime = -1
removeongethit = 1
removetime = -2
sprpriority = 4
scale = const(size.xscale),const(size.yscale)

[state 1055, bounce]
type = velset
trigger1 = time = 0
y = -8

[state 1055, gravity]
type = gravity
trigger1 = 1

[State 810, Grab Sound]
type = PlaySnd
trigger1 = time = 0
value = 1, 1

[State 810, Width]
type = Width
trigger1 = 1
edge = 300,300

[State 810, Throw Sound]
type = PlaySnd
trigger1 = AnimElem = 1
value = 800, 0

;====================================
;  Grab Positioning
;====================================
[State 810, Bind 1]
type = TargetBind
trigger1 = AnimElemtime(2) < 0
pos = 250, -240
persistent = 1

[State 810, Bind 2]
type = TargetBind
trigger1 = AnimElemtime(2) >= 0 && animelemtime(3) < 0
pos = 180, -140
persistent = 1

[State 810, Bind 3]
type = TargetBind
trigger1 = AnimElemtime(3) >= 0 
pos = 130, -140
persistent = 1

;-------------------------------------


[State 810, Throw 11]
type = TargetState
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 1081

[State 810, State End]
type = ChangeState
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 1056

;--------------------------------------------------------------------------
;Landing facesit grab
[statedef 1056]
type = C
movetype = A
physics = C
anim = 1056
sprpriority = -1

[state 651, Crater]
type = explod
trigger1 = time = 0
trigger1 = !numexplod(2030)
anim = 2030
id = 2030
pos = 0,0
scale = const(size.xscale)*1,const(size.yscale)*1
sprpriority = -4

[state 651, Rubble]
type = explod
trigger1 = time = 0
trigger1 = !numexplod(2035)
anim = 2035
id = 2035
pos = 0,0
scale = const(size.xscale)*1,const(size.yscale)*1
sprpriority = -3

[state 1056, removeexplod]
type = removeexplod
trigger1 = time = 0
id = 1085

[state 1055, Butt cheek]
type = explod
trigger1 = time = 0
anim = 1086
postype = p1
pos = 0,0
id = 1086
bindtime = -1
removeongethit = 1
removetime = -2
sprpriority = 3
scale = const(size.xscale),const(size.yscale)


;====================================
;  Grab Positioning
;====================================
[State 1056, Bind 1]
type = TargetBind
trigger1 = AnimElem =1
pos = 110, 0
persistent = 1


;-------------------------------------

[State 1056, Hurt 11]
type = TargetLifeAdd
trigger1 = time = 0
value = floor(fvar(10)*-220)

[state 1102, targetpowerget]
type = targetpoweradd
trigger1 = time = 0
value = (enemynear,powermax / 1000) * 50 

[state 1102, powerget]
type = poweradd
trigger1 = time = 0
value = 150

[state 1056, velset]
type = velset
trigger1 = time = 0
x = 0
y = 0

[state 1056, posset]
type = posset
trigger1 = time = 0
y = 0


[State 1056, 4]
type = EnvShake
trigger1 = time = 0
time = 30
ampl = -48
freq = 80
phase = 80


[state 1056, velset]
type = velset
trigger1 = time = 12
y = -18

[state 1056, statetypeset]
type = statetypeset
trigger1 = time = 12
statetype = A
physics = N

[state 1056, gravity]
type = gravity
trigger1 = time > 12

[state 1056, 4]
type = playsnd
trigger1 = time = 0
value = S5100,0

[state 1056, 4]
type = playsnd
trigger1 = time = 0
value = S5100,0

[state 1056, land fx]
type = explod
trigger1 = time = 0
anim = 2010
bindtime = 1
id = 2010
pos = 0, 10
removetime = -2
sprpriority = 4
scale = 2.75,4
ownpal = 1

[state 1056, land fx]
type = explod
trigger1 = time = 0
anim = 2011
bindtime = 1
id = 2011
pos = 0, 10
removetime = -2
sprpriority = -2
scale = 2.75,4
ownpal = 1

[state 1056, changestate]
type = changestate
trigger1 = time > 12
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 1057


;--------------------------------------------------------------------------

;Landing facesit grab
[statedef 1057]
type = C
movetype = A
physics = C
anim = 1057
sprpriority = -1

[state 1067, removeexplod]
type = removeexplod
trigger1 = time = 0
id = 1086

[state 1067, Butt cheek]
type = explod
trigger1 = time = 0
anim = 1087
postype = p1
pos = 0,0
id = 1087
bindtime = -1
removeongethit = 1
removetime = -2
sprpriority = 3
scale = const(size.xscale),const(size.yscale)

[state 1067, velset]
type = velset
trigger1 = time = 0
x = 0
y = 0

[state 1067, posset]
type = posset
trigger1 = time = 0
y = 0


[State 1067, 4]
type = EnvShake
trigger1 = time = 0
time = 24
ampl = -18
freq = 80
phase = 80

[state 1056, 4]
type = playsnd
trigger1 = time = 0
value = S5100,0

[state 1077, grind add on]
type = changestate
triggerall = animelemtime(5) > 0 && animelemtime(5) < 8
trigger1 = command = "AddOn"
trigger2 = ailevel
trigger2 = random < ailevel*24
value = 1090

[state 1056, changestate]
type = changestate
trigger1 = animtime = 0
value = 657






;---------------------------------------------------------------------------
; Landing from flip
[statedef 1059]
type = C
movetype = I
physics = C
ctrl = 0

[state 1059, anim]
type = changeanim
trigger1 = time = 0
value = ifelse(prevstateno = 1052,1058,1059)

[state 1059, velset]
type = velset
trigger1 = time = 0
y = 0

[state 1059, posset]
type = posset
trigger1 = time = 0
y = 0

[State 1059, 4]
type = EnvShake
trigger1 = time = 0
time = 24
ampl = -18
freq = 100
phase = 100

[state 1059, land fx]
type = explod
trigger1 = time = 0
anim = 2000
bindtime = 1
id = 2000
pos = 0, 10
removetime = -2
sprpriority = 2
scale = 3,2.5
ownpal = 1

[state 1059, land fx]
type = explod
trigger1 = time = 0
anim = 2001
bindtime = 1
id = 2001
pos = 0, 10
removetime = -2
sprpriority = -2
scale = 3,2.5
ownpal = 1

[state 1059, 4]
type = playsnd
trigger1 = time = 0
value = S5100,0

[state 1059, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1

;--------------------------------------------------------------------------
;Jumba Flip
[statedef 1060]
type = S
movetype = I
physics = S
anim = 1050
ctrl = 0

[state 1060, after image]
type = afterimage
trigger1 = time = 0
time = 60
length = 4
framegap = 4
timegap = 2
trans = none

[state 1060, playerpush]
type = playerpush
trigger1 = time < 30
value = 0

[state 1060, gravity]
type = gravity
trigger1 = pos y < -1

[state 1060, physics]
type = statetypeset
trigger1 = animelemtime(3) = 0
physics = N
statetype = A



[state 1060, nothitby]
type = nothitby
trigger1 = animelemtime(3) >= 0
value = ,AP

[state 1060, playsnd]
type = playsnd
trigger1 = animelemtime(3) = 0
value = S41,0

[state 1050, playsnd]
type = playsnd
trigger1 = animelemtime(7) = 0
value = S1050,0
persistent = 1

[state 1060, damageset]
type = varset
trigger1 = time = 0
v = 14
value = 200

[state 1060, velset]
type = velset
trigger1 = animelemtime(3) = 0
x = 24
y = -30

[state 1060, steering]
type = veladd
triggerall = animelemtime(3) > 0
triggerall = vel x < 18
trigger1 = command = "holdfwd"
trigger1 = !ailevel
trigger2 = p2dist x > 40
trigger2 = ailevel
x = 0.6

[state 1060, steering]
type = veladd
triggerall = animelemtime(3) > 0
triggerall = vel x > 3
trigger1 = command = "holdback"
trigger1 = !ailevel
trigger2 = p2dist x < 40
trigger2 = ailevel
x = -0.6

[state 1060, butt drop]
type = changestate
triggerall = animelemtime(3) > 0
trigger1 = command = "b"
trigger1 = !ailevel
value = 1061

[state 1050, Grab Attempt]
type = changestate
triggerall = animelemtime(3) > 0
trigger1 = command = "y"
trigger1 = !ailevel
value = 1062

[state 1050, Dive Kick]
type = changestate
triggerall = animelemtime(3) > 0
trigger1 = command = "a"
trigger1 = !ailevel
value = 635

[state 1050, Escape]
type = changestate
triggerall = animelemtime(3) > 0
trigger1 = command = "x"
trigger1 = !ailevel
value = 1054


[state 1060, End]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 1069


;---------------------------------------------------------------------------
;Butt Drop
[statedef 1061]
type    = A
movetype= A
physics = N
poweradd= 120
ctrl = 0
sprpriority = 2
velset = 0,0


[state 1061, animation]
type = changeanim
trigger1 = anim != 650
value = 650

[state 1061, armor counter]
type = varset
trigger1 = time = 0
trigger1 = Var(21) = 1
V = 20
value = 1

[state 1061, armor intiator turn off]
type = varset
trigger1 = time = 1
V = 21
value = 0

[state 1061, armor count down]
type = varadd
trigger1 = gethitvar(damage) != 0
V = 20
value = -1
persistent = 1

[state 1061, still take damage]
type = lifeadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) != 0
value = floor(-gethitvar(damage)*0.75)
persistent = 1
ignorehitpause

[state 1061, Unstoppable]
type = hitoverride
trigger1 = Life > 1
trigger1 = var(20) > 0
attr = SCA, AA, AP
stateno = 650
time = 1
persistent = 1
ignorehitpause

[State 1061, flash red]
type = PalFX
trigger1 = Time = 0
trigger1 = gethitvar(damage) != 0
time = 7
add = 150,0,0
IgnoreHitPause = 1

[State 1061, 3]
type = HitDef
trigger1 = vel y > 0
trigger1 = !movecontact || !movereversed
persistent = 0
attr = A, SA
damage    = 160,32
guardflag = HA
hitflag = MAFD
id = 1051
nochainid = 1051
priority = 4
pausetime = 0,0
sparkno = 3
sparkxy = 0,0
Hitsound = S5000, 2
guardsound = S120,0
animtype = heavy
ground.type = high
ground.slidetime = 22
ground.hittime  = 22
ground.velocity = 0
air.velocity = 0,0
down.hittime = 60
guard.velocity = -30           
guard.hittime = 30
guard.slidetime = 30
airguard.velocity = -10,10
airguard.hittime = 35
guard.cornerpush.veloff = -120
guard.dist = 200


;determine what frame
[state 1061, remember frame]
type = varset
trigger1 = time <= 0
v = 22
value = animelemno(0)
ignorehitpause = 1

;delay effect
[state 1061, delay]
type = changeanim 
trigger1 = var(31) < floor(gethitvar(hittime)*0.8)
value = anim
elem = var(22)

[state 1061, freeze location]
type = posfreeze
trigger1 = var(31) < floor(gethitvar(hittime)*0.8)
value = 1
;--------------------------

[state 1061, enemy state]
type = targetstate
triggerall = vel y > 0
trigger1 = movehit
trigger1 = enemy,statetype != A
value = 660

;Ride down mechanic
[state 1061, Ride down]
type = targetbind
trigger1 = movehit
trigger1 = enemy,statetype = A
pos = 0, -20

[state 1061, state of ride down]
type = targetstate
trigger1 = movehit
trigger1 = enemy,statetype = A
value = 655

[state 1061, gravity]
type = veladd
trigger1 = animelemtime(4) > 0
y = 7.5

[state 1061, playerpush]
type = playerpush
trigger1 = 1
value = 0

[state 1061, combo damage]
type = varadd
trigger1 = movehit
v = 18
value = -3

[state 1061, end]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 651
;--------------------------------------------------------------------------
[statedef 1062]
type = A
movetype = A
physics = N
anim = 1052
poweradd = 100
sprpriority = -2

[state 1062, gravity]
type = gravity
trigger1 = 1

[State 1062, 1]
type = HitDef
Trigger1 = Time = 0
attr = S, ST         
hitflag = HA-          
priority = 1, Miss    
sparkno = -1 
getpower = 0     
p1sprpriority = -1
p2sprpriority = 1   
id = 1065                      
p1facing = 1
p2facing = 1          
p1stateno = 1065       
p2stateno = 1080       
guard.dist = 0        
fall = 1              
fall.recover = 0

[state 1062, steering]
type = veladd
triggerall = animelemtime(3) > 0
triggerall = vel x < 20
trigger1 = command = "holdfwd"
x = 0.4

[state 1062, steering]
type = veladd
triggerall = animelemtime(3) > 0
triggerall = vel x > -16
trigger1 = command = "holdback"
x = -0.4

[state 1062, Butt cheek]
type = explod
trigger1 = animelemtime(2)=0
anim = 1053
postype = p1
pos = 0,0
id = 1053
bindtime = -1
removeongethit = 1
removetime = -2
sprpriority = 4
scale = const(size.xscale),const(size.yscale)

[state 1060, End]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 1069


;---------------------------------------------------------------------------
;Facesit Grab
[Statedef 1065]
type    = S
movetype= A
physics = N
anim = 1055
sprpriority = -1

[state 1065, Butt cheek]
type = explod
trigger1 = time = 0
anim = 1085
postype = p1
pos = 0,0
id = 1085
bindtime = -1
removeongethit = 1
removetime = -2
sprpriority = 4
scale = const(size.xscale),const(size.yscale)

[state 1055, bounce]
type = velset
trigger1 = time = 0
y = -8

[state 1055, gravity]
type = gravity
trigger1 = 1

[State 810, Grab Sound]
type = PlaySnd
trigger1 = time = 0
value = 1, 1

[State 810, Width]
type = Width
trigger1 = 1
edge = 300,300

[State 810, Throw Sound]
type = PlaySnd
trigger1 = AnimElem = 1
value = 800, 0

;====================================
;  Grab Positioning
;====================================
[State 810, Bind 1]
type = TargetBind
trigger1 = AnimElemtime(2) < 0
pos = 250, -240
persistent = 1

[State 810, Bind 2]
type = TargetBind
trigger1 = AnimElemtime(2) >= 0 && animelemtime(3) < 0
pos = 180, -140
persistent = 1

[State 810, Bind 3]
type = TargetBind
trigger1 = AnimElemtime(3) >= 0 
pos = 130, -140
persistent = 1

;-------------------------------------


[State 810, Throw 11]
type = TargetState
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 1081

[State 810, State End]
type = ChangeState
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 1066

;--------------------------------------------------------------------------
;Landing facesit grab
[statedef 1066]
type = C
movetype = A
physics = C
anim = 1056
sprpriority = -1

[state 1056, removeexplod]
type = removeexplod
trigger1 = time = 0
id = 1085

[state 1055, Butt cheek]
type = explod
trigger1 = time = 0
anim = 1086
postype = p1
pos = 0,0
id = 1086
bindtime = -1
removeongethit = 1
removetime = -2
sprpriority = 3
scale = const(size.xscale),const(size.yscale)


;====================================
;  Grab Positioning
;====================================
[State 1056, Bind 1]
type = TargetBind
trigger1 = AnimElem =1
pos = 160, 0
persistent = 1


;-------------------------------------

[State 1056, Hurt 11]
type = TargetLifeAdd
trigger1 = time = 0
value = Ceil(fvar(10) * -220)

[state 1056, targetpowerget]
type = targetpoweradd
trigger1 = time = 0
value = (enemynear,powermax / 1000) * 50 

[state 1056, powerget]
type = poweradd
trigger1 = time = 0
value = 150

[state 1056, velset]
type = velset
trigger1 = time = 0
x = 0
y = 0

[state 1056, posset]
type = posset
trigger1 = time = 0
y = 0


[State 1056, 4]
type = EnvShake
trigger1 = time = 0
time = 24
ampl = -24
freq = 80
phase = 80

[state 1056, velset]
type = velset
trigger1 = time = 12
y = -21

[state 1056, statetypeset]
type = statetypeset
trigger1 = time = 12
statetype = A
physics = N

[state 1056, gravity]
type = gravity
trigger1 = time > 12


[state 1056, 4]
type = playsnd
trigger1 = time = 0
value = S5100,0

[state 1056, 4]
type = playsnd
trigger1 = time = 0
value = S5100,0





[state 1056, land fx]
type = explod
trigger1 = time = 0
anim = 2010
bindtime = 1
id = 2010
pos = 0, 10
removetime = -2
sprpriority = 4
scale = 2.75,4
ownpal = 1

[state 1056, land fx]
type = explod
trigger1 = time = 0
anim = 2011
bindtime = 1
id = 2011
pos = 0, 10
removetime = -2
sprpriority = -2
scale = 2.75,4
ownpal = 1

[state 1056, changestate]
type = changestate
trigger1 = time > 12
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 1057
;--------------------------------------------------------------------------
;Landing facesit grab
[statedef 1067]
type = C
movetype = A
physics = C
anim = 1057
sprpriority = -1

[state 1067, removeexplod]
type = removeexplod
trigger1 = time = 0
id = 1086

[state 1067, Butt cheek]
type = explod
trigger1 = time = 0
anim = 1087
postype = p1
pos = 0,0
id = 1087
bindtime = -1
removeongethit = 1
removetime = -2
sprpriority = 3
scale = const(size.xscale),const(size.yscale)

[state 1067, velset]
type = velset
trigger1 = time = 0
x = 0
y = 0

[state 1067, posset]
type = posset
trigger1 = time = 0
y = 0


[State 1067, 4]
type = EnvShake
trigger1 = time = 0
time = 24
ampl = -18
freq = 80
phase = 80

[state 1056, 4]
type = playsnd
trigger1 = time = 0
value = S5100,0

[state 1077, grind add on]
type = changestate
triggerall = animelemtime(5) >= 0 && animelemtime(5) < 8
trigger1 = command = "AddOn"
trigger2 = ailevel
trigger2 = random < ailevel*24
value = 1090

[state 1056, changestate]
type = changestate
trigger1 = animtime = 0
value = 657


;---------------------------------------------------------------------------
; Landing from flip
[statedef 1069]
type = C
movetype = I
physics = C
ctrl = 0

[state 1059, anim]
type = changeanim
trigger1 = time = 0
value = ifelse(prevstateno = 1062,1058,1059)

[state 1069, velset]
type = velset
trigger1 = time = 0
y = 0

[state 1069, posset]
type = posset
trigger1 = time = 0
y = 0

[State 1069, 4]
type = EnvShake
trigger1 = time = 0
time = 24
ampl = -18
freq = 100
phase = 100

[state 1069, land fx]
type = explod
trigger1 = time = 0
anim = 2000
bindtime = 1
id = 2000
pos = 0, 10
removetime = -2
sprpriority = 2
scale = 3,2.5
ownpal = 1

[state 1069, land fx]
type = explod
trigger1 = time = 0
anim = 2001
bindtime = 1
id = 2001
pos = 0, 10
removetime = -2
sprpriority = -2
scale = 3,2.5
ownpal = 1

[state 1069, 4]
type = playsnd
trigger1 = time = 0
value = S5100,0

[state 1069, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1



;---------------------------------------------------------------------------
;EX Jumba Flip
[statedef 1070]
type = S
movetype = A
physics = S
anim = 1050
ctrl = 0

[state 1070, poweradd]
type = poweradd
trigger1 = time = 0
value = -500

[State 1070, Blink Yellow]
type = PalFX
trigger1 = time%2
trigger1 = time < 24
time = 1
add = 150,75,0 ;32,16,0
sinadd = 64,32,5,3
ignorehitpause

[state 1060, nothitby]
type = nothitby
trigger1 = 1
value = ,AP,AT

[state 1050, playsnd]
type = playsnd
trigger1 = animelemtime(3) = 0
value = S41,0

[state 1050, playsnd]
type = playsnd
trigger1 = animelemtime(7) = 0
value = S1050,0
persistent = 1

[state 1070, gravity]
type = gravity
trigger1 = pos y < -1

[state 1070, physics]
type = statetypeset
trigger1 = animelemtime(3) = 0
physics = N
statetype = A

[state 1070, damageset]
type = varset
trigger1 = time = 0
v = 14
value = 200

[state 1070, velset]
type = velset
trigger1 = animelemtime(3) = 0
x = ifelse(p2bodydist x < 900,(p2bodydist x * 0.026),40)
y = ifelse(p2bodydist x < 700,-36,-32)

[state 1070, steering]
type = veladd
triggerall = animelemtime(3) > 0
triggerall = vel x < 36
trigger1 = command = "holdfwd"
trigger1 = !ailevel
trigger2 = p2dist x > 70
trigger2 = ailevel
x = 3.6

[state 1070, steering]
type = veladd
triggerall = animelemtime(3) > 0
triggerall = vel x > -27
trigger1 = command = "holdback"
trigger1 = !ailevel
trigger2 = p2dist x < 10
trigger2 = ailevel
x = -2.4

[state 1070, butt drop]
type = changestate
triggerall = animelemtime(3) > 0
trigger1 = command = "b"
trigger1 = !ailevel
value = 1071

[state 1070, Grab Attempt]
type = changestate
triggerall = animelemtime(3) > 0
trigger1 = command = "y"
trigger1 = !ailevel
value = 1072

[state 1070, Dive Kick]
type = changestate
triggerall = animelemtime(3) > 0
trigger1 = command = "a"
trigger1 = !ailevel
value = 635

[state 1070, Escape]
type = changestate
triggerall = animelemtime(3) > 0
trigger1 = command = "x"
trigger1 = !ailevel
value = 1054


[state 1070, End]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 1079


;---------------------------------------------------------------------------
;Butt Drop
[statedef 1071]
type    = A
movetype= A
physics = N
poweradd= 0
ctrl = 0
sprpriority = 2
velset = 0,0


[state 1071, animation]
type = changeanim
trigger1 = anim != 650
value = 650

[state 1071, armor counter]
type = varset
trigger1 = time = 0
trigger1 = Var(21) = 1
V = 20
value = 1

[state 1071, armor intiator turn off]
type = varset
trigger1 = time = 1
V = 21
value = 0

[state 1071, armor count down]
type = varadd
trigger1 = gethitvar(damage) != 0
V = 20
value = -1
persistent = 1

[state 1071, still take damage]
type = lifeadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) != 0
value = floor(-gethitvar(damage)*0.75)
persistent = 1
ignorehitpause

[state 1071, Unstoppable]
type = hitoverride
trigger1 = Life > 1
trigger1 = var(20) > 0
attr = SCA, AA, AP
stateno = 650
time = 1
persistent = 1
ignorehitpause

[State 1071, flash red]
type = PalFX
trigger1 = Time = 0
trigger1 = gethitvar(damage) != 0
time = 7
add = 150,0,0
IgnoreHitPause = 1

[State 1071, 3]
type = HitDef
trigger1 = vel y > 0
trigger1 = !movecontact || !movereversed
persistent = 0
attr = A, SA
damage    = 180,36
guardflag = HA
hitflag = MAFD
id = 1051
nochainid = 1051
priority = 4
pausetime = 0,0
sparkno = 3
sparkxy = 0,0
Hitsound = S5000, 2
guardsound = S120,0
animtype = heavy
ground.type = high
ground.slidetime = 22
ground.hittime  = 22
ground.velocity = 0
air.velocity = 0,0
down.hittime = 60
guard.velocity = -30           
guard.hittime = 30
guard.slidetime = 30
airguard.velocity = -10,10
airguard.hittime = 35
guard.cornerpush.veloff = -120
guard.dist = 200


;determine what frame
[state 1071, remember frame]
type = varset
trigger1 = time <= 0
v = 22
value = animelemno(0)
ignorehitpause = 1

;delay effect
[state 1071, delay]
type = changeanim 
trigger1 = var(31) < floor(gethitvar(hittime)*0.8)
value = anim
elem = var(22)

[state 1071, freeze location]
type = posfreeze
trigger1 = var(31) < floor(gethitvar(hittime)*0.8)
value = 1
;--------------------------

[state 1071, enemy state]
type = targetstate
triggerall = vel y > 0
trigger1 = movehit
trigger1 = enemy,statetype != A
value = 660

;Ride down mechanic
[state 1071, Ride down]
type = targetbind
trigger1 = movehit
trigger1 = enemy,statetype = A
pos = 0, -20

[state 1071, state of ride down]
type = targetstate
trigger1 = movehit
trigger1 = enemy,statetype = A
value = 655

[state 1071, gravity]
type = veladd
trigger1 = animelemtime(4) > 0
y = 7.5

[state 1071, playerpush]
type = playerpush
trigger1 = 1
value = 0

[state 1071, combo damage]
type = varadd
trigger1 = movehit
v = 18
value = -3

[state 1071, end]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 651
;--------------------------------------------------------------------------
[statedef 1072]
type = A
movetype = A
physics = N
anim = 1052
sprpriority = -2

[state 1072, gravity]
type = gravity
trigger1 = 1

[state 1072, nothitby]
type = nothitby
trigger1 = time < 15
value = ,AP

[State 1072, 1]
type = HitDef
Trigger1 = Time = 0
attr = S, ST         
hitflag = HAF          
priority = 1, Miss    
sparkno = -1          
p1sprpriority = -1
p2sprpriority = 1   
id = 1075                      
p1facing = 1
p2facing = 1          
p1stateno = 1065       
p2stateno = 1080       
guard.dist = 0        
fall = 1              
fall.recover = 0

[state 1072, steering]
type = veladd
triggerall = animelemtime(3) > 0
triggerall = vel x < 20
trigger1 = command = "holdfwd"
x = 1.6

[state 1072, steering]
type = veladd
triggerall = animelemtime(3) > 0
triggerall = vel x > -16
trigger1 = command = "holdback"
x = -1.6

[state 1072, Butt cheek]
type = explod
trigger1 = animelemtime(2)=0
anim = 1053
postype = p1
pos = 0,0
id = 1053
bindtime = -1
removeongethit = 1
removetime = -2
sprpriority = 4
scale = const(size.xscale),const(size.yscale)

[state 1072, End]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 1079


;---------------------------------------------------------------------------
;Facesit Grab
[Statedef 1075]
type    = S
movetype= A
physics = N
anim = 1055
poweradd = 240
sprpriority = -1

[state 1075, Butt cheek]
type = explod
trigger1 = time = 0
anim = 1085
postype = p1
pos = 0,0
id = 1085
bindtime = -1
removeongethit = 1
removetime = -2
sprpriority = 4
scale = const(size.xscale),const(size.yscale)

[state 1075, bounce]
type = velset
trigger1 = time = 0
y = -8

[state 1075, gravity]
type = gravity
trigger1 = 1

[State 1075, Grab Sound]
type = PlaySnd
trigger1 = time = 0
value = 1, 1

[State 1075, Width]
type = Width
trigger1 = 1
edge = 300,300

[State 1075, Throw Sound]
type = PlaySnd
trigger1 = AnimElem = 1
value = 800, 0

;====================================
;  Grab Positioning
;====================================
[State 1075, Bind 1]
type = TargetBind
trigger1 = AnimElemtime(2) < 0
pos = 250, -240
persistent = 1

[State 1075, Bind 2]
type = TargetBind
trigger1 = AnimElemtime(2) >= 0 && animelemtime(3) < 0
pos = 180, -140
persistent = 1

[State 1075, Bind 3]
type = TargetBind
trigger1 = AnimElemtime(3) >= 0 
pos = 130, -140
persistent = 1

;-------------------------------------


[State 1075, Throw 11]
type = TargetState
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 1081

[State 1075, State End]
type = ChangeState
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 1066

;--------------------------------------------------------------------------
;Landing facesit grab
[statedef 1076]
type = C
movetype = A
physics = C
anim = 1056
sprpriority = -1

[state 1076, removeexplod]
type = removeexplod
trigger1 = time = 0
id = 1085

[state 1075, Butt cheek]
type = explod
trigger1 = time = 0
anim = 1086
postype = p1
pos = 0,0
id = 1086
bindtime = -1
removeongethit = 1
removetime = -2
sprpriority = 3
scale = const(size.xscale),const(size.yscale)


;====================================
;  Grab Positioning
;====================================
[State 1076, Bind 1]
type = TargetBind
trigger1 = AnimElem =1
pos = 160, 0
persistent = 1


;-------------------------------------

[State 1076, Hurt 11]
type = TargetLifeAdd
trigger1 = time = 0
value = -180

[state 1102, targetpowerget]
type = targetpoweradd
trigger1 = time = 0
value = (enemynear,powermax / 1000) * 40 

[state 1102, powerget]
type = poweradd
trigger1 = time = 0
value = 0

[state 1076, velset]
type = velset
trigger1 = time = 0
x = 0
y = 0

[state 1076, posset]
type = posset
trigger1 = time = 0
y = 0


[State 1076, 4]
type = EnvShake
trigger1 = time = 0
time = 24
ampl = -24
freq = 80
phase = 80

[state 1076, velset]
type = velset
trigger1 = time = 12
y = -21

[state 1076, statetypeset]
type = statetypeset
trigger1 = time = 12
statetype = A
physics = N

[state 1076, gravity]
type = gravity
trigger1 = time > 12


[state 1076, 4]
type = playsnd
trigger1 = time = 0
value = S5100,0

[state 1076, 4]
type = playsnd
trigger1 = time = 0
value = S5100,0





[state 1056, land fx]
type = explod
trigger1 = time = 0
anim = 2010
bindtime = 1
id = 2010
pos = 0, 10
removetime = -2
sprpriority = 4
scale = 2.75,4
ownpal = 1

[state 1056, land fx]
type = explod
trigger1 = time = 0
anim = 2011
bindtime = 1
id = 2011
pos = 0, 10
removetime = -2
sprpriority = -2
scale = 2.75,4
ownpal = 1

[state 1076, changestate]
type = changestate
trigger1 = time > 12
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 1077
;--------------------------------------------------------------------------
;Landing facesit grab
[statedef 1077]
type = C
movetype = A
physics = C
anim = 1057
sprpriority = -1

[state 1077, removeexplod]
type = removeexplod
trigger1 = time = 0
id = 1086

[state 1077, Butt cheek]
type = explod
trigger1 = time = 0
anim = 1087
postype = p1
pos = 0,0
id = 1087
bindtime = -1
removeongethit = 1
removetime = -2
sprpriority = 3
scale = const(size.xscale),const(size.yscale)

[state 1077, velset]
type = velset
trigger1 = time = 0
x = 0
y = 0

[state 1077, posset]
type = posset
trigger1 = time = 0
y = 0


[State 1077, 4]
type = EnvShake
trigger1 = time = 0
time = 24
ampl = -18
freq = 80
phase = 80

[state 1077, 4]
type = playsnd
trigger1 = time = 0
value = S5100,0

[state 1077, grind add on]
type = changestate
triggerall = animelemtime(5) >= 0 && animelemtime(5) < 8
trigger1 = command = "AddOn"
trigger2 = ailevel
trigger2 = random < ailevel*24
value = 1090

[state 1077, changestate]
type = changestate
trigger1 = animtime = 0
value = 657


;---------------------------------------------------------------------------
; Landing from flip
[statedef 1079]
type = C
movetype = I
physics = C
ctrl = 0

[state 1079, anim]
type = changeanim
trigger1 = time = 0
value = ifelse(prevstateno = 1062,1058,1059)

[state 1079, velset]
type = velset
trigger1 = time = 0
y = 0

[state 1079, posset]
type = posset
trigger1 = time = 0
y = 0

[State 1079, 4]
type = EnvShake
trigger1 = time = 0
time = 24
ampl = -18
freq = 100
phase = 100

[state 1079, land fx]
type = explod
trigger1 = time = 0
anim = 2000
bindtime = 1
id = 2000
pos = 0, 10
removetime = -2
sprpriority = 2
scale = 3,2.5
ownpal = 1

[state 1079, land fx]
type = explod
trigger1 = time = 0
anim = 2001
bindtime = 1
id = 2001
pos = 0, 10
removetime = -2
sprpriority = -2
scale = 3,2.5
ownpal = 1

[state 1079, 4]
type = playsnd
trigger1 = time = 0
value = S5100,0

[state 1079, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1



;---------------------------------------------------------------------------

;Victim Animation

[Statedef 1080]
type    = A
movetype= H
physics = N
sprpriority = 1

[state 1080, screenbound]
type = screenbound
trigger1 = 1
value = 0
movecamera = 0,0



[State 1080, 1]
type = ChangeAnim2
Trigger1 = Time = 0
value = 1080

[State 1080, 2]
type = SelfState
trigger1 = time > 80
value = 5050

;---------------------------------------------------------------------------
;Thrown by Kung Fu Throw - thrown into the air
; (a custom gethit state)
; Description: This state has the opponent flying through the air and
;     falling down onto the ground. The SelfState controller sets the
;     opponent back using to his own state file when he his the ground.
;     Controllers 821,2 and 821,3 allow the opponent to recover by
;     hitting his recovery command when he is falling.
[Statedef 1081]
type    = L
movetype= H
physics = N
velset = 0,0
poweradd = 40
sprpriority = 1

[state 1081, changeanim2]
type = changeanim2
trigger1 = time = 0
value = 1081

[state 1081, angledraw]
type = angledraw
trigger1 = 1
scale = 1.3,0.1

[state 1081, posset]
type = posset
trigger1 = time = 0
y = 0 


[State 821, 4] ;Hit ground
type = SelfState
trigger1 = life > 0
trigger1 = time > 140
value = 5120 ;Hit ground

[State 821, 4] ;Hit ground
type = changeState
trigger1 = !alive
trigger1 = time > 40
value = 5150 ;Hit ground


;---------------------------------------------------------------------------
;Butt Grind add on
[statedef 1090]
type = C
movetype = A
physics = C
anim = 1090
sprpriority = -2

[state 654, playerpush]
type = playerpush
trigger1 = 1
value = 0

[state 1090, nothitby]
type = nothitby
trigger1 = 1
value = SCA
ignorehitpause = 1

[state 654, targetstate]
type = targetstate
trigger1 = numtarget(1055) || numtarget(1065) || numtarget(1075) || numtarget(1045)
trigger1 = time = 0
value = 662

[state 1002, Butt cheek]
type = explod
trigger1 = animelemtime(1) = 0
trigger1 = numexplod(1090) = 0
anim = 1091
postype = p1
pos = 0,0
id = 1090
bindtime = -1
removeongethit = 1
removetime = -1
sprpriority = 3
scale = const(size.xscale),const(size.yscale)
ignorehitpause = 1



[state 52, front foot front dust]
type = explod
trigger1 = animelemtime(1) >= 0 && animelemtime(3) < 6
trigger2 = animelemtime(4) >= 0 && animelemtime(6) < 6
anim = F120
pos = 80,20
scale = 2, 2
vel = -2,-1
sprpriority = 5
persistent =8

[state 52, front foot front dust]
type = explod
trigger1 = animelemtime(1) >= 0 && animelemtime(3) < 6
trigger2 = animelemtime(4) >= 0 && animelemtime(6) < 6
anim = F120
pos = 340,-20
scale = 2, 2
vel = -2,-1
sprpriority = -3
persistent =8

[state 654, playsnd]
type = playsnd
trigger1 = animelemtime(3) = 0
trigger2 = animelemtime(8) = 8
value = S654,0

[state 654, veladd]
type = veladd
trigger1 = animelemtime(1) >= 0 && animelemtime(3) < 6 
x = -0.6

[state 654, veladd]
type = veladd
trigger1 = animelemtime(4) >= 0 && animelemtime(6) < 6
x = 0.6




[state 654, targetlifeadd]
type = targetlifeadd
trigger1 = numtarget(1055) || numtarget(1065) || numtarget(1075) || numtarget(1045)
value = floor(fvar(10)*-2)
persistent = 8

[state 654, poweradd]
type = poweradd
triggerall = !numtarget(1075)
trigger1 = power != powermax
persistent = 8
value = 50

[state 654, targetlifeadd]
type = lifeadd
trigger1 = numtarget(1055) || numtarget(1065) || numtarget(1075) || numtarget(1045)
value = ifelse(power != powermax, 3, 6)
persistent = 8


[state 654, poweradd]
type = targetpoweradd
trigger1 = time < 80
persistent = 8
value = 10

[state 654, end]
type = changestate
trigger1 = time > 80
value = 657

;===========================================================================
; Izuna Drop: Air to Air Command Grab
;===========================================================================
[statedef 1100]
type = A
movetype = A
physics = N
anim = 1100
ctrl = 0
poweradd = 80

[state 1100, 1]
type = velmul
trigger1 = time = 0
x = 0
y = 0.25

[State 1100, 1]
type = HitDef
Trigger1 = Time = 0
attr = S, ST         
hitflag = A-          
priority = 1, Miss    
sparkno = -1          
p1sprpriority = 1     
id = 1100                      
p1facing = 1
p2facing = 1          
p1stateno = 1101       
p2stateno = 1130       
guard.dist = 0        
fall = 1              
fall.yvelocity = -24
fall.recover = 0


[state 1100, end]
type = changestate
trigger1 = animtime = 0
value = 50
ctrl = 1

[state 1100, 1]
type = velmul
trigger1 = vel y > 0
trigger1 = pos y > -120
y = 0

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -3
persistent = 0
ignorehitpause = 1

[state 1100, end2]
type = changestate
trigger1 = vel y  > 0
trigger1 = pos y > -vel y 
value = 52

;---------------------------------------------------------------------------
;Izuna Drop animation
[statedef 1101]
type = A
movetype = A
physics = N
anim = 1101
sprpriority = 1

[State 1101, Grab Sound]
type = PlaySnd
trigger1 = time = 0
value = 1, 1

[state 1101, velset]
type = velset
trigger1 = animelemtime(1) = 4
y = -27

[state 1101, velset]
type = velset
trigger1 = animelemtime(7) = 0
x = ifelse(backedgebodydist < 60, 16,-8)

[state 1101, wall bounce]
type = velmul
trigger1 = frontedgebodydist < 30
trigger2 = backedgebodydist < 30
x = -2
persistent = 60

[state 1101, gravity]
type = gravity
trigger1 = animelemtime(7) > 0

;====================================
;  Grab Positioning
;====================================
[State 810, Bind 1]
type = TargetBind
trigger1 = AnimElemTime(2) < 0
pos = 250, -700

[State 810, Bind 2]
type = TargetBind
trigger1 = AnimElemTime(2) >= 0 && AnimElemTime(3) < 0
pos = 220, -700

[State 810, Bind 3]
type = TargetBind
trigger1 = AnimElemTime(3) >= 0 && AnimElemTime(4) < 0
pos = -250, -700

[State 810, Bind 4]
type = TargetBind
trigger1 = AnimElemTime(4) >= 0 && AnimElemTime(5) < 0
pos = -280, -700

[State 810, Bind 5]
type = TargetBind
trigger1 = AnimElemTime(5) >= 0 && AnimElemTime(6) < 0
pos = -160, -700

[State 810, Bind 6]
type = TargetBind
trigger1 = AnimElemTime(6) >= 0 && AnimElemTime(7) < 0
pos = 20, -700

[State 810, Bind 7]
type = TargetBind
trigger1 = AnimElemTime(7) >= 0 && AnimElemTime(8) < 0
pos = 150, -300

[State 810, Bind 8]
type = TargetBind
trigger1 = AnimElemTime(8) >= 0 && AnimElemTime(9) < 0
pos = -200, -220

[State 810, Bind 9]
type = TargetBind
trigger1 = AnimElemTime(9) >= 0 && AnimElemTime(10) < 0
pos = -250, 10

[State 810, Bind 10]
type = TargetBind
trigger1 = AnimElemTime(10) >= 0 && AnimElemTime(11) < 0
pos = -200, 10

[State 810, Bind 11]
type = TargetBind
trigger1 = AnimElemTime(11) >= 0 && AnimElemTime(12) < 0
pos = 180, 10

[State 810, Bind 12]
type = TargetBind
trigger1 = AnimElemTime(12) >= 0 && AnimElemTime(13) < 0
pos = 240, 10

[State 810, Bind 13]
type = TargetBind
trigger1 = AnimElemTime(13) >= 0 && AnimElemTime(14) < 0
pos = 180, 10

[State 810, Bind 14]
type = TargetBind
trigger1 = AnimElemTime(14) >= 0 && AnimElemTime(14) < 4
pos = -56, 10

;=========================================
;End Positioning
;=========================================

[state 1131, wind snd]
type = playsnd
trigger1 = animelemtime(9) =0
trigger2 = animelemtime(12) = 0
trigger3 = animelemtime(2) = 0
trigger4 = animelemtime(4) = 0
value = S1050,0
persistent = 1

[state 1131, wind snd]
type = playsnd
trigger1 = animelemtime(1) = 4
value = S41,0
persistent = 1



;=========================================
;Sprite Priority
;=========================================
[state 1130, sprpriority]
type = sprpriority
trigger1 = animelem = 1
value = 3

[state 1130, sprpriority]
type = sprpriority
trigger1 = animelem = 5
value = -3


[state 1130, sprpriority]
type = sprpriority
trigger1 = animelem = 7
value = 3

[state 1130, sprpriority]
type = sprpriority
trigger1 = animelem = 10
value = -3

[state 1130, sprpriority]
type = sprpriority
trigger1 = animelem = 13
value = 3

[state 1101, end]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 1102


;---------------------------------------------------------------------------
;Izuna Drop Landing
[statedef 1102]
type = A
movetype = A
physics = N
anim = 1102
sprpriority = 3

;----------------------
; FX
;----------------------
;Custom Dust
[state 1102, explod]
type = explod
trigger1 = time = 0
anim = 2000
pos = 250,0
scale = const(size.xscale)*3.5,const(size.yscale)*2
sprpriority = 4
ownpal = 1

[state 1102, targetstate]
type = targetstate
trigger1 = time = 0
value = 1133

[state 651, fx]
type = explod
trigger1 = time = 0
anim = F61
pos = 250,0
scale = 4,2
ownpal = 1
sprpriority = -4


[state 651, explod]
type = explod
trigger1 = time = 0
anim = 2001
pos = 250,0
scale =  const(size.xscale)*3.5,const(size.yscale)*2
sprpriority = -4
ownpal = 1

[state 1102, snd]
type = playsnd
trigger1 = time = 0
value =S5100,0

[state 1102, snd]
type = playsnd
trigger1 = time = 0
value =S5100,0

[state 651, earthquakes]
type = envshake
trigger1 = time = 0
time = 24
ampl = -32
freq = 60
phase = 60

; -------------------

[state 1102, on ground]
type = velset
trigger1 = time = 0
x = 0
y = 0

[State 810, Bind 2]
type = TargetBind
trigger1 = AnimElemTime(2) < 0 
pos = 220, 50

[state 1102, targetdamage]
type = targetlifeadd
trigger1 = time = 0
value = ceil(-180*fvar(10))

[state 1102, targetpowerget]
type = targetpoweradd
trigger1 = time = 0
value = (enemynear,powermax / 1000) * 70 

[state 1102, powerget]
type = poweradd
trigger1 = time = 0
value = 220

[state 1102, targetstate]
type = targetstate
trigger1 = time = 24
value = 1131

[state 1102, on ground]
type = posset
trigger1 = time = 0
y = 0

[state 1102, bounce off]
type = velset
trigger1 = time = 24
x = -8
y = -40

[state 1102, gravity]
type = gravity
trigger1 = time > 24

[state 1102, end]
type = changestate
trigger1 = time > 24
trigger1 = vel y > 0
trigger1 = pos y > -vel y 
value = 52

;---------------------------------------------------------------------------
;Heavy Izuna Drop
[statedef 1110]
type = A
movetype = A
physics = N
anim = 1110
ctrl = 0
poweradd = 80

[state 1110, 1]
type = velmul
trigger1 = time = 0
x = 0
y = 0.25

[State 1100, 1]
type = HitDef
Trigger1 = Time = 0
attr = S, ST         
hitflag = A-          
priority = 1, Miss    
sparkno = -1          
p1sprpriority = 1     
id = 1110                      
p1facing = 1
p2facing = 1          
p1stateno = 1111       
p2stateno = 1130       
guard.dist = 0        
fall = 1              
fall.yvelocity = -24
fall.recover = 0

[state 1110, 1]
type = velmul
trigger1 = vel y > 0
trigger1 = pos y > -120
y = 0

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -3
persistent = 0
ignorehitpause = 1

[state 1100, end]
type = changestate
trigger1 = animtime = 0
value = 50
ctrl = 1

[state 1100, end2]
type = changestate
trigger1 = vel y  > 0
trigger1 = pos y > -vel y 
value = 52


;---------------------------------------------------------------------------
;Izuna Drop animation
[statedef 1111]
type = A
movetype = A
physics = N
anim = 1101
sprpriority = 1

[State 1111, Grab Sound]
type = PlaySnd
trigger1 = time = 0
value = 1, 1

[state 1111, velset]
type = velset
trigger1 = animelemtime(1) = 4
y = -36

[state 1111, velset]
type = velset
trigger1 = animelemtime(7) = 0
x = ifelse(backedgebodydist < 60, 16,-8)

[state 1101, wall bounce]
type = velmul
trigger1 = frontedgebodydist < 30
trigger2 = backedgebodydist < 30
x = -2
persistent = 60

[state 1111, gravity]
type = gravity
trigger1 = animelemtime(7) > 0

;====================================
;  Grab Positioning
;====================================
[State 810, Bind 1]
type = TargetBind
trigger1 = AnimElemTime(2) < 0
pos = 250, -700

[State 810, Bind 2]
type = TargetBind
trigger1 = AnimElemTime(2) >= 0 && AnimElemTime(3) < 0
pos = 220, -700

[State 810, Bind 3]
type = TargetBind
trigger1 = AnimElemTime(3) >= 0 && AnimElemTime(4) < 0
pos = -250, -700

[State 810, Bind 4]
type = TargetBind
trigger1 = AnimElemTime(4) >= 0 && AnimElemTime(5) < 0
pos = -280, -700

[State 810, Bind 5]
type = TargetBind
trigger1 = AnimElemTime(5) >= 0 && AnimElemTime(6) < 0
pos = -160, -700

[State 810, Bind 6]
type = TargetBind
trigger1 = AnimElemTime(6) >= 0 && AnimElemTime(7) < 0
pos = 20, -700

[State 810, Bind 7]
type = TargetBind
trigger1 = AnimElemTime(7) >= 0 && AnimElemTime(8) < 0
pos = 150, -300

[State 810, Bind 8]
type = TargetBind
trigger1 = AnimElemTime(8) >= 0 && AnimElemTime(9) < 0
pos = -200, -220

[State 810, Bind 9]
type = TargetBind
trigger1 = AnimElemTime(9) >= 0 && AnimElemTime(10) < 0
pos = -250, 10

[State 810, Bind 10]
type = TargetBind
trigger1 = AnimElemTime(10) >= 0 && AnimElemTime(11) < 0
pos = -200, 10

[State 810, Bind 11]
type = TargetBind
trigger1 = AnimElemTime(11) >= 0 && AnimElemTime(12) < 0
pos = 180, 10

[State 810, Bind 12]
type = TargetBind
trigger1 = AnimElemTime(12) >= 0 && AnimElemTime(13) < 0
pos = 240, 10

[State 810, Bind 13]
type = TargetBind
trigger1 = AnimElemTime(13) >= 0 && AnimElemTime(14) < 0
pos = 180, 10

[State 810, Bind 14]
type = TargetBind
trigger1 = AnimElemTime(14) >= 0 && AnimElemTime(14) < 4
pos = -56, 10

;=========================================
;End Positioning
;=========================================

[state 1111, wind snd]
type = playsnd
trigger1 = animelemtime(9) =0
trigger2 = animelemtime(12) = 0
trigger3 = animelemtime(2) = 0
trigger4 = animelemtime(4) = 0
value = S1050,0
persistent = 1

[state 1111, wind snd]
type = playsnd
trigger1 = animelemtime(1) = 4
value = S41,0
persistent = 1



;=========================================
;Sprite Priority
;=========================================
[state 1111, sprpriority]
type = sprpriority
trigger1 = animelem = 1
value = 3

[state 1111, sprpriority]
type = sprpriority
trigger1 = animelem = 5
value = -3


[state 1111, sprpriority]
type = sprpriority
trigger1 = animelem = 7
value = 3

[state 1111, sprpriority]
type = sprpriority
trigger1 = animelem = 10
value = -3

[state 1111, sprpriority]
type = sprpriority
trigger1 = animelem = 13
value = 3

[state 1111, end]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 1112


;---------------------------------------------------------------------------
;Izuna Drop Landing
[statedef 1112]
type = A
movetype = A
physics = N
anim = 1102
sprpriority = 3

[state 1112, targetstate]
type = targetstate
trigger1 = time = 0
value = 1133

;----------------------
; FX
;----------------------
;Custom Dust
[state 1102, explod]
type = explod
trigger1 = time = 0
anim = 2000
pos = 250,0
scale = const(size.xscale)*3.5,const(size.yscale)*2
sprpriority = 4
ownpal = 1

[state 1102, targetstate]
type = targetstate
trigger1 = time = 0
value = 1133

[state 651, fx]
type = explod
trigger1 = time = 0
anim = F61
pos = 250,0
scale = 4,2
ownpal = 1
sprpriority = -4


[state 651, explod]
type = explod
trigger1 = time = 0
anim = 2001
pos = 250,0
scale =  const(size.xscale)*3.5,const(size.yscale)*2
sprpriority = -4
ownpal = 1

[state 1112, snd]
type = playsnd
trigger1 = time = 0
value =S5100,0

[state 1112, snd]
type = playsnd
trigger1 = time = 0
value =S5100,0

[state 1112, earthquakes]
type = envshake
trigger1 = time = 0
time = 24
ampl = -32
freq = 60
phase = 60

; -------------------

[state 1112, on ground]
type = velset
trigger1 = time = 0
x = 0
y = 0

[State 1112, Bind 2]
type = TargetBind
trigger1 = AnimElemTime(2) < 0 
pos = 220, 50

[state 1112, targetdamage]
type = targetlifeadd
trigger1 = time = 0
value = ceil(-240*fvar(10))

[state 1102, targetpowerget]
type = targetpoweradd
trigger1 = time = 0
value = (enemynear,powermax / 1000) * 80 

[state 1102, powerget]
type = poweradd
trigger1 = time = 0
value = 260

[state 1112, targetstate]
type = targetstate
trigger1 = time = 24
value = 1131

[state 1102, on ground]
type = posset
trigger1 = time = 0
y = 0

[state 1112, bounce off]
type = velset
trigger1 = time = 24
x = -6
y = -40

[state 1112, gravity]
type = gravity
trigger1 = time > 24

[state 1112, end]
type = changestate
trigger1 = time > 24
trigger1 = vel y > 0
trigger1 = pos y > -vel y 
value = 52

;---------------------------------------------------------------------------
;EX Izuna Drop
[statedef 1120]
type = A
movetype = A
physics = N
anim = 1120
ctrl = 0

[state 1120, velset lunge]
type = veladd
trigger1 = time = 0
x = 20

[State 1120, Blink Yellow]
type = PalFX
trigger1 = time%2
time = 1
add = 150,75,0 ;32,16,0
sinadd = 64,32,5,3
ignorehitpause

[state 1120, poweradd]
type = poweradd
trigger1 = time = 0
value = -500

[state 1120, nothitby]
type = nothitby
trigger1 = time < 12
value = SCA

[state 1120, 1]
type = velmul
trigger1 = time = 1
x = 0
y = 0.25

[State 1120, 1]
type = HitDef
Trigger1 = Time = 0
attr = S, ST         
hitflag = AF          
priority = 1, Miss    
sparkno = -1          
p1sprpriority = 1     
id = 1120                      
p1facing = 1
p2facing = 1          
p1stateno = 1121       
p2stateno = 1132       
guard.dist = 0        
fall = 1              
fall.yvelocity = -24
fall.recover = 0

[state 1120, 1]
type = velmul
trigger1 = vel y > 0
trigger1 = pos y > -120
y = 0

[state x, combo damage score]
type = varadd
trigger1 = time = 0
v = 18
value = -3
persistent = 0
ignorehitpause = 1

[state 1120, end]
type = changestate
trigger1 = animtime = 0
value = 50
ctrl = 1

[state 1120, end2]
type = changestate
trigger1 = vel y  > 0
trigger1 = pos y > -vel y 
value = 52


;---------------------------------------------------------------------------
;Izuna Drop animation
[statedef 1121]
type = A
movetype = A
physics = N
anim = 1121
sprpriority = 1

[State 1121, Grab Sound]
type = PlaySnd
trigger1 = time = 0
value = 1, 1

[state 1121, velset]
type = velset
trigger1 = animelemtime(1) = 4
y = -45

[State 1120, Blink Yellow]
type = PalFX
trigger1 = time%2
trigger1 = time < 24
time = 1
add = 150,75,0 ;32,16,0
sinadd = 64,32,5,3
ignorehitpause

[state 1121, velset]
type = velset
trigger1 = animelemtime(7) = 0
x = ifelse(backedgebodydist < 60, 16,-8)

[state 1101, wall bounce]
type = velmul
trigger1 = frontedgebodydist < 30
trigger2 = backedgebodydist < 30
x = -2
persistent = 60

[state 1121, gravity]
type = gravity
trigger1 = animelemtime(7) > 0

;====================================
;  Grab Positioning
;====================================
[State 810, Bind 1]
type = TargetBind
trigger1 = AnimElemTime(2) < 0
pos = 250, -700

[State 810, Bind 2]
type = TargetBind
trigger1 = AnimElemTime(2) >= 0 && AnimElemTime(3) < 0
pos = 220, -700

[State 810, Bind 3]
type = TargetBind
trigger1 = AnimElemTime(3) >= 0 && AnimElemTime(4) < 0
pos = -250, -700

[State 810, Bind 4]
type = TargetBind
trigger1 = AnimElemTime(4) >= 0 && AnimElemTime(5) < 0
pos = -280, -700

[State 810, Bind 5]
type = TargetBind
trigger1 = AnimElemTime(5) >= 0 && AnimElemTime(6) < 0
pos = -160, -700

[State 810, Bind 6]
type = TargetBind
trigger1 = AnimElemTime(6) >= 0 && AnimElemTime(7) < 0
pos = 20, -700

[State 810, Bind 7]
type = TargetBind
trigger1 = AnimElemTime(7) >= 0 && AnimElemTime(8) < 0
pos = 150, -300

[State 810, Bind 8]
type = TargetBind
trigger1 = AnimElemTime(8) >= 0 && AnimElemTime(9) < 0
pos = -200, -220

[State 810, Bind 9]
type = TargetBind
trigger1 = AnimElemTime(9) >= 0 && AnimElemTime(10) < 0
pos = -250, 10

[State 810, Bind 10]
type = TargetBind
trigger1 = AnimElemTime(10) >= 0 && AnimElemTime(11) < 0
pos = -200, 10

[State 810, Bind 11]
type = TargetBind
trigger1 = AnimElemTime(11) >= 0 && AnimElemTime(12) < 0
pos = 180, 10

[State 810, Bind 12]
type = TargetBind
trigger1 = AnimElemTime(12) >= 0 && AnimElemTime(13) < 0
pos = 240, 10

[State 810, Bind 13]
type = TargetBind
trigger1 = AnimElemTime(13) >= 0 && AnimElemTime(14) < 0
pos = 180, 10

[State 810, Bind 14]
type = TargetBind
trigger1 = AnimElemTime(14) >= 0 && AnimElemTime(14) < 4
pos = -56, 10

;=========================================
;End Positioning
;=========================================

[state 1121, wind snd]
type = playsnd
trigger1 = animelemtime(9) =0
trigger2 = animelemtime(12) = 0
trigger3 = animelemtime(2) = 0
trigger4 = animelemtime(4) = 0
value = S1050,0
persistent = 1

[state 1121, wind snd]
type = playsnd
trigger1 = animelemtime(1) = 4
value = S41,0
persistent = 1



;=========================================
;Sprite Priority
;=========================================
[state 1121, sprpriority]
type = sprpriority
trigger1 = animelem = 1
value = 3

[state 1121, sprpriority]
type = sprpriority
trigger1 = animelem = 5
value = -3


[state 1121, sprpriority]
type = sprpriority
trigger1 = animelem = 7
value = 3

[state 1121, sprpriority]
type = sprpriority
trigger1 = animelem = 10
value = -3

[state 1121, sprpriority]
type = sprpriority
trigger1 = animelem = 13
value = 3

[state 1121, end]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 1122


;---------------------------------------------------------------------------
;Izuna Drop Landing
[statedef 1122]
type = A
movetype = A
physics = N
anim = 1102
sprpriority = 3

[state 1122, targetstate]
type = targetstate
trigger1 = time = 0
value = 1133
;----------------------
; FX
;----------------------

[State 1120, Blink Yellow]
type = PalFX
trigger1 = time%2
time = 1
add = 150,75,0 ;32,16,0
sinadd = 64,32,5,3
ignorehitpause

;Custom Dust
[state 1102, explod]
type = explod
trigger1 = time = 0
anim = 2000
pos = 250,0
scale = const(size.xscale)*3.5,const(size.yscale)*2
sprpriority = 4
ownpal = 1


[state 651, fx]
type = explod
trigger1 = time = 0
anim = F61
pos = 250,0
scale = 4,2
ownpal = 1
sprpriority = -4


[state 651, explod]
type = explod
trigger1 = time = 0
anim = 2001
pos = 250,0
scale =  const(size.xscale)*3.5,const(size.yscale)*2
sprpriority = -4
ownpal = 1

[state 1122, snd]
type = playsnd
trigger1 = time = 0
value =S5100,0

[state 1112, snd]
type = playsnd
trigger1 = time = 0
value =S5100,0

[state 1122, earthquakes]
type = envshake
trigger1 = time = 0
time = 24
ampl = -32
freq = 60
phase = 60

; -------------------

[state 1122, on ground]
type = velset
trigger1 = time = 0
x = 0
y = 0

[State 1122, Bind 2]
type = TargetBind
trigger1 = AnimElemTime(2) < 0 
pos = 220, 50

[state 1122, targetdamage]
type = targetlifeadd
trigger1 = time = 0
value = floor(fvar(10) * -220);ifelse(fvar(10) <= 0.7,-180,ceil(-230*fvar(10)))

[state 1102, targetpowerget]
type = targetpoweradd
trigger1 = time = 0
value = (enemynear,powermax / 1000) * 73 

[state 1102, powerget]
type = poweradd
trigger1 = time = 0
value = 0

[state 1122, targetstate]
type = targetstate
trigger1 = time = 24
value = 1131

[state 1102, on ground]
type = posset
trigger1 = time = 0
y = 0

[state 1122, bounce off]
type = velset
trigger1 = time = 24
x = -2
y = -36

[state 1122, gravity]
type = gravity
trigger1 = time > 24

[state 1122, end]
type = changestate
trigger1 = time > 24
trigger1 = vel y > 0
trigger1 = pos y > -vel y 
value = 52


;---------------------------------------------------------------------------
;Izuna Drop Victim

[Statedef 1130]
type    = A
movetype= H
physics = N
velset = 0,0
sprpriority = 2

[State 1130, 1]
type = ChangeAnim2
Trigger1 = Time = 0
value = 1130

[state 1130, movecamera]
type = ScreenBound
trigger1 = 1
value = 1
movecamera = 0,0
ignorehitpause = 1

[State 1130, 2]
type = SelfState
trigger1 = !gethitvar(isbound)
value = 5050

;---------------------------------------------------------------------------
;Izuna Drop Victim
[Statedef 1131]
type    = A
movetype= H
physics = N
velset = -6,-24
sprpriority = -2

[state 1131, changeanim]
type = changeanim2
trigger1 = time = 0
value = 1133

[state 1131, turn]
type = turn
trigger1 = time = 0


[state 1130, veladd]
type = veladd
trigger1 = 1
y = 1.25


[State 1130, 2]
type = SelfState
trigger1 = vel y > 0
trigger1 = pos y > -vel y 
value = 5100

;---------------------------------------------------------------------------
;Izuna Drop Victim EX
[Statedef 1132]
type    = A
movetype= H
physics = N
velset = 0,0
sprpriority = 2

[State 1130, 1]
type = ChangeAnim2
Trigger1 = Time = 0
value = 1131

[state 1130, movecamera]
type = ScreenBound
trigger1 = 1
value = 1
movecamera = 0,0
ignorehitpause = 1

[State 1130, 2]
type = SelfState
trigger1 = !gethitvar(isbound)
value = 5050

;--------------------------------------------------------------------------

;Izuna Drop Victim Spiked
[Statedef 1133]
type    = A
movetype= H
physics = N
velset = 0,0

[state 1130, 1]
type = angledraw
trigger1 = time >= 0 && time < 4
scale = 1,1

[state 1130, 1]
type = angledraw
trigger1 = time >= 4 && time < 8
scale = 1.1,0.8

[state 1130, 1]
type = angledraw
trigger1 = time >= 8 && time < 20
scale = 1.25,0.4

[state 1130, 1]
type = angledraw
trigger1 = time >= 20 && time < 24
scale = 1.1,0.8


[State 1130, 1]
type = ChangeAnim2
Trigger1 = Time = 0
value = 1132

;---------------------------------------------------------------------------
;Moonsault start
[statedef 1150]
type = A
movetype = A
physics = N
anim = 1150
ctrl = 0
poweradd = 60
velset = 0,0

[state 1150, armor counter]
type = varset
trigger1 = time = 0
trigger1 = Var(21) = 1
triggerall = prevstateno != 1150
V = 20
value = 0

[State 40, 1]
type = VarSet
trigger1 = command != "holdfwd"
trigger1 = command != "holdback"
trigger1 = Time = 0
sysvar(1) = 0

[State 40, 2]
type = VarSet
trigger1 = command = "holdfwd"
trigger1 = time = 0
sysvar(1) = 1

[State 40, 3]
type = VarSet
trigger1 = command = "holdback"
trigger1 = time = 0
sysvar(1) = -1

[state 1150, turn]
type = turn
trigger1 = animelemtime(3) = 1
trigger1 = sysvar(1) = -1

[state 1150, jump]
type = velset
trigger1 = animelemtime(3) = 0
x = ifelse(sysvar(1) = -1, backedgebodydist*-0.08,frontedgebodydist*0.08)
y = -30

;[state 1151, 5]
;type = velmul
;trigger1 = moveguarded
;trigger1 = animelemtime(3) >= 1
;x = 0
;y = 0.75
;persistent = 0

[state 1150, playerpush]
type = playerpush
trigger1 = animelemtime(3) >= 0
;trigger1 = !moveguarded
value = 0

[State 1150, 1]
type = HitDef
trigger1 = hitcount < 2
trigger1 = !moveguarded
trigger1 = !hitpausetime
persistent = 2
attr = S, SA                    
damage = 20, 4                  
animtype = up                 
guardflag = MA                   
hitflag = MAF                   
priority = 4, Hit                
pausetime = 6, 6   
guard.pausetime = 8,8
id = 1150             
sparkno = 3                    
sparkxy = -40, -304              
hitsound = S5000, 2                
guardsound = S120,0                
ground.type = High               
ground.slidetime = 10             
ground.hittime  = 60             
ground.velocity = 0,-35            
airguard.velocity = -7.6,-3.2    
air.type = High                  
air.velocity = 0,-30 
air.hittime = 60
guard.velocity = -8
guard.slidetime = 16
guard.hittime = 16
guard.kill = 0
fall = 1
fall.recover = 0


[state 1150, attackdist]
type = attackdist
trigger1 = 1
value = 500

[state 1150, playsnd]
type = playsnd
trigger1 = animelemtime(4) = 0
value = S610,0

[state 1150, target state]
type = targetstate
trigger1 = numtarget(1150)
trigger1 = movehit
trigger1 = hitpausetime = 2
ignorehitpause = 1
value = 1180

[state 1150, screen]
type = screenbound
trigger1 = 1
movecamera = 0,1

[state 1150, gravity]
type = gravity
trigger1 = pos y < -1


[state 1150, end]
type = changestate
triggerall = animelemtime(5) >= 0
trigger1 = frontedgebodydist < 30
value = 1151

[state 1151, end]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 1159
;---------------------------------------------------------------------------
;Moonsault
[Statedef 1151]
type    = A
movetype = A
physics = N
ctrl = 0
sprpriority = 1
velset = 0,0

[state 1151, turn]
type = turn
trigger1 = animelemtime(3) = 0
trigger1 = prevstateno = 1150

;===========
;Armor start
;===========
[state 1151, animation]
type = changeanim
trigger1 = anim != 1151
value = 1151

[state 1151, armor set]
type = varset
trigger1 = time = 0
trigger1 = prevstateno != 1151
v = 20
value = 1

[state 1151, excess armor check]
type = varset
trigger1 = var(20) > 1
var(20) = 1
persistent = 1
ignorehitpause = 1


;determine what frame
[state 1151, remember frame]
type = varset
trigger1 = time <= 0
v = 22
value = animelemno(0)
ignorehitpause = 1

;delay effect
[state 1151, delay]
type = changeanim 
trigger1 = var(31) < floor(gethitvar(hittime)*1.1)
value = anim
elem = var(22)

[state 1151, freeze location]
type = posfreeze
trigger1 = var(31) < floor(gethitvar(hittime)*1.1)
value = 1
;--------------------------

[state 1151, still take damage]
type = lifeadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) != 0
value = floor(-gethitvar(damage))
persistent = 1

[state 1151, armor count down]
type = varadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) > 0
V = 20
value = - 1
persistent = 1

[state 1151, Unstoppable]
type = hitoverride
trigger1 = Life > 1
trigger1 = Var(20) > 0
trigger1 = animelemtime(3) > 0 
attr = SCA, AA, AP
stateno = 1151
time = 1
persistent = 1

[State 1151, flash red]
type = PalFX
trigger1 = Time = 0
trigger1 = gethitvar(damage) != 0
time = 7
add = 100,0,0
IgnoreHitPause = 1
;--------------------------------------------------------------------------------


[state 1152, playerpush]
type = playerpush
trigger1 = 1
value = 0

[State 1151, 4]
type = VelSet
trigger1 = animelemTime(3) = 0
x = p2dist x * 0.015
y = const(velocity.jump.y)*1.1
persistent = 0

[State 1151, 4]
type = EnvShake
trigger1 = animelemtime(1) = 2
time = 12
ampl = -8
freq = 100
phase = 100

[state 1151, gravity]
type = gravity
trigger1 = animelemtime(3) > 2


[state 1150, screen]
type = screenbound
trigger1 = animelemtime(3) < 1
movecamera = 0,1


[state 55, 4]
type = playsnd
trigger1 = animelemtime(3) = 0
value = S3000,1

[state 55, width]
type= width
trigger1 = 1
player  = 40,57 ;60 works
edge = 5,50

[state 55,dekho]
type=turn
trigger1=backedgebodydist<=35
trigger1=animelemtime(1) = 0


[state 1236, posset]
type = posset
trigger1 = animelemtime(1) = 1
x=(pos x-screenpos x)*facing*-1

[state 55, posfreeze]
type = posfreeze
trigger1 = animelemTime(3) = 0
x = 1
y = 1

[state 1151, steering]
type = veladd
triggerall = animelemtime(3) > 1
trigger1 = command = "holdfwd"
trigger1 = !ailevel
trigger2 = ailevel
trigger2 = p2dist x > 0
x = 0.25

[state 1151, steering]
type = veladd
triggerall = animelemtime(3) > 1
trigger1 = command = "holdback"
trigger1 = !ailevel
trigger2 = ailevel
trigger2 = p2dist x < 0
x = -0.25

[State 1150, 1]
type = HitDef
trigger1 = time = 0
attr = S, SA                    
damage = ifelse(numtarget(1150),100,140),42               
animtype = Light                 
guardflag = HA                   
hitflag = MAF                   
priority = 3, Hit                
pausetime = 8, 8                
sparkno = 3                   
sparkxy = -40, -304              
hitsound = 5, 3                 
guardsound = S120,0                
ground.type = High               
ground.slidetime = 10             
ground.hittime  = 10             
ground.velocity = 0,0           
airguard.velocity = -26,-4  
air.type = High                  
air.velocity = 0,0  
air.hittime = 65
guard.velocity = -120
airguard.velocity = -40,-20
guard.slidetime = 45
guard.hittime = 45
fall = 1
guard.dist = 640

;--------------------------

[state 650, enemy state]
type = targetstate
triggerall = vel y > 0
trigger1 = movehit
trigger1 = enemy,statetype != A
value = 660

;Ride down mechanic
[state 650, Ride down]
type = targetbind
trigger1 = movehit
trigger1 = enemy,statetype = A
pos = 0, -20

[state 650, state of ride down]
type = targetstate
trigger1 = movehit
trigger1 = enemy,statetype = A
value = 655
;----------------------------------------------







[state 1151, end]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 1152


;-------------------------------------------------------------
;Landing 1st
[statedef 1152]
type = A
movetype = A
physics = N
anim = 1152

[state 1152, playerpush]
type = playerpush
trigger1 = time < 4
value = 0

;==============================
; Special FX
;==============================

;Custom Dust
[state 651, explod]
type = explod
trigger1 = time = 0
anim = 2000
pos = 30,0
scale = const(size.xscale)*3.5,const(size.yscale)*2.5
ontop = 1
ownpal = 1

[state 651, fx]
type = explod
trigger1 = time = 0
anim = F61
pos = 0,0
scale = 8,4
ownpal = 1


[state 651, explod]
type = explod
trigger1 = time = 0
anim = 2001
pos = 30,0
scale =  const(size.xscale)*3.5,const(size.yscale)*2.5
sprpriority = -4
ownpal = 1

[state 651, Crater]
type = explod
trigger1 = time = 0
trigger1 = !numexplod(2030)
anim = 2030
id = 2030
pos = 0,0
scale = const(size.xscale)*1,const(size.yscale)*1
sprpriority = -4

[state 651, Rubble]
type = explod
trigger1 = time = 0
trigger1 = !numexplod(2035)
anim = 2035
id = 2035
pos = 0,0
scale = const(size.xscale)*1,const(size.yscale)*1
sprpriority = -3
; -------------------

[state 651, snd]
type = playsnd
trigger1 = time = 0
value =S5100,0

[state 651, snd]
type = playsnd
trigger1 = time = 0
value =S5100,0

[State 651, 3]
type = HitDef
trigger1 = Time = 0
attr = C, SA
damage    = ifelse(numtarget(1150),100,140)
guardflag = 
hitflag = FD
priority = 4
pausetime = 12,12
sparkno = 1
sparkxy = -10,-40
hitsound   = 5,3
guardsound = S120,0
animtype = Med
p2stateno = 660
ground.type = High
ground.slidetime = 12
ground.hittime  = 15
ground.velocity = 0
air.velocity = 0,0

[state 651, earthquakes]
type = envshake
trigger1 = time = 0
time = 18
ampl = -18
freq = 60
phase = 60


[state 1152, velset]
type = velset
trigger1 = time = 0
y = 0
x = 0

[state 1152, on ground]
type = posset
trigger1 = time = 0
y = 0

[state 1152, bounce]
type = velset
trigger1 = time = 12
y = -12

[state 1152, gravity]
type = gravity
trigger1 = time > 11
trigger1 = pos y < -1


[state 1152, end]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 1153


;-------------------------------------------------------------
;Landing 2nd
[statedef 1153]
type = C
movetype = A
physics = N
anim = 1153

[state 1153, snd]
type = playsnd
trigger1 = time = 0
value =S5100,0

[state 1153, earthquakes]
type = envshake
trigger1 = time = 0
time = 18
ampl = -18
freq = 60
phase = 60

[state 1152, velset]
type = velset
trigger1 = time = 0
y = 0
x = 0

[state 1152, on ground]
type = posset
trigger1 = time = 0
y = 0

[state 1152. turn end]
type = turn
trigger1 = animtime = 0

[state 1152, end]
type = changestate
trigger1 = animtime = 0
value = 1155

;---------------------------------------------------------------------------
;Light Recovery
[statedef 1155]
type = A
movetype = I
physics = N
ctrl = 0
anim = 41

[state 1155, start]
type = velset
trigger1 = time = 1
x = -15
y = -18

[state 1155, changeanim]
type = changeanim
trigger1 = anim != 44
trigger1 = vel y > 0
value = 44

[state 1155, gravity]
type = gravity
trigger1 = time > 1

[state 1155, end]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 52

;---------------------------------------------------------------------------
; Landing from flip
[statedef 1159]
type = C
movetype = I
physics = C
ctrl = 0

[state 1159, anim]
type = changeanim
trigger1 = time = 0
value = 1159

[state 1059, velset]
type = velset
trigger1 = time = 0
y = 0

[state 1059, posset]
type = posset
trigger1 = time = 0
y = 0

[State 1059, 4]
type = EnvShake
trigger1 = time = 0
time = 24
ampl = -18
freq = 100
phase = 100

[state 1059, land fx]
type = explod
trigger1 = time = 0
anim = 2000
bindtime = 1
id = 2000
pos = 0, 10
removetime = -2
sprpriority = 2
scale = 3,2.5
ownpal = 1

[state 1059, land fx]
type = explod
trigger1 = time = 0
anim = 2001
bindtime = 1
id = 2001
pos = 0, 10
removetime = -2
sprpriority = -2
scale = 3,2.5
ownpal = 1

[state 1059, 4]
type = playsnd
trigger1 = time = 0
value = S5100,0

[state 1059, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1


;---------------------------------------------------------------------------
;Heavy Moonsault start
[statedef 1160]
type = A
movetype = A
physics = N
anim = 1160
ctrl = 0
velset = 0,0

[state 1150, armor counter]
type = varset
trigger1 = time = 0
trigger1 = Var(21) = 1
V = 20
value = 0

[State 1160, 1]
type = VarSet
trigger1 = Time = 0
sysvar(1) = 0

[State 1160, 2]
type = VarSet
trigger1 = command = "holdfwd"
sysvar(1) = 1

[State 1160, 3]
type = VarSet
trigger1 = command = "holdback"
sysvar(1) = -1

[state 1160, turn]
type = turn
trigger1 = animelemtime(3) = 1
trigger1 = sysvar(1) = -1

[state 1160, jump]
type = velset
trigger1 = animelemtime(3) = 0
x = ifelse(sysvar(1) = -1, backedgebodydist*-0.08,frontedgebodydist*0.08)
y = -55

;[state 1160, 5]
;type = velmul
;trigger1 = moveguarded
;trigger1 = animelemtime(3) >= 1
;x = -0.01
;y = 0.8
;persistent = 0

[state 1160, playerpush]
type = playerpush
trigger1 = animelemtime(3) >= 0
;trigger1 = !moveguarded
value = 0

[State 1160, 1]
type = HitDef
trigger1 = hitcount < 3
trigger1 = !moveguarded
trigger1 = !hitpausetime
attr = S, SA                    
damage = 20, 6                 
animtype = up                 
guardflag = MA                   
hitflag = MAF                   
priority = 4, Hit                
pausetime = 6, 6  
guard.pausetime = 12,12 
id = 1160             
sparkno = 3                    
sparkxy = -40, -304              
hitsound = S5000, 2                
guardsound = S120,0                
ground.type = High               
ground.slidetime = 10             
ground.hittime  = 60             
ground.velocity = 0,-35            
airguard.velocity = -7.6,-3.2    
air.type = High                  
air.velocity = 0,-30 
air.hittime = 60
guard.velocity = -8
guard.slidetime = 16
guard.hittime = 16 
guard.kill = 0
fall = 1
fall.recover = 0

[state 1160, attackdist]
type = attackdist
trigger1 = 1
value = 500

[state 1160, playsnd]
type = playsnd
trigger1 = animelemtime(4) = 0
value = S610,0

[state 1160, target state]
type = targetstate
trigger1 = numtarget(1160)
trigger1 = movehit
trigger1 = hitpausetime = 2
ignorehitpause = 1
value = 1180

[state 1160, screen]
type = screenbound
trigger1 = 1
movecamera = 0,1

[state 1160, gravity]
type = gravity
trigger1 = pos y < -1

[state 1160, end]
type = changestate
triggerall = animelemtime(5) >= 0
trigger1 = frontedgebodydist < 30
value = 1161

[state 1160, end]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 1159
;---------------------------------------------------------------------------
;Moonsault
[Statedef 1161]
type    = A
movetype = A
physics = N
ctrl = 0
sprpriority = 1
velset = 0,0

[state 1151, turn]
type = turn
trigger1 = animelemtime(3) = 0
trigger1 = prevstateno = 1160

;===========
;Armor start
;===========
[state 1161, animation]
type = changeanim
trigger1 = anim != 1151
value = 1151

[state 1161, armor set]
type = varset
trigger1 = time = 0
trigger1 = prevstateno != 1161
v = 20
value = 1

[state 1161, excess armor check]
type = varset
trigger1 = var(20) > 1
var(20) = 1
persistent = 1
ignorehitpause = 1

[state 1161, armor intiator turn off]
type = varset
trigger1 = time = 1
V = 21
value = 0

;determine what frame
[state 1161, remember frame]
type = varset
trigger1 = time <= 0
v = 22
value = animelemno(0)
ignorehitpause = 1

;delay effect
[state 1161, delay]
type = changeanim 
trigger1 = var(31) < floor(gethitvar(hittime)*1.1)
value = anim
elem = var(22)

[state 1161, freeze location]
type = posfreeze
trigger1 = var(31) < floor(gethitvar(hittime)*1.1)
value = 1
;--------------------------

[state 1161, still take damage]
type = lifeadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) != 0
value = floor(-gethitvar(damage))
persistent = 1

[state 1161, armor count down]
type = varadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) > 0
V = 20
value = - 1
persistent = 1

[state 1161, Unstoppable]
type = hitoverride
trigger1 = Life > 1
trigger1 = Var(20) > 0
trigger1 = animelemtime(3) > 0 
attr = SCA, AA, AP
stateno = 1161
time = 1
persistent = 1

[State 1161, flash red]
type = PalFX
trigger1 = Time = 0
trigger1 = gethitvar(damage) != 0
time = 7
add = 100,0,0
IgnoreHitPause = 1
;--------------------------------------------------------------------------------


[state 1161, playerpush]
type = playerpush
trigger1 = 1
value = 0

[State 1161, 4]
type = VelSet
trigger1 = animelemTime(3) = 0
x = p2dist x * 0.015
y = const(velocity.jump.y)*1.1
persistent = 0



[State 1161, 4]
type = EnvShake
trigger1 = time = 0
time = 12
ampl = -8
freq = 100
phase = 100

[state 1161, gravity]
type = gravity
trigger1 = animelemtime(3) > 2


[state 1161, screen]
type = screenbound
trigger1 = animelemtime(3) < 1
movecamera = 0,1


[state 1161, 4]
type = playsnd
trigger1 = animelemtime(3) = 0
value = S3000,1

[state 1161, width]
type= width
trigger1 = 1
player  = 40,57 ;60 works
edge = 5,50

[state 1161,dekho]
type=turn
trigger1=backedgebodydist<=35
trigger1=time=0


[state 1161, posset]
type = posset
trigger1 = animelemtime(1) = 1
x=(pos x-screenpos x)*facing*-1

[state 1161, posfreeze]
type = posfreeze
trigger1 = animelemTime(3) = 0
x = 1
y = 1

[state 1161, steering]
type = veladd
triggerall = animelemtime(3) > 1
trigger1 = command = "holdfwd"
trigger1 = !ailevel
trigger2 = ailevel
trigger2 = p2dist x > 0
x = 0.25

[state 1161, steering]
type = veladd
triggerall = animelemtime(3) > 1
trigger1 = command = "holdback"
trigger1 = !ailevel
trigger2 = ailevel
trigger2 = p2dist x < 0
x = -0.25

[State 1161, 1]
type = HitDef
trigger1 = time = 0
attr = S, SA                    
damage = ifelse(numtarget(1160),120,180), 54             
animtype = Light                 
guardflag = HA                   
hitflag = MAF                   
priority = 3, Hit                
pausetime = 8, 8                
sparkno = 3                   
sparkxy = -40, -304              
hitsound = 5, 3                 
guardsound = S120,0                
ground.type = High               
ground.slidetime = 10             
ground.hittime  = 10             
ground.velocity = 0,0           
airguard.velocity = -40,-20   
air.type = High                  
air.velocity = 0,0  
air.hittime = 65
guard.velocity = -120
guard.slidetime = 45
guard.hittime = 45
fall = 1
guard.dist = 640

;--------------------------

[state 1161, enemy state]
type = targetstate
triggerall = vel y > 0
trigger1 = movehit
trigger1 = enemy,statetype != A
value = 660

;Ride down mechanic
[state 1161, Ride down]
type = targetbind
trigger1 = movehit
trigger1 = enemy,statetype = A
pos = 0, -20

[state 1161, state of ride down]
type = targetstate
trigger1 = movehit
trigger1 = enemy,statetype = A
value = 655
;----------------------------------------------







[state 1161, end]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 1162


;-------------------------------------------------------------
;Landing 1st
[statedef 1162]
type = A
movetype = A
physics = N
anim = 1152

[state 1162, playerpush]
type = playerpush
trigger1 = time < 4
value = 0

;==============================
; Special FX
;==============================

;Custom Dust
[state 1162, explod]
type = explod
trigger1 = time = 0
anim = 2000
pos = 30,0
scale = const(size.xscale)*3.5,const(size.yscale)*2.5
ontop = 1
ownpal = 1

[state 1162, fx]
type = explod
trigger1 = time = 0
anim = F61
pos = 0,0
scale = 8,4
ownpal = 1


[state 1162, explod]
type = explod
trigger1 = time = 0
anim = 2001
pos = 30,0
scale =  const(size.xscale)*3.5,const(size.yscale)*2.5
sprpriority = -4
ownpal = 1

[state 651, Crater]
type = explod
trigger1 = time = 0
trigger1 = !numexplod(2030)
anim = 2030
id = 2030
pos = 0,0
scale = const(size.xscale)*1,const(size.yscale)*1
sprpriority = -4

[state 651, Rubble]
type = explod
trigger1 = time = 0
trigger1 = !numexplod(2035)
anim = 2035
id = 2035
pos = 0,0
scale = const(size.xscale)*1,const(size.yscale)*1
sprpriority = -3
; -------------------

[state 1162, snd]
type = playsnd
trigger1 = time = 0
value =S5100,0

[state 1162, snd]
type = playsnd
trigger1 = time = 0
value =S5100,0

[State 1162, 3]
type = HitDef
trigger1 = Time = 0
attr = C, SA
damage    = ifelse(numtarget(1160),120,180)
guardflag = 
hitflag = FD
priority = 4
pausetime = 12,12
sparkno = 1
sparkxy = -10,-40
hitsound   = 5,3
guardsound = S120,0
animtype = Med
p2stateno = 660
ground.type = High
ground.slidetime = 12
ground.hittime  = 15
ground.velocity = 0
air.velocity = 0,0

[state 1162, earthquakes]
type = envshake
trigger1 = time = 0
time = 18
ampl = -18
freq = 60
phase = 60


[state 1162, velset]
type = velset
trigger1 = time = 0
y = 0
x = 0

[state 1162, on ground]
type = posset
trigger1 = time = 0
y = 0

[state 1162, bounce]
type = velset
trigger1 = time = 12
y = -12

[state 1162, gravity]
type = gravity
trigger1 = time > 11
trigger1 = pos y < -1


[state 1162, end]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 1163


;-------------------------------------------------------------
;Landing 2nd
[statedef 1163]
type = C
movetype = A
physics = N
anim = 1153

[state 1163, snd]
type = playsnd
trigger1 = time = 0
value =S5100,0

[state 1163, earthquakes]
type = envshake
trigger1 = time = 0
time = 18
ampl = -18
freq = 60
phase = 60

[state 1163, velset]
type = velset
trigger1 = time = 0
y = 0
x = 0

[state 1163, on ground]
type = posset
trigger1 = time = 0
y = 0

[state 1163. turn end]
type = turn
trigger1 = animtime = 0


[state 1163, end]
type = changestate
trigger1 = animtime = 0
value = 1165

;---------------------------------------------------------------------------
;Light Recovery
[statedef 1165]
type = A
movetype = I
physics = N
ctrl = 0
anim = 41
facep2 = 1

[state 1165, start]
type = velset
trigger1 = time = 1
x = -15
y = -24

[state 1165, changeanim]
type = changeanim
trigger1 = anim != 44
trigger1 = vel y > 0
value = 44

[state 1165, gravity]
type = gravity
trigger1 = time > 1

[state 1165, end]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 52

;---------------------------------------------------------------------------
;EX Moonsault
[statedef 1170]
type = A
movetype = A
physics = N
anim = 1170
ctrl = 0
velset = 0,0

[state 1170, poweradd]
type = poweradd
trigger1 = time = 0
value = -500
persistent = 0

[state 1170, nothitby]
TYPE = nothitby
trigger1 = 1
value = SCA

;[State 1170, Blink Yellow]
;type = PalFX
;trigger1 = time%2
;time = 1
;add = 150,75,0 ;32,16,0
;sinadd = 64,32,5,3
;ignorehitpause

[State 1170, 1]
type = VarSet
trigger1 = Time = 0
sysvar(1) = 0

[State 1170, 2]
type = VarSet
trigger1 = command = "holdfwd"
sysvar(1) = 1

[State 1170, 3]
type = VarSet
trigger1 = command = "holdback"
sysvar(1) = -1

[state 1170, turn]
type = turn
trigger1 = animelemtime(3) = 1
trigger1 = sysvar(1) = -1

[state 1170, jump]
type = velset
trigger1 = animelemtime(3) = 0
x = ifelse(sysvar(1) = -1, backedgebodydist*-0.08,frontedgebodydist*0.08)
y = -36

;[state 1170, 5]
;type = velmul
;trigger1 = moveguarded
;trigger1 = animelemtime(3) >= 1
;x = -0.05
;y = 0.6
;persistent = 0

[state 1170, playerpush]
type = playerpush
trigger1 = animelemtime(4) >= 0
;trigger1 = !moveguarded
value = 0

[state 1170, Helper Illusion]
type = helper
triggerall = !numhelper(1170)
trigger1 = animelemtime(3) = 1
id = 1170
stateno = 1175
helpertype = normal
pos = 0,0
postype = p1
Name = "Illusion"
ignorehitpause = 1


[State 1170, 1]
type = HitDef
trigger1 = hitcount < 4
trigger1 = !moveguarded
trigger1 = !hitpausetime
attr = S, SA                    
damage = 10, 4                 
animtype = up                 
guardflag = MA                   
hitflag = MAF                   
priority = 4, Hit                
pausetime = 6, 6
guard.pausetime = 12,12
getpower = 0 
id = 1170             
sparkno = 3                    
sparkxy = -40, -304              
hitsound = S5000, 2                
guardsound = S120,0                
ground.type = High               
ground.slidetime = 10             
ground.hittime  = 60             
ground.velocity = 0,-35            
airguard.velocity = -7.6,-3.2    
air.type = High                  
air.velocity = 0,-30 
air.hittime = 60
guard.velocity = -16
guard.slidetime = 16
guard.hittime = 16  
guard.kill = 0
fall = 1
fall.recover = 0

[state 1170, attackdist]
type = attackdist
trigger1 = 1
value = 500

[state 1170, playsnd]
type = playsnd
trigger1 = animelemtime(4) = 0
value = S610,0

[state 1170, target state]
type = targetstate
trigger1 = numtarget(1170)
trigger1 = movehit
trigger1 = hitpausetime = 2
ignorehitpause = 1
value = 1180

[state 1170, screen]
type = screenbound
trigger1 = 1
movecamera = 0,1

[state 1170, gravity]
type = gravity
trigger1 = pos y < -1


[state 1170, end]
type = changestate
triggerall = animelemtime(5) >= 0
trigger1 = frontedgebodydist < 30
value = 1171

[state 1170, end]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 1159
;---------------------------------------------------------------------------
;Moonsault
[Statedef 1171]
type    = A
movetype = A
physics = N
ctrl = 0
sprpriority = 1
velset = 0,0

[state 1151, turn]
type = turn
trigger1 = animelemtime(3) = 0
trigger1 = prevstateno = 1170

;===========
;Armor start
;===========
[state 1171, animation]
type = changeanim
trigger1 = anim != 1171
value = 1171

[state 1171, excess armor check]
type = varset
trigger1 = var(20) > 1
var(20) = 1
persistent = 1
ignorehitpause = 1

[state 1171, armor intiator turn off]
type = varset
trigger1 = time = 1
V = 21
value = 0

;determine what frame
[state 1171, remember frame]
type = varset
trigger1 = time <= 0
v = 22
value = animelemno(0)
ignorehitpause = 1

;delay effect
[state 1171, delay]
type = changeanim 
trigger1 = var(31) < floor(gethitvar(hittime)*1.1)
value = anim
elem = var(22)

[state 1171, freeze location]
type = posfreeze
trigger1 = var(31) < floor(gethitvar(hittime)*1.1)
value = 1
;--------------------------

[state 1161, still take damage]
type = lifeadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) != 0
value = floor(-gethitvar(damage))
persistent = 1

[state 1161, armor count down]
type = varadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) > 0
V = 20
value = - 1
persistent = 1

[state 1161, Unstoppable]
type = hitoverride
trigger1 = Life > 1
trigger1 = Var(20) > 0
attr = SCA, AA, AP
stateno = 1171
time = 1
persistent = 1

[State 1161, flash red]
type = PalFX
trigger1 = Time = 0
trigger1 = gethitvar(damage) != 0
time = 7
add = 100,0,0
IgnoreHitPause = 1
;--------------------------------------------------------------------------------

[state 1171, playerpush]
type = playerpush
trigger1 = 1
value = 0

[State 1171, 4]
type = VelSet
trigger1 = animelemTime(3) = 0
x = p2dist x * 0.015
y = const(velocity.jump.y)*1.1
persistent = 0



[State 1171, 4]
type = EnvShake
trigger1 = time = 0
time = 12
ampl = -8
freq = 100
phase = 100

[state 1171, gravity]
type = gravity
trigger1 = animelemtime(3) > 2


[state 1171, screen]
type = screenbound
trigger1 = animelemtime(3) < 1
movecamera = 0,1


[state 1171, 4]
type = playsnd
trigger1 = animelemtime(3) = 0
value = S3000,1

[state 1171, width]
type= width
trigger1 = 1
player  = 40,57 ;60 works
edge = 5,50

[state 1171,dekho]
type=turn
trigger1=backedgebodydist<=35
trigger1=time=0


[state 1171, posset]
type = posset
trigger1 = animelemtime(1) = 1
x=(pos x-screenpos x)*facing*-1

[state 1171, posfreeze]
type = posfreeze
trigger1 = animelemTime(3) = 0
x = 1
y = 1

[state 1171, steering]
type = veladd
triggerall = animelemtime(3) > 1
trigger1 = command = "holdfwd"
trigger1 = !ailevel
trigger2 = ailevel
trigger2 = p2dist x > 0
x = 0.35

[state 1171, steering]
type = veladd
triggerall = animelemtime(3) > 1
trigger1 = command = "holdback"
trigger1 = !ailevel
trigger2 = ailevel
trigger2 = p2dist x < 0
x = -0.35

[State 1171, 1]
type = HitDef
trigger1 = time = 0
attr = S, SA                    
damage = ifelse(numtarget(1170),120,160), 48                 
animtype = Light                 
guardflag = HA
getpower = 0                 
hitflag = MAF                   
priority = 3, Hit                
pausetime = 8, 8                
sparkno = 3                   
sparkxy = -40, -304              
hitsound = 5, 3                 
guardsound = S120,0                
ground.type = High               
ground.slidetime = 10             
ground.hittime  = 10             
ground.velocity = 0,0           
airguard.velocity = -26,4   
air.type = High                  
air.velocity = 0,0  
air.hittime = 75
guard.velocity = -140
airguard.velocity = -40,-20
guard.slidetime = 50
guard.hittime = 50
fall = 1
guard.dist = 640

;--------------------------

[state 1171, enemy state]
type = targetstate
triggerall = vel y > 0
trigger1 = movehit
trigger1 = enemy,statetype != A
value = 660

;Ride down mechanic
[state 1171, Ride down]
type = targetbind
trigger1 = movehit
trigger1 = enemy,statetype = A
pos = 0, -20

[state 1171, state of ride down]
type = targetstate
trigger1 = movehit
trigger1 = enemy,statetype = A
value = 655
;----------------------------------------------

[state 1171, end]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 1172


;-------------------------------------------------------------
;Landing 1st
[statedef 1172]
type = A
movetype = A
physics = N
anim = 1152

[state 1172, playerpush]
type = playerpush
trigger1 = time < 4
value = 0

;==============================
; Special FX
;==============================

;Custom Dust
[state 1172, explod]
type = explod
trigger1 = time = 0
anim = 2000
pos = 30,0
scale = const(size.xscale)*3.5,const(size.yscale)*2.5
ontop = 1
ownpal = 1

[state 1172, fx]
type = explod
trigger1 = time = 0
anim = F61
pos = 0,0
scale = 8,4
ownpal = 1


[state 1172, explod]
type = explod
trigger1 = time = 0
anim = 2001
pos = 30,0
scale =  const(size.xscale)*3.5,const(size.yscale)*2.5
sprpriority = -4
ownpal = 1

[state 651, Crater]
type = explod
trigger1 = time = 0
trigger1 = !numexplod(2030)
anim = 2030
id = 2030
pos = 0,0
scale = const(size.xscale)*1,const(size.yscale)*1
sprpriority = -4

[state 651, Rubble]
type = explod
trigger1 = time = 0
trigger1 = !numexplod(2035)
anim = 2035
id = 2035
pos = 0,0
scale = const(size.xscale)*1,const(size.yscale)*1
sprpriority = -3
; -------------------

[state 1172, snd]
type = playsnd
trigger1 = time = 0
value =S5100,0

[state 1172, snd]
type = playsnd
trigger1 = time = 0
value =S5100,0

[State 1172, 3]
type = HitDef
trigger1 = Time = 0
attr = C, SA
damage    = ifelse(numtarget(1170),120,160)
guardflag = 
hitflag = FD
priority = 4
getpower = 0
pausetime = 12,12
sparkno = 1
sparkxy = -10,-40
hitsound   = 5,3
guardsound = S120,0
animtype = Med
p2stateno = 660
ground.type = High
ground.slidetime = 12
ground.hittime  = 15
ground.velocity = 0
air.velocity = 0,0

[state 1172, earthquakes]
type = envshake
trigger1 = time = 0
time = 18
ampl = -18
freq = 60
phase = 60


[state 1172, velset]
type = velset
trigger1 = time = 0
y = 0
x = 0

[state 1172, on ground]
type = posset
trigger1 = time = 0
y = 0

[state 1172, bounce]
type = velset
trigger1 = time = 12
y = -12

[state 1172, gravity]
type = gravity
trigger1 = time > 11
trigger1 = pos y < -1


[state 1172, end]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 1173


;-------------------------------------------------------------
;Landing 2nd
[statedef 1173]
type = C
movetype = A
physics = N
anim = 1153

[state 1173, snd]
type = playsnd
trigger1 = time = 0
value =S5100,0

[state 1173, earthquakes]
type = envshake
trigger1 = time = 0
time = 18
ampl = -18
freq = 60
phase = 60

[state 1173, velset]
type = velset
trigger1 = time = 0
y = 0
x = 0

[state 1173, on ground]
type = posset
trigger1 = time = 0
y = 0


[state 1152. turn end]
type = turn
trigger1 = animtime = 0
trigger2 = command = "holdback"  || command = "holdfwd"
trigger2 = animelemtime(4) > 0
trigger3 = animelemtime(4) > 0
trigger3 = p2stateno != [660,669]
trigger3 = ailevel

[state 1173, end]
type = changestate
trigger1 = animtime = 0
trigger2 = command = "holdback"  || command = "holdfwd"
trigger2 = animelemtime(4) > 0
trigger3 = animelemtime(4) > 0
trigger3 = p2stateno != [660,669]
trigger3 = ailevel
value = 1174


;---------------------------------------------------------------------------
;Light Recovery
[statedef 1174]
type = A
movetype = I
physics = N
ctrl = 0
anim = 41
facep2 = 1



[state 1174, start]
type = velset
trigger1 = time = 0
x = -12
y = -18

[state 1174, changeanim]
type = changeanim
trigger1 = anim != 44
trigger1 = vel y > 0
value = 44

[state 1174, gravity]
type = gravity
trigger1 = time > 1

[state 1174, end]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 52

;--------------------------------------------------------------------------
;Illusion Helper
[statedef 1175]
type = A
movetype = I
physics = N
anim = 1175
ctrl = 0
velset = 0,0

[state 1175, nothitby]
type = nothitby
trigger1 = 1
value = SCA
ignorehitpause = 1

;[State 1175, Blink Yellow]
;type = PalFX
;trigger1 = time%2
;time = 1
;add = 150,75,0 ;32,16,0
;sinadd = 64,32,5,3
;ignorehitpause

[state 1175, flickering]
type = assertspecial
trigger1 = time%4
flag = invisible
time = 2
persistent = 1


[state 1175, turn]
type = turn
trigger1 = time = 0

[state 1175, jump]
type = velset
trigger1 = time = 0
x = ifelse(parent,sysvar(1) >= 0, frontedgebodydist*0.08,backedgebodydist*-0.08)
y = -36

[state 1175, screen]
type = screenbound
trigger1 = 1
movecamera = 0,1

[state 1175, gravity]
type = gravity
trigger1 = pos y < -1

[state 1175, end]
type = changestate
triggerall = animelemtime(3) >= 0
trigger1 = frontedgebodydist < 30
value = 1176

[state 1175, end]
type = destroyself
trigger1 = vel y > 0
trigger1 = pos y > -vel y
ignorehitpause = 1
;---------------------------------------------------------------------------
;Moonsault
[Statedef 1176]
type    = A
movetype = I
physics = N
anim = 1171
ctrl = 0
sprpriority = 1
velset = 0,0

[state 1176, playerpush]
type = playerpush
trigger1 = 1
value = 0

[state 1176, nothitby]
type = nothitby
trigger1 = 1
value = SCA
ignorehitpause = 1

[state 1176, flickering]
type = assertspecial
trigger1 = time%2
flag = invisible
persistent = 1

[State 1176, 4]
type = VelSet
trigger1 = animelemTime(3) = 0
x = p2dist x * 0.01
y = const(velocity.jump.y)*1.1
persistent = 0




[state 1176, gravity]
type = gravity
trigger1 = animelemtime(3) > 2


[state 1176, screen]
type = screenbound
trigger1 = animelemtime(3) < 1
movecamera = 0,1



[state 1176, width]
type= width
trigger1 = 1
player  = 40,57 ;60 works
edge = 5,50

[state 1176,dekho]
type=turn
trigger1=backedgebodydist<=35
trigger1=time=0


[state 1176, posset]
type = posset
trigger1 = time = 0
x=(pos x-screenpos x)*facing*-1

[state 1176, posfreeze]
type = posfreeze
trigger1 = animelemTime(3) = 0
x = 1
y = 1

[state 1176, steering]
type = veladd
trigger1 = parent,command = "holdfwd"
trigger1 = animelemtime(3) > 1
x = -0.5

[state 1176, steering]
type = veladd
trigger1 = parent,command = "holdback"
trigger1 = animelemtime(3) > 1
x = 0.5


[state 1176, end]
type = destroyself
trigger1 = vel y > 0
trigger1 = pos y > -vel y
trigger2 = time > 300





;---------------------------------------------------------------------------
; Air get-hit (falling)
[Statedef 1180]
type    = A
movetype= H
physics = N

[State 1180, 1] ;Change anim when done with transition
type = ChangeAnim
trigger1 = AnimTime = 0
trigger1 = Anim = 5035
trigger2 = Time = 0     ;If no transition anim
trigger2 = Anim != 5035
trigger2 = (Anim != [5051, 5059]) && (Anim != [5061, 5069])
trigger2 = Anim != 5090 ;Not if hit off ground anim
value = 5050

[State 1180, 2] ;Coming down anim
type = ChangeAnim
trigger1 = anim = [5050,5059]
trigger1 = Vel Y >= ifelse(anim = 5050, Const720p(4), Const720p(-8))
trigger1 = SelfAnimExist(anim+10)
value = anim+10
persistent = 0

[State 1180, 3] ;Gravity
type = Velset
trigger1 = time = 0
y = GetHitVar(yvel)
x = gethitvar(xvel)

[state 1180, gravity]
type = gravity
trigger1 = time > 1 

[State 1180, 6]
type = ChangeState
trigger1 = Vel Y > 0
trigger1 = Pos Y > -vel y 
value = 1181 ;Downed get-hit (hit ground from fall)

;---------------------------------------------------------------------------
; Downed get-hit (lying down) Custom for big body
[Statedef 1181]
type    = L
movetype= H
physics = N
velset = 0,0

[state 1181, on ground]
type = posset
trigger1 = time = 0
y = 0

[State 5110, EnvShake]
type = FallEnvShake
trigger1 = Time = 0

[State 5110, 1] ;For hit up/up-diag type (from state 5081)
type = ChangeAnim
persistent = 0
trigger1 = SelfAnimExist(5110 + (anim % 10))
trigger1 = anim = [5081,5089]
value = 5110 + (anim % 10)

[State 5110, 2] ;Hit ground anim (normal)
type = ChangeAnim
triggerall = time = 0
triggerall = anim != [5110,5119] ;Not already changed anim
trigger1 = anim != [5161,5169]
trigger2 = !SelfAnimExist(5170 + (anim % 10))
value = 5170

[State 5110, 3] ;Hit ground anim (for hit up)
type = ChangeAnim
triggerall = time = 0
triggerall = anim != [5110,5119] ;Not already changed anim
trigger1 = anim = [5161,5169]
trigger1 = SelfAnimExist(5170 + (anim % 10))
value = 5170 + (anim % 10)

[State 5110, 4]
type = HitFallDamage
trigger1 = Time = 0

[State 5110, 5]
type = PosSet
trigger1 = Time = 0
y = 0

[State 5110, Var] ;Get fall velocity
type = VarSet
trigger1 = Time = 0
trigger1 = GetHitVar(fall.yvel) != 0
sysvar(1) = floor(vel y)

[State 5110, 6]
type = PlaySnd
trigger1 = Time = 0
trigger1 = !SysVar(0)
value = S0, 0

[State 5110, ground shockwave]
type = Explod
trigger1 = Time = 0
trigger1 = !SysVar(0)
anim = F61
scale = 1,1
postype = p1
pos = 0, 0
facing = facing
sprpriority = ifelse (sysvar(1) <= Const720p(56), -10, 10)

[State 5110, 7]
type = EnvShake
trigger1 = time = 0
persistent = 0
time = 10
ampl = 12

[State 5110, 8]
type = VelSet
trigger1 = Time = 0
y = 0

[State 5110, 9] ;For hit up type
type = ChangeAnim
persistent = 0
triggerall = anim = [5171,5179]
triggerall = SelfAnimExist(5110 + (anim % 10))
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground anim
value = 5110 + (anim % 10)

[State 5110, 10] ;For normal
type = ChangeAnim
persistent = 0
triggerall = Anim != [5111,5119]
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground frame
value = 5110

[State 5110, 12]
type = VarSet
trigger1 = SysVar(0)
trigger1 = Time = 0
sysvar(0) = 0

[State 5110, 13] ;Friction
type = VelMul
trigger1 = 1
x = 0.85

[State 5110, 14] ;Friction
type = VelSet
trigger1 = abs(Vel x) < Const(movement.down.friction.threshold)
persistent = 0
x = 0

[State 5110, 15]
type = ForceFeedback
trigger1 = alive
trigger1 = Time = 0
time = 8
ampl = 240
waveform = sine

[state 1181,selfstate]
type = selfstate
trigger1 = time > 110
value = 5120

[State 5110, 16]
type = ForceFeedback
trigger1 = !alive
trigger1 = Time = 0
ampl = 200, 7, -.467
time = 30
waveform = sine



;---------------------------------------------------------------------------
;Ninja Vanish Ground Start
[statedef 1300]
type = S
movetype = I
physics = N
anim = 1300
ctrl = 0
velset = 0,0
poweradd = 30

[state 1300, statetypeset]
type = statetypeset
trigger1 = animelemtime(3) = 0
statetype = A

[state 1300, limiter]
type = varadd
trigger1 = animelemtime(3) = 1
var(12) = -1
persistent = 0

[state 1300, nothitby]
type = nothitby
trigger1 = animelemtime(4) > 0
value = SCA

[state 1300, playerpush]
type = playerpush
trigger1 = animelemtime (4) > 0
value = 0

[state 1300, velset]
type = velset
trigger1 = animelem = 3
y = -0.25

[state 1300, posadd]
type = posset
trigger1 = animelem = 8
trigger1 = pos y > -400
y = -400

[state 1300, pal dim]
type = palfx
trigger1 = animelem = 4
mul = 128,128,128
time = 2

[state 1300, pal dim]
type = palfx
trigger1 = animelem = 5
mul = 96,96,96
time = 2

[state 1300, pal dim]
type = palfx
trigger1 = animelem = 6
mul = 64,64,64
time = 2

[state 1300, pal dim]
type = palfx
trigger1 = animelem = 7
mul = 32,32,32
time = 2


[state 1300, horizontal movement]
type = posadd
trigger1 = animelemtime(8) = 0
trigger1 = command = "holdback"
x = -1200

[state 1300, horizontal movement]
type = posadd
trigger1 = animelemtime(8) = 0
trigger1 = command = "holdfwd"
x = ifelse(p2dist x  < 1200, 1200, p2dist x + 200)

[state 1300, horizontal movement]
type = posadd
trigger1 = animelemtime(8) = 0
trigger1 = command != "holdfwd"
trigger1 = command != "holdback"
x = ifelse(p2dist x > 440, 300, p2dist x - 140)

[state 1300, End]
type = changestate
trigger1 =animtime = 0
value = 1310

;---------------------------------------------------------------------------
;Ninja Vanish Air Start
[statedef 1301]
type = A
movetype = I
physics = N
anim = 1301
ctrl = 0
velset = 0,0

[state 1300, limiter]
type = varadd
trigger1 = time = 0
var(12) = -1
persistent = 0

[state 1300, pal dim]
type = palfx
trigger1 = animelem = 2
mul = 128,128,128
time = 2

[state 1300, pal dim]
type = palfx
trigger1 = animelem = 3
mul = 96,96,96
time = 2

[state 1300, pal dim]
type = palfx
trigger1 = animelem = 4
mul = 64,64,64
time = 2

[state 1300, pal dim]
type = palfx
trigger1 = animelem = 5
mul = 32,32,32
time = 2

[state 1301, nothitby]
type = nothitby
trigger1 = animelemtime(2) > 0
value = SCA

[state 1301, playerpush]
type = playerpush
trigger1 = animelemtime (2) > 0
value = 0

[state 1301, posadd]
type = posset
trigger1 = animelem = 6
trigger1 = pos y > -400
y = -400

[state 1301, horizontal movement]
type = posadd
trigger1 = animelemtime(6) = 0
trigger1 = command = "holdback"
x = -600

[state 1301, horizontal movement]
type = posadd
trigger1 = animelemtime(6) = 0
trigger1 = command = "holdfwd"
x = 600

[state 1301, horizontal movement]
type = posadd
trigger1 = animelemtime(6) = 0
trigger1 = command != "holdfwd"
trigger1 = command != "holdback"
x = ifelse(p2dist x > 440, 300, p2dist x - 140)

[state 1301, End]
type = changestate
trigger1 =animtime = 0
value = 1310
;---------------------------------------------------------------------------
;Reaapear
[statedef 1310]
type = A
movetype = I
physics = N
ctrl = 0
velset = 0,0
anim = 1310
facep2 = 1

[state 1205, noairguard]
type = assertspecial
trigger1 = 1
flag = noairguard

[state 1300, pal dim]
type = palfx
trigger1 = animelem = 4
mul = 128,128,128
time = 2

[state 1300, pal dim]
type = palfx
trigger1 = animelem = 3
mul = 96,96,96
time = 2

[state 1300, pal dim]
type = palfx
trigger1 = animelem = 2
mul = 64,64,64
time = 2

[state 1300, pal dim]
type = palfx
trigger1 = animelem = 1
mul = 32,32,32
time = 2


[state 1310, end]
type = changestate
trigger1 = animtime = 0
value = 50
ctrl = 1

;--------------------------------------------------------------------------
;Defensive Option - Teleport Butt Bump
;--------------------------------------------------------------------------
[statedef 1400]
type = S
movetype = I
physics = S
ctrl = 0
anim = 1400

[state 1400, poweradd]
type = poweradd
trigger1 = time = 0
value = -1000

[state 1400, awareness pause]
type = pause
trigger1 = time = 0
time = 8
endcmdbuftime = 8

[state 1400, explod smoke]
type = explod
trigger1 = animelemtime(6) = 0
anim = 2021
id = 2021
postype = p1
pos = -100,800
scale = const(size.xscale)*4,const(size.yscale)*4
ownpal = 1
sprpriority = 5

[state 1400, smoke snd]
type = playsnd
trigger1 = animelemtime(6) = 0
value = 1400,1

[state 1400, smoke snd]
type = playsnd
trigger1 = animelemtime(6) = 0
value = 1400,1


[state 1400, explod tree]
type = Explod
trigger1 = animelemtime(8) = 0
anim = 2020
id = 2020
postype = p1
pos =0,0
scale = const(size.xscale),const(size.yscale)
ownpal = 1
sprpriority = 4
vel = -4,-18
accel = 0,1.05

[state 1400, dim]
type = bgpalfx
trigger1 = time = 0
time = 8
mul = 200,200,200

[state 1400, hitby]
type = hitby
trigger1 = 1
value = SCA,AT

[state 3042, whoosh]
type = playsnd
trigger1 = animelemtime(8) = 2
value = 1000,0

[state 1400, move back]
type = posadd
triggerall = animelemtime(8) = 7
trigger1 = command = "holdback"
trigger2 = command != "holdfwd"
x = p2dist x - 175

[state 1400, move forward]
type = posadd
trigger1 = animelemtime(8) = 7
trigger1 = command = "holdfwd"
x = p2dist x + 175

[state 1400, end]
type = changestate
trigger1 = animtime = 0
value = 1401

;--------------------------------------------------------------------------
;Return with bump
[statedef 1401]
type = S
movetype = A
physics = S
anim = 1401

[state 1400, turn]
type = turn
trigger1 = p2dist x < 0
trigger1 = time = 0 

[state 1400, hitby]
type = hitby
trigger1 = time < 24
value = SCA,AT

[State 52, 4]
type = EnvShake
trigger1 = animelemtime(6) = 0
time = 12
ampl = -12
freq = 100
phase = 100

[state 52, 4]
type = playsnd
trigger1 = animelemtime(6) =0
value = S20,0

[state 1400, veladd]
type = veladd
trigger1 = animelemtime(10) = 0
x = 20
persistent = 0

[State 330, Spark]
type = Explod
trigger1 = AnimElemtime(11) = 0
id = 1420
anim = 1420
postype = p1
pos = 400,-275
sprpriority = 4
bindtime = 20
scale = 5,5
ownpal = 1

;[State 1400, Push]
;type = Helper
;trigger1 = animelemTime(11) = 2
;trigger2 = animelemtime(12) = 0
;ignorehitpause = 1
;ID = 1410
;name = "Shove"
;pos = -20,0
;postype = p1
;stateno = 1410
;keyctrl = 0
;ownpal = 1
;helpertype = normal

[State 1401, 3]
type = HitDef
trigger1 = !movecontact || !movereversed
persistent = 0
attr = S, SA
damage    = 150,30
guardflag = MA
hitflag = MAF
priority = 2
id = 1400
nochainid = 1400
pausetime = 8,16
sparkno = 3
p1sprpriority = -1
p2sprpriority = 1
sparkxy = 0,-300
hitsound   = S1006,0
guardsound = S120,0
animtype = heavy
ground.type = high
ground.slidetime = 24
ground.hittime  = 24
ground.velocity = -50,-4
air.velocity = -50,-2
guard.velocity = -68         
guard.hittime = 24
guard.slidetime = 24
airguard.velocity = -40,-6
airguard.hittime = 28
guard.cornerpush.veloff = -30
envshake.ampl = -12
envshake.time = 18
guard.dist = 300
guard.kill = 0
kill = 0
fall = 1
fall.recover = 0

[state 1400, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1

;--------------------------------------------------------------------------
; Pushing part
[Statedef 1410]
type    = A
movetype= I
physics = N
velset = 0,0
anim = 1410

[State 1440, Push]
type = posset
trigger1 = time = 0
y = 0

[State 1440, Push]
type = PlayerPush
trigger1 = 1
value = 1

[State 1440, NHB]
type = NotHitBy
Trigger1 = 1
value = SCA
Time = 1

[State 1440, Vel]
type = VelSet
trigger1 = Time >= 0
x = 30

[State 345, End]
type = DestroySelf
trigger1 = Time = 15




;==========================================================================
;==========================================================================
;                              Super Moves        
;==========================================================================
;==========================================================================
;Izuna drop into 10,000 lbs of ass
;Damage:  650
[statedef 3000]
type = A
movetype = A
physics = N
anim = 3000
ctrl = 0

[state 3000, nothitby]
type = nothitby
trigger1 = animelemtime(3) < 2
value = SCA

[state x, combo damage score]
type = varset
trigger1 = time = 0
trigger1 = var(18) < 90
v = 18
value = 90
persistent = 0
ignorehitpause = 1


[state 3000, no bg]
type = assertspecial
trigger1 = animelemtime(1) =[0, 60]
flag = nobg
ignorehitpause = 1

[State 3000, Super A]
type = SuperPause
trigger1 =  animelemtime(1) = 0
sound = S3000, 2
poweradd = -3000
pos = 10,-100
time = 60
movetime = 60

[state 3000, posfreeze]
type = posfreeze
trigger1 = animelemtime(1) > 0 && animelemtime(1) < 60
y = 1
x = 1

[state 3000, gravity]
type = gravity
trigger1 = animelemtime(3) > 4 


[state 3000, Super Portrait]
type = explod
trigger1 = animelemtime(1) =[0, 14]
anim = 3100
postype = back
sprpriority = -3
supermovetime = 60
removetime = 1
pausemovetime = 60
scale = (3-(time*0.15))*(0.65),(3-(time*0.15))*(0.65)
pos = 0,60-time*5
ownpal = 1


[state 3000, Super Portrait]
type = explod
trigger1 = animelemtime(1) = 15
anim = 3100
postype = back
vel = -0.1,0
sprpriority = -3
supermovetime = 60
removetime = 45
pausemovetime = 60
pos = 0,0
scale = 1,1
ownpal = 1

[state 3000, 1]
type = velmul
trigger1 = time = 0
trigger1 = vel y > 0
y = 0

[State 3000, 1]
type = HitDef
Trigger1 = animelemtime(2) < 4
attr = S, HT         
hitflag = A-          
priority = 1, Miss    
sparkno = -1          
p1sprpriority = 1     
id = 3000    
getpower = 0                  
p1facing = 1
p2facing = 1          
p1stateno = 3001       
p2stateno = 3010       
guard.dist = 0        
fall = 1              
fall.yvelocity = -24
fall.recover = 0

[State 3000, 1]
type = HitDef
Trigger1 = animelemtime(2) >= 4
attr = S, HT 
guardflag = A   
getpower = 0       
hitflag = AF          
priority = 1, Miss    
sparkno = -1          
p1sprpriority = 1     
id = 3000                      
p1facing = 1
p2facing = 1          
p1stateno = 3001       
p2stateno = 3010       
guard.dist = 480        
fall = 1              
fall.yvelocity = -24
fall.recover = 0
guard.dist = 300


[state 3000, end]
type = changestate
trigger1 = animtime = 0
value = 50
ctrl = 1

[state 1100, 1]
type = velmul
trigger1 = vel y > 0
trigger1 = pos y > -120
x = 0
y = 0
persistent = 1



[state 3000, end2]
type = changestate
trigger1 = vel y  > 0
trigger1 = pos y > -vel y 
value = 52
;-------------------------------------------------------------------------

;Izuna Drop animation
[statedef 3001]
type = A
movetype = A
physics = N
anim = 3001
sprpriority = 1

[state 3001, width]
type = width
trigger1 = 1
edge = 639,639

[State 3001, Grab Sound]
type = PlaySnd
trigger1 = time = 0
value = 1, 1

[state 3001, velset]
type = velset
trigger1 = time = 0
x = 0
y = 0

[state 3001, velset]
type = velset
trigger1 = animelemtime(2) = 0
y = -32

[state 3001, velset]
type = velset
trigger1 = animelemtime(7) = 0
trigger1 = backedgebodydist < 260
x = 4

[state 3001, velset]
type = velset
trigger1 = animelemtime(7) = 0
trigger1 = frontedgebodydist < 180
x = -4

[state 1101, wall bounce]
type = velmul
trigger1 = frontedgebodydist < 30
trigger2 = backedgebodydist < 30
x = -2
persistent = 60

[state 3001, gravity]
type = gravity
trigger1 = animelemtime(7) > 0

;====================================
;  Grab Positioning
;====================================
[State 810, Bind 1]
type = TargetBind
trigger1 = AnimElemTime(2) < 0
pos = 250, -700

[State 810, Bind 2]
type = TargetBind
trigger1 = AnimElemTime(2) >= 0 && AnimElemTime(3) < 0
pos = 220, -700

[State 810, Bind 3]
type = TargetBind
trigger1 = AnimElemTime(3) >= 0 && AnimElemTime(4) < 0
pos = -250, -700

[State 810, Bind 4]
type = TargetBind
trigger1 = AnimElemTime(4) >= 0 && AnimElemTime(5) < 0
pos = -280, -700

[State 810, Bind 5]
type = TargetBind
trigger1 = AnimElemTime(5) >= 0 && AnimElemTime(6) < 0
pos = -160, -700

[State 810, Bind 6]
type = TargetBind
trigger1 = AnimElemTime(6) >= 0 && AnimElemTime(7) < 0
pos = 20, -700

[State 810, Bind 7]
type = TargetBind
trigger1 = AnimElemTime(7) >= 0 && AnimElemTime(8) < 0
pos = 150, -300

[State 810, Bind 8]
type = TargetBind
trigger1 = AnimElemTime(8) >= 0 && AnimElemTime(9) < 0
pos = -200, -220

[State 810, Bind 9]
type = TargetBind
trigger1 = AnimElemTime(9) >= 0 && AnimElemTime(10) < 0
pos = -250, 10

[State 810, Bind 10]
type = TargetBind
trigger1 = AnimElemTime(10) >= 0 && AnimElemTime(11) < 0
pos = -200, 10

[State 810, Bind 11]
type = TargetBind
trigger1 = AnimElemTime(11) >= 0 && AnimElemTime(12) < 0
pos = 180, 10

[State 810, Bind 12]
type = TargetBind
trigger1 = AnimElemTime(12) >= 0 && AnimElemTime(13) < 0
pos = 240, 10

[State 810, Bind 13]
type = TargetBind
trigger1 = AnimElemTime(13) >= 0 && AnimElemTime(14) < 0
pos = 180, 10

[State 810, Bind 14]
type = TargetBind
trigger1 = AnimElemTime(14) >= 0 && AnimElemTime(14) < 4
pos = -56, 10

;=========================================
;End Positioning
;=========================================

[state 3001, wind snd]
type = playsnd
trigger1 = animelemtime(9) =0
trigger2 = animelemtime(12) = 0
trigger3 = animelemtime(2) = 0
trigger4 = animelemtime(4) = 0
value = S1050,0
persistent = 1

[state 3001, wind snd]
type = playsnd
trigger1 = animelemtime(1) = 4
value = S41,0
persistent = 1



;=========================================
;Sprite Priority
;=========================================
[state 3001, sprpriority]
type = sprpriority
trigger1 = animelem = 1
value = 3

[state 3001, sprpriority]
type = sprpriority
trigger1 = animelem = 5
value = -3


[state 3001, sprpriority]
type = sprpriority
trigger1 = animelem = 7
value = 3

[state 3001, sprpriority]
type = sprpriority
trigger1 = animelem = 10
value = -3

[state 3001, sprpriority]
type = sprpriority
trigger1 = animelem = 13
value = 3

[state 3001, end]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 3002


;---------------------------------------------------------------------------
;Izuna Drop Landing
[statedef 3002]
type = A
movetype = A
physics = N
anim = 3002
sprpriority = 3

;----------------------
; FX
;----------------------
;Custom Dust
[state 3002, explod]
type = explod
trigger1 = time = 0
anim = 2000
pos = 250,0
scale = const(size.xscale)*3.5,const(size.yscale)*2
sprpriority = 4
ownpal = 1

[state 3002, nothitby]
type = nothitby
trigger1 = 1
value = SCA
ignorehitpause = 1
persistent = 1 

[state 3002, targetstate]
type = targetstate
trigger1 = time = 0
value = 3011

[state 3002, fx]
type = explod
trigger1 = time = 0
anim = F61
pos = 250,0
scale = 4,2
ownpal = 1
sprpriority = -4


[state 3002, explod]
type = explod
trigger1 = time = 0
anim = 2001
pos = 250,0
scale =  const(size.xscale)*3.5,const(size.yscale)*2
sprpriority = -4
ownpal = 1

[state 3002, snd]
type = playsnd
trigger1 = time = 0
value =S5100,0

[state 3002, snd]
type = playsnd
trigger1 = time = 0
value =S5100,0

[state 3002, earthquakes]
type = envshake
trigger1 = time = 0
time = 24
ampl = -32
freq = 60
phase = 60

; -------------------

[state 3002, on ground]
type = velset
trigger1 = time = 0
x = 0
y = 0

[State 3002, Bind 2]
type = TargetBind
trigger1 = AnimElemTime(2) < 0 
pos = 220, 50

[state 3002, targetdamage]
type = targetlifeadd
trigger1 = time = 0
value = ceil(-130*fvar(10))
Kill = 0

[state 3002, targetpowerget]
type = targetpoweradd
trigger1 = time = 0
value = floor((enemynear,powermax / 1000) * 111)

[state 3002, targetstate]
type = targetstate
trigger1 = time = 24
value = 3012

[state 3002, on ground]
type = posset
trigger1 = time = 0
y = 0

[state 3002, bounce off]
type = velset
trigger1 = animelemtime(4) = 4
x = p2dist x * 0.02
y = -48

[state 3002, gravity]
type = gravity
trigger1 = time > 24

[state 3002, changestate]
type = changestate
trigger1 = vel y > 0
value = 3003

[state 3002, end]
type = changestate
trigger1 = time > 24
trigger1 = vel y > 0
trigger1 = pos y > -vel y 
value = 52

;---------------------------------------------------------------------------

;Over head Stomp Rise
[statedef 3003]
type = A
movetype = A
physics = N
anim = 3003
ctrl = 0

[state 3003, turn]
type = turn
trigger1 = time = 0

[state 10x4, on top]
type = posadd
trigger1 = movehit
x = p2dist x
ignorehitpause
persistent = 0

[state 3003, nothitby]
type = nothitby
trigger1 = 1
value = SCA
ignorehitpause = 1
persistent = 1 


[state 1004, gravity]
type = Veladd
trigger1 = 1
y = 3.5

[state 1004, playerpush]
type = playerpush
trigger1 = 1
value = 0

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -6
persistent = 0
ignorehitpause = 1

[state 1004, end]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 3004

;----------------------------------------------------------------------------------
;Overhead Stomp Land
[statedef 3004]
type = S
movetype = A
physics = S
anim = 3004

[state 3004, nothitby]
type = nothitby
trigger1 = 1
value = SCA
ignorehitpause = 1
persistent = 1 

[State 3004, 3]
type = HitDef
trigger1 = time = 0
attr = A, HA
damage    = 130 
guardflag = 
hitflag = FD
id = 3004
getpower = 0
givepower = floor((enemynear,powermax/1000)*111)
nochainid = 3004
priority = 4
pausetime = 12,12
sparkno = 1
sparkxy = -10,-40
hitsound   = 5,3
guardsound = S120,0
animtype = Med
p2stateno = 665
ground.type = High
ground.slidetime = 12
ground.hittime  = 15
ground.velocity = 0
air.velocity = 0,0
kill = 0

[state 3004, 4]
type = playsnd
trigger1 = time = 0
value = S5100,0

[state 3004, 4]
type = playsnd
trigger1 = time = 0
value = S5100,0

[state 3004, stop]
type = velset
trigger1 = time = 0
x = 0
y = 0

[state 3004, posset]
type = posset
trigger1 = time = 0
y = 0

[State 3004, 4]
type = EnvShake
trigger1 = time = 0
time = 24
ampl = -32
freq = 70
phase = 70
ignorehitpause = 1

[state 3004, land fx]
type = explod
trigger1 = time = 0
anim = 2000
bindtime = 1
id = 2000
pos = 40, 10
removetime = -2
sprpriority = 2
scale = 3.0,3.5
ownpal = 1

[state 3004, land fx]
type = explod
trigger1 = time = 0
anim = 2001
bindtime = 1
id = 2001
pos = 40, 10
removetime = -2
sprpriority = -2
scale = 3.0,3.5
ownpal = 1

[state 3004, end]
type = changestate
trigger1 = animtime = 0
value = 3005
;------------------------------------------------------------------------
;Wall Bounces 
[statedef 3005]
type = A
movetype = A
physics = N
anim = 3005

[state 3005, nothitby]
type = nothitby
trigger1 = 1
value = SCA
ignorehitpause = 1
persistent = 1 

[state 3005, movecamera]
type = screenbound
trigger1 = 1
movecamera = 0,1

[state 3005, pal dim]
type = palfx
trigger1 = animelem = 6
mul = 64,64,64
time = 2

[state 3005, velset]
type = velset
trigger1 = time = 0
trigger1 = anim = 3005
x = 96
y = -12

[state 3005, afterimage]
type = afterimage
trigger1 = 1
time = 16
length = 60
timegap = 3
framegap = 3
trans = none
palcolor = 256
;palbright = 30,30,30
;palcontrast = 120,120,120


[state 3005, wallbounce]
type = changestate
trigger1 = frontedgebodydist <= 35
value = 3006
;-------------------------------------------------------------------------
;Jump off wall
[statedef 3006]
type    = A
physics = N
anim = 55
ctrl = 0
sprpriority = 1

[state 3006, nothitby]
type = nothitby
trigger1 = 1
value = SCA
ignorehitpause = 1
persistent = 1 


[state 3006, movecamera]
type = screenbound
trigger1 = 1
movecamera = 0,1

[State 3006, 4]
type = EnvShake
trigger1 = time = 0
time = 12
ampl = -8
freq = 100
phase = 100


[state 3006, 4]
type = playsnd
trigger1 = time = 0
value = S20,0

[state 3006, after image]
type = afterimage
trigger1 = time = 4
time = 8
timegap = 1
framegap = 4
trans = "sub"

[state 3006, width]
type= width
trigger1 = 1
player  = 40,57 ;60 works
edge = 5,50

[state 3006,dekho]
type=turn
trigger1=frontedgebodydist<=35
trigger1=time=0

[state 3006, playsnd]
type = playsnd
trigger1 = time = 4
value = S3000,1


[state 3006, posset]
type = posset
trigger1 = time = 0
x=(pos x-screenpos x)*facing

[state 3006, posfreeze]
type = posfreeze
trigger1 = time < 4
x = 1
y = 1

[State 3006, 6]
type = ChangeState
trigger1 = time = 4 
trigger1 = pos y > -700
value = 3005

[State 3006, 6]
type = ChangeState
trigger1 = time = 4 
trigger1 = pos y <= -700
value = 3007

;-------------------------------------------------------------------------
;Jump on victim
[statedef 3007]
type = A
movetype = A
physics = N
anim = 3007

[state 3007, nothitby]
type = nothitby
trigger1 = 1
value = SCA
ignorehitpause = 1
persistent = 1 

[state 3007, velset]
type = velset
trigger1 = time = 0
x = p2dist x*0.06
y = -12

[state 3005, afterimage]
type = afterimage
trigger1 = time < 24
time = 4
length = 20
timegap = 4
framegap = 4
trans = none

[state 3007, stop on location]
type = velset
trigger1 = p2dist x < 0
x = 0

[state 3007, pos on location]
type = posset
trigger1 = p2dist x < -80
x = p2dist x - 80

[state 3007, butt drop]
type = changeanim
trigger1 = time > 32
trigger1 = anim != 650
value = 650

[state 3007, gravity]
type = veladd
trigger1 = time > 32
y = 1.25

[state 3007, gravity]
type = gravity
trigger1 = time > 32

[state 3007, playerpush]
type = playerpush
trigger1 = 1
value = 0


[state 3007, end]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 3008
;-------------------------------------------------------------------------
; 1st Landing
[statedef 3008]
type    = C
movetype= A
physics = N



[state 3008, nothitby]
type = nothitby
trigger1 = 1
value = SCA
ignorehitpause = 1
persistent = 1 

[state 3008, anim]
type = changeanim
trigger1 = time = 0
value = 651

[state 651, Crater]
type = explod
trigger1 = time = 0
trigger1 = !numexplod(2030)
anim = 2030
id = 2030
pos = 0,0
scale = const(size.xscale)*1,const(size.yscale)*1
sprpriority = -4

[state 651, Rubble]
type = explod
trigger1 = time = 0
trigger1 = !numexplod(2035)
anim = 2035
id = 2035
pos = 0,0
scale = const(size.xscale)*1,const(size.yscale)*1
sprpriority = -3

;Custom Dust
[state 3008, explod]
type = explod
trigger1 = time = 0
anim = 2000
pos = 30,0
scale = const(size.xscale)*3.5,const(size.yscale)*3.25
ontop = 1
ownpal = 1

[state 3008, fx]
type = explod
trigger1 = time = 0
anim = F61
pos = 0,0
scale = 8,4
ownpal = 1


[state 3008, explod]
type = explod
trigger1 = time = 0
anim = 2001
pos = 30,0
scale =  const(size.xscale)*3.5,const(size.yscale)*3.25
sprpriority = -4
ownpal = 1
; -------------------

[state 3008, snd]
type = playsnd
trigger1 = time = 0
value =S5100,0

[state 651, snd]
type = playsnd
trigger1 = time = 0
value =S5100,0

[state 651, snd]
type = playsnd
trigger1 = time = 0
value =S5100,0

[state 3008, pos]
type = posset
trigger1 = time = 0
y = 0

[state 3008, playerpush]
type = playerpush
trigger1 = 1
value = 0

[State 3008, 3]
type = HitDef
trigger1 = Time = 0
attr = A, HA
damage    = 368
id = 3000
guardflag = 
getpower = 0
givepower = floor((enemynear,powermax/1000)*111)
hitflag = FD
priority = 4
pausetime = 12,12
sparkno = 1
sparkxy = -10,-40
hitsound   = 5,3
guardsound = S120,0
animtype = Med
p2stateno = 660
ground.type = High
ground.slidetime = 12
ground.hittime  = 15
ground.velocity = 0
air.velocity = 0,0
kill = 1

[state 3008, targetstate]
type = targetstate
trigger1 =  numtarget(3004)
trigger1 = time = 0
id = 3004
value = 660

[state 3008, targetlifeadd]
type = targetlifeadd
trigger1 = time = 0
trigger1 = numtarget(3004)
id = 3004
value = ceil(fvar(10)*-368)

[state 3008, vel]
type = velset
trigger1 = time = 0
y = 0
x = 0

[state 3008, earthquakes]
type = envshake
trigger1 = time = 0
time = 60
ampl = -40
freq = 75
phase = 75

;[state 651, earthquakes]
;type = envshake
;trigger1 = time = 0
;trigger1 = var(15) = 1 
;time = 48
;ampl = -32
;freq = 75
;phase = 75


[state 3008, end]
type = changestate
trigger1 = animtime = 0
value = 30081

;--------------------------------------------------------------------------
;Bounce
[statedef 30081]
type    = A
movetype= A
physics = N

[state 30081, nothitby]
type = nothitby
trigger1 = 1
value = SCA
ignorehitpause = 1
persistent = 1 

[state 30081, anim]
type = changeanim
trigger1 = time = 0
value = 652

[state 30081, playerpush]
type = playerpush
trigger1 = 1
value = 0


[state 30081, velset]
type = velset
trigger1 = time = 0
y = -18

[state 30081, gravity]
type = gravity
trigger1 = time > 2

[state 30081, end]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 30082

;--------------------------------------------------------------------------
;Landing Rest
[statedef 30082]
type    = C
movetype= A
physics = N

[state 30082, nothitby]
type = nothitby
trigger1 = 1
value = SCA
ignorehitpause = 1
persistent = 1 

[state 30082, anim]
type = changeanim
trigger1 = time = 0
value = 653

[state 30082, posset]
type = posset
trigger1 = time = 0
y = 0

[state 30082, playerpush]
type = playerpush
trigger1 = 1
value = 0


[state 30082, velset]
type = velset
trigger1 = time = 0
y = 0
x = 0

[state 30082, snd]
type = playsnd
trigger1 = time = 0
value =S5100,0

[state 30082, earthquakes]
type = envshake
trigger1 = time = 0
time = 15
ampl = 12
freq = 100
phase = 100

[state 30082, end]
type = null
triggerall = animelemtime(5) > 0 && animelemtime(5) < 8
trigger1 = command = "AddOn"
trigger2 = Ailevel
value = 3009

[state 30082, end]
type = changestate
trigger1 = animtime = 0
value = 3009;656
 
;---------------------------------------------------------------------------
;Grind add on
[statedef 3009]
type = C
movetype = A
physics = C
anim = 654

[state 3009, nothitby]
type = nothitby
trigger1 = 1
value = SCA
ignorehitpause = 1
persistent = 1 

[state 654, targetstate]
type = targetstate
triggerall = numtarget(3000) || numtarget(3004) 
trigger1 = time = 0
trigger2 = time = 40
value = 661

;[state 654, targetlifeadd]
;type = poweradd
;trigger1 = 1
;value = 10
;persistent = 9

[state 52, front foot front dust]
type = explod
trigger1 = animelemtime(3) >= 0 && animelemtime(5) < 0
trigger2 = animelemtime(8) >= 0 && animelemtime(11) < 0
anim = F120
pos = -320,-10
scale = 2, 2
vel = -2,-1
sprpriority = 4
persistent =3

[state 654, playsnd]
type = playsnd
trigger1 = animelemtime(3) = 0
trigger2 = animelemtime(8) = 8
value = S654,0


[state 654, targetlifeadd]
type = null;targetpoweradd
trigger1 = numtarget(3000) || numtarget(3004)
value = 15
persistent = 9

[state 654, targetlifeadd]
type = targetlifeadd
trigger1 = numtarget(3000) || numtarget(3004)
value = ceil(-2*fvar(10))
persistent = 9



[state 654, end]
type = changestate
trigger1 = time > 90
value = 656

;---------------------------------------------------------------------------







;=========================================================================
;Enemy Animations
;=========================================================================
;Izuna Drop Victim
[Statedef 3010]
type    = A
movetype= H
physics = N
velset = 0,0
sprpriority = 2

[State 3010, 1]
type = ChangeAnim2
Trigger1 = Time = 0
value = 3010

[state 3010, movecamera]
type = ScreenBound
trigger1 = 1
value = 1
movecamera = 0,0
ignorehitpause = 1

[State 3010, 2]
type = SelfState
trigger1 = !gethitvar(isbound)
value = 5050

;---------------------------------------------------------------------------

;Izuna Drop Victim Spiked
[Statedef 3011]
type    = A
movetype= H
physics = N
velset = 0,0

[state 1130, 1]
type = angledraw
trigger1 = time >= 0 && time < 4
scale = 1,1

[state 1130, 1]
type = angledraw
trigger1 = time >= 4 && time < 8
scale = 1.1,0.8

[state 1130, 1]
type = angledraw
trigger1 = time >= 8 && time < 20
scale = 1.25,0.4

[state 1130, 1]
type = angledraw
trigger1 = time >= 20 && time < 24
scale = 1.1,0.8


[State 1130, 1]
type = ChangeAnim2
Trigger1 = Time = 0
value = 1132

;-----------------------------------------------------
;Izuna Drop Victim
[Statedef 3012]
type    = A
movetype= H
physics = N
velset = -2,-18
sprpriority = -2

[state 3012, changeanim]
type = changeanim2
trigger1 = time = 0
value = 1133

[state 3012, turn]
type = turn
trigger1 = time = 0


[state 3012, veladd]
type = veladd
trigger1 = 1
y = 1.25


[State 3012, 2]
type = changeState
trigger1 = vel y > 0
trigger1 = pos y > -vel y 
value = 3013

;---------------------------------------------------------------------------
[Statedef 3013]
type    = L
movetype= H
physics = N

[State 5100, 2004.04.14 behavior]
type = null;VelSet
trigger1 = Time = 0
trigger1 = GetHitVar(fall.yvel) = 0
trigger1 = vel x < -1
x = -1

[State 5100, EnvShake]
type = FallEnvShake
trigger1 = Time = 0

[State 5100, Var] ;Save fall velocity
type = VarSet
trigger1 = Time = 0
sysvar(1) = floor(vel y)

[State 5100, 2] ;Hit ground anim (normal)
type = ChangeAnim
triggerall = time = 0
trigger1 = (anim != [5051,5059]) && (anim != [5061,5069])
trigger2 = !SelfAnimExist(5100 + (anim % 10))
value = 5100

[State 5100, 3] ;Hit ground anim (for hit up)
type = ChangeAnim
trigger1 = time = 0
trigger1 = (anim = [5051,5059]) || (anim = [5061,5069])
trigger1 = SelfAnimExist(5100 + (anim % 10))
value = 5100 + (anim % 10)

[state 3013, change animation]
type = changeanim
trigger1 = time > 12
value = 5110

[State 5100, 4]
type = PosSet
trigger1 = Time = 0
y = 0

[State 5100, 5]
type = VelSet
trigger1 = Time = 0
y = 0

[State 5100, 6] ;Reduce speed
type = VelMul
trigger1 = Time = 0
x = 0.75

[State 5100, 8]
type = Explod
trigger1 = Time = 0
anim = F61
postype = p1
pos = 0, 0
scale = 3,1.5
facing = facing
sprpriority = ifelse (sysvar(1) <= Const720p(56), -10, 10)


[State 5100, 10]
type = PlaySnd
trigger1 = Time = 1
value = F7, (sysvar(1) > Const720p(20)) + (sysvar(1) > Const720p(56))

[State 5100, 11]
type = PosFreeze
trigger1 = 1

;--------------------------------------------------------------------------
;Ninja Vanish then overwhelm
[statedef 3040]
type = S
movetype = A
physics = N
anim = 3040
velset = 0,0
ctrl = 0

[state 3000, nothitby]
type = nothitby
trigger1 = time < 68
value = SCA

;one hit of armor
[state 1006, armor counter]
type = varset
trigger1 = time = 0
trigger2 = var(20) > 5
V = 20
value = 5
persistent = 0
ignorehitpause = 1

[state 3000, no bg]
type = assertspecial
trigger1 = animelemtime(2) >= 0 && animelemtime(8) < 0
flag = nobg
ignorehitpause = 1

[State 3000, Super A]
type = SuperPause
trigger1 =  animelemtime(2) = 0
sound = S3000, 2
poweradd = -1000
pos = 10,-100
time = 60
movetime = 60

[state 3000, posfreeze]
type = posfreeze
trigger1 = animelemtime(3) > 0 && animelemtime(3) < 48
y = 1
x = 1

[state 3000, Super Portrait]
type = explod
trigger1 = animelemtime(2) >= 0 && animelemtime(3) < 13
anim = 3100
postype = back
sprpriority = -3
supermovetime = 60
removetime = 1
pausemovetime = 60
scale = (3-(time*0.15))*(0.65),(3-(time*0.15))*(0.65)
pos = 0,60-time*5
ownpal = 1


[state 3000, Super Portrait]
type = explod
trigger1 = animelemtime(3) = 13
anim = 3100
postype = back
vel = -0.1,0
sprpriority = -3
supermovetime = 60
removetime = 45
pausemovetime = 60
pos = 0,0
scale = 1,1
ownpal = 1

[state 3040, screen bound]
type = screenbound
trigger1 = animelemtime(8) >= 0
movecamera = 0,0
value  = 0

[state 3042, whoosh]
type = playsnd
trigger1 = animelemtime(8) = 2
value = 1000,0

[state 3000, Teleport]
type = posadd
triggerall = animelemtime(8) = 1
trigger1 = command = "holdfwd"
trigger1 = !ailevel
trigger2 = ailevel
trigger2 = enemynear,movetype = A 
x = p2dist x + 800

[state 3000, Teleport]
type = posadd
triggerall = animelemtime(8) = 1
trigger1 = command != "holdfwd"
trigger1 = !ailevel
trigger2 = command = "holdback"
trigger2 = !ailevel
trigger3 = ailevel
trigger3 = enemynear,movetype != A
x = p2dist x - 800

[state 1400, explod smoke]
type = explod
trigger1 = animelemtime(4) = 0
anim = 2021
id = 2021
postype = p1
supermovetime = 16
pos = -100,800
scale = const(size.xscale)*4,const(size.yscale)*4
ownpal = 1
sprpriority = 5

[state 1400, smoke snd]
type = playsnd
trigger1 = animelemtime(4) = 0
value = 1400,1

[state 1400, smoke snd]
type = playsnd
trigger1 = animelemtime(4) = 0
value = 1400,1

[state 1400, explod tree]
type = Explod
trigger1 = animelemtime(6) = 0
anim = 2020
id = 2020
postype = p1
pos =0,0
scale = const(size.xscale),const(size.yscale)
ownpal = 1
sprpriority = 4
vel = -4,-18
accel = 0,1.05


[state 1300, pal dim]
type = palfx
trigger1 = animelem = 4
mul = 128,128,128
time = 2

[state 1300, pal dim]
type = palfx
trigger1 = animelem = 5
mul = 96,96,96
time = 2

[state 1300, pal dim]
type = palfx
trigger1 = animelem = 6
mul = 64,64,64
time = 2

[state 1300, pal dim]
type = palfx
trigger1 = animelem = 7
mul = 32,32,32
time = 2

[state x, Minimum Super combo damage]
type = varset
trigger1 = time = 0
trigger1 = var(18) < 70
v = 18
value = 70

[state 3000, end]
type = changestate
trigger1 = animtime = 0
value = 3041

;--------------------------------------------------------------------------
;return
[statedef 3041]
type = S
movetype = A
physics = S
anim = 3041
facep2 = 1

[state 3042, whoosh]
type = playsnd
trigger1 = time = 0
value = 1000,0

[state 1300, pal dim]
type = palfx
trigger1 = animelem = 4
mul = 128,128,128
time = 2

[state 1300, pal dim]
type = palfx
trigger1 = animelem = 3
mul = 96,96,96
time = 2

[state 1300, pal dim]
type = palfx
trigger1 = animelem = 2
mul = 64,64,64
time = 2

[state 1300, pal dim]
type = palfx
trigger1 = animelem = 1
mul = 32,32,32
time = 2

[state 3040, screen bound]
type = screenbound
trigger1 = 1
movecamera = 0,0
value  = 0

[state 3041, end]
type = changestate
trigger1 = animtime = 0
value = 3042

;--------------------------------------------------------------------------
;Run in
[statedef 3042]
type = S
movetype = I
physics = S
ctrl = 0

;-----------------
;Armor
;-----------------


[state 3042, still take damage]
type = lifeadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) > 0
value = floor(-gethitvar(damage)*0.5)
persistent = 1
ignorehitpause = 1

[state 3042, armor count down]
type = varadd
trigger1 = gethitvar(damage) != 0
V = 20
value = - 1
persistent = 1
ignorehitpause = 1

;----------------------------------------------
;determine what frame
[state 3042, remember frame]
type = varset
trigger1 = time <= 0
v = 22
value = animelemno(0)
ignorehitpause = 1

;delay effect
[state 3042, delay]
type = changeanim 
trigger1 = var(32) < floor(gethitvar(hittime)*0.2)
value = anim
elem = var(22)

[state 3042, posfreeze]
type = posfreeze
trigger1 = var(32) < floor(gethitvar(hittime)*0.2)
value = 1
;-------------------------------------------------


[state 3042, Unstoppable]
type = hitoverride
trigger1 = Life > 1
trigger1 = Var(20) > 0
attr = SCA, AA, AP
stateno = 3042
time = 1
persistent = 1
ignorehitpause = 1

[State 3042, flash red]
type = PalFX
trigger1 = Time = 0
trigger1 = gethitvar(damage) != 0
time = 7
add = 100,0,0
IgnoreHitPause = 1
;--------------------------
;armor end
;--------------------------

[state 3042, animation]
type = changeanim
trigger1 = anim != 3042
value = 3042



[State 3042, 1]
type = VelSet
trigger1 = 1
x = const(velocity.run.fwd.x)*2.5


[State 3042, Shockwave]
type = explod
anim = F61
trigger1 = animelemtime(4) = 0 
pos = 125, 0
scale = const(size.xscale),const(size.yscale)
persistent = 1

[State 3042, Shockwave]
type = explod
anim = F61
trigger1 = animelemtime(8) = 0 
pos = 85, 5
scale = const(size.xscale),const(size.yscale)
persistent = 1

[State 3042, 4]
type = EnvShake
trigger1 = animElemtime(4) = 0
trigger2 = animElemtime(8) = 0
time = 12
ampl = -18
freq = 80
phase = 80

[State 3042, footstep]
type = PlaySnd
trigger1 = AnimElemtime(4) = 0
trigger2 = animelemtime(8) = 0
value = S20,0

[state 3042, no block]
type = assertspecial
trigger1 = var(20) != 10
flag = nostandguard
flag2 = nocrouchguard
ignorehitpause = 1

[state 3042, noturn]
type = assertspecial
trigger1 = 1
flag = NoautoTurn
persistent = 1
ignorehitpause = 1

[State 3042, 2] ;Prevent run from canceling into walk
type = AssertSpecial
trigger1 = 1
flag = NoWalk

[State 3042, 3] ;Prevent from turning
type = AssertSpecial
trigger1 = 1
flag = NoAutoTurn

[State 3042, 4]
type = ChangeState
trigger1 = time > 70
trigger2 = p2bodydist x < 170
trigger2 = time > 8
value = 3043

;--------------------------------------------------------------------------
;Butt hit
[statedef 3043]
type = S
movetype = A
physics = S
sprpriority = -2

[state 3043, anim]
type = changeanim
trigger1 = anim != 3043
value = 3043

;-----------------
;Armor
;-----------------

[state 3043, still take damage]
type = lifeadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) > 0
value = floor(-gethitvar(damage)*0.5)
persistent = 1
ignorehitpause = 1

[state 3043, armor count down]
type = varadd
trigger1 = gethitvar(damage) != 0
V = 20
value = -1
persistent = 1
ignorehitpause = 1

;----------------------------------------------
;determine what frame
[state 3043, remember frame]
type = varset
trigger1 = time <= 0
v = 22
value = animelemno(0)
ignorehitpause = 1

;delay effect
[state 3043, delay]
type = changeanim 
trigger1 = var(32) < floor(gethitvar(hittime)*0.2)
value = anim
elem = var(22)

[state 3043, posfreeze]
type = posfreeze
trigger1 = var(32) < floor(gethitvar(hittime)*0.2)
value = 1
;-------------------------------------------------


[state 3043, Unstoppable]
type = hitoverride
triggerall = animelemtime(5) < 0 
trigger1 = Life > 1
trigger1 = Var(20) > 0
attr = SCA, AA, AP
stateno = 3043
time = 1
persistent = 1
ignorehitpause = 1

[State 3043, flash red]
type = PalFX
trigger1 = Time = 0
trigger1 = gethitvar(damage) != 0
time = 7
add = 100,0,0
IgnoreHitPause = 1
;--------------------------
;armor end
;--------------------------

[state 3043, veladd]
type = veladd
trigger1 = animelemtime(5) > 0 && animelemtime(7) < 0
x = 6
ignorehitpause = 0

[state 3043, velset]
type = velmul
trigger1 = animelemtime(7) = 0
x = 0.25
ignorehitpause = 1

[state 3043, velset]
type = velset
trigger1 = animelemtime(7) = 8
x = 0
ignorehitpause = 1


[State 3043, 3]
type = HitDef
trigger1 = animelemtime(6) >= 0
persistent = 4
attr = S, HA
damage    = 60,12
guardflag = MA
hitflag = MAF
priority = 2
id = 3040
getpower = 0
givepower = 100,30
pausetime = ifelse(animelemtime(6) < 16, 2,16),ifelse(animelemtime(6) < 16, 2,16)
sparkno = ifelse(animelemtime(6) < 16, 2,3)
p1sprpriority = -1
p2sprpriority = 1
sparkxy = 0,-300
hitsound   = ifelse(animelemtime(6) < 16, 5,1006),ifelse(animelemtime(6) < 160, 2,0)
guardsound = S120,0
animtype = heavy
p2facing = 1
ground.type = high
ground.slidetime = 24
ground.hittime  = 24
ground.velocity = ifelse(animelemtime(6) < 16, -2,-80),ifelse(animelemtime(6) < 16, 0,-40)
air.velocity = ifelse(animelemtime(6) < 16, -2,-70),ifelse(animelemtime(6) < 16, -4,-40)
guard.velocity = ifelse(animelemtime(6) < 16, -8,-40)       
guard.hittime = ifelse(animelemtime(6) < 16, 12,18)
guard.slidetime = ifelse(animelemtime(6) < 16, 12,18)
airguard.velocity = ifelse(animelemtime(6) < 16, -2,-16),ifelse(animelemtime(6) < 16, -4,-18)
airguard.hittime = ifelse(animelemtime(6) < 16, 12,22)
guard.cornerpush.veloff = ifelse(animelemtime(6) < 16, -4,-30)
envshake.ampl = ifelse(animelemtime(6) < 16, -4,-12)
envshake.time = ifelse(animelemtime(6) < 16, 6,18)
guard.dist = 640
fall = ifelse(animelemtime(6) < 16, 0,1)
fall.recover = 0
fall.recovertime = 60

[state 3043, targetstate]
type = targetstate
trigger1 = movehit
trigger1 = animelemtime(6) > 16
trigger1 = var(7) > 0
trigger1 = hitpausetime = 1
ignorehitpause = 1
value = 675

[state 3043, nothitby]
type = nothitby
trigger1 = movehit
value = SCA
ignorehitpause = 1

[state 3043, Butt cheek]
type = explod
trigger1 = animelemtime(6)=0
trigger1 = numexplod(1006) = 0
anim = 3044
postype = p1
pos = 0,0
id = 3044
bindtime = -1
removeongethit = 1
removetime = -2
sprpriority = 3
scale = const(size.xscale),const(size.yscale)
ignorehitpause = 0

[state 3043, front foot front dust]
type = explod
trigger1 = animelemtime(4) >= 0 && animelemtime(5) < 0
anim = F120
pos = -30,0
scale = 4, 4
persistent = 4
sprpriority = 3

[state 3043, Not Active]
type = statetypeset
trigger1 = animelemtime(7) = 0
movetype = I


[state 3043, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1


;----------------------------------------------------------------------
[statedef 3050]
type = S
movetype = A
physics = N
anim = 3050
velset = 0,0
ctrl = 0

[State 3000, Super A]
type = SuperPause
trigger1 =  animelemtime(2) = 0
sound = S3000, 0
poweradd = -1000
pos = 10,-300
time = 60
movetime = 60
ignorehitpause = 1



[State 800, 1]
type = HitDef
Trigger1 = animelem = 2,<0
trigger1 = p2stateno != [150,155]
attr = S, HT         
hitflag = M          
priority = 1, Miss    
sparkno = -1          
p1sprpriority = 2
p2sprpriority = 1     
id = 3050                      
p1facing = 1
p2facing = 1          
p1stateno = 3051       
p2stateno = 3060      
guard.dist = 0        
fall = 1              
fall.recover = 0
numhits = 0

[state 3000, no bg]
type = assertspecial
trigger1 = animelemtime(2) =[0, 60]
flag = nobg
ignorehitpause = 1

[state 3000, Super Portrait]
type = explod
trigger1 = animelemtime(2) =[0,14]
anim = 3100
postype = back
sprpriority = -3
supermovetime = 60
removetime = 1
pausemovetime = 60
scale = (3-(time*0.15))*(0.65),(3-(time*0.15))*(0.65)
pos = 0,60-time*5
ownpal = 1

[state 3000, Super Portrait]
type = explod
trigger1 = animelemtime(2) = 15
anim = 3100
postype = back
vel = -0.1,0
sprpriority = -3
supermovetime = 60
removetime = 45
pausemovetime = 60
pos = 0,0
scale = 1,1
ownpal = 1

[state 3050, nothitby]
type = nothitby
trigger1 = animelemtime(3) < 0
value = SCA

[State 0, StateTypeSet]
type = StateTypeSet
trigger1 = animelem = 4
movetype = I

[state 3043, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1

;-----------------------------------------------------------------------------------------
[statedef 3051]
type = S
movetype = A
physics = N
anim = 3051
velset = 0,0
ctrl = 0

[State 3051, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = timerfreeze

[state 3051, nothitby]
type = nothitby
trigger1 = 1
value = SCA

[State 3051, Width]
type = Width
trigger1 = 1
edge = 200,0

[State 3051, ScreenBound]
type = ScreenBound
trigger1 = animelem = 14,>=0
value = 1
movecamera = 1,0

[State 3051, TargetState]
type = TargetState
triggerall = NumTarget(3050)
trigger1 = !time
value = 3060
ID = 3050

[State 3051, TargetBind]
type = TargetBind
triggerall = NumTarget(3050)
trigger1 = animelem = 2,<0
trigger2 = animelem = 3,>=0 && animelem = 6,<0
id = 3050
pos = 350,0

[State 3051, TargetBind]
type = TargetBind
triggerall = NumTarget(3050)
trigger1 = animelem = 2,>=0 && animelem = 3,<0
id = 3050
pos = 240,-520

[State 3051, TargetState]
type = TargetState
triggerall = NumTarget(3050)
trigger1 = animelem = 7
value = 3061
ID = 3050

[State 3051, TargetLifeAdd]
type = TargetLifeAdd
trigger1 = animelem = 7
value = ceil(-20*fvar(10))
ID = 3050
kill = 0

[State 3051, TargetLifeAdd]
type = TargetpowerAdd
trigger1 = animelem = 7
value = ceil(20*fvar(10)*.6)
ID = 3050

[State 3051, PlaySnd]
type = PlaySnd
trigger1 = animelem = 14
value = S3000,1

[State 3051, Explod]
type = Explod
trigger1 = animelem = 7
anim = f3
pos = 338,-280
postype = p1
facing = -1
bindtime = -1
removetime = -2
ontop = 1
supermovetime = 9999
pausemovetime = 9999
ownpal = 1
removeongethit = 1

[State 3051, PlaySnd]
type = PlaySnd
trigger1 = animelem = 7
value = f5,4

[State 3051, HitAdd]
type = HitAdd
trigger1 = animelem = 7
value = 1

[State 3051, VelSet]
type = VelSet
trigger1 = animelem = 14
y = -125

[State 3051, ChangeState]
type = ChangeState
trigger1 = !animtime
value = 3052

;-------------------------------------------------------------------------
[statedef 3052]
type = A
movetype = A
physics = N
anim = 3052
velset = 0,0
ctrl = 0

[State 3052, PosSet]
type = PosSet
trigger1 = animelem = 6,<0
x = 0
y = -480

[State 3052, PosSet]
type = PosSet
trigger1 = animelem = 6
x = 0
y = 0

[state 3052, nothitby]
type = nothitby
trigger1 = 1
value = SCA

[State 3052, AssertSpecial]
type = AssertSpecial
trigger1 = animelem = 7,<0
flag = nofg
flag2 = nobg


[State 3052, AssertSpecial]
type = AssertSpecial
trigger1 = animelem = 8,<0
flag = timerfreeze

[State 3052, ScreenBound]
type = ScreenBound
trigger1 = 1
value = 1
movecamera = 1,0

[State 3052, Explod]
type = Explod
trigger1 = animelem = 2
anim = 3055
ID = 3052
pos = 0,0
postype = p1
bindtime = -1
removetime = -2
sprpriority = 3
ownpal = 1
removeongethit = 1

[State 3052, Explod]
type = Explod
trigger1 = animelem = 2
anim = 3055
ID = 3052
pos = 0,0
postype = p1
bindtime = -1
facing = -1
removetime = -2
sprpriority = 0
ownpal = 1
removeongethit = 1

[State 3052, Explod]
type = Explod
trigger1 = animelem = 3
anim = 3056
ID = 3052
pos = 0,0
postype = p1
bindtime = -1
removetime = -2
sprpriority = 0
ownpal = 1
removeongethit = 1


[State 3052, Explod]
type = Explod
trigger1 = animelem = 3
anim = 3056
ID = 3052
pos = 0,0
postype = p1
bindtime = -1
facing = -1
removetime = -2
sprpriority = 3
ownpal = 1
removeongethit = 1

[State 3052, Explod]
type = Explod
trigger1 = animelem = 4
anim = 3057
ID = 3052
pos = 0,0
postype = p1
bindtime = -1
removetime = -2
sprpriority = 3
ownpal = 1
removeongethit = 1

[State 3052, Explod]
type = Explod
trigger1 = animelem = 4
anim = 3057
ID = 3052
pos = 0,0
postype = p1
bindtime = -1
facing = -1
removetime = -2
sprpriority = 0
ownpal = 1
removeongethit = 1

[State 3052, Explod]
type = Explod
trigger1 = animelem = 5
anim = 3058
ID = 3052
pos = 0,0
postype = p1
bindtime = -1
sprpriority = 3
ownpal = 1
removeongethit = 1

[State 3052, TargetBind]
type = TargetBind
trigger1 = animelem = 18,<0
id = 3050
pos = 0,0

[State 3052, TargetState]
type = TargetState
trigger1 = animelem = 2
value = 3062
ID = 3050

[State 3052, TargetState]
type = TargetState
trigger1 = animelem = 3
value = 3063
ID = 3050

[State 3052, TargetState]
type = TargetState
trigger1 = animelem = 4
value = 3064
ID = 3050


[State 3052, TargetState]
type = TargetState
trigger1 = animelem = 5
value = 3065
ID = 3050

[State 3052, TargetState]
type = TargetState
trigger1 = animelem = 6
value = 660
ID = 3050

[State 3052, PlaySnd]
type = PlaySnd
trigger1 = animelem = 2
trigger2 = animelem = 3
trigger3 = animelem = 4
value = S610,0

[State 3052, PlaySnd]
type = PlaySnd
trigger1 = animelem = 5
value = S41,0

[State 3052, EnvColor]
type = EnvColor
trigger1 = animelem = 2,=3
trigger2 = animelem = 3,=3
trigger3 = animelem = 4,=3
trigger4 = animelem = 5,=3
trigger5 = animelem = 6
value = 255,255,255
time = 1
under = 1
ignorehitpause = 1

[State 3052, Explod]
type = Explod
trigger1 = animelem = 2,=3
trigger2 = animelem = 3,=3
trigger3 = animelem = 4,=3
anim = f3
pos = 0,0
postype = p1
bindtime = -1
removetime = -2
ontop = 1
supermovetime = 9999
pausemovetime = 9999
ownpal = 1
removeongethit = 1

[State 3052, Explod]
type = Explod
trigger1 = animelem = 6
anim = f3
pos = 0,0
postype = p1
bindtime = -1
removetime = -2
ontop = 1
supermovetime = 9999
pausemovetime = 9999
ownpal = 1
removeongethit = 1

[State 3052, Explod]
type = Explod
trigger1 = animelem = 6,=1
anim = 2010
pos = 0,0
scale = 4,4
postype = p1
sprpriority = 6
ownpal = 1

[State 3052, Explod]
type = Explod
trigger1 = animelem = 6,=1
anim = 2011
pos = 0,0
scale = 4,4
postype = p1
sprpriority = -1
ownpal = 1

[State 3052, PlaySnd]
type = PlaySnd
trigger1 = animelem = 6
value = s5100,0

[state 651, Crater]
type = explod
trigger1 = animelemtime(6) = 0
trigger1 = !numexplod(2030)
anim = 2030
id = 2030
pos = 0,0
scale = const(size.xscale)*1,const(size.yscale)*1
sprpriority = -4

[state 651, Rubble]
type = explod
trigger1 = animelemtime(6) = 0
trigger1 = !numexplod(2035)
anim = 2035
id = 2035
pos = 0,0
scale = const(size.xscale)*1,const(size.yscale)*1
sprpriority = -3

[State 3052, PlaySnd]
type = PlaySnd
trigger1 = animelem = 2,=3
trigger2 = animelem = 3,=3
trigger3 = animelem = 4,=3
value = f5,3
[State 3052, PlaySnd]
type = PlaySnd
trigger1 = animelem = 6
value = f5,4

[State 3052, HitAdd]
type = HitAdd
trigger1 = animelem = 2,=3
trigger2 = animelem = 3,=3
trigger3 = animelem = 4,=3
value = 2
[State 3052, HitAdd]
type = HitAdd
trigger1 = animelem = 5,=3
trigger2 = animelem = 6
value = 1

[State 3052, EnvShake]
type = EnvShake
trigger1 = animelem = 6,=1
time = 30
freq = 60
ampl = -18

[State 3052, TargetLifeAdd]
type = TargetLifeAdd
trigger1 = animelem = 2,=3
trigger2 = animelem = 3,=3
trigger3 = animelem = 4,=3
value = ceil(-60*fvar(10))
ID = 3050
kill = 0

[State 3052, TargetLifeAdd]
type = TargetpowerAdd
trigger1 = animelem = 2,=3
trigger2 = animelem = 3,=3
trigger3 = animelem = 4,=3
value = ceil(60*fvar(10)*.6)

[State 3052, TargetLifeAdd]
type = TargetLifeAdd
trigger1 = animelem = 5,=3
value = ceil(-20*fvar(10))
ID = 3050
kill = 0

[State 3052, TargetLifeAdd]
type = TargetpowerAdd
trigger1 = animelem = 5,=3
value = ceil(20*fvar(10)*.6)
ID = 3050

[State 3052, TargetLifeAdd]
type = TargetLifeAdd
trigger1 = animelem = 6
value = ceil(-130*fvar(10))
ID = 3050
kill = 1

[State 3052, TargetLifeAdd]
type = TargetpowerAdd
trigger1 = animelem = 6
value = ceil(100*fvar(10)*.6)
ID = 3050

[state x, combo damage score]
type = varadd
trigger1 = animelem = 6,=1
v = 18
value = -20
persistent = 0
ignorehitpause = 1

[State 3052, VelSet]
type = VelSet
trigger1 = animelem = 20
x = -24

[State 3052, VelSet]
type = VelSet
trigger1 = animelem = 22
x = 0

[State 3052, ChangeState]
type = ChangeState
trigger1 = !animtime
value = 0
ctrl = 1

;---------------------------------------------------
[Statedef 3060]
type = S
movetype = H
physics = N
velset = 0,0
ctrl = 0

[State 0, ScreenBound]
type = ScreenBound
trigger1 = 1
value = 1
movecamera = 1,0

[State 0, NotHitBy]
type = NotHitBy
trigger1 = 1
value = SCA

[State 0, ChangeAnim2]
type = ChangeAnim2
trigger1 = !time
value = 3060

[State 0, ChangeState]
type = selfState
trigger1 = !gethitvar(isbound)
trigger1 = time > 90
value = 0
ctrl = 1
;----------------------------------------------------------------------
[Statedef 3061]
type = A
movetype = H
physics = N
velset = 0,-125
ctrl = 0

[State 0, ScreenBound]
type = ScreenBound
trigger1 = 1
value = 1
movecamera = 1,0

[State 0, NotHitBy]
type = NotHitBy
trigger1 = 1
value = SCA

[State 0, ChangeAnim2]
type = ChangeAnim
trigger1 = !time
value = ifelse(selfanimexist(5051),5051,5030)


[State 0, ChangeAnim2]
type = ChangeAnim
trigger1 = anim = 5030 || anim = 5035
trigger1 = !animtime
value = ifelse(selfanimexist(5035)&&anim=5030,5035,5050)

[State 0, ChangeAnim2]
type = ChangeAnim2
trigger1 = screenpos Y <= -100
trigger1 = anim != 9741
value = 9741

[State 0, VelSet]
type = VelSet
trigger1 = animelem = 1
trigger1 = anim = 9741
y = 0

[State 0, ChangeState]
type = selfState
trigger1 = !gethitvar(isbound)
trigger1 = time > 600
value = 5050
;--------------------------------------------------------------------
[Statedef 3062]
type = A
movetype = H
physics = N
velset = 0,0
ctrl = 0

[State 0, ScreenBound]
type = ScreenBound
trigger1 = 1
value = 1
movecamera = 1,0

[State 0, NotHitBy]
type = NotHitBy
trigger1 = 1
value = SCA

[State 0, ChangeAnim2]
type = ChangeAnim2
trigger1 = !time
value = 3062

[State 0, ChangeState]
type = selfState
trigger1 = !gethitvar(isbound)
trigger1 = time > 600
value = 5050
;----------------------------------------------------------------------
[Statedef 3063]
type = A
movetype = H
physics = N
velset = 0,0
ctrl = 0

[State 0, ScreenBound]
type = ScreenBound
trigger1 = 1
value = 1
movecamera = 1,0

[State 0, NotHitBy]
type = NotHitBy
trigger1 = 1
value = SCA

[State 0, ChangeAnim2]
type = ChangeAnim2
trigger1 = !time
value = 3063

[State 0, ChangeState]
type = selfState
trigger1 = !gethitvar(isbound)
trigger1 = time > 600
value = 5050
;----------------------------------------------------------------------
[Statedef 3064]
type = A
movetype = H
physics = N
velset = 0,0
ctrl = 0

[State 0, ScreenBound]
type = ScreenBound
trigger1 = 1
value = 1
movecamera = 1,0

[State 0, NotHitBy]
type = NotHitBy
trigger1 = 1
value = SCA

[State 0, ChangeAnim2]
type = ChangeAnim2
trigger1 = !time
value = 3064

[State 0, ChangeState]
type = selfState
trigger1 = !gethitvar(isbound)
trigger1 = time > 600
value = 5050

[Statedef 3065]
type = A
movetype = H
physics = N
velset = 0,0
ctrl = 0

[State 0, ScreenBound]
type = ScreenBound
trigger1 = 1
value = 1
movecamera = 1,0

[State 0, NotHitBy]
type = NotHitBy
trigger1 = 1
value = SCA

[State 0, ChangeAnim2]
type = ChangeAnim2
trigger1 = !time
value = 3065

[State 0, ChangeState]
type = selfState
trigger1 = !gethitvar(isbound)
trigger1 = time > 600
value = 5050
;----------------------------------------------------------------------------------
[statedef 3066]
type    = L
movetype= H
physics = N
ctrl = 0
velset = 0,0

[state 660, 1]
type = changeanim
trigger1 = time = 0
value = 5110

[State 660, flatten]
type = AngleDraw
trigger1 = time > 0
value = 0
scale = 1.3,0.1

[state 660, on ground]
type = posset
trigger1 = 1
y = 0

[state 660, passthrough]
type = playerpush
trigger1 = 1
value = 0

[State 660, Width]
type = Width
trigger1 = time > 0
value = 0,0

[state 660, invunerable]
type = nothitby
trigger1 = 1
value = SCA

[State 660, 5]
type = PosSet
trigger1 = Time = 0
y = 0

[State 660, 9] ;For hit up type
type = ChangeAnim
persistent = 0
trigger1 = !time
value = 5110

[State 660, 12]
type = VarSet
trigger1 = SysVar(0)
trigger1 = Time = 0
sysvar(0) = 0

[state 1108, nothitby]
type = nothitby
trigger1 = 1
value = SCA
time = 4

[State 660, get up]
type = selfstate
trigger1 = life >= 1
trigger1 = time > 130 ;95
value = 5120

[state 660, flat death]
type = changestate
trigger1 = !alive
trigger1 = time > 130
value = 5150







;==========================================================================
;[Info]
;author = "Inktrebuchet" 
;versiondate = 12/13/2018                  
;goal = Detect enemy's projectile (helper). For use with AI.
;       敵の発射物（helper）を検出する。 AIで使用する場合。
;==========================================================================
;                Notes
;==========================================================================
;notes:
;-Enemy's projectile now has a PlayerID use PlayerID(helper(33333333),var(3)) as a redirect.
;
;base examples of trigger use: 
;
;;Enemy's projectile helper's distance from character.
;trigger1 = PlayerIDExist(helper(33333333),var(3))
;trigger1 = PlayerID(helper(33333333),var(3)), p2bodydist x 
;
;;Enemy's projectile helper's velocity.
;trigger1 = PlayerIDExist(helper(33333333),var(3))
;trigger1 = PlayerID(helper(33333333),var(3)), Vel X
;
;==========================================================================
;                Helper var usage.
;==========================================================================
; numhelper(33333333) Variable usage:
; This is a record of the variables that are used
;
; var(0) - highest playerid + 1
; var(3) - projectile player id while it exists
; 
;==========================================================================
[Statedef 33333333]
type = A
movetype = I
physics = N
ctrl = 0
velset = 0, 0
 
;==========================================================================
;                Config Section
;==========================================================================
anim = 9741                   ; blank animation
 
;==========================================================================
 
[state 33333333, Clipboard] 
type = DisplayToClipboard
trigger1 = 1
text = "Highest Playerid = %d , Projectile helper's PlayerId = %d\nBy Inktrebuchet"
params = var(0)-1, var(3)
;==========================================================================
;                Detect Enemy's Projectile Helper
;==========================================================================
[State 33333333, 0]
type = Null
trigger1 = var(0) = 0
trigger1 = (var(0) := id)
ignorehitpause = 1
 
[state 33333333, 1] 
type = varadd
trigger1 = PlayerIdExist(var(0)) 
trigger2 = PlayerIdExist(var(0)+1) 
trigger3 = PlayerIdExist(var(0)+2) 
trigger4 = PlayerIdExist(var(0)+3) 
trigger5 = PlayerIdExist(var(0)+4) 
trigger6 = PlayerIdExist(var(0)+5) 
trigger7 = PlayerIdExist(var(0)+6) 
trigger8 = PlayerIdExist(var(0)+7) 
trigger9 = PlayerIdExist(var(0)+8) 
trigger10 = PlayerIdExist(var(0)+9) 
trigger11 = PlayerIdExist(var(0)+10) 
trigger12 = PlayerIdExist(var(0)+11) 
trigger13 = PlayerIdExist(var(0)+12) 
trigger14 = PlayerIdExist(var(0)+13) 
trigger15 = PlayerIdExist(var(0)+14) 
trigger16 = PlayerIdExist(var(0)+15) 
trigger17 = PlayerIdExist(var(0)+16) 
trigger18 = PlayerIdExist(var(0)+17) 
trigger19 = PlayerIdExist(var(0)+18) 
trigger20 = PlayerIdExist(var(0)+19) 
trigger21 = PlayerIdExist(var(0)+20) 
trigger22 = PlayerIdExist(var(0)+21) 
trigger23 = PlayerIdExist(var(0)+22) 
trigger24 = PlayerIdExist(var(0)+23) 
trigger25 = PlayerIdExist(var(0)+24) 
trigger26 = PlayerIdExist(var(0)+25) 
v = 0
value = 1
ignorehitpause = 1
 
[State 33333333, 2]
type = Null
triggerall = PlayerIdExist(Root,ID)
trigger1 = PlayerIdExist(var(0)-1)
trigger1 = cond(root,teamside = 1, PlayerID(var(0)-1),teamside = 2, PlayerID(var(0)-1),teamside = 1)
trigger1 = PlayerID(var(0)-1),hitdefattr = ASC, NP, SP, HP
trigger1 = var(3) := (var(0)-1)
trigger2 = PlayerIdExist(var(0)-2)
trigger2 = cond(root,teamside = 1, PlayerID(var(0)-2),teamside = 2, PlayerID(var(0)-2),teamside = 1)
trigger2 = PlayerID(var(0)-2),hitdefattr = ASC, NP, SP, HP
trigger2 = var(3) := (var(0)-2)
trigger3 = PlayerIdExist(var(0)-3)
trigger3 = cond(root,teamside = 1, PlayerID(var(0)-3),teamside = 2, PlayerID(var(0)-3),teamside = 1)
trigger3 = PlayerID(var(0)-3),hitdefattr = ASC, NP, SP, HP
trigger3 = var(3) := (var(0)-3)
trigger4 = PlayerIdExist(var(0)-4)
trigger4 = cond(root,teamside = 1, PlayerID(var(0)-4),teamside = 2, PlayerID(var(0)-4),teamside = 1)
trigger4 = PlayerID(var(0)-4),hitdefattr = ASC, NP, SP, HP
trigger4 = var(3) := (var(0)-4)
trigger5 = PlayerIdExist(var(0)-5)
trigger5 = cond(root,teamside = 1, PlayerID(var(0)-5),teamside = 2, PlayerID(var(0)-5),teamside = 1)
trigger5 = PlayerID(var(0)-5),hitdefattr = ASC, NP, SP, HP
trigger5 = var(3) := (var(0)-5)
trigger6 = PlayerIdExist(var(0)-6)
trigger6 = cond(root,teamside = 1, PlayerID(var(0)-6),teamside = 2, PlayerID(var(0)-6),teamside = 1)
trigger6 = PlayerID(var(0)-6),hitdefattr = ASC, NP, SP, HP
trigger6 = var(3) := (var(0)-6)
trigger7 = PlayerIdExist(var(0)-7)
trigger7 = cond(root,teamside = 1, PlayerID(var(0)-7),teamside = 2, PlayerID(var(0)-7),teamside = 1)
trigger7 = PlayerID(var(0)-7),hitdefattr = ASC, NP, SP, HP
trigger7 = var(3) := (var(0)-7)
trigger8 = PlayerIdExist(var(0)-8)
trigger8 = cond(root,teamside = 1, PlayerID(var(0)-8),teamside = 2, PlayerID(var(0)-8),teamside = 1)
trigger8 = PlayerID(var(0)-8),hitdefattr = ASC, NP, SP, HP
trigger8 = var(3) := (var(0)-8)
trigger9 = PlayerIdExist(var(0)-9)
trigger9 = cond(root,teamside = 1, PlayerID(var(0)-9),teamside = 2, PlayerID(var(0)-9),teamside = 1)
trigger9 = PlayerID(var(0)-9),hitdefattr = ASC, NP, SP, HP
trigger9 = var(3) := (var(0)-9)
trigger10 = PlayerIdExist(var(0)-10)
trigger10 = cond(root,teamside = 1, PlayerID(var(0)-10),teamside = 2, PlayerID(var(0)-10),teamside = 1)
trigger10 = PlayerID(var(0)-10),hitdefattr = ASC, NP, SP, HP
trigger10 = var(3) := (var(0)-10)
ignorehitpause = 1
 
[State 33333333, BindToRoot]
type = BindToRoot
trigger1 = PlayerIdExist(Root,ID)
time = 1
facing = 1
pos =0,-2
ignorehitpause = 1 


;---------------------------------------------------------------------------
; Override common states (use same number to override) :
;---------------------------------------------------------------------------

;---------------------------------------------------------------------------
; States that are always executed (use statedef -2)
;---------------------------------------------------------------------------
[statedef -2]


;=======================AI Detect Projectile System==========================
[state -2, AI Detect Projectile System]
type = helper
trigger1 = ailevel ;M.U.G.E.N 1.0+
trigger1 = !numhelper(33333333)
name = "AI Detect Projectile System"
ID = 33333333
stateno = 33333333
postype = p1
ownpal = 1
keyctrl = 0
size.xscale = 1.0
size.yscale = 1.0
supermovetime = 2147483647
pausemovetime = 2147483647
ignorehitpause = 1

;------------------------------------------------------------------------------

;Jumba Elephant is © Kazecat 2019
[state -2, distance check]
type = displaytoclipboard
trigger1 = 1
text = "distance Opp X: %d Y: %d, Position x: %d, Combo Scaling: %d"
params = p2dist x, p2dist y, pos x, var(18) 
;text = "Jumba Elephant is (c) Kazecat 2019

;===========================================
;  Combo damage reduction
;===========================================

[State -2, attack scaling]
type = attackMulSet
trigger1 = 1
value = fvar (10)
ignorehitpause = 1

[state -2, combo points]
type = varset
trigger1 = numenemy
trigger1 = (enemynear, movetype != H)
trigger2 = !numenemy
ignorehitpause = 1
v = 18
value = 100

[state -2, gradual lowering]
type= varset
trigger1 =  var(18) >= 100
fvar(10) = 1

[state -2, gradual lowering]
type= varset
trigger1 = var(18) < 100 && var(18) >= 90
fvar(10) = 0.9

[state -2, gradual lowering]
type= varset
trigger1 = var(18) < 90 && var(18) >= 80
fvar(10) = 0.8

[state -2, gradual lowering]
type= varset
trigger1 = var(18) < 80 && var(18) >= 70
fvar(10) = 0.7

[state -2, gradual lowering]
type= varset
trigger1 = var(18) < 70 && var(18) >= 60
fvar(10) = 0.6

[state -2, gradual lowering]
type= varset
trigger1 = var(18) < 60 && var(18) >= 50
fvar(10) = 0.5

[state -2, gradual lowering]
type= varset
trigger1 = var(18) < 50 && var(18) >= 40
fvar(10) = 0.4

[state -2, gradual lowering]
type= varset
trigger1 = var(18) < 40 && var(18) >= 30
fvar(10) = 0.3

[state -2, gradual lowering]
type= varset
trigger1 = var(18) < 30 && var(18) >= 20
fvar(10) = 0.2

[state -2, gradual lowering]
type= varset
trigger1 = var(18) < 20 && var(18) >= 10
fvar(10) = 0.1

[state -2, gradual lowering]
type= varset
trigger1 = var(18) < 10
fvar(10) = 0.05

;-----------------------------------------------------
; Explods
;-----------------------------------------------------

[state -2, removeexpod]
type = removeexplod
trigger1 = stateno != 1006
id = 1006

[state -2, removeexpod]
type = removeexplod
trigger1 = stateno != 1016
id = 1016

[state -2, removeexpod]
type = removeexplod
trigger1 = stateno != 1026
id = 1026

[state -2, removeexpod]
type = removeexplod
trigger1 = stateno != 1052
id = 1053

[state -2, removeexpod]
type = removeexplod
trigger1 = stateno != 1062
id = 1063

[state -2, removeexpod]
type = removeexplod
trigger1 = stateno != 1072
id = 1073

[state -2, removeexpod]
type = removeexplod
trigger1 = stateno != 1090
id = 1090




;--------------------------------------------------------

[state -2, Slide Launch limiter]
type = varset
triggerall = numenemy
trigger1 = (enemynear, movetype != H)
var(6) = 2
ignorehitpause = 1

[state -2, Wall bounce limiter]
type = varset
triggerall = numenemy
trigger1 = (enemynear, movetype != H)
var(7) = 2
ignorehitpause = 1

[state -2, Ground Bounce limiter]
type = varset
triggerall = numenemy
trigger1 = (enemynear, movetype != H)
var(8) = 2
ignorehitpause = 1

[state -2, Launcher limiter]
type = varset
triggerall = numenemy
trigger1 = (enemynear, movetype != H)
var(11) = 2
ignorehitpause = 1

[state -2, runstop limiter]
type = varset
triggerall = numenemy
trigger1 = (enemynear,movetype != H)
fvar(12) = 1.00
ignorehitpause = 1

[state -2, Airthrow inhibitor]
type = varset
trigger1 = numenemy
trigger1 = (enemynear,statetype = S) || (enemynear,statetype = C)
trigger1 = (enemynear,ctrl = 1)
var(37) = 1
ignorehitpause = 1

[state -2, Teleport limiter]
type = varset
triggerall = var(12) != 2
trigger1 = statetype = S
trigger2 = statetype = C
var(12) = 1
ignorehitpause

[state -2, Jump infinite check]
type = varset
triggerall = numenemy
trigger1 = (enemynear, movetype != H)
var(29) = 1
ignorehitpause = 1

[state -2, Jumping Fierce limiter]
type = varset
triggerall = numenemy
trigger1 = (enemynear,movetype != H)
var(41) = 1
ignorehitpause

;---------------------------------------------------------------------------------------

;Weight Detection
;If needed add or remove from this list those that have great strength to move him.
;All Grapplers/Power Archetypes should be allowed to Throw him and nothing else IMO.   
[state -2, Those strong enough to throw her]
type = varset
triggerall = numenemy
trigger1 = enemy,name = "Savage Hulk"
Trigger2 = enemy,name = "Superman"
Trigger3 = enemy,name = "Juggernaut"
trigger4 = enemy,name = "ZangiefHD"
trigger5 = enemy,name = "Kimala"
trigger6 = enemy,name = "Bertha Hippo"
trigger7 = enemy,name = "Goku Z2"
trigger8 = enemy,name = "Vegeta Z2"
trigger9 = enemy,name = "Gohan Z2"
trigger10 = enemy,name = "SSJ Goku Z2"
Trigger11 = enemy,name = "Hulk"
Trigger12 = enemy,name = "Colossus"
trigger13 = enemy,name = "Jumbo Elephant" || enemy,name = "Makuyama"  || enemy,name = "Jumba Elephant" || enemy,name = "Julian Hippo"
trigger14 = enemy,name = "John Cena"
trigger15 = enemy,name = "Yokozuna"
trigger16 = enemy,name = "Zangief"
trigger17 = enemy,name = "Bowser"
trigger18 = enemy,name = "Wonder Woman"
trigger19 = enemy,name = "She Hulk"
trigger20 = enemy,name = "Blubberman"
trigger21 = enemy,name = "The-Mountain"
Trigger22 = enemy,name = "Shaq"
Trigger23 = enemy,name = "2DFM95 Kinnikuman"
trigger24 = enemy,name = "Haggar"
trigger25 = enemy,name = "Katrina Crocodile"
trigger26 = enemy,name = "Kazecat" || enemy,name = "Kaze Cat"
trigger27 = enemy,name = "Power Girl"
trigger28 = enemy,name = "Freeza Z2"
trigger29 = enemy,name = "Buu Z2"
trigger30 = enemy,name = "Majin Vegeta Z2"
trigger31 = enemy,name = "Thor" || enemy,name = "The Mighty Thor"
trigger32 = enemy,name = "Pastilla Skunk"
trigger33 = enemy,name = "Lilly Star"
V = 10
value = 1

;Weight Detection
[state -2, Can't be thrown]
type = Null;NotHitBy
triggerall = time > 0
trigger1 = Var(10) = 0
value = ,NT
ignorehitpause = 1
time = 1



;==============================================================================
;                               Victory Quotes
;==============================================================================
[state -2, win quotes]
type = victoryquote
trigger1 = 1
value = 1+(random%6)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Jumbo Elephant"
value = 8+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Ana 'Jiggly' Bunny"
value = 11+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Bertha Hippo"
value = 14+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Katrina Crocodile"
value = 17+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Aroma Skunk"
value = 20+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Enorma Pig"
value = 23+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Lardo Rat"
value = 26+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Zafta Giraffe"
value = 29+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Makuyama"
value = 32+(random%2)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Pastilla Skunk"
value = 35+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Jumba Elephant"
value = 38+(random%2)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Twiggi Bunny"
value = 41+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Ra Lord"
value = 44+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Violet 'Tyla' Bunny"
value = 47+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Battu Tri-red"
value = 50+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Julian Hippo"
value = 53+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Rapid Bunny"
value = 56+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Noah Sharker"
value = 59+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Akai R. Panda"
value = 88+(random%3)
ignorehitpause
persistent = 1



;Others ---------------------------------------

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Guy"
value = 70+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Mai Shiranui"  || enemy,name = "Mai"
value = 73+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 =  enemy, Name = "Leonardo M/TF" || enemy,name = "DCatLeonardo"
value = 76+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy,name =  "Raphael M/TF" || enemy,name = "DCatRaphael"
value = 79+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 =  enemy, Name = "Donatello M/TF" || enemy,name = "DCatDonatello"
value = 82+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 =  enemy, Name = "Michealangelo M/TF" || enemy,name = "DCatMichealangelo"
value = 85+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 =  enemy, Name = "Akai R. Panda" 
value = 88+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 =  enemy, Name = "Andy Armadillo"
value = 91+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 =  enemy, Name = "Montana Moth"
value = 94+(random%3)
ignorehitpause
persistent = 1

[state -2, win quote]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Texas Stanton"
value = 97+(random%3)
ignorehitpause
persistent = 1



;---------------------------------------------------------------------------
;Transformed changes
;---------------------------------------------------------------------------

;Earthquakes
[State -2, quakes]
type = envshake
triggerall = time = 1
trigger1 = stateno = 1521
trigger1 = prevstateno != 1523  
trigger2 = stateno = 1527 && time = 1
time = 15
ampl = -10

;Thuds
[State -2, sfx]
type = PlaySnd
triggerall = Time = 1
trigger1 = stateno = 1521
trigger1 = prevstateno != 1523   
trigger2 = stateno = 1527 && time = 1 
value = S20,0 

;Huge target, Defense buff
[state -2, Defense Up]
type = defencemulset
trigger1 = stateno = [1521,1549]
trigger1 = anim = [19030, 19040]
value = 1.5




;===============================================================================
; Simple Counter
;===============================================================================

[state -2, counter]
type = varset
trigger1 = gethitvar(damage) != 0
v = 31
value = 0
ignorehitpause = 1

[state -2, count up]
type = varadd
trigger1 = var(31) < var(33)
v = 31
value = 1
ignorehitpause = 0

[state -2, delay conter set]
type = varset
trigger1 = 1
v = 33
value = 90



;---------------------------------------------------------------------------
; States that are executed when in self's state file (use statedef -3)
;---------------------------------------------------------------------------

[Statedef -3]

[State -3, quakes]
type = envshake
triggerall = time = 1
trigger1 = stateno = 5100
time = 25
ampl = -16
freq = 60
phase = 60

;This controller plays a sound everytime KFM lands from a jump, or
;from his back-dash.
[State -3, Landing Sound]
type = PlaySnd
triggerall = Time = 1
trigger1 = stateno = 52 ;Jump land
trigger2 = stateno = 106 ;Run-back land
value = 40, 0

[state -3, gravity]
type = gravity
trigger1 = stateno = 5620
trigger1 = time > 0

[state -3, land]
type = changestate
triggerall = stateno = 5620
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 52

[State -3, Crashing Sound]
type = PlaySnd
triggerall = Time = 1
trigger1 = stateno = 5100
value = S5100, 0
