; KFM's constants and state file.
; There are comments scattered through this file, so you may like to
; take a look if would like to learn more about the cns.

[Data]
;Amount of life to start with
life = 900 ; 800 - 900 Recommended
power = 5000
;attack power (more is stronger)
attack = 100
;defensive power (more is stronger)
defence = 100
;Percentage to increase defense everytime player is knocked down
fall.defence_up = 50
;Time which player lies down for, before getting up
liedown.time = 60
;Number of points for juggling
airjuggle = 15
;Default hit spark number for HitDefs
sparkno = 2
;Default guard spark number
guard.sparkno = 40
;1 to enable echo on KO
KO.echo = 0
;Volume offset (negative for softer)
volume = 0
;Variables with this index and above will not have their values
;reset to 0 between rounds or matches. There are 60 int variables,
;indexed from 0 to 59, and 40 float variables, indexed from 0 to 39.
;If omitted, then it defaults to 60 and 40 for integer and float
;variables repectively, meaning that none are persistent, i.e. all
;are reset. If you want your variables to persist between matches,
;you need to override state 5900 from common1.cns.
IntPersistIndex = 60
FloatPersistIndex = 40

[Size]
xscale = 1.2           ;Horizontal scaling factor.
yscale = 1.2           ;Vertical scaling factor.
ground.back = 20     ;Player width (back, ground)
ground.front = 60    ;Player width (front, ground)
air.back = 12        ;Player width (back, air)
air.front = 12       ;Player width (front, air)
height = 240          ;Height of player (for opponent to jump over)
attack.dist = 720    ;Default attack distance
proj.attack.dist = 480 ;Default attack distance for projectiles
proj.doscale = 0     ;Set to 1 to scale projectiles too
head.pos = 12, -446   ;Approximate position of head
mid.pos = 12, -270    ;Approximate position of midsection
shadowoffset = 0     ;Number of pixels to vertically offset the shadow
draw.offset = 0,0    ;Player drawing offset in pixels (x, y). Recommended 0,0

[Velocity]
walk.fwd  = 7.0      ;Walk forward
walk.back = -6.5     ;Walk backward
run.fwd  = 20, 0    ;Run forward (x, y)
run.back = -24,-8 ;Hop backward (x, y)
jump.neu = 0,-14   ;Neutral jumping velocity (x, y)
jump.back = -4.5    ;Jump back Speed (x, y)
jump.fwd = 4.5       ;Jump forward Speed (x, y)
runjump.back = -2.55,-14 ;Running jump speeds (opt)
runjump.fwd = 18,-7      ;.
airjump.neu = 0,-14     ;.
airjump.back = -2.55      ;Air jump speeds (opt)
airjump.fwd = 2.5         ;.
air.gethit.groundrecover = -.15,-3.5  ;Velocity for ground recovery state (x, y) **MUGEN 1.0**
air.gethit.airrecover.mul = .5,.4;.2     ;Multiplier for air recovery velocity (x, y) **MUGEN 1.0**
air.gethit.airrecover.add = 0,-4.5    ;Velocity offset for air recovery (x, y) **MUGEN 1.0**
air.gethit.airrecover.back = -1       ;Extra x-velocity for holding back during air recovery **MUGEN 1.0**
air.gethit.airrecover.fwd = 0         ;Extra x-velocity for holding forward during air recovery **MUGEN 1.0**
air.gethit.airrecover.up = -2         ;Extra y-velocity for holding up during air recovery **MUGEN 1.0**
air.gethit.airrecover.down = 1.3     ;Extra y-velocity for holding down during air recovery **MUGEN 1.0**

[Movement]
airjump.num = 0       ;Number of air jumps allowed (opt)
airjump.height = 35   ;Minimum distance from ground before you can air jump (opt)
yaccel = 1.2          ;Vertical acceleration
stand.friction = .91  ;Friction coefficient when standing
crouch.friction = .88 ;Friction coefficient when crouching
stand.friction.threshold = 2          ;If player's speed drops below this threshold while standing, stop his movement **MUGEN 1.0**
crouch.friction.threshold = .05       ;If player's speed drops below this threshold while crouching, stop his movement **MUGEN 1.0**
air.gethit.groundlevel = 25           ;Y-position at which a falling player is considered to hit the ground **MUGEN 1.0**
air.gethit.groundrecover.ground.threshold = -20 ;Y-position below which falling player can use the recovery command **MUGEN 1.0**
air.gethit.groundrecover.groundlevel = 10   ;Y-position at which player in the ground recovery state touches the ground **MUGEN 1.0**
air.gethit.airrecover.threshold = -1  ;Y-velocity above which player may use the air recovery command **MUGEN 1.0**
air.gethit.airrecover.yaccel = 1.2    ;Vertical acceleration for player in the air recovery state **MUGEN 1.0**
air.gethit.trip.groundlevel = 15      ;Y-position at which player in the tripped state touches the ground **MUGEN 1.0**
down.bounce.offset = 0, 20            ;Offset for player bouncing off the ground (x, y) **MUGEN 1.0**
down.bounce.yaccel = 1.1               ;Vertical acceleration for player bouncing off the ground **MUGEN 1.0**
down.bounce.groundlevel = 12          ;Y-position at which player bouncing off the ground touches the ground again **MUGEN 1.0**
down.friction.threshold = .05         ;If the player's speed drops below this threshold while lying down, stop his movement **MUGEN 1.0**

;Default language victory quotes (optional).  **MUGEN 1.0**
;If this section is included, the default language victory quotes must be in English.
[Quotes]
; Up to 100 victory quotes can be specified per language (victory0 - victory99)
victory1 = "If I can win muscle mass must be entirely unnessisary."
victory2 = "Don't tell me to eat a sandwich you ass!  I have a cursed form.  I can't change it."
victory3 = "Yoga?  What's that?"
victory4 = "I will hug my sweet ass girlfriend and then destroy you.  lol jk."
victory5 = "This body isn't as bad as I originally thought."
victory6 = "If you stretch daily you too can throw your legs across a whole room."
victory7 = "You know if you see a giant shadow forming on top of you maybe you should run from under it."

; Jumbo
victory8 = "Did you really only invest in power?  Gives me great reason to never let you get close."
victory9 = "I know elephants aren't that fast but you are extremely slow."
victory10 = "As confident as you are I still think Eliza could complete with you."

; Jiggly
victory11 = "I want your body shape!  But I wouldn't curse someone like you with my form."
victory12 = "Your booty attacks are quite amusing.  I may need you to teach Eliza some techniques like that."
victory13 = "Your speed is annoying but that butt is like 'Mhhh'!"

; Bertha
victory14 = "That unstoppable ass of yours is a treat and terror to see."
victory15 = "If a train and your ass were on a collision course I think your ass would crush a train."
victory16 = "Is threatening me crushing all you got?  You're not gonna stop me with a good time."

; Katrina
victory17 = "Finally, someone else smart enough to bring back up."
victory18 = "You must have a hard time finding shirts."
victory19 = "Yeah, your bite is intimidating.  That's why I won't let you in."

; Enorma
victory20 = "So are guns really allowed or is that just an Texan thing?"
victory21 = "Guns or not if you shoot at Eliza I'll make you pay for it!"
victory22 = "You can shoot into the void all you want.  You're not gonna get past it."

; Aroma
victory23 = "How the hell do you smell so bad on command?"
victory24 = "Your smells are worse than a dead rotting corpse."
victory25 = "Terrible smells are all you got and that's no where near enough."

; Lardo
victory26 = "I didn't know rats got this big in America."
victory27 = "Eating me won't provide you with much.  I would probably wreck your insides."
victory28 = "Its called 'soap' wash your ass you filthy rat!"

; Zafta
victory29 = "It feels odd to be outranged.  Good thing I have a few other tricks."
victory30 = "Your long legged kicks are impressive.  I wish I had your mass."
victory31 = "Such reach and great curves.  I am jealous."

; Makuyama
victory32 = "Your strength is crazy good but you're gonna have to demonstrate it from at least 10 feet away."
victory33 = "Pandas are adorable.  When you wake up I wanna a picture with Eliza, you and me."
victory34 = "You're far too large to just be a panda.  What are you?"

; Pastilla
victory35 = "I'm sorry for the fate that fell on you two.  I hope you can someday regain your bodies."
victory36 = "That form isn't the one you two started with.  I'm sorry for your ordeal."
victory37 = "Your magic is interesting, maybe we should share techniques."

; Jumba
victory38 = "Nice to meet such an extremely attractive elephant.  If you calm down with the whole assault thing I would like to be friends."
victory39 = "You're not gonna beat me with such a good time.  Feel free to stop by our place anytime."
victory40 = "My girlfriend sits on me all the time.  You're not really bringing anything new to the table."

; Twiggi(self)
victory41 = "So are you an evil double, alternate timeline or alternate universe?"
victory42 = "Wow, I have no meat on my body."
victory43 = "Thinnest.  Match.  Ever."

; Ra Lord
Victory44 = "Oh wow, someone else with stretchy limbs. Thats so cool."
Victory45 = "You better not die when Eliza sits on your or I will kill you."
Victory46 = "and I'm pretty sure I can stretch longer than you too."

; Violet Bunny
victory47 = "You have my dream body!  I would love to have as thick a body as yours."
victory48 = "Its such a pleasure to see you in action.  Those legs are amazing!"
victory49 = "Envy is so cruel.  You're a visual reminder of a body I can't have."

; Battu
victory50 = "You probably have tech for body altering purposes.  I don't know why I can make an assumption like that but I'm probably right."
victory51 = "You are so short...but so thick.  You probably take up more space than I do."
victory52 = "Why can't I have thighs like that!?"

; Julian
victory53 = "Pleasure to port into you Julian."
victory54 = "I didn't know you could fight too.  I just saw you in ads and thought you just did modeling."
victory55 = "I'd rather not get crushed by you Julian. So enjoy that zoning."

;Rapid
victory56 = "In your travels around the world start searching for one that can rid me of my curse."
victory57 = "Even when I teleport you're right there.  How'd you get so fast?!"
victory58 = "You may be fast but you'll still have to deal with my range."

;Akai
victory59 = "Don't ever take your body for granted.  I would love to have moobs and hips like yours."
victory60 = "You waste that body getting into fights with me with it."
victory61 = "Your speed won't help you much if I never let you get in."

;Noah
victory62 = "Welcome to the club of fighters that throw their girlfriends at their opponents."
victory63 = "You and Tracy have a nice battle couple vibe going."
Victory64 = "Fighting you seems like a shower of fat ladies.  We're dropping them all over the place."

;Andy
Victory65 = "That shield of yours is pretty annoying, but I'm sure you didn't appreciate Eliza denting your armor."
Victory66 = "Hey its pretty cool that we are a duo of fighting couples.  With both are partners being medics."
Victory67 = "Did your partner try to crush me with her breast?!  You're not gonna stop me with a good time like that."

;Montana
Victory68 = "If it weren't for the terrible smells, getting crushed by you would be rather plesant."
Victory69 = "Magic to Magic, I gotta say I like your stuff but I don't think I would lose to it."
victory70 = "You got all dressed up to just get a beat down from someone a fraction of your weight."

;Texas
Victory71 = "You're new here so I'm gonna let that slide.  But don't ask me for weight loss advice when you know I'm extremely jealous of your figure."
Victory72 = "I'm not scared of you or your outlaws, Texas.  I get sat on by Eliza for fun and she is a medic!"
Victory73 = "Oh no, you constantly get sat on by bigger and bigger bodies.  Woe is you.  Cry me a river and switch places with me."


;Alternate language victory quotes (optional).
;0 or more alternate language sections may be added, preceded by the
;ISO 639-1 code followed by a ".", e.g. "[ja.Quotes]".
;See language setting in mugen.cfg.
[ja.Quotes]
victory1 = "カンフー突き手を破らぬ限り、お前に勝ち目はない！"
victory2 = "十年早いんだぞ"
victory3 = "お前は見覚えがあるな。テレビにでも…？"
victory4 = "お前の動きは見破りやすすぎる。　なに、カンフー突き手が覚えたいんだと？　素人には無理だぞ"
victory5 = "ふー。　いい汗だった"
victory6 = "もっと強い相手に挑戦したい"
victory7 = "なんだと！彼女はここにもいないと？"

;---------------------------------------------------------------------------
; Variable usage:
; This is a record of the variables that KFM uses. Keeping a record of your
; variable usage helps you avoid careless mistakes later.
; var(0) - Projectile AI 
; var(1)  - Used in kfm.cmd for combo condition (updated every tick)
; var(2)  - Used in Kung Fu Throw (state 800) to remember if fwd was being
;           held (remembered from state 800 through state 810).
; var(14) - Teleport limiter

;---------------------------------------------------------------------------
; Lose by Time Over
; CNS difficulty: basic
[Statedef 170]
type = S
ctrl = 0
anim = 170
velset = 0,0

[State 170, 1]
type = NotHitBy
trigger1 = 1
value = SCA
time = 1

;---------------------------------------------------------------------------
; Win state decider
; CNS difficulty: basic
[Statedef 180]
type = S

[State 180, 1]
type = ChangeState
trigger1 = Time = 0
value = 181

;---------------------------------------------------------------------------
; Win pose 1 - Bow
; CNS difficulty: basic
[Statedef 181]
type = S
ctrl = 0
velset = 0,0

[State 181, AssertSpecial]
type = AssertSpecial
trigger1 = time < 600
flag = roundnotover

[state 181, width]
type = width
trigger1 = 1
edge = 400,400

[State 181, Helper]
type = Helper
trigger1 = !numhelper(4180)
trigger1 = !numhelper(4500)
helpertype = normal ;player
name = "Eliza Elephant - Hug"
ID = 4180
stateno = 4180 
pos = 0,0
postype = p1    ;p2,front,back,left,right
facing = 1
keyctrl = 0
ownpal = 1

[state 181, changestate]
type = changestate
trigger1 = numhelper(4180)
trigger1 = helper(4180),stateno = 4181
value = 182

[state 181, announce]
type = playsnd
triggerall = teammode = single
trigger1 = time = 10
trigger1 = life != lifemax
value = S180,1

[state 181, announce]
type = playsnd
triggerall = teammode = single
trigger1 = time = 10
trigger1 = life = lifemax
value = S180,1

[State 181, 1]
type = NotHitBy
trigger1 = 1
value = SCA
time = 1

;---------------------------------------------------------------------------
;Win pose
[statedef 182]
type = S
ctrl = 0
velset = 0

[state 181, width]
type = width
trigger1 = 1
edge = 400,400

[state 182, anim]
type = changeanim
trigger1 = time = 0
value = 181

[State 181, AssertSpecial]
type = AssertSpecial
trigger1 = animelemtime(8) < 75
flag = roundnotover

[State 181, 1]
type = NotHitBy
trigger1 = 1
value = SCA
time = 1



;---------------------------------------------------------------------------
; Introduction
; CNS difficulty: basic
[Statedef 191]
type = S
ctrl = 0
anim = 190
velset = 0,0
sprpriority = 2

[state 191, version]
type = explod
trigger1 = time = 0
anim = ifelse(facing = -1,9101,9100)
scale = 1,1
postype = Back
pos = ifelse(facing =1, 20, 157),360 ; Nice!
ontop = 1

[State 191, 1] ;Freeze animation until PreIntro is over
type = ChangeAnim
trigger1 = RoundState = 0
trigger1 = time = 0
value = 190

[State 1100, Helper]
type = Helper
trigger1 = roundstate = 0
trigger1 = !numhelper(4501)
trigger1 = time = 0
helpertype = normal ;player
name = "Eliza Elephant Intro"
ID = 4501
stateno = 4501 
pos = -110,0
postype = p1    ;p2,front,back,left,right
facing = 1
keyctrl = 0
ownpal = 1

[State 191, 2] ;Assert this until you want "round 1, fight" to begin
type = AssertSpecial
trigger1 = 1
flag = Intro

[State 191, 3] ;Change to stand state when done
type = ChangeState
trigger1 = AnimTime = 0
value = 0


;---------------------------------------------------------------------------
; Taunt
; CNS difficulty: easy
[Statedef 195]
type = S
ctrl = 0
anim = 195
velset = 0,0
movetype = I
physics = S
sprpriority = 2

[State 195, 1]
type = CtrlSet
trigger1 = Time = 40
value = 1

[State 195, 2]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1


;---------------------------------------------------------------------------
; Stand Light Punch
; CNS difficulty: easy
[Statedef 200]
type    = S                     
movetype= A                      
physics = S                    
juggle  = 1                     
velset = 0,0                     
ctrl = 0                         
anim = 200                       
poweradd = 10                   
sprpriority = 2                  

[State 200, 1]
type = HitDef
trigger1 = AnimElem = 3
attr = S, NA                     
damage = 15, 0                  
animtype = Light                
guardflag = MA                  
hitflag = MAF                   
priority = 3, Hit               
;Hit/Miss/Dodge type (Def: Hit)
pausetime = 6, 6                
sparkno = 0                     
sparkxy = -10, -324               
hitsound   = S5000, 0                 
guardsound = 6, 0                
ground.type = High             
ground.slidetime = 12           
ground.hittime  = 12 
guard.hittime = 12
guard.slidetime = 12
guard.velocity = -14         
ground.velocity = -12          
airguard.velocity = -10,-1    
air.type = High                 
air.velocity = -1.4,-3           

air.hittime = 15               
guard.dist = 640
fall.recovertime = 20

[State 200, 2]
type = PlaySnd
trigger1 = Time = 1
value = 200, 0

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -9
persistent = 0
ignorehitpause = 1

[State 200, 3]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
; Standing strong punch
[Statedef 210]
type    = S
movetype= A
physics = S
juggle  = 5
poweradd= 30
ctrl = 0
velset = 0,0
anim = 210
sprpriority = 2

[State 210, Width]
type = Width
trigger1 = (AnimElemTime (2) >= 0) && (AnimElemTime (7) < 0)
value = 15,0

[State 210, 1]
type = PlaySnd
trigger1 = animelem = 5
value = 210, 0

[State 210, 2]
type = HitDef
trigger1 = animelemtime(8) >= 0 && animelemtime(10) < 0
attr = S, NA
persistent = 0
animtype  = Medium
damage    = 40
guardflag = MA
pausetime = 10,10
sparkno = 2
sparkxy = -10,-122
hitsound   = S210,1
guardsound = S120, 0
ground.type = High
ground.slidetime = 23
ground.hittime  = 23
ground.velocity = -18
guard.hittime = 11
guard.slidetime = 11
guard.velocity = -18
air.velocity = -12,-4
forcenofall = 1
guard.dist = 1280
fall.recovertime = 40

[State 210, 2]
type = HitDef
trigger1 = animelemtime(10) >= 0
attr = S, NA
persistent = 0
animtype  = Medium
damage    = 30
hitflag = FD
pausetime = 10,10
sparkno = 2
sparkxy = -10,-122
hitsound   = S210,1
guardsound = S120, 0
ground.type = High
ground.slidetime = 22
ground.hittime  = 22
ground.velocity = -18
down.velocity = 0,-12
down.hittime = 26
guard.dist = 1280
fall.recovertime = 40

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -3
persistent = 0
ignorehitpause = 1

[state 210, Not Active]
type = statetypeset
trigger1 = animelemtime(11) = 0
movetype = I


[State 210, 5]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
; Standing light kick
; CNS difficulty: easy
[Statedef 230]
type    = S
movetype= A
physics = S
juggle  = 4
poweradd= 15
ctrl = 0
velset = 0,0
anim = 230
sprpriority = 2

[State 230, 1]
type = PlaySnd
trigger1 = animelem = 2
value = 230, 0

[State 230, 2]
type = HitDef
trigger1 = Time = 0
attr = S, NA
animtype  = Medium
damage    = 20
guardflag = MA
pausetime = 6,6
sparkno = 0
sparkxy = -10,-68
hitsound   = 5,1
guardsound = S120, 0
ground.type = Low
ground.slidetime = 19
ground.hittime  = 19
ground.velocity = -12
guard.hittime = 18
guard.slidetime = 18
guard.velocity = -14
air.velocity = -2.5,-3.5
guard.dist = 720
fall.recovertime = 20

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -9
persistent = 0
ignorehitpause = 1

[State 230, 3]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
; Standing strong kick
; CNS difficulty: easy
[Statedef 240]
type    = S
movetype= A
physics = S
juggle  = 5
poweradd= 40
ctrl = 0
velset = 0,0
anim = 240
sprpriority = 2

[State 240, 1]
type = PlaySnd
trigger1 = Time = 2
value = 210, 0

[State 240, 2]
type = HitDef
trigger1 = Time = 0
attr = S, NA
animtype  = heavy
damage    = 45
guardflag = MA
pausetime = 10,10
sparkno = 2
sparkxy = -10,-404
hitsound   = 5,3
guardsound = S120, 0
ground.type = high
ground.slidetime = 23
ground.hittime  = 23
ground.velocity = -22
guard.hittime = 11
guard.slidetime = 11
guard.velocity = -24
airguard.velocity = -12,-2
air.velocity = -16,-2
fall = 0
forcestand = 1
guard.dist = 1280
fall.recovertime = 40

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -3
persistent = 0
ignorehitpause = 1

[state 240, Not Active]
type = statetypeset
trigger1 = animelemtime(9) = 0
movetype = I

[State 240, 4]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
;Crouching light punch
; CNS difficulty: easy
; Description: Simple crouching attack. The HitDef's guardflag parameter
;     is set to "L", meaning that the move can only be guarded low
;     (crouching), and not by standing or jumping opponents.
;     Like for all light attacks, it's a good idea to keep the slidetime
;     and hittime parameters at a smaller number, so the opponent isn't
;     stunned for too long. For all crouching attacks you have to
;     remember to set the attr parameter to indicate that it is crouching
;     attack. In this case, "C, NA" stands for "crouching, normal attack".
;     The HitDef's priority is set at 3, instead of the default of 4,
;     so this attack has a lower priority than most others, meaning
;     KFM will get hit instead of trading hits with his opponent if
;     their attack collision boxes (Clsn1) intersect each other's Clsn2
;     boxes at the same time.
[Statedef 400]
type    = C
movetype= A
physics = C
poweradd= 10
ctrl = 0
anim = 400
velset = 0,0
sprpriority = 2

[State 400, 1]
type = PlaySnd
trigger1 = Time = 1
value = 200, 0

[State 400, 2]
type = HitDef
trigger1 = Time = 0
attr = C, NA
damage    = 13
priority  = 3
animtype  = Light
hitflag = MAF
guardflag = MA
pausetime = 6,6
sparkno = 0
sparkxy = -10,-204
hitsound   = 5,0
guardsound = S120, 0
ground.type = Low
ground.slidetime = 11
ground.hittime  = 11
ground.velocity = -9
air.velocity = -1.5,-3
guard.hittime = 11
guard.slidetime = 11
guard.velocity = -7
guard.dist = 640
fall.recovertime = 20

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -9
persistent = 0
ignorehitpause = 1

[State 400, 4]
type = ChangeState
trigger1 = AnimTime = 0
value = 11
ctrl = 1

;---------------------------------------------------------------------------
;Crouching strong punch
; CNS difficulty: easy
; Description: This is a 2-hit move. It is done by having two HitDefs
;     triggered, one for each frame of animation that hits.
;     Notice how the first hit cannot be guarded by an opponent in the
;     air, because of the "M" in the guardflag, meaning it can only
;     be guarded "middle". The second hit has an "MA" guardflag, so
;     it can be guarded both on the ground and in the air.
[Statedef 410]
type    = C
movetype= A
physics = C
poweradd= 50
ctrl = 0
anim = 410
sprpriority = 2

[State 410, 1]
type = PlaySnd
trigger1 = Time = 1
value = 410, 0

[State 410, 2]
type = HitDef
trigger1 = animelemtime(3) > 0 && animelemtime(6) < 0
persistent = 0
attr = C, NA
damage    = 50
animtype  = Medium
hitflag = MAF
guardflag = MA
getpower = 50
pausetime = 18,18
guard.pausetime  = 12,12
sparkno = 3
sparkxy = -10,-190
hitsound   = 5,4
guardsound = S120, 0
ground.type = Low
ground.slidetime = 16
ground.hittime  = 55
air.hittime = 55
ground.velocity = -2,ifelse(var(11) > 0,-38,-8)
air.velocity = -2,ifelse(var(11) > 0,-33,-6)
guard.velocity = -24
airguard.velocity = -14,-7
guard.hittime = 12
guard.slidetime = 12
airguard.hittime = 24
fall = ifelse(var(11) > 0,0,1)
guard.dist = 640
fall.recovertime = 30

[state 410, launcher limiter]
type = varadd
trigger1 = movehit
var(11) = -1
ignorehitpause =1 
persistent = 0


[state 410, changestate]
type = changestate
triggerall = movehit
trigger1 = command = "holdup"
trigger2 = ailevel
value = 42
ctrl = 0



[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -9
persistent = 0
ignorehitpause = 1

[state 410, Not Active]
type = statetypeset
trigger1 = animelemtime(6) = 0
movetype = I

[State 410, 4]
type = ChangeState
trigger1 = AnimTime = 0
value = 11
ctrl = 1

;---------------------------------------------------------------------------
;Crouching light kick
; CNS difficulty: easy
[Statedef 430]
type    = C
movetype= A
physics = C
poweradd= 15
ctrl = 0
anim = 430
sprpriority = 2

[State 430, 1]
type = PlaySnd
trigger1 = Time = 1
value = 230, 0

[State 430, 2]
type = HitDef
trigger1 = Time = 0
attr = C, NA
damage    = 15
animtype  = Light
hitflag = MAF
guardflag = LA
pausetime = 7,7
sparkno = 0
sparkxy = -10,-154
hitsound   = 5,1
guardsound = S120, 0
ground.type = Low
ground.slidetime = 19
ground.hittime  = 19
ground.velocity = -10
air.velocity = -2,-3
down.velocity = -5,0
down.hittime = 22
guard.hittime = 15
guard.slidetime = 15
guard.dist = 720
fall.recovertime = 20

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -9
persistent = 0
ignorehitpause = 1

[State 430, 3]
type = ChangeState
trigger1 = AnimTime = 0
value = 11
ctrl = 1

;---------------------------------------------------------------------------
;Crouch Strong Kick
; CNS difficulty: easy
; Description: This move uses "Trip" for the "ground.type" parameter in
;     its HitDef. It's a special type that puts the opponent in a tripped
;     animation as he falls. Also, the hitflag parameter in the HitDef
;     is set to "MAFD". The "D" indicates that a downed opponent can be
;     hit by the attack.
[Statedef 440]
type    = C
movetype= A
physics = C
poweradd= 60
ctrl = 0
anim = 440
sprpriority = 2

[State 440, 2]
type = PlaySnd
trigger1 = Time = 2
value = 0, 2

[state 440, nothitby]
type = nothitby
trigger1 = animelemtime(2) > 0 && animelemtime(11) < 0
value = ,AP
ignorehitpause = 1


[state 440, veladd]
type = veladd
trigger1 = animelemtime(5)=0
x = 12
persistent = 0
ignorehitpause = 1


[state 440, veladd]
type = veladd
trigger1 = animelemtime(9)=0
x = 0
persistent = 0
ignorehitpause = 1

[State 440, 3]
type = HitDef
trigger1 = Time = 0
attr = C, NA
damage    = ifelse(p2statetype = A, 25, 50)
hitflag = MAF
guardflag = L
pausetime = 10,10
guard.pausetime = 12,7
sparkno = 3
sparkxy = -5,-132
hitsound   = 5,3
guardsound = S120, 0
ground.type = Trip
ground.slidetime = 10
ground.hittime  = 17
ground.velocity = -12,-8
air.velocity = -12,-8
guard.velocity = -24
guard.hittime = 10
guard.slidetime = 10
airguard.hittime = 14
airguard.velocity = -8,-4
fall = 1
fall.recover = 0
guard.dist = 1280

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -3
persistent = 0
ignorehitpause = 1

[state 440, Not Active]
type = statetypeset
trigger1 = animelemtime(8) = 0
movetype = I


[State 440, 4]
type = ChangeState
trigger1 = AnimTime = 0
value = 11
ctrl = 1

;---------------------------------------------------------------------------
;Jump Light Punch
; CNS difficulty: easy
[Statedef 600]
type    = A
movetype= A
physics = N
poweradd= 5
ctrl = 0
anim = 600
sprpriority = 2

[State 600, 1]
type = PlaySnd
trigger1 = Time = 1
value = 0, 0



[State 600, 2]
type = HitDef
trigger1 = Time = 0
attr = A, NA
damage    = 13
guardflag = HA
priority = 3
pausetime = 8,8
sparkno = 0
sparkxy = -10,-640
hitsound   = 5,0
guardsound = S120, 0
ground.type = High
ground.slidetime = 12
ground.hittime  = 12
ground.velocity = -4
air.velocity = -2,-6
air.hittime = 16
guard.dist = 640
fall.recovertime = 32

[State 600, 3]
type = changestate
trigger1 = animtime = 0
value = 50
ctrl = 1

[state 600, gravity]
type = veladd
trigger1 = 1
y = 0.32

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -9
persistent = 0
ignorehitpause = 1

[State 600, 3]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 52

;---------------------------------------------------------------------------
;Jump Light Punch
; CNS difficulty: easy
[Statedef 605]
type    = A
movetype= A
physics = N
poweradd= 20
ctrl = 0
anim = 605
sprpriority = 2

[State 600, 1]
type = PlaySnd
trigger1 = animelemTime(3) = 0
trigger2 = animelemtime(6) =0
value =S210, 0


[State 600, 2]
type = HitDef
trigger1 = animelem = 4
persistent = 0
attr = A, NA
damage    = 15
guardflag = HA
priority = 3
getpower = 40
pausetime = 4,4
sparkno = 1
id = 604
sparkxy = -10,-408
hitsound   = S210,1
guardsound = S120, 0
ground.type = High
animtype = med
ground.slidetime = 14
ground.hittime  = 14
ground.velocity = -4
air.velocity = -2,-12
air.hittime = 14
guard.hittime = 10
guard.slidetime = 10
guard.dist = 720
fall.recovertime = 20

[State 600, 2]
type = HitDef
trigger1 = animelem = 7
persistent = 0
attr = A, NA
damage    = 15
guardflag = HA
priority = 3
pausetime = 8,8
sparkno = 1
getpower = 40
id = 605
sparkxy = -10,-408
hitsound   = S210,1
guardsound = S120, 0
ground.type = High
animtype = med
ground.slidetime = 14
ground.hittime  = 14
ground.velocity = -8
air.velocity = -4,-12
guard.velocity = -10
airguard.velocity = -6,-4
guard.hittime = 10
guard.slidetime = 10
air.hittime = 18
guard.dist = 720
fall.recovertime = 20

[State 600, 3]
type = changestate
trigger1 = animtime = 0
value = 50
ctrl = 1

[state 600, gravity]
type = veladd
trigger1 = 1
y = 0.32

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -6
persistent = 0
ignorehitpause = 1

[State 600, 3]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 52


;---------------------------------------------------------------------------
;Jump Strong Punch
; CNS difficulty: easy
[Statedef 610]
type    = A
movetype= A
physics = N
poweradd= 40
ctrl = 0
anim = 610
sprpriority = 2

[State 610, 2]
type = PlaySnd
trigger1 = Time = 2
value = 0, 1

[State 610, 3]
type = HitDef
trigger1 = Time = 0
attr = A, NA
damage = ifelse(animelemtime(6) < 0,55,45)
guardflag = HA
priority = 2
pausetime = 12,12
sparkno = 2
sparkxy = -10,-390
hitsound   = 5,3
guardsound = S120, 0
animtype = Med
ground.type = High
ground.slidetime = 24
ground.hittime  = 24
ground.velocity = -12
air.velocity = -6,45
guard.hittime = 18
guard.slidetime = 18
guard.slidetime = -14
airguard.hittime = 20
airguard.velocity = -16,2
air.fall = 1
fall.recover = 0
guard.dist = 640
fall.recovertime = 45

[State 610, 3]
type = changestate
trigger1 = animtime = 0
value = 50
ctrl = 1

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -3
persistent = 0
ignorehitpause = 1

[state 610, gravity]
type = veladd
trigger1 = 1
y = 0.32

[state 610, Not Active]
type = statetypeset
trigger1 = animelemtime(8) = 0
movetype = I

[State 610, 3]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 52

;---------------------------------------------------------------------------
;Jump Light Kick
; CNS difficulty: easy
[Statedef 630]
type    = A
movetype= A
physics = N
poweradd= 15
ctrl = 0
anim = 630
sprpriority = 2

[State 630, 1]
type = PlaySnd
trigger1 = Time = 1
value = 0, 0

[State 630, 2]
type = HitDef
trigger1 = Time = 0
attr = A, NA
damage = 18
guardflag = HA
priority = 3
pausetime = 8,8
sparkno = 1
sparkxy = -5,-518
hitsound   = 5,0
guardsound = S120, 0
ground.type = High
ground.slidetime = 16
ground.hittime  = 18
ground.velocity = -6
air.velocity = -2,-20
air.hittime = 24
guard.velocity = -6
guard.hittime = 12
guard.slidetime = 12
airguard.velocity = -3,-16
airguard.hittime = 14
guard.dist = 640
fall.recovertime = 32

[state 630, end]
type = changestate
trigger1 = animtime = 0
value = 50
ctrl = 1

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -9
persistent = 0
ignorehitpause = 1

[state 630, gravity]
type = veladd
trigger1 = 1
y = 0.32

[State 630, 3]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 52

;---------------------------------------------------------------------------
;Jump Med Kick
; CNS difficulty: easy
[Statedef 632]
type    = A
movetype= A
physics = N
poweradd= 25
ctrl = 0
anim = 632
sprpriority = 2

[State 632, 1]
type = PlaySnd
trigger1 = animelemTime(2) = 0
trigger2 = animelemtime(4) =0
value =S210, 0

[State 632, 2]
type = HitDef
trigger1 = animelem = 3
attr = A, NA
damage = 20
guardflag = HA
priority = 3
pausetime = 4,4
sparkno = 1
getpower = 60
sparkxy = -5,-324
hitsound   = S210,1
guardsound = S120, 0
ground.type = High
ground.slidetime = 15
ground.hittime  = 15
ground.velocity = -8
air.velocity = -4,-16
air.hittime = 24
guard.velocity = -6
guard.hittime = 10
guard.slidetime = 10
airguard.velocity = -3,-16
airguard.hittime = 14
guard.dist = 720
fall.recovertime = 20

[State 632, 2]
type = HitDef
trigger1 = animelem = 6
attr = A, NA
damage = 20
guardflag = HA
priority = 2
pausetime = 8,8
sparkno = 1
getpower = 60
sparkxy = -5,-324
hitsound   = S210,1
guardsound = S120, 0
ground.type = High
ground.slidetime = 18
ground.hittime  = 18
ground.velocity = -8
air.velocity = -4,-12
air.hittime = 24
guard.velocity = -6
guard.hittime = 10
guard.slidetime = 10
airguard.velocity = -3,-16
airguard.hittime = 12
guard.dist = 720
fall.recovertime = 20

[state 632, end]
type = changestate
trigger1 = animtime = 0
value = 50
ctrl = 1

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -6
persistent = 0
ignorehitpause = 1

[state 632, gravity]
type = veladd
trigger1 = 1
y = 0.32

[State 632, 3]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 52



;---------------------------------------------------------------------------
;Twirl
[Statedef 635]
type    = A
movetype= A
physics = N
poweradd= 20
ctrl = 0
anim = 635
sprpriority = 2

[state 635, playsnd]
type = playsnd
trigger1 = animelemtime(2) > 0
value = 635,0
persistent = 14


[state 635, angledraw]
type = angledraw
trigger1 = animelemtime(2) > 0
trigger1 = stateno = 635
value = 45
ignorehitpause = 1

[state 635, posadd]
type = posadd
trigger1 = animelemtime(2) = 0
x = 180
y = -80

[state 635, velset]
type = velmul
trigger1 = animelemtime(1) = 0
x = 0.2
y = 0.2

[state 635, dive!]
type = veladd
trigger1 = animelemtime(3) = 0
y = 6

[state 635, Dive!]
type = velset
trigger1 = animelemtime(3) = 0
x = 15

[State 635, 3]
type = HitDef
trigger1 = animelem = 3
trigger2 = animelem = 5
trigger3 = animelem = 7
attr = A, SA
damage    = 8
guardflag = HA
hitflag = MAF
priority = 2
pausetime = 2,2
sparkno = 1
sparkxy = -10,-146
hitsound   = 5,1
guardsound = S120, 0
animtype = light
ground.type = High
ground.slidetime = 20
ground.hittime  = 20 ;18
ground.velocity = -4
air.velocity = -4,8
air.hittime = 16
guard.hittime = 8
guard.velocity = -8
guard.slidetime = 8
airguard.velocity = -6,6
airguard.hittime = 16
guard.dist = 640
fall = ifelse(var(29) < 0, 1, 0)
air.fall = 1
fall.recover = 0
fall.recovertime = 20

[state 640, varadd]
type = varadd
trigger1 = movehit = 1
var(29) = -1
ignorehitpause = 1
persistent = 0


[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -9
persistent = 0
ignorehitpause = 1

[state 635, gravity]
type = veladd
trigger1 = 1
y = 0.32

[State 635, 3]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 52


;---------------------------------------------------------------------------
;Jump Strong Kick
; CNS difficulty: easy
[Statedef 640]
type    = A
movetype= A
physics = N
juggle  = 4
poweradd= 30
ctrl = 0
anim = 640
sprpriority = 2

[State 640, 2]
type = PlaySnd
trigger1 = Time = 2
value = 0, 1

[State 640, 3]
type = HitDef
trigger1 = Time = 0
attr = A, NA
damage    = 45
guardflag = HA
priority = 4
pausetime = 12,12
sparkno = 1
sparkxy = -10,-180
hitsound   = 5,3
guardsound = S120, 0
animtype = Med
ground.type = High
ground.slidetime = 22
ground.hittime  = 22 
ground.velocity = -16
air.velocity = -36,12
guard.hittime = 16
guard.velocity = -16
guard.slidetime = 16
airguard.velocity = -18,6
airguard.hittime = 12
air.fall = 1
fall.recover = 1
fall.recovertime = 45
guard.dist = 1280

[State 640, 3]
type = changestate
trigger1 = animtime = 0
value = 50
ctrl = 1

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -3
persistent = 0
ignorehitpause = 1

[state 640, gravity]
type = veladd
trigger1 = 1
y = 0.32

[state 640, Not Active]
type = statetypeset
trigger1 = animelemtime(7) = 0
movetype = I

[State 640, 3]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 52

;---------------------------------------------------------------------------
;Drill Steep
[Statedef 645]
type    = A
movetype= A
physics = N
poweradd= 20
ctrl = 0
anim = 645
sprpriority = 2

[state 635, playsnd]
type = playsnd
trigger1 = animelemtime(2) > 0
value = 635,0
persistent = 14


[state 645, velset]
type = velmul
trigger1 = animelemtime(1) = 0
x = 0.2
y = 0.2

[state 645, dive!]
type = veladd
trigger1 = animelemtime(2) = 0
y = 20

[state 645, Dive!]
type = velset
trigger1 = animelemtime(2) = 0
x = 10

[State 645, 3]
type = HitDef
trigger1 = animelem = 3
trigger2 = animelem = 5
trigger3 = animelem = 7
attr = A, SA
damage    = 11
guardflag = HA
hitflag = MAF
priority = 3
pausetime = 2,2
sparkno = 1
sparkxy = -10,24
hitsound   = 5,1
guardsound = S120, 0
animtype = light
ground.type = High
ground.slidetime = 18
ground.hittime  = 18 ;16
ground.velocity = -4
air.hittime = 16
air.velocity = -4,8
guard.hittime = 6 ;6
guard.velocity = -8
guard.slidetime = 6
airguard.velocity = -6,6
airguard.hittime = 12
guard.dist = 640
fall = ifelse(var(29) < 0, 1, 0)
fall.recovertime = 20

[state 640, varadd]
type = varadd
trigger1 = movehit
var(29) = -1
ignorehitpause = 1
persistent = 0


[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -9
persistent = 0
ignorehitpause = 1

[state 645, gravity]
type = veladd
trigger1 = 1
y = 0.32

[State 645, 3]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 52




;---------------------------------------------------------------------------
;Rode down
[statedef 655]
type = A
movetype = H
physics = N

[state 655, anim]
type = changeanim2
trigger1 = time = 0
value = 655

[State 655, 2]
type = changeState
trigger1 = !gethitvar(isbound)
value = 660


;===========================================================================
;---------------------------Crushed State-----------------------------------
;===========================================================================
; Moderate Crushed State
[statedef 660]
type    = L
movetype= H
physics = N
ctrl = 0
velset = 0,0

[state 660, sprpriority]
type = sprpriority
trigger1 = time = 0
value = -4

[state 660, 1]
type = changeanim
trigger1 = time = 0
value = 5110

[State 660, flatten]
type = AngleDraw
trigger1 = time > 0
value = 0
scale = 1.3,0.1

[state 660, on ground]
type = posset
trigger1 = 1
y = 0

[state 660, passthrough]
type = playerpush
trigger1 = 1
value = 0
time = 600

[State 660, Width]
type = Width
trigger1 = time > 0
value = 0,0

[state 660, invunerable]
type = nothitby
trigger1 = 1
value = SCA


[State 660, 1] ;For hit up/up-diag type (from state 5081)
type = ChangeAnim
persistent = 0
trigger1 = SelfAnimExist(5110 + (anim % 10))
trigger1 = anim = [5081,5089]
value = 5110 + (anim % 10)

[State 660, 2] ;Hit ground anim (normal)
type = ChangeAnim
triggerall = time = 0
triggerall = anim != [5110,5119] ;Not already changed anim
trigger1 = anim != [5161,5169]
trigger2 = !SelfAnimExist(5170 + (anim % 10))
value = 5170

[State 660, 3] ;Hit ground anim (for hit up)
type = ChangeAnim
triggerall = time = 0
triggerall = anim != [5110,5119] ;Not already changed anim
trigger1 = anim = [5161,5169]
trigger1 = SelfAnimExist(5170 + (anim % 10))
value = 5170 + (anim % 10)


[State 660, 5]
type = PosSet
trigger1 = Time = 0
y = 0

[State 660, 7]
type = GameMakeAnim
trigger1 = Time = 0
trigger1 = !SysVar(0)
value = 60 + (sysvar(1) > 5) + (sysvar(1) > 14)
pos = 0, 0
under = sysvar(1) <= 10

[State 660, 8]
type = VelSet
trigger1 = Time = 0
y = 0

[State 660, 9] ;For hit up type
type = ChangeAnim
persistent = 0
triggerall = anim = [5171,5179]
triggerall = SelfAnimExist(5110 + (anim % 10))
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground anim
value = 5110 + (anim % 10)

[State 660, 10] ;For normal
type = ChangeAnim
persistent = 0
triggerall = Anim != [5111,5119]
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground frame
value = 5110

[State 660, 11] ;If just died
type = ChangeState
triggerall = !alive && p2stateno = 0 && roundstate = 3
trigger1 = AnimTime = 0 
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground frame
trigger3 = Anim = [5110,5119]
value = 5150

;[State 660, 12]
;type = VarSet
;trigger1 = SysVar(0)
;trigger1 = Time = 0
;sysvar(0) = 0

[State 660, 13] ;Friction
type = VelMul
trigger1 = 1
x = 0.85

[State 660, 14]
type = ForceFeedback
trigger1 = alive
trigger1 = Time = 0
time = 8
ampl = 240
waveform = sine

[State 660, 15]
type = ForceFeedback
trigger1 = !alive
trigger1 = Time = 0
ampl = 200, 7, -.467
time = 30
waveform = sine

[state 1108, nothitby]
type = nothitby
trigger1 = time = 120
value = SCA
time = 4

[State 660, get up]
type = selfstate
trigger1 = life >= 1
trigger1 = time > 140 ;95
value = 5120

[state 660, flat death]
type = changestate
trigger1 = !alive
trigger1 = time > 40
value = 5150

;===========================================================================
;------------------------------Wall Bounce State
;===========================================================================
[statedef 670]
type = A
movetype = H
physics = N

[State 672, Stop moving]
type = PosFreeze
trigger1 = 1
x = 1
y = 1

[state 670]
type = changeanim
trigger1 = time = 0
value = 5030
ignorehitpause = 1

[state 670, changestate]
type = changestate
trigger1 = hitshakeover
value = 671
;------------------------------------------------------------------------

[statedef 671]
type    = A
movetype= H
physics = N

[state 671, anim]
type = changeanim
trigger1 = anim != 5030
value = 5030

[State 670, Velocity]
type = velset
trigger1 = Time = 0
x = facing * gethitvar(xvel)
y = gethitvar(yvel)

[State 670, Gravity]
type = veladd
trigger1 = 1
y = 1.05

;[State 670, No scroll]
;type = ScreenBound
;triggerall = Pos y < -15
;trigger1 = BackEdgeBodyDist < 65
;trigger2 = FrontEdgeBodyDist < 65
;value = 1
;movecamera = 0,1

[State 670, Hit wall]
type = ChangeState
triggerall = Pos y < 0
trigger1 = BackEdgeBodyDist <= 20
trigger2 = FrontEdgeBodyDist <= 20
value = 672

[State 670, Hit ground]
type = SelfState
trigger1 = (Vel y > 0) && (Pos y >= 0)
value = 5100

;---------------------------------------------------------------------------
;Hit wall - part 2 bounce off wall
[statedef 672]
type    = A
movetype= H
physics = N

[State 672, Turn]
type = Turn
trigger1 = (Time = 0) && (FrontEdgeBodyDist <= 30)

[State 672, Pos]
type = PosAdd
trigger1 = Time = 0
x = 15 - BackEdgeBodyDist

[State 672, Stop moving]
type = PosFreeze
trigger1 = 1
x = 1
y = 1

[State 672, No scroll]
type = ScreenBound
trigger1 = 1
value = 1
movecamera = 0,1

[State 672, Spark]
type = Explod
trigger1 = Time = 1
anim = F72
pos = 0,const(size.mid.pos.y)
postype = p1
sprpriority = 3
ownpal = 1

[state 672, anim]
type = changeanim
trigger1 = anim != 5030
value = 5030

[State 672, Sound]
type = PlaySnd
trigger1 = Time = 1
value = F7,0

[State 672, State]
type = ChangeState
trigger1 = time = 10
value = 673
;--------------------------------------------------------------------------
;wall bounce - part 3 fall toward ground
[Statedef 673]
type    = A
movetype= H
physics = N

[State 673, Vel Y]
type = VelSet
trigger1 = Time = 0
y = -18

[State 673, Vel X]
type = VelSet
trigger1 = Time = 0
x = ceil(abs(p2dist x *0.02))

[State 673, Turn]
type = Turn
trigger1 = (Time = 0) && (BackEdgeDist < 30)

[State 672, Gravity]
type = VelAdd
trigger1 = 1
y = 1.05

;[state 673, gravity]
;type = gravity
;trigger1 = 1

[State 673, Anim 5050] ;Self falling animation
type = ChangeAnim
trigger1 = Time = 0
trigger1 = !SelfAnimExist(5052)
value = 5050

[State 673, Anim 5052] ;Self falling animation (diagup type)
type = ChangeAnim
trigger1 = Time = 0
trigger1 = SelfAnimExist(5052)
value = 5052

[State 673, Anim 5060] ;Coming down - normal
type = ChangeAnim
trigger1 = Vel Y > -2
trigger1 = Anim = 5050
trigger1 = SelfAnimExist(5060)
persistent = 0
value = 5060

[State 673, Anim 5062] ;Coming down - diagup type
type = ChangeAnim
trigger1 = Vel Y > -2
trigger1 = Anim = 5052
trigger1 = SelfAnimExist(5062)
persistent = 0
value = 5062

[State 673, Hit ground]
type = SelfState
trigger1 = (Vel y > 0) && (Pos y >= 0)
value = 5100

;============================================================================
; Neutral Wall Bounce
;============================================================================
[statedef 675]
type = A
movetype = H
physics = N

[state 675, nothitby]
type = nothitby
trigger1 = 1
value = SCA

[State 675, Stop moving]
type = PosFreeze
trigger1 = 1
x = 1
y = 1

[state 675]
type = changeanim
trigger1 = time = 0
value = 5030
ignorehitpause = 1

[state 675, changestate]
type = changestate
trigger1 = hitshakeover
value = 676
;------------------------------------------------------------------------

[statedef 676]
type    = A
movetype= H
physics = N

[state 676, anim]
type = changeanim
trigger1 = anim != 5030
value = 5030

[State 676, Velocity]
type = velset
trigger1 = Time = 0
x = facing * gethitvar(xvel)
y = gethitvar(yvel)

[State 676, Gravity]
type = gravity
trigger1 = 1


;[State 670, No scroll]
;type = ScreenBound
;triggerall = Pos y < -15
;trigger1 = BackEdgeBodyDist < 65
;trigger2 = FrontEdgeBodyDist < 65
;value = 1
;movecamera = 0,1

[State 676, Hit wall]
type = ChangeState
triggerall = Pos y < 0
trigger1 = BackEdgeBodyDist <= 20
trigger2 = FrontEdgeBodyDist <= 20
value = 677

[State 676, Hit ground]
type = SelfState
trigger1 = (Vel y > 0) && (Pos y >= 0)
value = 5100

;---------------------------------------------------------------------------
;Hit wall - part 2 bounce off wall
[statedef 677]
type    = A
movetype= H
physics = N

[State 677, Turn]
type = Turn
trigger1 = (Time = 0) && (FrontEdgeBodyDist <= 30)

[State 677, Pos]
type = PosAdd
trigger1 = Time = 0
x = 15 - BackEdgeBodyDist

[State 677, Stop moving]
type = PosFreeze
trigger1 = 1
x = 1
y = 1

[State 677, No scroll]
type = ScreenBound
trigger1 = 1
value = 1
movecamera = 0,1

[State 677, Spark]
type = Explod
trigger1 = Time = 1
anim = F72
pos = 0,const(size.mid.pos.y)
postype = p1
sprpriority = 3
ownpal = 1

[state 677, anim]
type = changeanim
trigger1 = anim != 5030
value = 5030

[State 677, Sound]
type = PlaySnd
trigger1 = Time = 1
value = F7,0

[State 677, State]
type = ChangeState
trigger1 = time = 10
value = 678
;--------------------------------------------------------------------------
;wall bounce - part 3 fall toward ground
[Statedef 678]
type    = A
movetype= H
physics = N

[State 678, Vel Y]
type = VelSet
trigger1 = Time = 0
y = -12

[State 678, Vel X]
type = VelSet
trigger1 = Time = 0
x = 4

[State 678, Turn]
type = Turn
trigger1 = (Time = 0) && (BackEdgeDist < 30)

[State 672, Gravity]
type = gravity
trigger1 = 1


;[state 678, gravity]
;type = gravity
;trigger1 = 1

[State 678, Anim 5050] ;Self falling animation
type = ChangeAnim
trigger1 = Time = 0
trigger1 = !SelfAnimExist(5052)
value = 5050

[State 678, Anim 5052] ;Self falling animation (diagup type)
type = ChangeAnim
trigger1 = Time = 0
trigger1 = SelfAnimExist(5052)
value = 5052

[State 678, Anim 5060] ;Coming down - normal
type = ChangeAnim
trigger1 = Vel Y > -2
trigger1 = Anim = 5050
trigger1 = SelfAnimExist(5060)
persistent = 0
value = 5060

[State 678, Anim 5062] ;Coming down - diagup type
type = ChangeAnim
trigger1 = Vel Y > -2
trigger1 = Anim = 5052
trigger1 = SelfAnimExist(5062)
persistent = 0
value = 5062

[State 678, Hit ground]
type = SelfState
trigger1 = (Vel y > 0) && (Pos y >= 0)
value = 5100




;---------------------------------------------------------------------------

;---------------------------------------------------------------------------
;Kung Fu Throw - Attempt
; CNS difficulty: medium-advanced
; Description: Throws are not difficult to make, although then can be
;     tedious at times. Throw attempt states have a HitDef of a
;     special format. The key parameters in a throw are p1stateno
;     and p2stateno. If the HitDef successfully connects, then
;     the attacker will change to the state number specified by
;     p1stateno, and the opponent will be change to the state
;     number assigned to p2stateno. The special thing about p2stateno
;     is that the opponent will be temporarily brought into the
;     attacker's state file. In this case, no matter who the
;     opponent is, he will be taken to state 820 of this file (kfm.cns)
;     and remain here until the end of the throw (look at his debug
;     information when he is being thrown; the text changes to yellow
;     to mean that he is in another player's state file).
[Statedef 800]
type    = S
movetype= A
physics = S
juggle  = 0
velset = 0,0
ctrl = 0
anim = 800
sprpriority = 2


[State 800, 1]
type = HitDef
triggerall = p2movetype != A
Trigger1 = Time = 0
attr = S, NT         
hitflag = M-         
priority = 1, Miss    
sparkno = -1          
p1sprpriority = 1                     
id = 800
p1facing = 1
p2facing = 1          
p1stateno = 810      
p2stateno = 820      
guard.dist = 0        
fall = 1     

[State 800, 1]
type = HitDef
triggerall = p2movetype = A
Trigger1 = Time = 0
attr = S, NT         
hitflag = M-         
priority = 1, Miss    
sparkno = -1          
p1sprpriority = 1                     
id = 800
p1facing = 1
p2facing = 1          
p1stateno = 810      
p2stateno = 822      
guard.dist = 0        
fall = 1             

[State 800, 2]
type = ChangeState
Trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
;Grab Escape - p2
[statedef 805]
type = A
movetype = H
physics = S
ctrl = 0
facep2 = 1
sprpriority = 4

[state 805, anim]
type = changeanim
trigger1 = time = 0
trigger1 = SelfAnimExist(805)
value = 805

[state 805, anim]
type = changeanim
trigger1 = time = 0
trigger1 = !selfanimexist(805)
value = 120

;[state 1400, dim]
;type = bgpalfx
;trigger1 = time = 0
;time = 8
;mul = 200,200,200

;[state 805, freeze]
;type = pause
;trigger1 = time = 0
;time = 8
;endcmdbuftime = 8

;[state 805, sound]
;type = playsnd
;trigger1 = time = 0
;value = S805,0

[state 805, pos y]
type = posset
trigger1 = time = 0
y = 0

[state 805, velset]
type = velset
trigger1 = time = 10
x= -32

[state 805, nothitby]
type = nothitby
trigger1 = 1
value = SCA

[state 805, end]
type = selfstate
trigger1 = time = 35
value = 0
ctrl = 1

;---------------------------------------------------------------------------
;Grab Escape - p1
[statedef 806]
type = A
movetype = H
physics = S
ctrl = 0

[state 805, anim]
type = changeanim
trigger1 = time = 0
trigger1 = SelfAnimExist(130)
value = 130

[state 805, anim]
type = changeanim
trigger1 = time = 0
trigger1 = !selfanimexist(805)
value = 130

[state 1400, dim]
type = bgpalfx
trigger1 = time = 0
time = 8
mul = 200,200,200

[state 805, freeze]
type = pause
trigger1 = time = 0
time = 12
endcmdbuftime = 8

[state 805, sound]
type = playsnd
trigger1 = time = 0
value = S805,0

[state 805, pos y]
type = posset
trigger1 = time = 0
y = 0

[state 805, turn]
type = turn
trigger1 = prevstateno = 820
trigger1 = time = 0
persistent = 0
ignorehitpause

[state 805, velset]
type = velset
trigger1 = time = 10
x= -32

[state 805, nothitby]
type = nothitby
trigger1 = 1
value = SCA

[state 805, end]
type = selfstate
trigger1 = time = 35
value = 0
ctrl = 1

;---------------------------------------------------------------------------
;Throw
[Statedef 810]
type    = S
movetype= A
physics = N
anim = 810
poweradd = 0

[state 810, tech]
type = changestate
triggerall = numtarget
trigger1 = target(800),stateno = 805
value = 806
persistent = 1

; Here a variable, var(2), is used to remember whether or not the
; player was holding forward at the start of the state. This variable
; is checked later on to turn KFM around if necessary.
[State 810, Holding fwd?]
type = VarSet
trigger1 = Time = 0
var(2) = command = "holdfwd"

[State 810, holdfwd - Turn 6] ;If was holding fwd before, turn now
type = Turn
trigger1 = var(2)
trigger1 = AnimElem = 2

[State 810, holdfwd - Turn Target 6] ;If was holding fwd before, turn target too
type = TargetFacing
trigger1 = var(2)
trigger1 = AnimElem = 2
value = -1

[state 810, width]
type = width
trigger1 = 1
edge = 250,250

[State 810, Grab Sound]
type = PlaySnd
trigger1 = AnimElem = 2
value = 1, 1

[State 810, Throw Sound]
type = PlaySnd
trigger1 = AnimElem = 7
value = 800, 0

[State 810, Bind 1]
type = TargetBind
trigger1 = AnimElemTime(2) < 0
pos = 360, 0

[State 810, Bind 2]
type = TargetBind
trigger1 = AnimElemTime(2) >= 0 && AnimElemTime(3) < 0
pos = 360, 0

[State 810, Bind 3]
type = TargetBind
trigger1 = AnimElemTime(3) >= 0 && AnimElemTime(4) < 0
pos = 360, 0

[State 810, Bind 4]
type = TargetBind
trigger1 = AnimElemTime(4) >= 0 && AnimElemTime(5) < 0
pos = 360, 0


[State 810, Bind 5]
type = TargetBind
trigger1 = AnimElemTime(5) >= 0 && AnimElemTime(6) < 0
pos = 60, -110


[State 810, Bind 6]
type = TargetBind
trigger1 = AnimElemTime(6) >= 0 && AnimElemTime(7) < 0
pos = -300, -80

[State 810, Hurt 11]
type = TargetLifeAdd
trigger1 = AnimElemtime(7) = 0
value = -110

[state 810,targetpoweradd]
type = targetpoweradd
trigger1= animelemtime(7) =0
value= 140

[State 810, Throw 11]
type = TargetState
trigger1 = AnimElemtime(7) = 0
value = 821

[State 810, Pos 15]
type = PosAdd
trigger1 = AnimElem = 15
x = -10

[state x, combo damage score]
type = varadd
trigger1 = animtime = 0
v = 18
value = -18
persistent = 0
ignorehitpause = 1

[State 810, State End]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
;Thrown by Kung Fu Throw
; (a custom gethit state)
; Description: This is the state that the opponent changes to after being
;     hit by KFM's throw HitDef. The important thing here is to use a
;     ChangeAnim2 controller. The difference between ChangeAnim2 and
;     ChangeAnim is that ChangeAnim2 changes the player's animation to
;     an action in the AIR file of the attacker (in this case, kfm.air),
;     whereas ChangeAnim always changes the player to an action in his
;     own AIR file. Look at Action 820 in kfm.air for some extra
;     comments.
[Statedef 820]
type    = A
movetype= H
physics = N
velset = 0,0


[state 820, tech throw]
type = changestate
triggerall = time < 12
trigger1 = ailevel = 0
trigger1 = command = "holdfwd" || command = "holdback"
trigger1 = command = "y" || command = "b" || command = "z" || command = "c"
trigger2 = command = "x" && command = "a"
trigger3 = ailevel > 4 
trigger3 = random < (ailevel * ifelse(ailevel>7,1,3))
value = 805

[State 820, 1]
type = ChangeAnim2
Trigger1 = Time = 0
value = 820

;In case attacker loses binding on player for any reason, this controller
;guarantees that the player will never get stuck in this thrown state.
[State 820, 2]
type = SelfState
trigger1 = !gethitvar(isbound)
value = 5050



;---------------------------------------------------------------------------

;Thrown by Kung Fu Throw
; (a custom gethit state)
; Description: This is the state that the opponent changes to after being
;     hit by KFM's throw HitDef. The important thing here is to use a
;     ChangeAnim2 controller. The difference between ChangeAnim2 and
;     ChangeAnim is that ChangeAnim2 changes the player's animation to
;     an action in the AIR file of the attacker (in this case, kfm.air),
;     whereas ChangeAnim always changes the player to an action in his
;     own AIR file. Look at Action 820 in kfm.air for some extra
;     comments.
[Statedef 822]
type    = A
movetype= H
physics = N
velset = 0,0

[State 820, 1]
type = ChangeAnim2
Trigger1 = Time = 0
value = 820

;In case attacker loses binding on player for any reason, this controller
;guarantees that the player will never get stuck in this thrown state.
[State 820, 2]
type = SelfState
trigger1 = !gethitvar(isbound)
value = 5050

;---------------------------------------------------------------------------
;Thrown by Kung Fu Throw - thrown into the air
; (a custom gethit state)
; Description: This state has the opponent flying through the air and
;     falling down onto the ground. The SelfState controller sets the
;     opponent back using to his own state file when he his the ground.
;     Controllers 821,2 and 821,3 allow the opponent to recover by
;     hitting his recovery command when he is falling.
[Statedef 821]
type    = A
movetype= H
physics = N
velset = 36,-8
poweradd = 40

[State 821, 1] ;Gravity
type = VelAdd
Trigger1 = 1
y = 1.25

[State 821, 4] ;Hit ground
type = SelfState
trigger1 = Vel Y > 0
trigger1 = Pos Y >= 0
value = 5100 ;Hit ground


;===========================================================================
;                           Shadow Ball
;===========================================================================
;Light Shadow Beam
[statedef 1000]
type = S
movetype = A
physics = S
anim = 1000
ctrl = 0
poweradd = 40
velset = 0,0

[state 1000, Skull Summon]
type = explod
trigger1 = animelemtime(4) = 0
anim = 4000
id = 4000
scale = const(size.xscale),const(size.yscale)
postype = p1
pos = -200,-420
sprpriority = -2
removeongethit = 1
removetime = -1

;==============================================
; modify explod
;==============================================

[state 1000, modifyexplod]
type = modifyexplod
trigger1 = animelemtime(5) = 0
id = 4000
pos = -60,-350
postype = p1

[state 1000, width]
type = width
trigger1 = animelemtime(6) >= 0
player = 255,0

[State 200, 1]
type = null
trigger1 = AnimElem = 6
attr = S, NA                     
damage = 20, 0                  
animtype = Light                
guardflag = MA                  
hitflag = MAF                   
priority = 3, Hit               
;Hit/Miss/Dodge type (Def: Hit)
pausetime = 2, 2                
sparkno = 0                     
sparkxy = -10, -324               
hitsound   = S5000, 0                 
guardsound = 6, 0                
ground.type = High             
ground.slidetime = 18           
ground.hittime  = 18 
guard.hittime = 16
guard.slidetime = 16
guard.velocity = -28         
ground.velocity = -30          
airguard.velocity = -16,-2    
air.type = High                 
air.velocity = -18,-2    


[state 1000, modifyexplod]
type = modifyexplod
trigger1 = animelemtime(6) = 0
id = 4000
pos = 340,-268
postype = p1
sprpriority = 3

[state 1000, Skullbeam Base]
type = explod
trigger1 = animelemtime(6) = 0
anim = 4001
id = 4001
scale = const(size.xscale),const(size.yscale)
postype = p1
pos = 340,-250
sprpriority = -1
removeongethit = 1
removetime = -1

[state 1000, Skullbeam Blast]
type = explod
trigger1 = animelemtime(6) = 0
anim = 4002
id = 4002
scale = const(size.xscale)*1.1,const(size.yscale)*1.1
postype = p1
pos = 341,-250
sprpriority = 5
removeongethit = 1
removetime = -1

[State 1000, Skullbeam]
type = Helper
triggerall = !numhelper(1005)
trigger1 = animelemtime(6) = 0
helpertype = normal ;player
name = "Light Beam"
ID = 1005
stateno = 1005
pos = 375,-250 ;-328
postype = p1    
facing = 1
keyctrl = 0
ownpal = 1



[state 1000, parentvaradd]
type = varadd
triggerall = numhelper(1005)
trigger1 = helper(1005),movehit
v = 18
value = -3
persistent = 0
ignorehitpause = 1

[state 1000, end]
type = changestate
triggerall = animelemtime(6) > 0 
trigger1 = !numhelper(1005)
value = 1001



;--------------------------------------------------------------------------;
;Beam End
[statedef 1001]
type = S
movetype = I
anim = 1001

[state 1000, modifyexplod]
type = explod
trigger1 = time = 0
anim = 4009
id = 4009
pos = 340,-268
postype = p1
scale = const(size.xscale),const(size.yscale)
sprpriority = 3

[state 1001, removeexplod]
type = removeexplod
trigger1 = time = 0
id = 4000

[state 1001, removeexplod]
type = removeexplod
trigger1 = time = 0
id = 4001

[state 1001, removeexplod]
type = removeexplod
trigger1 = time = 0
id = 4002

[state 1001, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
;Beam 
[statedef 1005]
type = S
movetype = A
physics = N
velset = 0,0
sprpriority = 4

[state 1005, attackmulset]
type = attackmulset
trigger1 = 1
value = parent,fvar(10)
Persistent = 1

[state 1005, stretch]
type = angledraw
trigger1 = 1
scale = const(size.xscale)*750,const(size.yscale)
ignorehitpause = 1
persistent = 1

[state 1005, nothitby]
type = hitby
trigger1 = 1
value = SCA, NP,SP,HP
ignorehitpause = 1
persistent = 1

[state 1005, playerpush]
type = playerpush
trigger1 = 1
value = 0
ignorehitpause = 1

[state 1005, varset]
type = varset
trigger1 = time = 0
trigger1 = prevstateno != 1005
v = 27
value = 2

[state 1005, anim]
type = changeanim
trigger1 = anim != 4003
value = 4003

[State 0, Projectile]
type = Projectile
trigger1 = animelemtime(1) = 0
;trigger1 = animelemtime(1) = 0
;trigger2 = animelemtime(6) = 0
ProjID = 1000
projanim = 4014
projhitanim = -1
projremanim = -1
projcancelanim = -1
projscale = 1,1
projremove = 1
projremovetime = 22
velocity = 105,0
remvelocity = 0,0
projhits = 1
projmisstime = 3
projpriority = 1
projsprpriority = 3
projedgebound = 160
projstagebound = 160
offset = -300,0
postype = p1         
; HitDef     
attr = S, SP
animtype  = heavy
damage    = ifelse(enemy,name = "Onslaught", 90,60),6
getpower = 20
guardflag = MA
pausetime = 8,8
sparkno = 2
hitonce = 1
sparkxy = 0,-70
hitsound   = 5,2
guardsound = S120, 0
ground.type = High
ground.slidetime = 24
ground.hittime  = 24
ground.velocity = -36
guard.hittime = 16
guard.slidetime = 16
guard.velocity = -27
airguard.velocity = -18,-2
air.velocity = -27,-2
forcenofall = 1
guard.dist = 3000
ground.cornerpush.veloff = 0
air.cornerpush.veloff = 0
guard.cornerpush.veloff = 0
airguard.cornerpush.veloff = 0


[State 1005, move counter]
type = varadd
trigger1 = movecontact
var(27) = -1
ignorehitpause = 1
persistent = 0

[state 1005, parentvaradd]
type = varadd
trigger1 = gethitvar(damage) != 0
var(27) = -1
ignorehitpause = 1
persistent = 0

[state 1005, hitoverride]
type = hitoverride
trigger1 = 1
attr = SCA,NP,SP,HP        
stateno = 1005
time = 1
ignorehitpause = 1
persistent = 1

[state 1005, changestate]
type = changestate
trigger1 = var(27) <= 0
value = 1006
ignorehitpause = 1

[state 1005, destroyself]
type = destroyself
trigger1 = parent,movetype = H
ignorehitpause = 1

[state 1005, end]
type = changestate
trigger1 = animtime = 0
value = 1006

;----------------------------------------------------------------------------
;beam end
[statedef 1006]
type = S
movetype = I
physics = N
anim = 4005

[state 1006, nothitby]
type = nothitby
trigger1 = 1
VALUE = SCA
ignorehitpause = 1

[state 1005, stretch]
type = angledraw
trigger1 = 1
scale = const(size.xscale)*750,const(size.yscale)
ignorehitpause = 1
persistent = 1

[state 1006, destroyself]
type = destroyself
trigger1 = animtime = 0

;--------------------------------------------------------------------------------------------
;Heavy Shadow Beam
[statedef 1010]
type = S
movetype = A
physics = S
anim = 1010
ctrl = 0
poweradd = 60
velset = 0,0

[state 1010, Skull Summon]
type = explod
trigger1 = animelemtime(4) = 8
anim = 4010
id = 4010
scale = const(size.xscale),const(size.yscale)
postype = p1
pos = -200,-420
sprpriority = -2
removeongethit = 1
removetime = -1
;==============================================
; modify explod
;==============================================


[state 1010, width]
type = width
trigger1 = animelemtime(6) >= 0
player = 255,0

[State 1010, 1]
type = null
trigger1 = AnimElem = 6
attr = S, NA                     
damage = 20, 0                  
animtype = Light                
guardflag = MA                  
hitflag = MAF                   
priority = 3, Hit               
;Hit/Miss/Dodge type (Def: Hit)
pausetime = 2, 2                
sparkno = 0                     
sparkxy = -10, -324               
hitsound   = S5000, 0                 
guardsound = 6, 0                
ground.type = High             
ground.slidetime = 18           
ground.hittime  = 18 
guard.hittime = 16
guard.slidetime = 16
guard.velocity = -28         
ground.velocity = -30          
airguard.velocity = -16,-2    
air.type = High                 
air.velocity = -18,-2 


[state 1010, modifyexplod]
type = modifyexplod
trigger1 = animelemtime(5) = 0
id = 4010
pos = -60,-350
postype = p1


[state 1010, modifyexplod]
type = modifyexplod
trigger1 = animelemtime(6) = 0
id = 4010
pos = 340,-268
postype = p1
sprpriority = 3

[state 1010, Skullbeam Base]
type = explod
trigger1 = animelemtime(6) = 0
anim = 4011
id = 4011
scale = const(size.xscale),const(size.yscale)
postype = p1
pos = 340,-250
sprpriority = -1
removeongethit = 1
removetime = -1

[state 1010, Skullbeam Blast]
type = explod
trigger1 = animelemtime(6) = 0
anim = 4012
id = 4012
scale = const(size.xscale)*1.1,const(size.yscale)*1.1
postype = p1
pos = 341,-250
sprpriority = 5
removeongethit = 1
removetime = -1

[State 1010, Skullbeam]
type = Helper
triggerall = !numhelper(1015)
trigger1 = animelemtime(6) = 0
helpertype = normal ;player
name = "Heavy Beam"
ID = 1015
stateno = 1015
pos = 375,-250
postype = p1    
facing = 1
keyctrl = 0
ownpal = 1

[state 1010, parentvaradd]
type = varadd
triggerall = numhelper(1015)
trigger1 = helper(1015),movehit
v = 18
value = -3
persistent = 0
ignorehitpause = 1

[state 1000, end]
type = changestate
triggerall = animelemtime(6) > 0
trigger1 = !numhelper(1015)
value = 1011


;-------------------------------------------------------------------------
;Beam End
[statedef 1011]
type = S
movetype = I
anim = 1011

[state 1000, modifyexplod]
type = explod
trigger1 = time = 0
anim = 4009
id = 4019
pos = 340,-268
postype = p1
scale = const(size.xscale),const(size.yscale)
sprpriority = 3

[state 1001, removeexplod]
type = removeexplod
trigger1 = time = 0
id = 4010

[state 1001, removeexplod]
type = removeexplod
trigger1 = time = 0
id = 4011

[state 1001, removeexplod]
type = removeexplod
trigger1 = time = 0
id = 4012

[state 1001, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1


;---------------------------------------------------------------------------
;Beam 
[statedef 1015]
type = S
movetype = A
physics = N
velset = 0,0
sprpriority = 4

[state 1015, attackmulset]
type = attackmulset
trigger1 = 1
value = parent,fvar(10)
Persistent = 1

[state 1015, stretch]
type = angledraw
trigger1 = 1
scale = const(size.xscale)*750,const(size.yscale)
ignorehitpause = 1
persistent = 1

[state 1015, nothitby]
type = hitby
trigger1 = 1
value = SCA, NP,SP,HP
ignorehitpause = 1
persistent = 1

[state 1015, playerpush]
type = playerpush
trigger1 = 1
value = 0
ignorehitpause = 1

[state 1015, varset]
type = varset
trigger1 = time = 0
trigger1 = prevstateno != 1015
v = 27
value = 3

[state 1015, anim]
type = changeanim
trigger1 = anim != 4013
value = 4013

[State 0, Projectile]
type = Projectile
trigger1 = animelemtime(3) = 0
trigger2 = animelemtime(7) = 0
ProjID = 1010
projanim = 4014
projhitanim = -1
projremanim = -1
projcancelanim = -1
projscale = 1,1
projremove = 1
projremovetime = 22
velocity = 105,0
remvelocity = 0,0
projhits = 1
projmisstime = 3
projpriority = 1
projsprpriority = 3
projedgebound = 160
projstagebound = 40160
offset = -300,0
postype = p1 
;hitdef
attr = S, SP
animtype  = heavy
damage    = ifelse(enemy,name = "Onslaught",60,40),4
guardflag = MA
pausetime = 1,1
getpower = 15
sparkno = 2
hitonce = 1
sparkxy = 0,-70
hitsound   = 5,1
guardsound = S120, 0
ground.type = High
ground.slidetime = 24
ground.hittime  = 24
ground.velocity = -24
guard.hittime = 16
guard.slidetime = 16
guard.velocity = -18
airguard.velocity = -8,-4
air.velocity = -20,-2
forcenofall = 1
guard.dist = 3000
ground.cornerpush.veloff = 0
air.cornerpush.veloff = 0
guard.cornerpush.veloff = 0
airguard.cornerpush.veloff = 0    

[State 1015, move counter]
type = varadd
trigger1 = movecontact
var(27) = -1
ignorehitpause = 1
persistent = 0

[state 1015, parentvaradd]
type = varadd
trigger1 = gethitvar(damage) != 0
var(27) = -1
ignorehitpause = 1
persistent = 0

[state 1015, hitoverride]
type = hitoverride
trigger1 = 1
attr = SCA,NP,SP,HP        
stateno = 1015
time = 1
ignorehitpause = 1
persistent = 1

[state 1015, changestate]
type = changestate
trigger1 = var(27) <= 0
value = 1016
ignorehitpause = 1

[state 1015, destroyself]
type = destroyself
trigger1 = parent,movetype = H
ignorehitpause = 1

[state 1015, end]
type = changestate
trigger1 = animtime = 0
value = 1016
ignorehitpause = 1

;----------------------------------------------------------------------------
;beam end
[statedef 1016]
type = S
movetype = I
physics = N
anim = 4005

[state 1016, nothitby]
type = nothitby
trigger1 = 1
VALUE = SCA
ignorehitpause = 1

[state 1016, stretch]
type = angledraw
trigger1 = 1
scale = const(size.xscale)*750,const(size.yscale)
ignorehitpause = 1
persistent = 1

[state 1016, destroyself]
type = destroyself
trigger1 = animtime = 0

;---------------------------------------------------------------------------
;EX Shadow Ball
[statedef 1020]
type = S
movetype = A
physics = S
anim = 1020
ctrl = 0
velset = 0,0

[state 1020, EX]
type = poweradd
trigger1 = time = 1
value = -500

[State 1020, Blink Yellow]
type = PalFX
trigger1 = time%2
time = 1
add = 150,75,0 ;32,16,0
sinadd = 64,32,5,3
ignorehitpause


[state 1000, width]
type = width
trigger1 = animelemtime(6) >= 0
player = 255,0

[State 200, 1]
type = null
trigger1 = AnimElem = 6
attr = S, NA                     
damage = 20, 0                  
animtype = Light                
guardflag = MA                  
hitflag = MAF                   
priority = 3, Hit               
;Hit/Miss/Dodge type (Def: Hit)
pausetime = 2, 2                
sparkno = 0                     
sparkxy = -10, -324               
hitsound   = S5000, 0                 
guardsound = 6, 0                
ground.type = High             
ground.slidetime = 18           
ground.hittime  = 18 
guard.hittime = 16
guard.slidetime = 16
guard.velocity = -28         
ground.velocity = -30          
airguard.velocity = -16,-2    
air.type = High                 
air.velocity = -18,-2 



[state 1020, Skull Summon]
type = explod
trigger1 = animelemtime(4) = 0
anim = 4000
id = 4020
scale = const(size.xscale),const(size.yscale)
postype = p1
pos = -200,-438
sprpriority = -2
removeongethit = 1

[state 1020, Skull Summon Low]
type = explod
trigger1 = animelemtime(4) = 2
anim = 4000
id = 40201
scale = const(size.xscale),const(size.yscale)
postype = p1
pos = 340,-138
removeongethit = 1

[state 1020, Skull Summon High]
type = explod
trigger1 = animelemtime(5) = 0
anim = 4000
id = 40202
scale = const(size.xscale),const(size.yscale)
postype = p1
pos = 340,-398
sprpriority = -2
removeongethit = 1

;==============================================
; modify explod
;==============================================


[state 1020, modifyexplod]
type = modifyexplod
trigger1 = animelemtime(5) = 0
id = 4020
pos = -60,-350
postype = p1


[state 1020, modifyexplod]
type = modifyexplod
trigger1 = animelemtime(6) = 0
id = 4020
pos = 340,-268
postype = p1
sprpriority = 3

[state 1020, Skullbeam Base]
type = explod
trigger1 = animelemtime(6) = 0
anim = 4001
id = 40210
scale = const(size.xscale),const(size.yscale)
postype = p1
pos = 340,-250
sprpriority = -1
removeongethit = 1

[state 1020, Skullbeam Base Low]
type = explod
trigger1 = animelemtime(7) = 0
anim = 4001
id = 40211
scale = const(size.xscale),const(size.yscale)
postype = p1
pos = 340,-120
sprpriority = -1
removeongethit = 1

[state 1020, Skullbeam Base High]
type = explod
trigger1 = animelemtime(7) = 0
anim = 4001
id = 40212
scale = const(size.xscale),const(size.yscale)
postype = p1
pos = 340,-380
sprpriority = -1
removeongethit = 1

[state 1020, Skullbeam Blast Mid]
type = explod
trigger1 = animelemtime(6) = 2
anim = 4002
id = 40220
scale = const(size.xscale)*1.1,const(size.yscale)*1.1
postype = p1
pos = 341,-250
sprpriority = 5
removeongethit = 1

[state 1020, Skullbeam Blast Low]
type = explod
trigger1 = animelemtime(7) = 2
anim = 4002
id = 40221
scale = const(size.xscale)*1.1,const(size.yscale)*1.1
postype = p1
pos = 341,-120
sprpriority = 5
removeongethit = 1

[state 1020, Skullbeam Blast High]
type = explod
trigger1 = animelemtime(8) = 2
anim = 4002
id = 40222
scale = const(size.xscale)*1.1,const(size.yscale)*1.1
postype = p1
pos = 341,-380
sprpriority = 5
removeongethit = 1

[State 1020, Skullbeam Mid]
type = Helper
triggerall = numhelper(1025) < 4
trigger1 = animelemtime(6) = 2
helpertype = normal ;player
name = "EX Beam Mid"
ID = 1025
stateno = 1025
pos = 375,-250
postype = p1    
facing = 1
keyctrl = 0
ownpal = 1

[State 1020, Skullbeam]
type = Helper
triggerall = numhelper(1025) < 4
trigger1 = animelemtime(7) = 2
helpertype = normal ;player
name = "EX Beam Low"
ID = 1025
stateno = 1025
pos = 375,-120
postype = p1    
facing = 1
keyctrl = 0
ownpal = 1

[State 1020, Skullbeam]
type = Helper
triggerall = numhelper(1025) < 4
trigger1 = animelemtime(8) = 2
helpertype = normal ;player
name = "EX Beam High"
ID = 1025
stateno = 1025
pos = 375,-380
postype = p1    
facing = 1
keyctrl = 0
ownpal = 1

[state 1020, parentvaradd]
type = varadd
triggerall = numhelper(1025)
trigger1 = helper(1025),movehit
v = 18
value = -3
persistent = 0
ignorehitpause = 1

[state 1020, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1

;-----------------------------------------------------------------------------------
;EX Beam 
[statedef 1025]
type = S
movetype = A
physics = N
velset = 0,0
sprpriority = 4

[state 1025, attackmulset]
type = attackmulset
trigger1 = 1
value = parent,fvar(10)
Persistent = 1

[state 1025, stretch]
type = angledraw
trigger1 = 1
scale = const(size.xscale)*750,const(size.yscale)
ignorehitpause = 1
persistent = 1

[state 1025, nothitby]
type = hitby
trigger1 = 1
value = SCA, NP,SP,HP
ignorehitpause = 1
persistent = 1

[state 1025, playerpush]
type = playerpush
trigger1 = 1
value = 0
ignorehitpause = 1

[state 1025, varset]
type = varset
trigger1 = time = 0
trigger1 = prevstateno != 1025
v = 27
value = 2

[state 1025, anim]
type = changeanim
trigger1 = anim != 4023
value = 4023

[State 0, Projectile]
type = Projectile
trigger1 = animelemtime(1) = 0
trigger2 = animelemtime(4) = 0
ProjID = 1000
projanim = 4014
projhitanim = -1
projremanim = -1
projcancelanim = -1
projscale = 1,1
projremove = 1
projremovetime = 22
velocity = 105,0
remvelocity = 0,0
projhits = 1
projmisstime = 3
projpriority = 1
projsprpriority = 3
projedgebound = 160
projstagebound = 40160
offset = -300,0
postype = p1
;hitdef
attr = S, SP
animtype  = heavy
damage    = ifelse(enemy,name = "Onslaught",48,24),4
guardflag = MA
hitflag = MAF
pausetime = 1,1
sparkno = 2
getpower = 0
hitonce = 1
sparkxy = -10,-70
hitsound   = 5,1
guardsound = S120, 0
ground.type = High
ground.slidetime = 24
ground.hittime  = 24
ground.velocity = -27,-16
guard.hittime = 18
guard.slidetime = 18
guard.velocity = -16
airguard.velocity = -8,-4
air.velocity = -27,-14
guard.dist = 3000
ground.cornerpush.veloff = 0
air.cornerpush.veloff = 0
guard.cornerpush.veloff = 0
airguard.cornerpush.veloff = 0
fall = 1
fall.recover = 1
fall.recovertime = 30

[State 1025, move counter]
type = varadd
trigger1 = movecontact
var(27) = -1
ignorehitpause = 1
persistent = 0

[state 1025, parentvaradd]
type = varadd
trigger1 = gethitvar(damage) != 0
var(27) = -1
ignorehitpause = 1
persistent = 0

[state 1025, hitoverride]
type = hitoverride
trigger1 = 1
attr = SCA,NP,SP,HP        
stateno = 1025
time = 1
slot = 1
ignorehitpause = 1
persistent = 1

[state 1025, changestate]
type = changestate
trigger1 = var(27) <= 0
value = 1006
ignorehitpause = 1

[state 1025, destroyself]
type = destroyself
trigger1 = parent,movetype = H
ignorehitpause = 1

[state 1025, end]
type = changestate
trigger1 = animtime = 0
value = 1006


;===========================================================================
;                       Black Hole Summon
;===========================================================================
;Black Hole Summon LK
[statedef 1050]
type = S
movetype = A
physics = S
anim = 1050
ctrl = 0
poweradd = 60
velset = 0,0

[State 1100, Helper]
type = Helper
trigger1 = animelemtime(6) = 0
helpertype = normal ;player
name = "Black Hole Timer Timer"
ID = 1059
stateno = 1059 
pos = 0,-600
postype = p1    
facing = 1
keyctrl = 0
ownpal = 0

[State 1050, BlackHole]
type = Helper
triggerall = !numhelper(1055)
trigger1 = animelemtime(6) = 0
helpertype = normal ;player
name = "Black Hole LK"
ID = 1055
stateno = 1055
pos = ifelse(p2dist x < 600, ifelse(p2dist x > 50 ,p2dist x, 50),600),-240 ;540
postype = p1    
facing = 1
keyctrl = 0
ownpal = 1

[State 1052, Explod]
type = explod
trigger1 = !numexplod(1051)
trigger1 = animelemtime(7) > 0
id = 1051
anim = 1051
removetime = -1
removeongethit = 1
postype = p1
pos = 0,0
scale = const(size.xscale),const(size.yscale)
sprpriority = 3

[state -2, Projectile imunity]
type = nothitby
triggerall = numhelper(1055)
trigger1 = helper(1055),animelemtime(6) >= 0
value = ,AP
time = 2
ignorehitpause = 1
persistent = 1

[state 1050, end early]
type = changestate
trigger1 = animelemtime(7) > 0
trigger1 = !numhelper(1055)
trigger2 = time > 240
value = 1057
ignorehitpause = 1



;---------------------------------------------------------------------------
;Anti Air Version
;Black Hole Summon LK
[statedef 1052]
type = S
movetype = A
physics = S
anim = 1052
ctrl = 0
poweradd = 60
velset = 0,0

[State 1052, Helper]
type = Helper
trigger1 = animelemtime(6) = 0
helpertype = normal ;player
name = "Black Hole Timer Timer"
ID = 1059
stateno = 1059 
pos = 0,-600
postype = p1    
facing = 1
keyctrl = 0
ownpal = 0

[State 1052, BlackHole]
type = Helper
triggerall = !numhelper(1055)
trigger1 = animelemtime(6) = 0
helpertype = normal ;player
name = "Black Hole AA LK"
ID = 1055
stateno = 1055
pos = ifelse(p2dist x < 300, ifelse(p2dist x > 0 ,p2dist x, 0),300),-610 ;240
postype = p1    
facing = 1
keyctrl = 0
ownpal = 1

[state 1052, nothitby]
type = nothitby
trigger1 = time < 14
value = A
ignorehitpause = 1

[State 1052, Explod]
type = explod
trigger1 = !numexplod(1053)
trigger1 = animelemtime(7) > 0
id = 1053
anim = 1053
removetime = -1
removeongethit = 1
postype = p1
pos = 0,0
scale = const(size.xscale),const(size.yscale)
sprpriority = 3

[state 1052, end early]
type = changestate
trigger1 = animelemtime(7) > 0
trigger1 = !numhelper(1055)
value = 1058
ignorehitpause = 1

;-----------------------------------------------------------------

;Dark Void
[statedef 1055]
type = S
movetype = A
physics = N
velset = 0,0
sprpriority = 2

[state 1055, special]
type = assertspecial
trigger1 = 1
flag = noshadow
ignorehitpause = 1

[state 1055, attackmulset]
type = attackmulset
trigger1 = 1
value = parent,fvar(10)
Persistent = 1

[state 1055, stretch]
type = angledraw
trigger1 = 1
scale = const(size.xscale),const(size.yscale)
ignorehitpause = 1
persistent = 1

[state 1055, nothitby]
type = hitby
trigger1 = 1
value = SCA, NP,SP,HP
ignorehitpause = 1
persistent = 1

[state 1055, playerpush]
type = playerpush
trigger1 = 1
value = 0
ignorehitpause = 1

[state 1055, anim]
type = changeanim
trigger1 = anim != 4050
value = 4050

[state 1055, playsnd]
type = playsnd
trigger1 = animtime != 0
value = 1050,0
channel = 2
persistent = 75

[State 1055, 2]
type = HitDef
trigger1 = animelem = 6
trigger2 = animelem = 8
trigger3 = animelem = 10
trigger4 = animelem = 12
trigger5 = animelem = 14
persistent = 2
attr = S, SP
animtype  = heavy
damage    = ifelse(enemy,name = "Onslaught",48,24),6
guardflag = MA
hitflag = MAF
getpower = 12
pausetime = 1,1
sparkno = 1
sparkxy = -10,-70
hitsound   = 5,1
guardsound = S120, 0
ground.type = High
ground.slidetime = 16
ground.hittime  = 16
ground.velocity = ifelse(animelemtime(14) < 0, ifelse(p2dist x > 0, 8, -8),-22),ifelse(animelemtime(14) < 0, 0,-18)
guard.hittime = 23;-10
guard.slidetime = 23
guard.velocity = ifelse(animelemtime(14) < 0, ifelse(p2dist x > 0, 3, -3),-32)
airguard.velocity = ifelse(animelemtime(14) < 0, ifelse(p2dist x > 0, 4, -4),-24),ifelse(animelemtime(14) < 0,-2,-8)
air.velocity = ifelse(animelemtime(14) < 0, ifelse(p2dist x > 0, 6, -6),-18),ifelse(animelemtime(14) < 0, -2,-18)
guard.dist = 1280
ground.cornerpush.veloff = 0
air.cornerpush.veloff = 0
guard.cornerpush.veloff = 0
airguard.cornerpush.veloff = 0
fall = ifelse(animelemtime(13) > 0, 1, 0)
fall.recover = 1
fall.recovertime = 30
guard.dist = 480

[state 1055, hitoverride]
type = hitoverride
trigger1 = 1
attr = SCA,NP,SP,HP        
stateno = 1055
slot = 1
time = 1
ignorehitpause = 1
persistent = 1

;[state 1005, changestate]
;type = changestate
;trigger1 = movecontact
;trigger1 = var(27) > 0
;value = 1006
;ignorehitpause = 1

[State 0, DisplayToClipboard]
type = DisplayToClipboard
trigger1 = 1
text = "Distance from opponent:  %d"
params = p2dist x
ignorehitpause = 1 
persistent = 1

[state 1055, parentvaradd]
type = parentvaradd
trigger1 = movehit
trigger1 = animtime = 0
v = 18
value = -3
persistent = 0
ignorehitpause = 1



[state 1055, stopsnd]
type = stopsnd
trigger1 = animtime = 0
trigger2 = parent,movetype = H
channel = 2
ignorehitpause = 1

[state 1055, destroyself]
type = destroyself
trigger1 = parent,movetype = H
;trigger2 = !numhelper(1059)
trigger2 = animtime = 0
ignorehitpause = 1

;--------------------------------------------------------------------------------------------
;End early Horizontal
[statedef 1057]
type = S
movetype = A
physics = S
anim = 1057
ctrl = 0
velset = 0,0

[state 1058, stopsnd]
type = stopsnd
trigger1 = time = 0
channel = 2

[state 1058, removeexplod]
type = removeexplod
trigger1 = time = 0
id = 1051

[state 1057, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1

;----------------------------------------------------------------------------
;End early Vertical
[statedef 1058]
type = S
movetype = A
physics = S
anim = 1058
ctrl = 0
velset = 0,0

[state 1058, stopsnd]
type = stopsnd
trigger1 = time = 0
channel = 2

[state 1058, removeexplod]
type = removeexplod
trigger1 = time = 0
id = 1053

[state 1058, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------


;--------------------------------------------------------------------------------------------
;Timer
[statedef 1059]
type = U
movetype = I
physics = N
anim = 9999

[state 4502, end]
type = destroyself
trigger1 = time > 60

;----------------------------------------------------------------------------------------------
;Hard versions
;-----------------------------------------------------------------------------------------------
;Black Hole Summon HK
[statedef 1060]
type = S
movetype = A
physics = S
anim = 1060
ctrl = 0
poweradd = 100
velset = 0,0

[State 1060, BlackHole]
type = Helper
triggerall = !numhelper(1065)
trigger1 = animelemtime(6) = 0
helpertype = normal ;player
name = "Black Hole HK"
ID = 1065
stateno = 1065
pos = ifelse(p2dist x < 600, ifelse(p2dist x > 50 ,p2dist x, 50),600),-240
postype = p1    
facing = 1
keyctrl = 0
ownpal = 1

[State 1060, Explod]
type = explod
trigger1 = !numexplod(1051)
trigger1 = animelemtime(7) > 0
id = 1051
anim = 1051
removetime = -1
removeongethit = 1
postype = p1
pos = 0,0
scale = const(size.xscale),const(size.yscale)
sprpriority = 3

[state 1060, Projectile imunity]
type = nothitby
triggerall = numhelper(1065)
trigger1 = helper(1065),animelemtime(6) >= 0
value = ,AP
time = 2
ignorehitpause = 1
persistent = 1


[state 1060, end early]
type = changestate
trigger1 = animelemtime(7) > 0
trigger1 = !numhelper(1065)
trigger2 = time > 240
value = 1067
ignorehitpause = 1

;---------------------------------------------------------------------------
;Anti Air Version
;Black Hole Summon HK
[statedef 1062]
type = S
movetype = A
physics = S
anim = 1062
ctrl = 0
poweradd = 100
velset = 0,0

[State 1062, BlackHole]
type = Helper
triggerall = !numhelper(1065)
trigger1 = animelemtime(6) = 0
helpertype = normal ;player
name = "Black Hole AA HK"
ID = 1065
stateno = 1065
pos = ifelse(p2dist x < 300, ifelse(p2dist x > 0 ,p2dist x, 0),300),-610
postype = p1    
facing = 1
keyctrl = 0
ownpal = 1

[State 1062, Explod]
type = explod
trigger1 = !numexplod(1053)
trigger1 = animelemtime(7) > 0
id = 1053
anim = 1053
removetime = -1
removeongethit = 1
postype = p1
pos = 0,0
scale = const(size.xscale),const(size.yscale)
sprpriority = 3

[state 1062, nothitby]
type = nothitby
trigger1 = time < 22
value = A
ignorehitpause = 1


[state 1062, end early]
type = changestate
trigger1 = animelemtime(7) > 0
trigger1 = !numhelper(1065)
trigger2 = time > 240
value = 1068
ignorehitpause = 1

;------------------------------------------------------------------------------------------------
;Dark Void
[statedef 1065]
type = S
movetype = A
physics = N
velset = 0,0
sprpriority = 2

[state 1065, special]
type = assertspecial
trigger1 = 1
flag = noshadow
ignorehitpause = 1

[state 1065, attackmulset]
type = attackmulset
trigger1 = 1
value = parent,fvar(10)
Persistent = 1

[state 1065, stretch]
type = angledraw
trigger1 = 1
scale = const(size.xscale),const(size.yscale)
ignorehitpause = 1
persistent = 1

[state 1065, nothitby]
type = hitby
trigger1 = 1
value = SCA, NP,SP,HP
ignorehitpause = 1
persistent = 1

[state 1065, playerpush]
type = playerpush
trigger1 = 1
value = 0
ignorehitpause = 1

[state 1065, anim]
type = changeanim
trigger1 = anim != 4060
value = 4060

[state 1065, playsnd]
type = playsnd
trigger1 = animtime != 0
value = 1050,0
channel = 2
persistent = 75

[State 1065, 2]
type = HitDef
trigger1 = animelem = 6
trigger2 = animelem = 8
trigger3 = animelem = 10
trigger4 = animelem = 12
trigger5 = animelem = 14
trigger6 = animelem = 16
trigger7 = animelem = 18
trigger8 = animelem = 20
persistent = 2
attr = S, SP
animtype  = heavy
damage    = ifelse(enemy,name = "Onslaught",40,20),6
getpower = 18
guardflag = MA
hitflag = MAF
pausetime = 1,1
sparkno = 1
sparkxy = -10,-70
hitsound   = 5,1
guardsound = S120, 0
ground.type = High
ground.slidetime = 18
ground.hittime  = 18
ground.velocity = ifelse(animelemtime(20) < 0, ifelse(p2dist x > 0, 8, -8),-22),ifelse(animelemtime(20) < 0, 0,-18)
guard.hittime = 23
guard.slidetime = 23
guard.velocity = ifelse(animelemtime(20) < 0, ifelse(p2dist x > 0, 3, -3),-32)
airguard.velocity = ifelse(animelemtime(20) < 0, ifelse(p2dist x > 0, 4, -4),-24),ifelse(animelemtime(20) < 0,-2,-8)
air.velocity = ifelse(animelemtime(20) < 0, ifelse(p2dist x > 0, 6, -6),-18),ifelse(animelemtime(20) < 0, -2,-18)
guard.dist = 1280
ground.cornerpush.veloff = 0
air.cornerpush.veloff = 0
guard.cornerpush.veloff = 0
airguard.cornerpush.veloff = 0
fall = ifelse(animelemtime(19) > 0, 1, 0)
fall.recover = 1
fall.recovertime = 30
guard.dist = 480

[state 1065, hitoverride]
type = hitoverride
trigger1 = 1
attr = SCA,NP,SP,HP        
stateno = 1065
slot = 1
time = 1
ignorehitpause = 1
persistent = 1

;[state 1005, changestate]
;type = changestate
;trigger1 = movecontact
;trigger1 = var(27) > 0
;value = 1006
;ignorehitpause = 1

[state 1065, parentvaradd]
type = parentvaradd
trigger1 = movehit
trigger1 = animtime = 0
v = 18
value = -3
persistent = 0
ignorehitpause = 1

[state 1065, stopsnd]
type = stopsnd
trigger1 = animtime = 0
trigger2 = parent,movetype = H
channel = 2
ignorehitpause = 1

[state 1065, destroyself]
type = destroyself
trigger1 = parent,movetype = H
;trigger2 = !numhelper(1059)
trigger2 = animtime = 0
ignorehitpause = 1

;--------------------------------------------------------------------------------------------
;End early Horizontal
[statedef 1067]
type = S
movetype = A
physics = S
anim = 1067
ctrl = 0
velset = 0,0

[state 1067, stopsnd]
type = stopsnd
trigger1 = time = 0
channel = 2

[state 1067, removeexplod]
type = removeexplod
trigger1 = time = 0
id = 1051

[state 1067, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1

;----------------------------------------------------------------------------
;End early Vertical
[statedef 1068]
type = S
movetype = A
physics = S
anim = 1068
ctrl = 0
velset = 0,0

[state 1058, stopsnd]
type = stopsnd
trigger1 = time = 0
channel = 2

[state 1058, removeexplod]
type = removeexplod
trigger1 = time = 0
id = 1053

[state 1058, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
;EX versions
;---------------------------------------------------------------------------
;Black Hole Summon EX
[statedef 1070]
type = S
movetype = A
physics = S
anim = 1070
ctrl = 0
velset = 0,0

[state 1072, nothitby]
type = nothitby
trigger1 = time < 16
value = SCA

[state 1070, poweradd]
type = poweradd
trigger1 = time = 3
value = -500
persistent = 0

[State 1020, Blink Yellow]
type = PalFX
trigger1 = time%2
time = 1
add = 150,75,0 ;32,16,0
sinadd = 64,32,5,3
ignorehitpause

[State 1070, BlackHole]
type = Helper
triggerall = !numhelper(1075)
trigger1 = animelemtime(6) = 0
helpertype = normal ;player
name = "Black Hole EX"
ID = 1075
stateno = 1075
pos = ifelse(p2dist x < 600,ifelse(p2dist x > 50,p2dist x,50),600),-240
postype = p1    
facing = 1
keyctrl = 0
ownpal = 1

[State 1070, Explod]
type = explod
trigger1 = !numexplod(1051)
trigger1 = animelemtime(7) > 0
id = 1051
anim = 1051
removetime = -1
removeongethit = 1
postype = p1
pos = 0,0
scale = const(size.xscale),const(size.yscale)
sprpriority = 3

[state 1070, Projectile imunity]
type = nothitby
triggerall = numhelper(1075)
trigger1 = helper(1075),animelemtime(6) >= 0
value = ,AP
time = 2
ignorehitpause = 1
persistent = 1


[state 1070, end early]
type = changestate
trigger1 = animelemtime(7) > 0
trigger1 = !numhelper(1075)
trigger2 = time > 240
value = 1077
ignorehitpause = 1

;---------------------------------------------------------------------------
;Anti Air Version
;Black Hole Summon HK
[statedef 1072]
type = S
movetype = A
physics = S
anim = 1072
ctrl = 0
velset = 0,0

[state 1072, nothitby]
type = nothitby
trigger1 = time < 16
value = SCA

[state 1072, poweradd]
type = poweradd
trigger1 = time = 3
value = -500
persistent = 0

[State 1020, Blink Yellow]
type = PalFX
trigger1 = time%2
time = 1
add = 150,75,0 ;32,16,0
sinadd = 64,32,5,3
ignorehitpause

[State 1072, BlackHole]
type = Helper
triggerall = !numhelper(1075)
trigger1 = animelemtime(6) = 0
helpertype = normal ;player
name = "Black Hole AA EX"
ID = 1075
stateno = 1075
pos = ifelse(p2dist x < 300, ifelse(p2dist x > 0 ,p2dist x, 0),300),-610
postype = p1    
facing = 1
keyctrl = 0
ownpal = 1

[State 1072, Explod]
type = explod
trigger1 = !numexplod(1053)
trigger1 = animelemtime(7) > 0
id = 1053
anim = 1053
removetime = -1
removeongethit = 1
postype = p1
pos = 0,0
scale = const(size.xscale),const(size.yscale)
sprpriority = 3


[state 1072, end early]
type = changestate
trigger1 = animelemtime(7) > 0
trigger1 = !numhelper(1075)
value = 1068
ignorehitpause = 1

;------------------------------------------------------------------------------------------------
;Dark Void
[statedef 1075]
type = S
movetype = A
physics = N
velset = 0,0
sprpriority = 2

[state 1075, special]
type = assertspecial
trigger1 = 1
flag = noshadow
ignorehitpause = 1

[state 1075, attackmulset]
type = attackmulset
trigger1 = 1
value = parent,fvar(10)
Persistent = 1

[state 1075, stretch]
type = angledraw
trigger1 = 1
scale = const(size.xscale),const(size.yscale)
ignorehitpause = 1
persistent = 1

[state 1075, nothitby]
type = hitby
trigger1 = 1
value = SCA, NP,SP,HP
ignorehitpause = 1
persistent = 1

[state 1075, playerpush]
type = playerpush
trigger1 = 1
value = 0
ignorehitpause = 1

[state 1075, anim]
type = changeanim
trigger1 = anim != 4070
value = 4070

[state 1075, playsnd]
type = playsnd
trigger1 = animtime != 0
value = 1050,0
channel = 2
persistent = 75



[State 1075, 2]
type = HitDef
trigger1 = animelem = 6
trigger2 = animelem = 8
trigger3 = animelem = 10
trigger4 = animelem = 12
trigger5 = animelem = 14
trigger6 = animelem = 16
trigger7 = animelem = 18
persistent = 2
attr = S, SP
animtype  = heavy
damage    = ifelse(enemy,name = "Onslaught",40,20),6
GETPOWER = 0
guardflag = MA
hitflag = MAF
pausetime = 1,1
sparkno = 1
sparkxy = -10,-70
hitsound   = 5,1
guardsound = S120, 0
ground.type = High
ground.slidetime = 16
ground.hittime  = 16
ground.velocity = ifelse(animelemtime(17) < 0, ifelse(p2dist x > 0, 8, -8),-22),ifelse(animelemtime(17) < 0, 0,-18)
guard.hittime = 24
guard.slidetime = 24
guard.velocity = ifelse(animelemtime(17) < 0, ifelse(p2dist x > 0, 3, -3),-32)
airguard.velocity = ifelse(animelemtime(17) < 0, ifelse(p2dist x > 0, 4, -4),-28),ifelse(animelemtime(17) < 0,-2,-8)
air.velocity = ifelse(animelemtime(17) < 0, ifelse(p2dist x > 0, 6, -6),-18),ifelse(animelemtime(17) < 0, -2,-18)
guard.dist = 1280
ground.cornerpush.veloff = 0
air.cornerpush.veloff = 0
guard.cornerpush.veloff = 0
airguard.cornerpush.veloff = 0
fall = ifelse(animelemtime(17) > 0, 1, 0)
fall.recover = 1
fall.recovertime = 30
guard.dist = 480

[state 1075, hitoverride]
type = hitoverride
trigger1 = 1
attr = SCA,NP,SP,HP        
stateno = 1075
slot = 1
time = 1
ignorehitpause = 1
persistent = 1

;[state 1005, changestate]
;type = changestate
;trigger1 = movecontact
;trigger1 = var(27) > 0
;value = 1006
;ignorehitpause = 1

[state 1075, parentvaradd]
type = parentvaradd
trigger1 = movehit
trigger1 = animtime = 0
v = 18
value = -3
persistent = 0
ignorehitpause = 1

[state 1075, stopsnd]
type = stopsnd
trigger1 = animtime = 0
trigger2 = parent,movetype = H
channel = 2
ignorehitpause = 1

[state 1075, destroyself]
type = destroyself
trigger1 = parent,movetype = H
;trigger2 = !numhelper(1059)
trigger2 = animtime = 0
ignorehitpause = 1

;--------------------------------------------------------------------------------------------
;End early Horizontal
[statedef 1077]
type = S
movetype = A
physics = S
anim = 1077
ctrl = 0
velset = 0,0

[state 1077, stopsnd]
type = stopsnd
trigger1 = time = 0
channel = 2

[state 1077, removeexplod]
type = removeexplod
trigger1 = time = 0
id = 1051

[state 1077, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1

;----------------------------------------------------------------------------
;End early Vertical
[statedef 1078]
type = S
movetype = A
physics = S
anim = 1078
ctrl = 0
velset = 0,0

[state 1078, stopsnd]
type = stopsnd
trigger1 = time = 0
channel = 2

[state 1078, removeexplod]
type = removeexplod
trigger1 = time = 0
id = 1053

[state 1078, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1



;===========================================================================
;                      Eliza Bodyblock Summon
;===========================================================================
;Body Block and Grab maybe
[statedef 1100]
type = S
movetype = I
physics = S
ctrl = 0
poweradd = 20
anim = 1130

[State 1100, Helper]
type = Helper
trigger1 = animelemtime(6) = 0
helpertype = normal ;player
name = "Eliza Elephant - Bodyblock"
ID = 4500
stateno = 4500 
pos = 200,0
postype = p1    ;p2,front,back,left,right
facing = 1
keyctrl = 0
ownpal = 1

[State 1100, Helper]
type = Helper
trigger1 = animelemtime(6) = 0
helpertype = normal ;player
name = "Eliza Timer"
ID = 4502
stateno = 4502 
pos = 0,-600
postype = p1    ;p2,front,back,left,right
facing = 1
keyctrl = 0
ownpal = 1

[state 4531, varset]
type = varset
trigger1 = animelemtime(6) = 0
var(20) = 240

[state 1100, end]
type = changestate
trigger1 = animtime = 0
ctrl = 1
value = 0

;---------------------------------------------------------------------------
;butt Bump and Heal
[statedef 1110]
type = S
movetype = I
physics = S
ctrl = 0
poweradd = 30
anim = 1130

[State 1110, Helper]
type = Helper
trigger1 = animelemtime(6) = 0
helpertype = normal ;player
name = "Eliza Elephant - Butt Bump"
ID = 4500
stateno = 4540 
pos = -420,-300
postype = p1    ;p2,front,back,left,right
facing = 1
keyctrl = 0
ownpal = 1



[state 4531, varset]
type = varset
trigger1 = animelemtime(6) = 0
var(20) = 85

[state 1110, end]
type = changestate
trigger1 = animtime = 0
ctrl = 1
value = 0


;===========================================================================
;                         Heavy Summon
;===========================================================================
;Heavy Drop Close
[statedef 1130]
type = S
movetype = I
physics = S
anim = 1130
velset = 0,0
ctrl = 0
poweradd = 80

[State 1130, Helper]
type = Helper
trigger1 = animelemtime(6) = 0
helpertype = normal ;player
name = "Eliza Elephant - Heavy Summon"
ID = 4500
stateno = 4510
pos = 350,0
postype = p1    ;p2,front,back,left,right
facing = 1
keyctrl = 0
ownpal = 1
supermovetime = 0
pausemovetime = 0

[state 1130, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1


;--------------------------------------------------------------------------
;Heavy Drop Far
[statedef 1140]
type = S
movetype = I
physics = S
anim = 1130
velset = 0,0
ctrl = 0
poweradd = 80

[State 1140, Helper]
type = Helper
trigger1 = animelemtime(6) = 0
helpertype = normal ;player
name = "Eliza Elephant - Heavy Summon"
ID = 4500
stateno = 4510
pos = p2dist x,0
postype = p1    ;p2,front,back,left,right
facing = 1
keyctrl = 0
ownpal = 1
supermovetime = 0
pausemovetime = 0

[state 1140, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1


;--------------------------------------------------------------------------
;EX Heavy Drop Homing
[statedef 1150]
type = S
movetype = I
physics = S
anim = 1130
velset = 0,0
ctrl = 0


[state 1150, EX]
type = poweradd
trigger1 = time = 0
value = -500

[State 1150, Blink Yellow]
type = PalFX
trigger1 = time%2
time = 1
add = 150,75,0 ;32,16,0
sinadd = 64,32,5,3
ignorehitpause

[State 1150, Helper]
type = Helper
trigger1 = animelemtime(6) = 0
helpertype = normal ;player
name = "Eliza Elephant - EX Summon"
ID = 4500
stateno = 4515
pos = p2dist x,0
postype = p1    ;p2,front,back,left,right
facing = 1
keyctrl = 0
ownpal = 1
supermovetime = 0
pausemovetime = 0

[state 1150, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1





;===========================================================================
;                           Teleport
;===========================================================================
;Disappear
[statedef 1200]
type = A
movetype = I
physics = N
ctrl = 0
velset = 0,0

[state 1200, nothitby]
type = nothitby
trigger1 = time > 3
value = SCA

[state 1200, teleport limiter]
type = varadd
trigger1 = time = 0
var(14) = -1
ignorehitpause = 1
persistent = 0

[state 1200, anim]
type = changeanim
trigger1 = time = 0
value = ifelse(statetype = A, 1205, 1200)
persistent = 0

[state 1200, screenbound]
type = screenbound
trigger1 = animelemtime(9) >= 0
value = 0
movecamera = 1,1

[state 1200, Teleport Behind]
type = posadd
triggerall = animelemtime(9) = 2
trigger1 = command = "holdfwd"
trigger1 = !ailevel
trigger2 = ailevel
x = p2dist x + 400
persistent = 0

[state 1200, Teleport Neutral]
type = posadd
triggerall = animelemtime(9) = 2
trigger1 = command != "holdfwd"
trigger1 = command != "holdback"
trigger1 = !ailevel
x = 0
persistent = 0

[state 1200, Teleport Retreat]
type = posadd
triggerall = animelemtime(9) = 2
trigger1 = command = "holdback"
trigger1 = !ailevel
x = -600
persistent = 0

[state 1200, Teleport Above]
type = null
triggerall = animelemtime(9) = 2
trigger1 = command = "holdup"
trigger1 = command != "holddown"
trigger1 = !ailevel
y = -400
persistent = 0

[state 1200, Teleport Below]
type = null
triggerall = animelemtime(9) = 2
trigger1 = command = "holddown"
trigger1 = command != "holdup"
trigger1 = !ailevel
y = -50
persistent = 0

[state 1200, Teleport neutral]
type = null
triggerall = animelemtime(9) = 2
trigger1 = command != "holddown"
trigger1 = command != "holdup"
trigger1 = !ailevel
trigger2 = ailevel
y = -100
persistent = 0

[state 1200, reappear portion]
type = changestate
trigger1 = animtime = 0
value = 1205


;---------------------------------------------------------------------------
;REappear
[statedef 1205]
type = A
movetype = I
physics = N
anim = 1210
velset = 0,0
ctrl = 0
facep2 = 1

[state 1205, noairguard]
type = assertspecial
trigger1 = 1
flag = noairguard


[state 1205, end]
type = changestate
trigger1 = animtime = 0
value = 50
ctrl = 1


;--------------------------------------------------------------------------
;Push block - teleport escape

[statedef 1400]
type = S
movetype = I
physics = N
ctrl = 0
velset = 0,0

[state 1400, freeze]
type = pause
trigger1 = time = 0
time = 8
endcmdbuftime = 8
movetime = 0

[state 1400, dim]
type = bgpalfx
trigger1 = time = 0
time = 8
mul = 200,200,200

[state 1400, nothitby]
type = hitby
trigger1 = 1
value = SCA,AT

[state 1400, meter spend]
type = poweradd
trigger1 = time = 0
value = -1000

[state 1400, anim]
type = changeanim
trigger1 = time = 0
value = 1400
persistent = 0

[state 1400, screenbound]
type = screenbound
trigger1 = animelemtime(9) >= 0
value = 0
movecamera = 1,1

[state 1400, Teleport Behind]
type = posadd
triggerall = animelemtime(9) = 1
trigger1 = command = "holdfwd"
trigger1 = !ailevel
trigger2 = ailevel
trigger2 = backedgebodydist <= 80
x = p2dist x + 600
persistent = 0

[state 1400, Teleport Retreat]
type = posadd
triggerall = animelemtime(9) = 1
trigger1 = command = "holdback"
trigger1 = !ailevel
trigger2 = ailevel
trigger2 = backedgebodydist > 80
trigger3 = command != "holdback" && command != "holdfwd"
trigger3 = !ailevel
x = -600
persistent = 0


[state 1400, Teleport Below]
type = posset
trigger1 = animelemtime(9) = 1
y = -2
persistent = 0

[state 1400, reappear portion]
type = changestate
trigger1 = animtime = 0
value = 1405


;---------------------------------------------------------------------------
;REappear
[statedef 1405]
type = A
movetype = I
physics = N
anim = 1410
velset = 0,0
ctrl = 0
facep2 = 1

[state 1405, hitby]
type = hitby
trigger1 = 1
value = SCA,AT

[state 1205, end]
type = changestate
trigger1 = animtime = 0
value = 50
ctrl = 1

;=========================================================================
;                        SUPERS
;=========================================================================
;Life Steal  CC Portion
[statedef 3000]
type = S
movetype = A
physics = S
anim = 3000
ctrl = 0
velset = 0,0

[state x, Minimum Super combo damage]
type = varset
trigger1 = time = 0
trigger1 = var(18) < 90
v = 18
value = 90

[state 3000, width]
type = width
trigger1 = animelemtime(5) >= 0
player = 275,0
Edge = 330,0
ignorehitpause = 1

[state 3000, nothitby]
type = nothitby
trigger1 = time < 80
value = SCA
ignorehitpause = 1

[state 3040, no bg]
type = assertspecial
trigger1 = animelemtime(4) =[0,60]
flag = nobg
ignorehitpause = 1

[State 3000, Super Pause]
type = SuperPause
trigger1 = animelemtime(4) = 0
sound = S3000, 0
poweradd = -3000
pos = 30,-140
time = 60
movetime = 60

[state 3000, Super Portrait]
type = explod
trigger1 = animelemtime(4) >= 0 && animelemtime(4) < 14 ;7
anim = 3100
postype = back
sprpriority = -4
supermovetime = 60
removetime = 1
pausemovetime = 60
scale = (3-(time*0.15))*(1),(3-(time*0.15))*(1)
pos = 0,60-time*5
ownpal = 1

[state 3000, Super Portrait]
type = explod
trigger1 = animelemtime(4) = 15
anim = 3100
postype = back
vel = -0.1,0
sprpriority = -4
supermovetime = 60
removetime = 45
pausemovetime = 60
pos = 0,0
scale = 1,1
ownpal = 1

[State 0, Helper]
type = Helper
trigger1 = animelemtime(6) = 0
helpertype = normal ;player
name = "CC Projectile"
ID = 4300
stateno = 4300
pos = 240,-300
postype = p1    ;p2,front,back,left,right
facing = 1
keyctrl = 0
ownpal = 0
scale = const(size.xscale),const(size.yscale)

[state 1058, removeexplod]
type = removeexplod
trigger1 = time = 0
id = 1051

[state 1058, removeexplod]
type = removeexplod
trigger1 = time = 0
id = 1053

[state 1058, removeexplod]
type = removeexplod
trigger1 = time = 0
id = 1061

[state 1058, removeexplod]
type = removeexplod
trigger1 = time = 0
id = 1063

[state 1058, removeexplod]
type = removeexplod
trigger1 = time = 0
id = 1071

[state 1058, removeexplod]
type = removeexplod
trigger1 = time = 0
id = 1073

[state 3000, hitconfirm teleport]
type = changestate
trigger1 = numhelper(4300)
trigger1 = helper(4300),movehit
trigger1 = helper(4300),var(27) = 0
value = 3001

[state 3000, end]
type = changestate
trigger1 = animelemtime(6) > 0
trigger1 = !numhelper(4300)
value = 30000


;---------------------------------------------------------------------------
;Premature end
[statedef 30000]
type = S
movetype = I
anim = 3001
ctrl = 0

[state 30000, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1
;------------------------------------------------------------------------
;Teleport portion
;Disappear
[statedef 3001]
type = S
movetype = I
physics = N
ctrl = 0
velset = 0,0

[state 3001, nothitby]
type = nothitby
trigger1 = 1
value = SCA
ignorehitpause = 1

[state 3001, anim]
type = changeanim
trigger1 = time = 0
value =  1200
persistent = 0

[state 3001, screenbound]
type = screenbound
trigger1 = animelemtime(11) >= 0
value = 0
movecamera = 1,1

[state 3001, Teleport Neutral]
type = posadd
trigger1 = animelemtime(9) = 1
x = p2bodydist x - 750
persistent = 0
ignorehitpause = 1

[state 1200, reappear portion]
type = changestate
trigger1 = animtime = 0
value = 3002


;---------------------------------------------------------------------------
;REappear
[statedef 3002]
type = S
movetype = I
physics = N
anim = 1210
velset = 0,0
ctrl = 0
facep2 = 1

[state 3001, nothitby]
type = nothitby
trigger1 = 1
value = SCA
ignorehitpause = 1

[state 3002, end]
type = changestate
trigger1 = animtime = 0
value = 3003


;----------------------------------------------------------------------------
;Life steal start
[statedef 3003]
type = S
movetype = A
physics = S
anim = 3003

[state 3001, nothitby]
type = nothitby
trigger1 = 1
value = SCA
ignorehitpause = 1

[State 3000, 1]
type = HitDef
Trigger1 = Time = 0
attr = S, HP         
hitflag = MA
hitonce = 1
priority = 1, Miss    
sparkno = -1          
p1sprpriority = 1                     
p1facing = 1
p2facing = 1          
p1stateno = 3004      
p2stateno = 3011     
guard.dist = 0        
fall = 1   

[state 3003, changestate]
type = changestate
trigger1 = animelem = 6
trigger1 = helper,numtarget(4300)
value = 3004

[state 3003, end]
type = changestate
trigger1 = animtime = 0
TRIGGER1 = !numtarget(4300)
value = 0
ctrl = 1

;-----------------------------------------------------------------------
;Lifesteal
[statedef 3004]
type = S
movetype = A
physics = N
anim = 3004

[state 3004, targetstate]
type = targetstate
trigger1 = time = 0
value = 3011
id = 4300

;=============
; Movement
;=============

[state 3004, steps]
type = posadd
trigger1 = animelem = 7
x = 40
persistent = 0

[state 3004, steps]
type = posadd
trigger1 = animelem = 9
x = 40
persistent = 0

[state 3004, steps]
type = posadd
trigger1 = animelem = 10
x = 30
persistent = 0

[state 3004, steps]
type = posadd
trigger1 = animelem = 11
x = 100
persistent = 0

[state 3004, steps]
type = posadd
trigger1 = animelem = 17
x = 30
persistent = 0

[state 3004, steps]
type = posadd
trigger1 = animelem = 19
x = 30
persistent = 0

[state 3004, steps]
type = posadd
trigger1 = animelem = 20
x = 100
persistent = 0

;---------------------------

;===============
;  Shakes
;===============
[State 0, EnvShake]
type = EnvShake
trigger1 = animelemtime(11) = 0
time = 24
freq = 60
ampl = -8
phase = 90

[State 0, EnvShake]
type = EnvShake
trigger1 = animelemtime(20) = 0
time = 32
freq = 60
ampl = -16
phase = 90
;---------------------------------
;===================================
;  Sound
;===================================
[state 3004, snd]
type = playsnd
trigger1 = animelemtime(11) =0
value = S4510,2

[state 3004, snd]
type = playsnd
trigger1 = animelemtime(20) =0
value = S4510,1




;=====================
;  Damage
;=====================
[state 3004, First wave]
type = targetlifeadd
trigger1 = animelemtime(1) > 6 && animelemtime(9) < 0
value = ceil((fvar(10)*-4)*(ifelse(life=lifemax, 1.25, 1)))
persistent = 2
kill = 0

[state 3004, Second wave]
type = targetlifeadd
trigger1 = animelemtime(11) >= 0 && animelemtime(15) < 0
value = ceil((fvar(10)*-4)*(ifelse(life=lifemax, 1.25, 1)))
persistent = 1
kill = 0

[state 3004, Last Hit]
type = targetlifeadd
trigger1 = animelemtime(21) = 0
value = ceil((fvar(10)*-40)*(ifelse(life=lifemax, 1.25, 1)))
persistent = 1
kill = 0

;=========================
;  Target Poweradd
;=========================
[state 3004, First wave]
type = targetpoweradd
trigger1 = animelemtime(1) > 6 && animelemtime(9) < 0
value = 10 ;210
persistent = 2


[state 3004, Second wave]
type = targetpoweradd
trigger1 = animelemtime(11) >= 0 && animelemtime(15) < 0
value = 10 ;300
persistent = 1


[state 3004, Last Hit]
type = targetpoweradd
trigger1 = animelemtime(21) = 0
value = 200
persistent = 1



;=========================
; Sound
;=========================

[state 3004, snd]
type = playsnd
trigger1 = animelemtime(1) = 6
trigger2 = animelemtime(11) = 0
trigger3 = animelemtime(20) = 0
value = S1050,0
persistent = 1

;========================
;Heal
;========================
[state 3004, First wave]
type = lifeadd
trigger1 = animelemtime(1) > 6 && animelemtime(9) < 0
value = 4
persistent = 2

[state 3004, Second wave]
type = lifeadd
trigger1 = animelemtime(11) >= 0 && animelemtime(15) < 0
value = 4
persistent = 1

[state 3004, Last Hit]
type = lifeadd
trigger1 = animelemtime(21) = 0
value = 51 ;37
persistent = 1

;===========================
; Orb
;===========================

[State 3004, Palm Light]
type = Explod
trigger1 = animelemtime(1) = 0
anim = 4302
ID = 4302
pos = 340,-348
postype = p1  ;p2,front,back,left,right
bindtime = 1
removetime = -1
scale = const(size.xscale),const(size.yscale)
sprpriority = -1
ownpal = 1
removeongethit = 1

[State 3004, Palm Light]
type = Explod
trigger1 = animelemtime(11) = 0
anim = 4302
ID = 4302
pos = 360,-380
postype = p1  ;p2,front,back,left,right
bindtime = 1
removetime = -1
scale = const(size.xscale),const(size.yscale)
sprpriority = 4
ownpal = 1
removeongethit = 1

[State 3004, Palm Light]
type = Explod
trigger1 = animelemtime(20) = 0
anim = 4302
ID = 4302
pos = 410,-410
postype = p1  ;p2,front,back,left,right
bindtime = 1
removetime = -1
scale = const(size.xscale),const(size.yscale)
sprpriority = -1
ownpal = 1
removeongethit = 1

[state 3004, stolen life]
type = explod
trigger1 = animelemtime(1) > 6 && animelemtime(9) < 0
anim = 4302
postype = p2
pos = -50,(-50-(random%200))
vel = p2bodydist x * 0.02,(p2bodydist y * 0.02)-4
removetime = 32
scale = const(size.xscale)*0.5,const(size.yscale)*0.5
persistent = 4


[state 3004, stolen life]
type = explod
trigger1 = animelemtime(11) > 0 && animelemtime(15) < 0
anim = 4302
postype = p2
pos = -50,(-50-(random%200))
vel = p2bodydist x * 0.02,(p2bodydist y * 0.02)-4
removetime = 32
scale = const(size.xscale)*0.5,const(size.yscale)*0.5
persistent = 4

[state 3004, remove palm light]
type = removeexplod
trigger1 = animelemtime(9) = 0
trigger2 = animelemtime(15) = 0
trigger3 = animtime = 0
id = 4302

;=====================================================
;Glowing hand
;=====================================================

[state 3004, glowing hand]
type = explod
trigger1 = animelemtime(1) = 6
anim  = 4303
postype = p1
pos = 260,-360
removetime = -1
id = 4303
sprpriority = 5

[state 3004, glowing hand]
type = explod
trigger1 = animelemtime(11) = 0
anim  = 4303
postype = p1
pos = 260,-400
removetime = -1
id = 4303
sprpriority = 5

[state 3004, glowing hand]
type = explod
trigger1 = animelemtime(20) = 6
anim  = 4303
postype = p1
pos = 320,-400
removetime = -1
id = 4303
sprpriority = 5


[state 3004, remove palm light]
type = removeexplod
trigger1 = animelemtime(9) = 0
trigger2 = animelemtime(15) = 0
trigger3 = animtime = 0
id = 4303

;=======================================
;Particles
;=======================================
[state 3008, explod]
type = explod
trigger1 = animelemtime(1) > 6  && animelemtime(9) < 0
anim = 4302
postype = p1
pos = 240+(random%120),-360
scale = const(size.xscale)*0.2,const(size.yscale)*0.2
removetime = 24
vel = -2+(random%4),-4
sprpriority = 3
persistent = 2
trans = addalpha

[state 3008, explod]
type = explod
trigger1 = animelemtime(11) > 0  && animelemtime(15) < 0
anim = 4302
postype = p1
pos = 240+(random%120),-400
scale = const(size.xscale)*0.2,const(size.yscale)*0.2
removetime = 24
vel = 2+(random%4),-4
sprpriority = 3
persistent = 2
trans = addalpha

[state 3008, explod]
type = explod
trigger1 = animelemtime(20) > 0  && animelemtime(21) < 12
anim = 4302
postype = p1
pos = 310+(random%90),-400
scale = const(size.xscale)*0.2,const(size.yscale)*0.2
removetime = 24
vel = 2+(random%4),-4
sprpriority = 3
persistent = 2
trans = addalpha


;==============================
;Hitadd
;==============================

[state 3008, hitadd]
type = hitadd
trigger1 = animelemtime(1) > 6 && animelemtime(9) < 0
trigger2 = animelemtime(11) > 0 && animelemtime(15) < 0
trigger3 = animelemtime(20) > 0 && animelemtime(21) < 8
value = 1
persistent = 3


[state 3004, end]
type = changestate
trigger1 = animtime = 0
value = 3005



;---------------------------------------------------------------------
;Warp
[statedef 3005]
type = A
movetype = A
physics = N
anim = 3005

[state 3005, camera]
type = screenbound
trigger1 = 1
movecamera = 1,0
ignorehitpause = 1

[state 3005, nothitby]
type = nothitby
trigger1 = 1
value = SCA
ignorehitpause = 1


[state 3005, reposition]
type = posset
trigger1 = animelemtime(3) = 0
y = -1200

[state 3005, Reposition]
type = posadd
trigger1 = animelemtime(3) = 0
x = p2dist x 

[state 3005, end]
type = changestate
trigger1 = animtime = 0
value = 3006
;-----------------------------------------------------------------
;Butt Drop, becasue of course it is
[statedef 3006]
type = A
movetype = A
physics = N
anim = 3006

[state 3006, gravity]
type = veladd
trigger1 = animelemtime(3) >= 0
y = 1.65

[state 3006, nothitby]
type = nothitby
trigger1 = 1
value = SCA
ignorehitpause = 1

[state 3006, playerpush]
type = playerpush
trigger1 = 1
value = 0
ignorehitpause = 1

[state 3006, playsnd]
type = playsnd
trigger1 = time = 0
value = S4510,0
channel = 3

[state 3005, camera]
type = screenbound
trigger1 = 1
movecamera = 1,0
ignorehitpause = 1

[State 3006, Damage]
type = HitDef
trigger1 = !movecontact || !movereversed
persistent = 0
attr = A, SA
damage    = 124,24
guardflag = HA
hitflag = MAF
id = 3000
;nochainid = 4520
priority = 3
getpower = 0
givepower = 290
pausetime = 0,0
sparkno = 3
sparkxy = 0,0
hitsound   = 5,4
guardsound = S120, 0
animtype = heavy
ground.type = high
ground.slidetime = ifelse(var(26) > 2, 0, 8*var(26))
ground.hittime  = ifelse(var(26) > 2, 0, 8*var(26))
ground.velocity = ifelse(var(26) = 2, -6, 0),ifelse(var(26) = 2, 4, 0)
air.velocity = ifelse(var(26) = 2, -6, 0),ifelse(var(26) = 2, 4, 0)
down.hittime = 60
guard.velocity = -28            
guard.hittime = 12*var(26)
guard.slidetime = 12*var(26)
airguard.velocity = -28,10
airguard.hittime = 35
guard.dist = 640
fall = 1
air.fall = 1
fall.recover = 0
fall.recovertime = 30

[state 3006, targetstate]
type = targetstate
trigger1 = movehit
trigger1 = p2statetype = A
value = 655

[state 3006, targetstate]
type = targetstate
trigger1 = movehit
trigger1 = p2statetype != A
value = 660


[state 3006, land]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 3007


;-----------------------------------------------------------------------------
;Impact
[statedef 3007]
type = C
movetype = A
physics = N
anim = 3007
velset = 0,0
sprpriority = 2
ctrl = 0

[state 3007, stopsnd]
type = stopsnd
trigger1 = time = 0
channel = 3

[state 3007, playsnd]
type = playsnd
trigger1 = time = 0
value = 4510,1
channel = 1


[state 3007, playsnd]
type = playsnd
trigger1 = time = 0
value = 4510,1

[state 3007, Dust 1]
type = explod
trigger1 = time = 0
anim = 2010
postype = p1
pos = 0,0
scale = 3,2.5
sprpriority = 5

[state 3007, Dust 1]
type = explod
trigger1 = time = 0
anim = 2011
postype = p1
pos = 0,0
scale = 3,2.5
sprpriority = -3

[State 3007, Hitdef]
type = HitDef
trigger1 = Time = 0
attr = A, SA
damage    = 124
guardflag = 
hitflag = FD
getpower = 0
priority = 4
pausetime = 12,12
sparkno = 1
sparkxy = -10,-40
hitsound   = 5,3
guardsound = S120, 0
animtype = Med
p2stateno = 660
ground.type = High
ground.slidetime = 12
ground.hittime  = 15
ground.velocity = 0
air.velocity = 0,0

[State 3007, EnvShake]
type = EnvShake
trigger1 = time = 0
time = 22
freq = 60
ampl = -12
phase = 90
ignorehitpause = 1
persistent = 0

[state 3007, nothitby]
type = nothitby
trigger1 = 1
VALUE = SCA
ignorehitpause = 1

[state 3007, on ground]
type = posset
trigger1 = time = 0
y = 0

[state 3007, bounce]
type = velset
trigger1 = time = 12
y = -12

[state 3007, gravity]
type = veladd
trigger1 = time > 12
y = 1.25

[state 3007, land]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 3008

;------------------------------------------------------------------------------
; 2nd Landing
[statedef 3008]
type = C
movetype = I
physics = N
velset = 0,0
anim = 3008
sprpriority = 2

[state 3008, nothitby]
type = nothitby
trigger1 = 1
VALUE = SCA
ignorehitpause = 1

[State 3008, EnvShake]
type = EnvShake
trigger1 = time = 0
time = 8
freq = 60
ampl = -8
phase = 90
ignorehitpause = 1
persistent = 0

[state 3008, on ground]
type = posset
trigger1 = time = 0
y = 0


[state 3008, leaves]
type = changestate
trigger1 = animtime = 0
value = 30090


;-----------------------------------------------------------------------------
;Warp
[statedef 30090]
type = A
movetype = A
physics = N
anim = 3005

[state 3005, reposition]
type = posset
trigger1 = animelemtime(3) = 0
y = -25

[state 3005, Reposition]
type = posadd
trigger1 = animelemtime(3) = 0
x = ifelse(backedgebodydist < 320,960,-960 )

[state 3005, end]
type = changestate
trigger1 = animtime = 0
value = 30091

;-----------------------------------------------------------------------------
;Warp
[statedef 30091]
type = A
movetype = A
physics = N
anim = 1210
facep2 = 1

[state 30091, nothitby]
type = nothitby
trigger1 = 1
value = SCA

[state 3005, end]
type = changestate
trigger1 = animtime = 0
value = 50
ctrl = 1


;------------------------------------------------------------------------
;Stun portion
[statedef 3010]
type = S
movetype = H
physics = S
anim = 5300
velset = 0,0
ctrl = 0

[state 3010, nothitby]
type = nothitby
trigger1 = time < 42
value = SCA
ignorehitpause = 1
persistent = 1


[state 3010, on ground]
type = posset
trigger1 = time = 0
y = 0

[state 3010, regain control]
type = selfstate
trigger1 = time > 180
value = 0
ctrl = 1


;-------------------------------------------------------------------------
;Stun state
[statedef 3011]
type = S
movetype = H
physics = N
ctrl = 0
velset = 0,0

[state 3011, nothitby]
type = nothitby
trigger1 = time < 170
value = SCA

[state 3011, anim]
type = changeanim
trigger1 = time = 0
value = 5300

;[state 3011, life taken]
;type = explod
;trigger1 = time > 6  & time < 122
;anim = 5000
;id = 3011
;scale = const(size.xscale)*0.25,const(size.yscale)*0.25
;removetime = 24
;vel = 16,-4
;persistent = 15
;sprpriority = 3
;trans = "addalpha"

[State 3011, PalFX]
type = PalFX
trigger1 = time = 55
time = 41
add = 0,0,0
mul = 192,208,192
;sinadd = 0,0,0,10
invertall = 0
color = 256

[State 3011, PalFX]
type = PalFX
trigger1 = time = 96
time = 36
add = 0,0,0
mul = 128,160,128
;sinadd = 0,0,0,10
invertall = 0
color = 256

[State 3011, PalFX]
type = PalFX
trigger1 = time = 132
time = 100
add = 0,0,0
mul = 64,96,64
;sinadd = 0,0,0,10
invertall = 0
color = 256

[state 3011, angledraw]
type = angledraw
trigger1 = time >= 55 && time < 96
scale = 0.8,0.9

[state 3011, angledraw]
type = angledraw
trigger1 = time >= 96 && time < 131 
scale = 0.6, 0.8


[state 3011, angledraw]
type = angledraw
trigger1 = time >= 131
scale = 0.4, 0.7






[state 3011, selfstate]
type = selfstate
trigger1 = time > 240
value = 0
ctrl = 1



;-------------------------------------------------------------------------
;Witch Counter
[statedef 3040]
type = S
movetype = A
physics = N
anim = 3040
velset = 0,0
ctrl = 0

[state 3040, reversal]
type = ReversalDef
trigger1 = 1
reversal.attr = SCA, AA
pausetime = 18,18 
p1stateno = 3041
p2stateno = 3053
ignorehitpause = 1

[State 1020, Blink White]
type = PalFX
trigger1 = animelemtime(11) > 0 && animelemtime(11) < 12
trigger1 = time%2
time = 1
add = 255,255,255 ;32,16,0
ignorehitpause

[state 1020, statetypeset]
type = statetypeset
trigger1 = animelemtime(11) = 0
movetype = I
ignorehitpause = 1

[state 3040, snd]
type = playsnd
trigger1 = time = 15
value = 3040,(0+random%4)
channel = 1


[state 3040, no bg]
type = assertspecial
trigger1 = time =[0,60]
flag = nobg
ignorehitpause = 1

[State 3040, Super Pause]
type = SuperPause
trigger1 = animelemtime(1) = 0
sound = S3000, 0
poweradd = -1000
pos = 30,-140
time = 60
movetime = 60


[state 3040, Super Portrait]
type = explod
trigger1 = animelemtime(1) >= 0 && animelemtime(2) < 10 ;7
anim = 3100
postype = back
sprpriority = -4
supermovetime = 60
removetime = 1
pausemovetime = 60
scale = (3-(time*0.15))*(1),(3-(time*0.15))*(1)
pos = 0,60-time*5
ownpal = 1

[state 3040, Super Portrait]
type = explod
trigger1 = animelemtime(2) = 10
anim = 3100
postype = back
vel = -0.1,0
sprpriority = -4
supermovetime = 60
removetime = 45
pausemovetime = 60
pos = 0,0
scale = 1,1
ownpal = 1

[state 3040, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1


;-------------------------------------------------------------------------
[statedef 3041]
type = S
movetype = A
physics = S
anim = 3041
ctrl = 0
velset = 0,0
facep2 = 1

[state 3041, stopsnd]
type = stopsnd
trigger1 = time = 0
channel = 1

[state 3041, snd]
type = playsnd
trigger1 = time = 2
value = 3041,2
channel = 2

[state 3041, snd]
type = playsnd
trigger1 = time = 12
value = 3041,0


[State 3041, 2]
type = HitDef
trigger1 = time = 0
attr = S, HA
animtype  = HEAVY
damage    = 140
guardflag = 
getpower = 0
givepower = 333
hitflag = MAF
pausetime = 2,2
sparkno = 3
id = 3040
sparkxy = -10,-70
hitsound   = S3041,1
guardsound = S120, 0
ground.type = High
ground.slidetime = 6
ground.hittime  = 6
ground.velocity = 0,0
guard.hittime = 10
guard.slidetime = 10
guard.velocity = -20
air.velocity = 0,0
guard.dist = 0
envshake.ampl = 6
envshake.time = 18
fall.recover = 0
fall.recovertime = 60
kill = 0

[state 3041, targetstate]
type = targetstate
triggerall = numtarget(3040)
trigger1 = movehit
value = 3050
ignorehitpause = 1
persistent = 0


[state 3041, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -3
persistent = 0
ignorehitpause = 1

[state 3041, nothitby]
type = nothitby
trigger1 = 1
value = SCA
ignorehitpause = 1

[State 3041, 5]
type = ChangeState
triggerall = numtarget(3040)
trigger1 = AnimTime = 0
value = 3042

[State 3041, 5]
type = ChangeState
triggerall = !numtarget(3040)
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;------------------------------------------------------------------------
;Slashing time
[statedef 3042]
type = S
movetype = A
physics = N
velset = 0,0
anim = 3042

[state 3042, posset]
type = posadd
trigger1 = animelemtime(6) = 0
x = p2dist x

[State 3042, PalFX]
type = PalFX
trigger1 = 1
time = 1
add = 0,0,0
mul = 256,192,192
invertall = 0
color = 256

[state 3042, targetstate]
type = targetstate
trigger1 = numtarget(3040)
trigger1 = animelemtime(12) = 0
value = 3051

;=========================================
; Damage
;=========================================

[state 3042, damage]
type = targetlifeadd
trigger1 = animelemtime(14) = 0
trigger2 = animelemtime(18) = 0
value = -14
persistent = 1
kill = 0

[state 3042, damage]
type = hitadd
trigger1 = animelemtime(14) = 0
trigger2 = animelemtime(18) = 0
value = 1
persistent = 1

;=========================================
;Sound
;=========================================

[state 3042, damage]
type = playsnd
trigger1 = animelemtime(14) = 0
trigger2 = animelemtime(18) = 0
value = S3041,1
persistent = 1

[state 3042, changestate]
type = changestate
trigger1 = time >= 87
value = 3043

;-------------------------------------------------------------------------
;Final Slash
[statedef 3043]
type = S
movetype = A
physics = S
anim = 3043

[State 3042, PalFX]
type = PalFX
trigger1 = 1
time = 1
add = 0,0,0
mul = 256,192,192
invertall = 0
color = 256

;=========================================
; Damage
;=========================================

[state 3043, damage]
type = targetlifeadd
trigger1 = animelemtime(3) = 0
value = -37
persistent = 1
kill = 0

[state 3043, damage]
type = targetlifeadd
trigger1 = animelemtime(7) = 0
value = -73
persistent = 1

[state 3043, damage]
type = hitadd
trigger1 = animelemtime(3) = 0
trigger2 = animelemtime(7) = 0
value = 1
persistent = 1

;=========================================
;Sound
;=========================================

[state 3043, damage]
type = playsnd
trigger1 = animelemtime(3) = 0
trigger2 = animelemtime(7) = 0
value = S3041,1
persistent = 1

;=========================================
;Targetstate
;=========================================

[state 3043, targetstate]
type = targetstate
trigger1 = animelemtime(7) = 0
value = 3052

[state 3043, velset]
type = velset
trigger1 = frontedgebodydist < 200
trigger1 = animelemtime(7) = 1
x = -90

[state 3043, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1






;-------------------------------------------------------------------------
;Victim Animation
[statedef 3050]
type = S
movetype = H
physics = S
velset = 0,0
sprpriority = 4

[state 3050, anim]
type = changeanim2
trigger1 = time = 0
value = 3050

[state 3050, changestatetype]
type = statetypeset
trigger1 = animelemtime(7) = 0
statetype = L

[state 3050, on ground]
type = posset
trigger1 = time = 0
y = 0

[state 3050, selfstate]
type = selfstate
trigger1 = time > 180
value = 5100

;----------------------------------------------------------------------------
;Victim Animation Slashed
[statedef 3051]
type = L
movetype = H
physics = C
velset = 0,0
sprpriority = 4



[state 3050, anim]
type = changeanim2
trigger1 = time = 0
value = 3051

[State 3042, PalFX]
type = PalFX
trigger1 = 1
time = 1
add = 0,0,0
mul = 256,192,192
invertall = 0
color = 256

[state 3050, selfstate]
type = selfstate
trigger1 = time > 300
value = 5100

;-----------------------------------------------------------------------------
[Statedef 3052]
type    = A
movetype= H
physics = N
velset = -35,-10
poweradd = 40

[state 3052, anim]
type = changeanim
trigger1 = time = 0
value = 5030

[State 3042, PalFX]
type = PalFX
trigger1 = 1
time = 45
add = 0,0,0
mul = 256,192,192
invertall = 0
color = 256

[State 821, 1] ;Gravity
type = VelAdd
Trigger1 = time > 0
y = 1.25

[State 821, 4] ;Hit ground
type = SelfState
trigger1 = Vel Y > 0
trigger1 = Pos Y >= 0
value = 5100 ;Hit ground

;------------------------------------------------------------------------
;Stun portion
[statedef 3053]
type = S
movetype = H
physics = S
anim = 5300
velset = 0,0
ctrl = 0

[state 3053, nothitby]
type = null;nothitby
trigger1 = time < 2
value = SCA
ignorehitpause = 1
persistent = 1


[state 3053, on ground]
type = posset
trigger1 = time = 0
y = 0

[state 3053, regain control]
type = selfstate
trigger1 = time > 180
value = 0
ctrl = 1
;--------------------------------------------------------------------------
;Super Dark Voids
[statedef 3080]
type = S
movetype = A
physics = S
anim = 3080
ctrl = 0
velset = 0,0

[state 3080, var check set]
type = varset
trigger1 = time = 0
value = 0
v = 15



;=================
;Remove Explods

[state 1058, removeexplod]
type = removeexplod
trigger1 = time = 0
id = 1051

[state 1058, removeexplod]
type = removeexplod
trigger1 = time = 0
id = 1053

[state 1058, removeexplod]
type = removeexplod
trigger1 = time = 0
id = 1061

[state 1058, removeexplod]
type = removeexplod
trigger1 = time = 0
id = 1063

[state 1058, removeexplod]
type = removeexplod
trigger1 = time = 0
id = 1071

[state 1058, removeexplod]
type = removeexplod
trigger1 = time = 0
id = 1073

;----------------------------------

[state 3040, combo damage scaling]
type = varset
trigger1 = var(18) < 80
trigger1 = time = 0
var(18) = 80
ignorehitpause

[State 3080, Super Pause]
type = SuperPause
trigger1 = animelemtime(3) = 0
sound = S3000, 0
poweradd = -1000
pos = 30,-140
time = 60
movetime = 60

[state 3080, nothitby]
type = nothitby
trigger1 = time < 66
value = SCA
ignorehitpause = 1

[state 3040, no bg]
type = assertspecial
trigger1 = animelemtime(3) =[0,60]
flag = nobg
ignorehitpause = 1

[State 3080, Helper]
type = Helper
trigger1 = animelemtime(6) = 0
helpertype = normal ;player
name = "Black Hole Timer Timer"
ID = 3080
stateno = 1059 
pos = 0,-600
postype = p1    
facing = 1
keyctrl = 0
ownpal = 0

[State 3080, BlackHole]
type = Helper
triggerall = !numhelper(3090)
trigger1 = animelemtime(6) = 0
helpertype = normal ;player
name = "Super Black Hole 1"
ID = 3090
stateno = 3090
pos = ifelse(p2dist x < 700, p2dist x, 700),-240
postype = p1    
facing = 1
keyctrl = 0
ownpal = 1

[State 3080, Explod]
type = explod
trigger1 = !numexplod(3080)
trigger1 = animelemtime(7) > 0
id = 3080
anim = 1051
removetime = -1
removeongethit = 1
postype = p1
pos = 0,0
scale = const(size.xscale),const(size.yscale)
sprpriority = 3

[state 3080, Projectile imunity]
type = nothitby
triggerall = numhelper(3090)
trigger1 = helper(3090),animelemtime(6) >= 0
value = ,AP
time = 2
ignorehitpause = 1
persistent = 1

[state 3080, end early]
type = changestate
triggerall = var(15) = 1
trigger1 = animelemtime(7) > 0
trigger1 = !numhelper(3090)
trigger2 = time > 240
value = 3081
ignorehitpause = 1

[state 3080, end early]
type = changestate
triggerall = var(15) = 0
trigger1 = animelemtime(7) > 0
trigger1 = !numhelper(3090)
trigger2 = time > 240
value = 3088
ignorehitpause = 1

[state 3080, Super Portrait]
type = explod
trigger1 = animelemtime(3) >= 0 && animelemtime(3) < 15 ;7
anim = 3100
postype = back
sprpriority = -4
supermovetime = 60
removetime = 1
pausemovetime = 60
scale = (3-(time*0.15))*(1),(3-(time*0.15))*(1)
pos = 0,60-time*5
ownpal = 1

[state 3080, Super Portrait]
type = explod
trigger1 = animelemtime(3) = 15
anim = 3100
postype = back
vel = -0.1,0
sprpriority = -4
supermovetime = 60
removetime = 45
pausemovetime = 60
pos = 0,0
scale = 1,1
ownpal = 1
;-----------------------------------------------------------------
;Super Dark Void 2nd portion
[statedef 3081]
type = S
movetype = A
physics = S
anim = 3081
ctrl = 0
velset = 0,0

[state 3081, var check set]
type = varset
trigger1 = time = 0
value = 0
v = 15

[state 3081, removeexplod]
type = removeexplod
trigger1 = time = 0
id = 3080

[State 3081, Helper]
type = Helper
trigger1 = animelemtime(6) = 0
helpertype = normal ;player
name = "Black Hole Timer Timer"
ID = 3081
stateno = 1059 
pos = 0,-600
postype = p1    
facing = 1
keyctrl = 0
ownpal = 0

[State 3081, BlackHole]
type = Helper
triggerall = !numhelper(3091)
trigger1 = animelemtime(6) = 0
helpertype = normal ;player
name = "Super Black Hole 2"
ID = 3091
stateno = 3090
pos = ifelse(p2dist x < 700, p2dist x, 700),-340
postype = p1    
facing = 1
keyctrl = 0
ownpal = 1

[State 3081, Explod]
type = explod
trigger1 = !numexplod(3081)
trigger1 = animelemtime(7) > 0
id = 3081
anim = 1051
removetime = -1
removeongethit = 1
postype = p1
pos = 0,0
scale = const(size.xscale),const(size.yscale)
sprpriority = 3

[state 3081, Projectile imunity]
type = nothitby
triggerall = numhelper(3091)
trigger1 = helper(3091),animelemtime(6) >= 0
value = ,AP
time = 2
ignorehitpause = 1
persistent = 1

[state 3081, end early]
type = changestate
triggerall = var(15) = 1
trigger1 = animelemtime(7) > 0
trigger1 = !numhelper(3091)
trigger2 = time > 240
value = 3082
ignorehitpause = 1

[state 3080, end early]
type = changestate
triggerall = var(15) = 0
trigger1 = animelemtime(7) > 0
trigger1 = !numhelper(3091)
trigger2 = time > 240
value = 3088
ignorehitpause = 1

;-----------------------------------------------------------------
;Super Dark Void 3 End
[statedef 3082]
type = S
movetype = A
physics = S
anim = 3082
ctrl = 0
velset = 0,0

[state 3081, removeexplod]
type = removeexplod
trigger1 = time = 0
id = 3081

[State 3082, Helper]
type = Helper
trigger1 = animelemtime(6) = 0
helpertype = normal ;player
name = "Black Hole Timer Timer"
ID = 3082
stateno = 1059 
pos = 0,-600
postype = p1    
facing = 1
keyctrl = 0
ownpal = 0

[State 3082, BlackHole]
type = Helper
triggerall = !numhelper(3092)
trigger1 = animelemtime(6) = 0
helpertype = normal ;player
name = "Super Black Hole 3"
ID = 3092
stateno = 3092
pos = ifelse(p2dist x < 700, p2dist x, 700),-610
postype = p1    
facing = 1
keyctrl = 0
ownpal = 1

[state 3082, Projectile imunity]
type = nothitby
triggerall = numhelper(3092)
trigger1 = helper(3092),animelemtime(6) >= 0
value = ,AP
time = 2
ignorehitpause = 1
persistent = 1

[State 3082, Explod]
type = explod
trigger1 = !numexplod(3082)
trigger1 = animelemtime(7) > 0
id = 3082
anim = 1053
removetime = -1
removeongethit = 1
postype = p1
pos = 0,0
scale = const(size.xscale),const(size.yscale)
sprpriority = 3

[state 3082, end early]
type = changestate
trigger1 = animelemtime(7) > 0
trigger1 = !numhelper(3092)
value = 3089
ignorehitpause = 1

;----------------------------------------------------------------
;End
[statedef 3088]
type = S
movetype = I
physics = S
ctrl = 0
anim = 3088

[state 3081, removeexplod]
type = removeexplod
trigger1 = time = 0
id = 3080

[state 3081, removeexplod]
type = removeexplod
trigger1 = time = 0
id = 3081


[state 3089, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1

;----------------------------------------------------------------
;End
[statedef 3089]
type = S
movetype = I
physics = S
ctrl = 0
anim = 3089

[state 3081, removeexplod]
type = removeexplod
trigger1 = time = 0
id = 3082


[state 3089, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1


;-----------------------------------------------------------------
;Dark Void Super
[statedef 3090]
type = S
movetype = A
physics = N
velset = 0,0
sprpriority = 2

[state 3090, special]
type = assertspecial
trigger1 = 1
flag = noshadow
ignorehitpause = 1

[state 3090, attackmulset]
type = attackmulset
trigger1 = 1
value = parent,fvar(10)
Persistent = 1

[state 3090, stretch]
type = angledraw
trigger1 = 1
scale = const(size.xscale),const(size.yscale)
ignorehitpause = 1
persistent = 1

[state 3090, nothitby]
type = hitby
trigger1 = 1
value = SCA, NP,SP,HP
ignorehitpause = 1
persistent = 1

[state 3090, playerpush]
type = playerpush
trigger1 = 1
value = 0
ignorehitpause = 1

[state 3090, anim]
type = changeanim
trigger1 = anim != 4050
value = 4050

[state 3090, playsnd]
type = playsnd
trigger1 = animtime != 0
value = 1050,0
channel = 2
persistent = 75

[State 3090, 2]
type = HitDef
trigger1 = animelem = 6
trigger2 = animelem = 8
trigger3 = animelem = 10
trigger4 = animelem = 12
trigger5 = animelem = 14
persistent = 2
attr = S, HP
damage    = ifelse(enemy,name = "Onslaught",32,16),4
guardflag = MA
hitflag = MAF
getpower = 0
pausetime = 1,1
sparkno = 1
sparkxy = -10,-70
hitsound   = 5,1
guardsound = S120, 0
yaccel = 1.22
ground.type = High
air.animtype = up
ground.slidetime = 30
ground.hittime  = 45
ground.velocity = ifelse(animelemtime(14) < 0, ifelse(p2dist x > 0, 8, -8),0),ifelse(animelemtime(14) < 0, 0,-26)
guard.hittime = 16;-10
guard.slidetime = 16
air.hittime = 45
guard.velocity = ifelse(animelemtime(14) < 0, ifelse(p2dist x > 0, 3, -3),0)
airguard.velocity = ifelse(animelemtime(14) < 0, ifelse(p2dist x > 0, 4, -4),-24),ifelse(animelemtime(14) < 0,-2,-8)
air.velocity = ifelse(animelemtime(14) < 0, ifelse(p2dist x > 0, 6, -6),0),ifelse(animelemtime(14) < 0, -4,-26)
guard.dist = 1280
ground.cornerpush.veloff = 0
air.cornerpush.veloff = 0
guard.cornerpush.veloff = 0
airguard.cornerpush.veloff = 0
fall = ifelse(animelemtime(13) > 0, 1, 0)
fall.recover = 0
guard.dist = 640

[state 3090, hitoverride]
type = hitoverride
trigger1 = 1
attr = SCA,NP,SP,HP        
stateno = 3090
slot = 1
time = 1
ignorehitpause = 1
persistent = 1

;[state 1005, changestate]
;type = changestate
;trigger1 = movecontact
;trigger1 = var(27) > 0
;value = 1006
;ignorehitpause = 1

[State 3090, DisplayToClipboard]
type = DisplayToClipboard
trigger1 = 1
text = "Distance from opponent:  %d"
params = p2dist x
ignorehitpause = 1 
persistent = 1

[state 3090, variable]
type = parentvarset
trigger1 = movehit
v = 15
value = 1
ignorehitpause = 1


[state 3090, stopsnd]
type = stopsnd
trigger1 = animtime = 0
trigger2 = parent,movetype = H
channel = 2
ignorehitpause = 1

[state 3090, destroyself]
type = destroyself
trigger1 = parent,movetype = H
;trigger2 = !numhelper(1059)
trigger2 = animtime = 0
ignorehitpause = 1

;--------------------------------------------------------------------------
;Super Dark Void 3
[statedef 3092]
type = S
movetype = A
physics = N
velset = 0,0
sprpriority = 2

[state 3092, special]
type = assertspecial
trigger1 = 1
flag = noshadow
ignorehitpause = 1

[state 3092, attackmulset]
type = attackmulset
trigger1 = 1
value = parent,fvar(10)
Persistent = 1

[state 3092, stretch]
type = angledraw
trigger1 = 1
scale = const(size.xscale),const(size.yscale)
ignorehitpause = 1
persistent = 1

[state 3092, nothitby]
type = hitby
trigger1 = 1
value = SCA, NP,SP,HP
ignorehitpause = 1
persistent = 1

[state 3092, playerpush]
type = playerpush
trigger1 = 1
value = 0
ignorehitpause = 1

[state 3092, anim]
type = changeanim
trigger1 = anim != 4060
value = 4060

[state 3092, playsnd]
type = playsnd
trigger1 = animtime != 0
value = 1050,0
channel = 2
persistent = 75

[State 3092, 2]
type = HitDef
trigger1 = animelem = 6
trigger2 = animelem = 8
trigger3 = animelem = 10
trigger4 = animelem = 12
trigger5 = animelem = 14
trigger6 = animelem = 16
trigger7 = animelem = 18
trigger8 = animelem = 20
persistent = 2
attr = S, HP
damage    = ifelse(enemy,name = "Onslaught",30,15),4
getpower = 0
guardflag = MA
hitflag = MAF
pausetime = 1,1
sparkno = 1
yaccel = 1.02
sparkxy = -10,-70
hitsound   = 5,1
guardsound = S120, 0
ground.type = High
air.animtype = up
ground.slidetime = 24
ground.hittime  = 45
air.hittime = 45
ground.velocity = ifelse(animelemtime(20) < 0, ifelse(p2dist x > 0, 8, -8),-22),ifelse(animelemtime(20) < 0, 0,-18)
guard.hittime = 16
guard.slidetime = 16
guard.velocity = ifelse(animelemtime(20) < 0, ifelse(p2dist x > 0, 3, -3),-16)
airguard.velocity = ifelse(animelemtime(20) < 0, ifelse(p2dist x > 0, 4, -4),-24),ifelse(animelemtime(20) < 0,-2,-8)
air.velocity = ifelse(animelemtime(20) < 0, ifelse(p2dist x > 0, 6, -6),-24),ifelse(animelemtime(20) < 0, -4,-18)
guard.dist = 1280
ground.cornerpush.veloff = 0
air.cornerpush.veloff = 0
guard.cornerpush.veloff = 0
airguard.cornerpush.veloff = 0
fall = ifelse(animelemtime(19) > 0, 1, 0)
fall.recover = 0
fall.recovertime = 60
guard.dist = 480

[state 3092, hitoverride]
type = hitoverride
trigger1 = 1
attr = SCA,NP,SP,HP        
stateno = 3092
slot = 1
time = 1
ignorehitpause = 1
persistent = 1

;[state 1005, changestate]
;type = changestate
;trigger1 = movecontact
;trigger1 = var(27) > 0
;value = 1006
;ignorehitpause = 1

[state 3092, stopsnd]
type = stopsnd
trigger1 = animtime = 0
trigger2 = parent,movetype = H
channel = 2
ignorehitpause = 1

[state 3092, destroyself]
type = destroyself
trigger1 = parent,movetype = H
;trigger2 = !numhelper(1059)
trigger2 = animtime = 0
ignorehitpause = 1

;==========================================================================
;Eliza Win Pose
;==========================================================================
;==========================================================================
[statedef 4180]
type = S
movetype = I
physics = S
sprpriority = -1

[state 4180, posset]
type = posset
trigger1 = time = 0
y = 0

[state 4180, anim]
type = changeanim
trigger1 = time = 0
value = 4185
ignorehitpause = 1
persistent = 1

[State 4180, Explod]
type = Explod
triggerall = !numexplod(4502)
trigger1 = time = 0
anim = 4501
ID = 4501
pos = 0,0
postype = p1  ;p2,front,back,left,right
facing = 1
vfacing = 1
bindtime = 0
vel = 0,0
accel = 0,0
random = 0,0
removetime = -2
pausemovetime = 0
scale = 1,1
sprpriority = -3
ontop = 0
shadow = 0,0,0
ownpal = 1
removeongethit = 0

[State 4180, EnvShake]
type = EnvShake
trigger1 = animelemtime(5) = 0
time = 12
freq = 60
ampl = -12
phase = 90
ignorehitpause = 1
persistent = 0

[state 4180, playsnd]
type = playsnd
trigger1 = animelemtime(5) = 0
value = 4510,1
channel = 1




[state 4180, nothitby]
type = nothitby
trigger1 = 1
value = SCA
ignorehitpause = 1

[state 4180, end]
type = Changestate
trigger1 = animtime = 0
value = 4181

;--------------------------------------------------------------------------
;Win Pose
[statedef 4181]
type = S
movetype = I
anim = 4180
velset = 0,0
sprpriority = -1

[state 4181, posadd]
type = posadd
trigger1 = 1
x = parentdist x
persistent = 30

[STATE 4181, sound]
type = playsnd
trigger1 = animelemtime(2) = 0
value = S800,0

[state 4181, explod]
type = explod
triggerall = !numexplod(4181)
trigger1 = time = 0
id = 4181
anim = 4181
postype = p1
pos = 0,0
scale = const(size.xscale),const(size.yscale)
removetime = -1
removeongethit = 1
sprpriority = 4



;==========================================================================
;                          Super Projectile
;==========================================================================
[statedef 4300]
type = S
movetype = A
physics = N
ctrl = 0

[state 4300, velocity]
type = velset
trigger1 = prevstateno != 4300
trigger1 = !movecontact 
x = 45

[state 4300, velocity]
type = velset
trigger1 = movecontact
trigger2 = prevstateno = 4300
x = 18


[state 4300, hitby]
type = hitby
trigger1 = 1
value = SCA, AP
ignorehitpause = 1

[state 4300, anim]
type = changeanim
trigger1 = anim != 4300
value = 4300

[STATE 4300, varset]
type = varset
trigger1 = time = 0
trigger1 = prevstateno != 4300
v = 27
value = 5

[State 4300, 2]
type = HitDef
trigger1 = var(27) > 0
persistent = 2
attr = S, HP
animtype  = heavy
damage    = 20,10
getpower = 0
givepower = 0
guardflag = MA
pausetime = 2,2
sparkno = 2
hitonce = 1
id = 4300
sparkxy = -10,-70
hitsound   = 5,1
guardsound = S120, 0
ground.type = High
ground.slidetime = 18
ground.hittime  = 18
ground.velocity = -8
guard.hittime = 16
guard.slidetime = 16
guard.velocity = -12
airguard.velocity = -10,-2
air.velocity = -8,-1
forcenofall = 1
guard.dist = 3000
ground.cornerpush.veloff = 0
air.cornerpush.veloff = 0
guard.cornerpush.veloff = 0
airguard.cornerpush.veloff = 0
kill = 0
guard.kill = 1

[state 4300, varadd]
type = varadd
trigger1 = movecontact = 1
trigger2 = gethitvar(damage) != 0
v = 27 
value = -1
ignorehitpause = 1
persistent = 0

[State 0, DisplayToClipboard]
type = DisplayToClipboard
trigger1 = 1
text = "Amount of hits left: %d"
params = var(27)
;ignorehitpause = 
;persistent = 

[state 4300, changestate]
type = changestate
trigger1 = movecontact
trigger1 = var(27) > 0
value = 4300
ignorehitpause = 1

[state 4300, hitoverride]
type = hitoverride
trigger1 = var(27) > 0
stateno = 4300
attr = SCA, AP
ignorehitpause = 1

[state 4300, targetstate]
type = targetstate
trigger1 = movehit
trigger1 = var(27) = 0
value = 3010
ignorehitpause = 1

[state 4300, changestate]
type = changestate
trigger1 = movecontact
trigger1 = var(27) <= 0
trigger2 = numtarget(4300)
trigger2 = target(4300),stateno = 3010
value = 4301
ignorehitpause = 1


[state 4300, destroyself]
type = destroyself
trigger1 = var(27) <= 0
trigger2 = frontedgebodydist < -30
ignorehitpause = 1

;-----------------------------------------------------------------------
;End projectile
[statedef 4301]
type = S
movetype = I
anim = 4301
physics = N
velset = 0,0

[state 4301, destroyself]
type = destroyself
trigger1 = animtime = 0





;==========================================================================
;                        Eliza Commands
;=========================================================================
[statedef 4500]
type = S
movetype = I
physics = S
sprpriority = 4

[state 4500, posset]
type = posset
trigger1 = time = 0
y = 0

[state 4500, var]
type = parentvaradd
trigger1 = gethitvar(damage) != 0
var(20) = floor(-gethitvar(damage)*1)
ignorehitpause = 1
persistent = 0

[state 4500, anim]
type = changeanim
trigger1 = anim != 4500
value = 4500
ignorehitpause = 1
persistent = 1

[State 0, Explod]
type = Explod
triggerall = !numexplod(4501)
triggerall = prevstateno != 4500
trigger1 = time = 1
anim = 4501
ID = 4501
pos = 0,0
postype = p1  ;p2,front,back,left,right
facing = 1
vfacing = 1
bindtime = 0
vel = 0,0
accel = 0,0
random = 0,0
removetime = -2
pausemovetime = 0
scale = 1,1
sprpriority = 0
ontop = 0
shadow = 0,0,0
ownpal = 1
removeongethit = 0

[State 4521, EnvShake]
type = EnvShake
trigger1 = animelemtime(6) = 0
time = 12
freq = 60
ampl = -12
phase = 90
ignorehitpause = 1
persistent = 0

[state 4601, playsnd]
type = playsnd
trigger1 = animelemtime(6) = 0
value = 4510,1
channel = 1


[State 0, Width]
type = Width
trigger1 = 1
player = 250,250
ignorehitpause = 1
persistent = 1

[State 1070, flash red]
type = PalFX
trigger1 = Time = 0
trigger1 = gethitvar(damage) != 0
time = 7
add = 100,0,0
IgnoreHitPause = 1

[state 4500, nothitby]
type = nothitby
trigger1 = animelemtime(5) < 0
value = SCA
ignorehitpause = 1

[state 4500, nothitby]
type = nothitby
trigger1 = animelemtime(5) >= 0
value = ,AT
ignorehitpause = 1

[State 4500, HitOverride]
type = HitOverride
triggerall = parent,var(32) > 0
trigger1 = animelemtime(5) >= 0
trigger1 = parent,var(20) > 0
attr = SCA, AA, AP
stateno = 4500
time = -1
slot = 1
persistent = 1
ignorehitpause = 1

[state 4500, damage]
type = parentvaradd
trigger1 = gethitvar(damage) != 0
V = 32
value = ceil(-gethitvar(damage)*0.5)
persistent = 1

[State 4500, HitOverride]
type = HitOverride
trigger1 = parent,var(32) <= 0
trigger2 = parent,var(20) <= 0
attr = SCA, NA,SA,HA     
stateno = 4600
time = -1
slot = 2
persistent = 1
ignorehitpause = 1

[state 4500, poweradd, support]
type = poweradd
trigger1 = animelemtime(5) > 0
value = 2
persistent = 2
ignorehitpause = 0

[state 4500, changestate]
type = changestate
trigger1 = parent,var(32) <= 0
trigger2 = parent,var(20) <= 0
value = 4600
ignorehitpause = 0
persistent = 1

[State 0, DisplayToClipboard]
type = DisplayToClipboard
trigger1 =  1
text = "Eliza get HP: %d"
params = parent,var(20)
ignorehitpause = 1
persistent = 1


[state 4500, end]
type = Changestate
triggerall = animelemtime(9) >= 0
trigger1 = !parent,numhelper(4502)
trigger2 = command = "QCB_x"
trigger2 = !ailevel
value = 4505
;==========================================================================
;Intro
[statedef 4501]
type = S
movetype = I
physics = S
sprpriority = -1

[state 4501, posset]
type = posset
trigger1 = time = 0
y = 0

;[state 4500, playerpush]
;type = playerpush
;trigger1 = 1
;value = 1
;ignorehitpause = 1

;[state 4500, velset]
;type = velset
;trigger1 = p2bodydist x = [0,100]
;x = enemy,vel x
;persistent = 1
;ignorehitpause = 1

[state 4501, anim]
type = changeanim
trigger1 = time = 0
value = 4502
ignorehitpause = 1
persistent = 1

[State 4501, Explod]
type = Explod
triggerall = !numexplod(4503)
triggerall = prevstateno != 4500
trigger1 = animelemtime(1) = 30
anim = 4503
ID = 4503
pos = 0,0
postype = p1  ;p2,front,back,left,right
facing = 1
vfacing = 1
bindtime = 0
vel = 0,0
accel = 0,0
random = 0,0
removetime = -2
pausemovetime = 0
scale = 1,1
sprpriority = -3
ontop = 0
shadow = 0,0,0
ownpal = 1
removeongethit = 0

[State 4521, EnvShake]
type = EnvShake
trigger1 = animelemtime(6) = 0
time = 12
freq = 60
ampl = -12
phase = 90
ignorehitpause = 1
persistent = 0

[state 4601, playsnd]
type = playsnd
trigger1 = animelemtime(6) = 0
value = 4510,1
channel = 1


[State 4501, Width]
type = Width
trigger1 = 1
player = 250,250
ignorehitpause = 1
persistent = 1

[State 4501, flash red]
type = PalFX
trigger1 = Time = 0
trigger1 = gethitvar(damage) != 0
time = 7
add = 100,0,0
IgnoreHitPause = 1

[state 4501, nothitby]
type = nothitby
trigger1 = 1
value = SCA
ignorehitpause = 1

[state 4500, end]
type = Changestate
trigger1 = animtime = 0
value = 4505




;--------------------------------------------------------------------------
;Timer
[statedef 4502]
type = U
movetype = I
physics = N
anim = 9999

[state 4502, end]
type = destroyself
triggerall = numhelper(4500)
trigger1 = time > 300
trigger1 = !PlayerIdExist(helper(33333333),var(3))
trigger2 = time > 600

[state 4502, end early]
type = destroyself
trigger1 = !numhelper(4500)
trigger1 = time > 10

;---------------------------------------------------------------------------
;Exit
[Statedef 4505]
type = S
movetype = I
physics = S
anim = 4505

[state 4505, sprpriority]
type = sprpriority
trigger1 = prevstateno = 4501
value = -1

[state 4505, nothitby]
type = nothitby
trigger1 = 1
value = SCA
ignorehitpause = 1

[State 0, Explod]
type = Explod
triggerall = !numexplod(4506)
trigger1 = time = 1
anim = 4506
ID = 4506
pos = 0,0
postype = p1  ;p2,front,back,left,right
facing = 1
vfacing = 1
bindtime = 0
vel = 0,0
accel = 0,0
random = 0,0
removetime = -2
pausemovetime = 0
scale = const(size.xscale),const(size.yscale)
sprpriority = -3
ontop = 0
shadow = 0,0,0
ownpal = 1
removeongethit = 0


[state 4505, end]
type = destroyself
trigger1 = animtime = 0
ignorehitpause = 1

;--------------------------------------------------------------------------
;Giant Shadow
[statedef 4510]
type = S
physics = S
movetype = I
anim = 9999
velset = 0,0

[state 4510, playsnd]
type = playsnd
trigger1 = time = 0
value = 4510,0
channel = 2


[State 0, Explod]
type = Explod
trigger1 = time = 0
anim = 4565
ID = 4565
pos = 0,0
postype = p1  ;p2,front,back,left,right
bindtime = 0
scale = fvar(25),fvar(25)
trans = sub
sprpriority = -4
shadow = 0,0,0
ownpal = 1
removeongethit = 1

[state 4510, modify explod]
type = modifyexplod
trigger1 = 1
id = 4565
scale = fvar(25), fvar(25)
ignorehitpause = 1
persistent = 2


[state 4510, velset]
type = varset
trigger1 = time = 0
fv = 25
value = 0.2

[state 4510, velset]
type = varset
trigger1 = time = 0
v = 26
value = 0

[state 4510, velset]
type = varadd
trigger1 = var(26) < 3
trigger1 = time > 59
v = 26
value = 1
persistent = 60

[state 4510, varset]
type = varadd
trigger1 = time > 0
trigger1 = fvar(25) < 1.00
fv = 25
value = 0.008
persistent = 2


[state 4510, velset]
type = varset
trigger1 = fvar(25) > 1.00
fv = 25
value = 1.00

[state 4510, shrunk]
type = angledraw
trigger1 = 1
scale = fvar(25),fvar(25) 
persistent = 1

[state 4510, changestate]
type = changestate
trigger1 = parent,command != "holda"  && parent,command != "holdb"
trigger1 = parent,movetype != H
trigger2 = time > 188
trigger3 = ailevel
trigger3 = parent,movetype != H
trigger3 = p2bodydist x = [-150,300]
trigger4 = roundstate = 3
value = ifelse(var(26) = 3,4524,ifelse(var(26) =2,4534,ifelse(var(26) = 1,4520,4530)))
; 4520 lv 1, 4524 lv 3, 4534 lv 2, 4530 lv 0

[state 4510, end]
type = destroyself
trigger1 = time >= 198
;---------------------------------------------------------------------------
;EX Homing Shadow
[statedef 4515]
type = S
physics = N
movetype = I
anim = 9999
velset = 0,0

[State 4515, DisplayToClipboard]
type = DisplayToClipboard
trigger1 = 1
text = "p2dist x: %d"
params = p2dist x
;ignorehitpause = 
;persistent = 


[state 4515, varset]
type = varset
trigger1 = 1
fvar(3) = ifelse(p2dist x > 40, 15, ifelse(p2dist x < -40, -15, 0))

[state 4515, veladd]
type = velset
trigger1 = time < 188
x = fvar(3)

[state 4515, veladd]
type = velmul
trigger1 = time < 188
x = 0.25
persistent = 4

[state 4515, playsnd]
type = playsnd
trigger1 = time = 0
value = 4510,0
channel = 2


[State 4515, Explod]
type = Explod
trigger1 = time = 0
anim = 4565
ID = 4565
pos = 0,0
postype = p1  ;p2,front,back,left,right
bindtime = -1
scale = fvar(25),fvar(25)
trans = sub
sprpriority = -4
shadow = 0,0,0
ownpal = 1
removeongethit = 1

[state 4515, modify explod]
type = modifyexplod
trigger1 = 1
id = 4565
scale = fvar(25), fvar(25)
ignorehitpause = 1
persistent = 2

[state 4515, velset]
type = varset
trigger1 = time = 0
fv = 25
value = 0.2

[state 4515, velset]
type = varset
trigger1 = time = 0
v = 26
value = 0

[state 4515, velset]
type = varadd
trigger1 = var(26) < 3
trigger1 = time > 59
v = 26
value = 1
persistent = 60

[state 4515, varset]
type = varadd
trigger1 = time > 0
trigger1 = fvar(25) < 1.00
fv = 25
value = 0.008
persistent = 2


[state 4515, velset]
type = varset
trigger1 = fvar(25) > 1.00
fv = 25
value = 1.00

[state 4515, shrunk]
type = angledraw
trigger1 = 1
scale = fvar(25),fvar(25) 
persistent = 1

[state 4515, changestate]
type = changestate
trigger1 = parent,command != "holdc" 
trigger1 = parent,movetype != H
trigger2 = time > 188
trigger3 = ailevel
trigger3 = parent,movetype != H
trigger3 = p2bodydist x = [-150,300]
trigger4 = roundstate = 3
value = ifelse(var(26) = 3,4524,ifelse(var(26) =2,4534,ifelse(var(26) = 1,4520,4530)))


[state 4515, end]
type = destroyself
trigger1 = time >= 198

;---------------------------------------------------------------------------
; Falling Eliza
[statedef 4520]
type = A
movetype = A
physics = N
anim = 4560

[state 4520, modify explod]
type = modifyexplod
trigger1 = prevstateno = 4515
trigger1 = time = 1
id = 4565
scale = fvar(25), fvar(25)
pos = 0,1600
postype = p1
bindtime = 1
vel = 0,0
ignorehitpause = 1


[state 4520, nothitby]
type = nothitby
trigger1 = 1
VALUE = SCA
ignorehitpause = 1

[state 1005, attackmulset]
type = attackmulset
trigger1 = 1
value = parent,fvar(10)
Persistent = 1

[state 4530, posset]
type = velset
trigger1 = time = 0
x = 0

[state 4520, posset]
type = posset
trigger1 = time = 0
y = -1600

[state 4520, getpower]
type = poweradd
triggerall = prevstateno != 4515
trigger1 = movecontact
value = ifelse(movehit = 1, 120, 40)
ignorehitpause = 1
persistent = 0

[State 4520, Damage]
type = HitDef
trigger1 = !movecontact || !movereversed
trigger1 = roundstate = 2
trigger1 = !numtarget(800)
persistent = 0
attr = A, SA
damage    = 120,36
guardflag = HA
hitflag = MAF
affectteam = E
id = 4520
nochainid = 4520,4300
priority = 3
getpower = 0
pausetime = 0,0
sparkno = 3
sparkxy = 0,0
hitsound   = 5,4
guardsound = S120, 0
animtype = heavy
ground.type = high
ground.slidetime = ifelse(var(26) > 2, 0, 8*var(26))
ground.hittime  = ifelse(var(26) > 2, 0, 8*var(26))
ground.velocity = ifelse(var(26) = 2, -6, 0),ifelse(var(26) = 2, 4, 0)
air.velocity = ifelse(var(26) = 2, -6, 0),ifelse(var(26) = 2, 4, 0)
down.hittime = 60
guard.velocity = -28            
guard.hittime = 12*var(26)
guard.slidetime = 12*var(26)
airguard.velocity = -28,10
airguard.hittime = 35
guard.dist = 640
fall = 1
air.fall = 1
fall.recover = 0
fall.recovertime = 30




;Ride down mechanic
[state 650, Ride down]
type = targetbind
;triggerall = var(26) > 2
trigger1 = movehit
trigger1 = enemy,statetype = A
pos = 96, -152

[state 650, state of ride down]
type = targetstate
;triggerall = var(26) > 2
trigger1 = movehit
trigger1 = enemy,statetype = A
value = 655
;----------------------------------------------

[state 4520, crush]
type = targetstate
;triggerall = var(26) > 2
trigger1 = movehit
trigger1 = p2statetype != A
value = 660


[State 0, HitOverride]
type = HitOverride
trigger1 = movereversed
attr = SCA,AA,AP,AT
slot = 2
stateno = 4521
time = 1
ignorehitpause = 1
persistent = 1


[state 4520, gravity]
type = veladd
trigger1 = time > 0
y = 1.85

[state 4520, combo scaling]
type = parentvaradd
trigger1 = movehit
v = 18
value = -3
ignorehitpause = 1
persistent = 0

[state 4520, land]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y 
value = 4521



;-----------------------------------------------------------------------------
;Impact
[statedef 4521]
type = C
movetype = A
physics = N
anim = 4561
velset = 0,0
sprpriority = -1

[state 4521, playsnd]
type = playsnd
trigger1 = time = 0
value = 4510,1
channel = 1

[state 4521, stopsnd]
type = stopsnd
trigger1 = time = 0
channel = 2

[state 4520, removeexplod]
type = removeexplod
trigger1 = time = 0
id = 4565

[state 4521, Dust 1]
type = explod
trigger1 = time = 0
anim = 2010
postype = p1
pos = 0,0
scale = 3,2.5
sprpriority = 5

[state 4521, Dust 1]
type = explod
trigger1 = time = 0
anim = 2011
postype = p1
pos = 0,0
scale = 3,2.5
sprpriority = -3





[state 4521, playsnd]
type = playsnd
trigger1 = time = 0
value = 4510,1

[State 4521, Hitdef]
type = HitDef
trigger1 = Time = 0
attr = A, SA
damage    = 120
guardflag = 
getpower = 180
hitflag = FD
nochainid = 4520,800
priority = 4
pausetime = 12,12
sparkno = 1
sparkxy = -10,-40
hitsound   = 5,3
guardsound = S120, 0
animtype = Med
p2stateno = 660
ground.type = High
ground.slidetime = 12
ground.hittime  = 15
ground.velocity = 0
air.velocity = 0,0

[State 4521, EnvShake]
type = EnvShake
trigger1 = time = 0
time = 22
freq = 60
ampl = -16
phase = 90
ignorehitpause = 1
persistent = 0

[state 4521, nothitby]
type = nothitby
trigger1 = 1
VALUE = SCA
ignorehitpause = 1

[state 4521, on ground]
type = posset
trigger1 = time = 0
y = 0

[state 4521, bounce]
type = velset
trigger1 = time = 12
y = -8

[state 4521, gravity]
type = veladd
trigger1 = time > 12
y = 1.45

[state 4520, land]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 4522

;------------------------------------------------------------------------------
; 2nd Landing
[statedef 4522]
type = C
movetype = I
physics = N
velset = 0,0
anim = 4562
sprpriority = -1

[state 4522, nothitby]
type = nothitby
trigger1 = 1
VALUE = SCA
ignorehitpause = 1

[State 4521, EnvShake]
type = EnvShake
trigger1 = time = 0
time = 8
freq = 60
ampl = -8
phase = 90
ignorehitpause = 1
persistent = 0

[state 4521, on ground]
type = posset
trigger1 = time = 0
y = 0


[state 4521, leaves]
type = changestate
trigger1 = animtime = 0
value = 4523

;-----------------------------------------------------------------------------
[statedef 4523]
type = C
movetype = I
physics = N
velset = 0,0
anim = 4563
sprpriority = -1

[state 4523, veladd]
type = veladd
trigger1 = animelemtime(1) = 0
y = -4

[state 4523, veladd]
type = velset
trigger1 = animelemtime(4) = 0
y = 0

[state 4523, sprpriority]
type = sprpriority
trigger1 = animelemtime(3) = 0
value = -2

[state 4523, explod]
type = explod
trigger1 = animelemtime(2) = 0
anim = 4506
postype = p1
pos = 100,-30;-15
scale = const(size.xscale),const(size.yscale)
sprpriority = -5

[state 4523, end]
type = destroyself
trigger1 = animtime = 0


;---------------------------------------------------------------------------
;Butt Drop
[statedef 4524]
type = A
movetype = A
physics = N
anim = 4550

[state 4524, modify explod]
type = modifyexplod
trigger1 = prevstateno = 4515
trigger1 = time = 1
id = 4565
scale = fvar(25), fvar(25)
pos = 0,1600
postype = p1
bindtime = 1
vel = 0,0
ignorehitpause = 1


[state 4524, nothitby]
type = nothitby
trigger1 = 1
VALUE = SCA
ignorehitpause = 1

[state 4524, attackmulset]
type = attackmulset
trigger1 = 1
value = parent,fvar(10)
Persistent = 1

[state 4524, posset]
type = velset
trigger1 = time = 0
x = 0

[state 4524, posset]
type = posset
trigger1 = time = 0
y = -1600

[state 4520, getpower]
type = poweradd
triggerall = prevstateno != 4515
trigger1 = movecontact
value = ifelse(movehit = 1, 320, 80)
ignorehitpause = 1
persistent = 0

[State 4524, Damage]
type = HitDef
trigger1 = !movecontact || !movereversed
trigger1 = roundstate = 2
trigger1 = !numtarget(800)
persistent = 0
attr = A, SA
damage    =  240,72
guardflag = HA
hitflag = MAF
affectteam = E
id = 4524
nochainid = 4524,4300
priority = 3
pausetime = 0,0
sparkno = 3
getpower = 0
sparkxy = 0,0
hitsound   = 5,4
guardsound = S120, 0
animtype = heavy
ground.type = high
ground.slidetime = ifelse(var(26) > 2, 0, 8*var(26))
ground.hittime  = ifelse(var(26) > 2, 0, 8*var(26))
ground.velocity = ifelse(var(26) = 2, -6, 0),ifelse(var(26) = 2, 4, 0)
air.velocity = ifelse(var(26) = 2, -6, 0),ifelse(var(26) = 2, 4, 0)
down.hittime = 60
guard.velocity = -28            
guard.hittime = 12*var(26)
guard.slidetime = 12*var(26)
airguard.velocity = -28,10
airguard.hittime = 35
guard.dist = 640
fall = 1
air.fall = 1
fall.recover = 0
fall.recovertime = 30




;Ride down mechanic
[state 4524, Ride down]
type = targetbind
;triggerall = var(26) > 2
trigger1 = movehit
trigger1 = enemy,statetype = A
pos = 96, -58

[state 4524, state of ride down]
type = targetstate
;triggerall = var(26) > 2
trigger1 = movehit
trigger1 = enemy,statetype = A
value = 655
;----------------------------------------------

[state 4524, crush]
type = targetstate
;triggerall = var(26) > 2
trigger1 = movehit
trigger1 = p2statetype != A
value = 660

[state 4524, gravity]
type = veladd
trigger1 = time > 0
y = 1.85

[state 4524, combo scaling]
type = parentvaradd
trigger1 = movehit
v = 18
value = -3
ignorehitpause = 1
persistent = 0

[State 0, HitOverride]
type = HitOverride
trigger1 = movereversed
attr = SCA,AA,AP,AT
slot = 2
stateno = 4525
time = 1
ignorehitpause = 1
persistent = 1

[state 4524, land]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y 
value = 4525



;-----------------------------------------------------------------------------
;Impact
[statedef 4525]
type = C
movetype = A
physics = N
anim = 4551
velset = 0,0
sprpriority = -1

[state 4525, playsnd]
type = playsnd
trigger1 = time = 0
value = 4510,1
channel = 1

[state 4525, stopsnd]
type = stopsnd
trigger1 = time = 0
channel = 2

[state 4525, removeexplod]
type = removeexplod
trigger1 = time = 0
id = 4565

[state 4525, Dust 1]
type = explod
trigger1 = time = 0
anim = 2010
postype = p1
pos = 0,0
scale = 3,2.5
sprpriority = 5

[state 4525, Dust 1]
type = explod
trigger1 = time = 0
anim = 2011
postype = p1
pos = 0,0
scale = 3,2.5
sprpriority = -3



[state 4525, playsnd]
type = playsnd
trigger1 = time = 0
value = 4510,1

[State 4525, Hitdef]
type = HitDef
trigger1 = Time = 0
attr = A, SA
damage    = 240
guardflag = 
hitflag = FD
getpower = 500
nochainid = 4520,800
priority = 4
pausetime = 12,12
sparkno = 1
sparkxy = -10,-40
hitsound   = 5,3
guardsound = S120, 0
animtype = Med
p2stateno = 660
ground.type = High
ground.slidetime = 12
ground.hittime  = 15
ground.velocity = 0
air.velocity = 0,0

[State 4525, EnvShake]
type = EnvShake
trigger1 = time = 0
time = 32
freq = 60
ampl = -32
phase = 90
ignorehitpause = 1
persistent = 0

[state 4525, nothitby]
type = nothitby
trigger1 = 1
VALUE = SCA
ignorehitpause = 1

[state 4525, on ground]
type = posset
trigger1 = time = 0
y = 0

[state 4525, bounce]
type = velset
trigger1 = time = 12
y = -8

[state 4525, gravity]
type = veladd
trigger1 = time > 12
y = 1.45

[state 4525, land]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 4526

;------------------------------------------------------------------------------
; 2nd Landing
[statedef 4526]
type = C
movetype = I
physics = N
velset = 0,0
anim = 4552
sprpriority = -1

[state 4526, nothitby]
type = nothitby
trigger1 = 1
VALUE = SCA
ignorehitpause = 1

[State 4526, EnvShake]
type = EnvShake
trigger1 = time = 0
time = 8
freq = 60
ampl = -8
phase = 90
ignorehitpause = 1
persistent = 0

[state 4526, on ground]
type = posset
trigger1 = time = 0
y = 0


[state 4526, leaves]
type = changestate
trigger1 = animtime = 0
value = 4527

;-----------------------------------------------------------------------------
[statedef 4527]
type = C
movetype = I
physics = N
velset = 0,0
anim = 4563
sprpriority = -1

[state 4527, veladd]
type = veladd
trigger1 = animelemtime(1) = 0
y = -4

[state 4527, veladd]
type = velset
trigger1 = animelemtime(4) = 0
y = 0

[state 4527, sprpriority]
type = sprpriority
trigger1 = animelemtime(3) = 0
value = -2

[state 4527, explod]
type = explod
trigger1 = animelemtime(2) = 0
anim = 4506
postype = p1
pos = 100,-30;-15
scale = const(size.xscale),const(size.yscale)
sprpriority = -5

[state 4527, end]
type = destroyself
trigger1 = animtime = 0

;--------------------------------------------------------------------------
;Butt Drop front facing Falling Eliza
[statedef 4534]
type = A
movetype = A
physics = N
anim = 4600

[state 4534, modify explod]
type = modifyexplod
trigger1 = prevstateno = 4515
trigger1 = time = 1
id = 4565
scale = fvar(25), fvar(25)
pos = 0,1600
postype = p1
bindtime = 1
vel = 0,0
ignorehitpause = 1


[state 4534, nothitby]
type = nothitby
trigger1 = 1
VALUE = SCA
ignorehitpause = 1

[state 4534, attackmulset]
type = attackmulset
trigger1 = 1
value = parent,fvar(10)
Persistent = 1

[state 4534, posset]
type = velset
trigger1 = time = 0
x = 0

[state 4534, posset]
type = posset
trigger1 = time = 0
y = -1600

[state 4534, getpower]
type = poweradd
triggerall = prevstateno != 4515
trigger1 = movecontact
value = ifelse(movehit = 1, 180, 45)
ignorehitpause = 1
persistent = 0

[State 4534, Damage]
type = HitDef
trigger1 = !movecontact || !movereversed
trigger1 = roundstate = 2
trigger1 = !numtarget(800)
persistent = 0
attr = A, SA
damage    = 180,54
guardflag = HA
hitflag = MAF
affectteam = E
id = 4534
nochainid = 4534, 4300
priority = 3
getpower = 0
pausetime = 0,0
sparkno = 3
sparkxy = 0,0
hitsound   = 5,4
guardsound = S120, 0
animtype = heavy
ground.type = high
ground.slidetime = ifelse(var(26) > 2, 0, 8*var(26))
ground.hittime  = ifelse(var(26) > 2, 0, 8*var(26))
ground.velocity = ifelse(var(26) = 2, -6, 0),ifelse(var(26) = 2, 4, 0)
air.velocity = ifelse(var(26) = 2, -6, 0),ifelse(var(26) = 2, 4, 0)
down.hittime = 60
guard.velocity = -28            
guard.hittime = 12*var(26)
guard.slidetime = 12*var(26)
airguard.velocity = -28,10
airguard.hittime = 35
guard.dist = 640
fall = 1
air.fall = 1
fall.recover = 0
fall.recovertime = 30

[State 0, HitOverride]
type = HitOverride
trigger1 = movereversed
attr = SCA,AA,AP,AT
slot = 2
stateno = 4535
time = 1
ignorehitpause = 1
persistent = 1



;Ride down mechanic
[state 4534, Ride down]
type = targetbind
;triggerall = var(26) > 2
trigger1 = movehit
trigger1 = enemy,statetype = A
pos = 30, -54

[state 4534, state of ride down]
type = targetstate
;triggerall = var(26) > 2
trigger1 = movehit
trigger1 = enemy,statetype = A
value = 655
;----------------------------------------------

[state 4534, crush]
type = targetstate
;triggerall = var(26) > 2
trigger1 = movehit
trigger1 = p2statetype != A
value = 660

[state 4534, gravity]
type = veladd
trigger1 = time > 0
y = 1.85

[state 4534, combo scaling]
type = parentvaradd
trigger1 = movehit
v = 18
value = -3
ignorehitpause = 1
persistent = 0

[state 4534, land]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y 
value = 4535



;-----------------------------------------------------------------------------
;Impact
[statedef 4535]
type = C
movetype = A
physics = N
anim = 4601
velset = 0,0
sprpriority = -1

[state 4535, playsnd]
type = playsnd
trigger1 = time = 0
value = 4510,1
channel = 1

[state 4535, stopsnd]
type = stopsnd
trigger1 = time = 0
channel = 2

[state 4535, removeexplod]
type = removeexplod
trigger1 = time = 0
id = 4565

[state 4535, Dust 1]
type = explod
trigger1 = time = 0
anim = 2010
postype = p1
pos = 0,0
scale = 3,2.5
sprpriority = 5

[state 4535, Dust 1]
type = explod
trigger1 = time = 0
anim = 2011
postype = p1
pos = 0,0
scale = 3,2.5
sprpriority = -3



[state 4535, playsnd]
type = playsnd
trigger1 = time = 0
value = 4510,1

[State 4535, Hitdef]
type = HitDef
trigger1 = Time = 0
attr = A, SA
damage    = 180
guardflag = 
hitflag = FD
nochainid = 4520,800
priority = 4
getpower = 300
pausetime = 12,12
sparkno = 1
sparkxy = -10,-40
hitsound   = 5,3
guardsound = S120, 0
animtype = Med
p2stateno = 660
ground.type = High
ground.slidetime = 12
ground.hittime  = 15
ground.velocity = 0
air.velocity = 0,0

[State 4535, EnvShake]
type = EnvShake
trigger1 = time = 0
time = 26
freq = 60
ampl = -24
phase = 90
ignorehitpause = 1
persistent = 0

[state 4535, nothitby]
type = nothitby
trigger1 = 1
VALUE = SCA
ignorehitpause = 1

[state 4535, on ground]
type = posset
trigger1 = time = 0
y = 0

[state 4535, bounce]
type = velset
trigger1 = time = 12
y = -8

[state 4535, gravity]
type = veladd
trigger1 = time > 12
y = 1.45

[state 4535, land]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 4536

;------------------------------------------------------------------------------
; 2nd Landing
[statedef 4536]
type = C
movetype = I
physics = N
velset = 0,0
anim = 4602
sprpriority = -1

[state 4536, nothitby]
type = nothitby
trigger1 = 1
VALUE = SCA
ignorehitpause = 1

[State 4536, EnvShake]
type = EnvShake
trigger1 = time = 0
time = 8
freq = 60
ampl = -8
phase = 90
ignorehitpause = 1
persistent = 0

[state 4536, on ground]
type = posset
trigger1 = time = 0
y = 0


[state 4536, leaves]
type = changestate
trigger1 = animtime = 0
value = 4537

;-----------------------------------------------------------------------------
[statedef 4537]
type = C
movetype = I
physics = N
velset = 0,0
anim = 4563
sprpriority = -1

[state 4523, veladd]
type = veladd
trigger1 = animelemtime(1) = 0
y = -4

[state 4523, veladd]
type = velset
trigger1 = animelemtime(4) = 0
y = 0

[state 4523, sprpriority]
type = sprpriority
trigger1 = animelemtime(3) = 0
value = -2

[state 4523, explod]
type = explod
trigger1 = animelemtime(2) = 0
anim = 4506
postype = p1
pos = 100,-30;-15
scale = const(size.xscale),const(size.yscale)
sprpriority = -5

[state 4523, end]
type = destroyself
trigger1 = animtime = 0


;---------------------------------------------------------------------------
; Falling Plush Eliza
[statedef 4530]
type = A
movetype = A
physics = N
anim = 4570

[state 4530, nothitby]
type = nothitby
trigger1 = 1
VALUE = SCA
ignorehitpause = 1

[state 4520, modify explod]
type = modifyexplod
trigger1 = prevstateno = 4515
trigger1 = time = 1
id = 4565
scale = fvar(25), fvar(25)
pos = 0,1600
postype = p1
bindtime = 1
vel = 0,0
ignorehitpause = 1

[state 4530, Speed]
type = null;velset
triggerall = time = 0
trigger1 = enemynear,statetype = L
trigger2 = enemynear,movetype = H
y = 30

[state 4530, posset]
type = velset
trigger1 = time = 0
x = 0

[state 4530, posset]
type = posset
trigger1 = time = 0
y = -1600

[state 4530, getpower]
type = poweradd
triggerall = prevstateno != 4515
trigger1 = movecontact
value = ifelse(movehit = 1, 60, 15)
ignorehitpause = 1
persistent = 0

[State 4530, Damage]
type = HitDef
trigger1 = !movecontact || !movereversed
trigger1 = roundstate = 2
trigger1 = !parent,numtarget(800)
persistent = 0
attr = A, SA
damage    = 60,6
guardflag = HA
hitflag = MAFD
affectteam = E
id = 4530
nochainid = 4530,4300
priority = 3
getpower = 0
pausetime = 8,8
sparkno = 3
sparkxy = 0,0
hitsound   = 5,4
guardsound = S120, 0
animtype = light
ground.type = high
ground.slidetime = 20
ground.hittime  = 20
air.hittime = 24
ground.velocity = -8
air.velocity = -2,-12
down.hittime = 60
down.velocity = -1,-32
guard.velocity = -12            
guard.hittime = 12
guard.slidetime = 12
airguard.velocity = -10,-4
airguard.hittime = 35
guard.dist = 640
air.fall = 1
fall.recover = 1
fall.recovertime = 30

[State 0, HitOverride]
type = HitOverride
trigger1 = movereversed
attr = SCA,AA,AP,AT
slot = 2
stateno = 4531
time = 1
ignorehitpause = 1
persistent = 1

[state 4530, gravity]
type = veladd
trigger1 = time > 0
y = 1.85

[state 4520, land]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y 
value = 4531

;--------------------------------------------------------------------------
;1st Impact
[statedef 4531]
type = C
movetype = A
physics = N
anim = 4571
velset = 0,0
sprpriority = 2

[state 4520, removeexplod]
type = removeexplod
trigger1 = time = 0
id = 4565

[state 4531, playsnd]
type = playsnd
trigger1 = time = 0
value = 4530,0
channel = 1


[state 4531, stopsnd]
type = stopsnd
trigger1 = time = 0
channel = 2

[state 4531, on ground]
type = posset
trigger1 = time = 0
y = 0

[state 4531, playsnd]
type = playsnd
trigger1 = time = 0
value = 4510,2

[State 4531, Hitdef]
type = HitDef
trigger1 = anim = 4565
trigger1 = Time = 0
attr = A, SA
damage    = 40 
guardflag = 
hitflag = FD
id = 4531
getpower = 100
nochainid = 4530, 800
priority = 4
pausetime = 12,12
sparkno = 1
sparkxy = -10,-40
hitsound   = 5,3
guardsound = S120, 0
animtype = Med
ground.type = High
ground.slidetime = 14
ground.hittime  = 14
ground.velocity = 0
air.velocity = 0,0
down.velocity = 0,-32
down.hittime = 60

[State 4531, EnvShake]
type = EnvShake
trigger1 = time = 0
time = 8
freq = 60
ampl = -4
phase = 90
ignorehitpause = 1
persistent = 0

[state 4531, harmless]
type = statetypeset
trigger1 = time = 4
movetype = I

[state 4531, bounce]
type = velset
trigger1 = time = 4
y = -12

[state 4531, changeanim]
type = changeanim
trigger1 = time = 4
value = 4570

[state 4531, gravity]
type = veladd
trigger1 = time > 5
y = 0.95

[state 4531, end]
type = changestate
trigger1 = time > 4
trigger1 = vel y > 0
trigger1 = pos y >-vel y
value = 4532

[state 4531, nothitby]
type = nothitby
trigger1 = 1
VALUE = SCA
ignorehitpause = 1





;--------------------------------------------------------------------------
;2nd Impact
[statedef 4532]
type = C
movetype = I
physics = N
anim = 4571
velset = 0,0
sprpriority = 2

[State 4531, EnvShake]
type = EnvShake
trigger1 = time = 0
time = 12
freq = 60
ampl = -4
phase = 90
ignorehitpause = 1
persistent = 0

[state 4531, nothitby]
type = nothitby
trigger1 = 1
VALUE = SCA
ignorehitpause = 1

[state 4531, on ground]
type = posset
trigger1 = time = 0
y = 0

[state 4520, land]
type = destroyself
trigger1 = animtime = 0

;---------------------------------------------------------------------------
;Jump in
[statedef 4540]
type = A
movetype = A
physics = N
anim = 4580

[state 4531, nothitby]
type = nothitby
trigger1 = 1
VALUE = SCA
ignorehitpause = 1

[state 4540, playerpush]
type = playerpush
trigger1 = 1
value = 1

[state 4540, velset]
type = velset
trigger1 = time = 0
x = 45 ;45
y = 30 ;30

[state 4540, end land]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y 
value = 4541

;----------------------------------------------------------------------------
;Eliza Butt Bump then heal
[statedef 4541]
type = S
movetype = A
physics = S


;Armor
[STATE 4541, animation]
type = changeanim
trigger1 = anim != 4581
value = 4581



[state 4531, hit counter]
type = parentvaradd
trigger1 = gethitvar(damage) != 0
var(20) = -gethitvar(damage)*1
ignorehitpause = 1

[state 4500, damage]
type = parentvaradd
trigger1 = gethitvar(damage) != 0
trigger1 = parent,var(20) > 0
V = 32
value = -gethitvar(damage)
persistent = 1
ignorehitpause = 1

;[state 4531, infinite Projectile Armor]
;type = HitOverride
;trigger1 = 1
;attr = SCA,AP ,     
;stateno = 4541
;slot = 1
;time = -1
;persistent = 1
;ignorehitpause = 1

[state 4541, Either knocked on ass or armored]
type = HitOverride
trigger1 = 1
attr = SCA,AA,AP
slot = 2    
stateno = ifelse(parent,var(20)>0, 4541, 4610)
time = -1
persistent = 1
ignorehitpause = 1

[state 4541, movereversed]
type = changestate
trigger1 = movereversed
trigger2 = parent,var(20) <= 0
value = 4610
ignorehitpause = 1
persistent = 1

[state 4531, nothitby]
type = nothitby
trigger1 = 1
VALUE = ,AT
ignorehitpause = 1

[State 1070, flash red]
type = PalFX
trigger1 = Time = 0
trigger1 = gethitvar(damage) != 0
time = 7
add = 100,0,0
IgnoreHitPause = 1

;determine what frame
[state 4541, remember frame]
type = varset
trigger1 = time <= 0
v = 22
value = animelemno(0)
ignorehitpause = 1

;delay effect
[state 4541, delay]
type = changeanim 
trigger1 = parent,var(31) < floor(gethitvar(hittime)*1.7)
value = anim
elem = var(22)

[state 240, freeze location]
type = posfreeze
trigger1 = parent,var(31) < floor(gethitvar(hittime)*1.7)
value = 1

;--------------------------

[state 4540, playerpush]
type = playerpush
trigger1 = 1
value = 1

[state 4540, settypeset]
type= statetypeset
trigger1 = animelemtime(5) = 0
movetype = I
ignorehitpause = 1

[state 4541, pos y]
type = posset
trigger1 = time = 0
y = 0

[state 4541, velset]
type = velset
trigger1 = time = 0
y = 0

[state 4521, playsnd]
type = playsnd
trigger1 = time = 0
value = 4510,1
channel = 1

[State 4521, EnvShake]
type = EnvShake
trigger1 = time = 0
time = 12
freq = 60
ampl = -12
phase = 90
ignorehitpause = 1
persistent = 0

[State 4541, 2]
type = HitDef
trigger1 = !movecontact
persistent = 0
attr = S, SA
animtype  = back
damage    = 180,52
guardflag = MA
hitflag = MAF
id = 4540
priority = 5,hit
nochainid = 4540
pausetime = 14,14
sparkno = 3
getpower = 160
sparkxy = -10,-70
hitsound   = 5,4
guardsound = S120, 0
ground.type = high
ground.slidetime = 12
ground.hittime  = 12
ground.velocity = -80,ifelse(parent,var(7) > 1, -24, -4)
guard.hittime = 22
guard.slidetime = 22
guard.velocity = -80
airguard.velocity = -40,-18
airguard.hittime = 22
air.velocity = -80,ifelse(parent,var(7) > 1, -18, -4)
p2sprpriority = 4
fall = 1
fall.recover = 0
fall.recovertime = 30
guard.dist = 600


[state 4541, parentvaradd]
type = parentvaradd
trigger1 = movehit
var(7) = -1
ignorehitpause = 1
persistent = 0

[state 4541, targetstate]
type = targetstate
trigger1 = movehit
trigger1 = hitpausetime = 13
trigger1 = parent,var(7) > 0
ignorehitpause = 1
value = 675

[state 4541, sprpriority]
type = sprpriority
trigger1 = animelemtime(4) =0
value = 3

[STATE 4541, SND]
type = playsnd
trigger1 = animelemtime(14) = 0
value = S4541,0

[State 0, DisplayToClipboard]
type = DisplayToClipboard
trigger1 = 1
text = "Twiggi distance from Eliza  X: %d  Y: %d"
params = parentdist x, parentdist y
ignorehitpause = 1
persistent = 1

[state 4541, change animation]
type = changestate
triggerall = animelemtime(7) = 0
trigger1 = parentdist x < -625  || parentdist x > 0 || parentdist y < -300
trigger2 = parent,statetype = L
trigger3 = parent,movetype = H && parent,stateno != [120,159]
value = 4542

[state 4541, explod spray]
type = explod
trigger1 = animelemtime(14) >= 0 && animelemtime(15) < 0
anim = 4302
removetime = 18
scale = const(size.xscale)*0.1, const(size.yscale)*0.1
postype = p1
pos = -380,-460
persistent = 1
vel = -12,12-(random%14)
sprpriority = 1


[state 4541, Not Active]
type = statetypeset
trigger1 = animelemtime(5) = 0
movetype = I


[state 4541, exit]
type = changestate
trigger1 = animtime = 0
value =  4505

;-------------------------------------------------------------------------
;leave early state
[statedef 4542]
type = S
movetype = A
physics = S

[state 4542, nothitby]
type = nothitby
trigger1 = 1
value = ,AT
persistent =1 
ignorehitpause = 1

[state 4542, anim]
type = changeanim
trigger1 = time = 0
value = 4582
elem = 7

[state 4531, Same state]
type = HitOverride
trigger1 = var(20) <= 0
attr = SCA,NA,SA,HA,NP,SP,HP        
stateno = 4610
time = 1
persistent = 1
ignorehitpause = 1



[state 4541, exit]
type = changestate
trigger1 = animtime = 0
value =  4505
;--------------------------------------------------------------------------
;Gethit Front
[Statedef 4600]
type = A
movetype = A
physics = N
anim = 4600
sprpriority = 4

[state 4500, damage]
type = parentvaradd
trigger1 = time = 0
V = 32
value = -gethitvar(damage)
persistent = 1

[state 4600, nothitby]
type = nothitby
trigger1 = 1
value = ,AT
ignorehitpause = 1
persistent = 1

[state 4600, screenbound]
type = screenbound
trigger1 = 1
value = 1
ignorehitpause = 1

[state 4600, nothitby]
type = nothitby
trigger1 = movehit
value = SCA
ignorehitpause = 1
persistent = 1
	
[state 4600, hitoverride]
type = HitOverride
trigger1 = 1
attr = SCA,AA,AP       
stateno = 4600
time = -1
ignorehitpause = 1
persistent = 1


[State 4600, 2]
type = velset
trigger1 = time = 0
y = -16
x = -8

[State 46000, Damage]
type = HitDef
trigger1 = !movecontact || !movereversed
persistent = 0
attr = A, SA
damage    = 240
guardflag = 
hitflag = MAF
affectteam = F
id = 4600
nochainid = 4600
priority = 3
pausetime = 0,0
sparkno = 3
givepower = 1000
sparkxy = 0,0
hitsound   = 5,4
guardsound = S120, 0
animtype = heavy
ground.type = high
ground.slidetime = ifelse(var(26) > 2, 0, 8*var(26))
ground.hittime  = ifelse(var(26) > 2, 0, 8*var(26))
ground.velocity = ifelse(var(26) = 2, -6, 0),ifelse(var(26) = 2, 4, 0)
air.velocity = ifelse(var(26) = 2, -6, 0),ifelse(var(26) = 2, 4, 0)
down.hittime = 60
guard.velocity = -28            
guard.hittime = 6*var(26)
guard.slidetime = 6*var(26)
airguard.velocity = -28,10
airguard.hittime = 35
guard.dist = 400
fall = ifelse(var(26) = 2, 1,0)
air.fall = ifelse(var(26) > 1, 1, 0)
fall.recover = 0
kill = 0
guard.kill = 0

;Ride down mechanic
[state 650, Ride down]
type = targetbind
trigger1 = movehit
pos = -20, -100

[state 650, state of ride down]
type = targetstate
trigger1 = movehit
value = 655
;----------------------------------------------

;[state 4520, crush]
;type = targetstate
;trigger1 = movehit
;trigger1 = p2statetype != A
;value = 660

[state 4600, gravity]
trigger1 = 1
type = veladd
y = 1.25

[state 4541, movereversed]
type = changestate
trigger1 = movereversed
value = 4600
ignorehitpause = 1
persistent = 1

[state 4600, end]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y 
value = 4601

;------------------------------------------------------------------------------
;Gethit Land 1
[statedef 4601]
type = L
movetype = A
physics = C
anim = 4601

[state 4601, nothitby]
type = nothitby
value = SCA
trigger1 = 1
ignorehitpause =1 

[state 4601, statetypeset]
type = statetypeset
trigger1 = animelem = 2
movetype = I


[state 4601, playsnd]
type = playsnd
trigger1 = time = 0
value = 4510,1
channel = 1

[state 4521, Dust 1]
type = explod
trigger1 = time = 0
anim = 2010
postype = p1
pos = 0,0
scale = 3,2.5
sprpriority = 5

[state 4521, Dust 1]
type = explod
trigger1 = time = 0
anim = 2011
postype = p1
pos = 0,0
scale = 3,2.5
sprpriority = -3

[State 4601, EnvShake]
type = EnvShake
trigger1 = time = 0
time = 16
freq = 60
ampl = -16
phase = 90
ignorehitpause = 1
persistent = 0


[state 4601, velset]
type = velset
trigger1 = time = 0
y = 0

[State 4601, Hitdef]
type = HitDef
trigger1 = Time = 0
attr = A, SA
damage    = 240
guardflag = 
hitflag = FD
Affectteam = F
nochainid = 4600
givepower = 1000
priority = 4
pausetime = 12,12
sparkno = 1
sparkxy = -10,-40
hitsound   = 5,3
guardsound = S120, 0
animtype = Med
p2stateno = 660
ground.type = High
ground.slidetime = 12
ground.hittime  = 15
ground.velocity = 0
air.velocity = 0,0
kill = 0

[state 4601, posset]
type = posset
trigger1 = time = 0
y = 0

[state 4601, bounce]
type = velset
trigger1 = animelemtime(3) = 0
y = -12

[state 4601, gravity]
type = veladd
trigger1 = animelemtime(3) > 0
y = 1.25

[state 4601, end]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 4602

;--------------------------------------------------------------------------------------------
;Front Gethit Land 2
[statedef 4602]
type = L
movetype = I
physics = C
anim = 4602

[state 4601, nothitby]
type = nothitby
value = SCA
trigger1 = 1
ignorehitpause =1

[state 4601, playsnd]
type = playsnd
trigger1 = time = 0
value = 4510,1
channel = 1

[State 4601, EnvShake]
type = EnvShake
trigger1 = time = 0
time = 12
freq = 60
ampl = -10
phase = 90
ignorehitpause = 1
persistent = 0

[state 4601, velset]
type = velset
trigger1 = time = 0
y = 0

[state 4601, posset]
type = posset
trigger1 = time = 0
y = 0

[state 4601, changestate]
type = changestate
trigger1 = animtime = 0
value = 4505



;--------------------------------------------------------------------------
;Gethit Back
[Statedef 4610]
type = A
movetype = A
physics = N
anim = 4610
sprpriority = 4

[state 4500, damage]
type = parentvaradd
trigger1 = time = 0
V = 32
value = -gethitvar(damage)
persistent = 1

[state 4610, nothitby]
type = nothitby
trigger1 = 1
value = ,AT
ignorehitpause = 1
persistent = 1

[state 4610, screenbound]
type = screenbound
trigger1 = 1
value = 1
ignorehitpause = 1

[state 4610, nothitby]
type = nothitby
trigger1 = movehit
value = SCA
ignorehitpause = 1
persistent = 1
	
[state 4610, hitoverride]
type = HitOverride
trigger1 = 1
attr = SCA,AA,AP      
stateno = 4610
time = -1
forceair = 0
ignorehitpause = 1
persistent = 1


[State 5030, 2]
type = velset
trigger1 = time = 0
y = -16
x = -8

[State 4520, Damage]
type = HitDef
trigger1 = !movecontact || !movereversed
persistent = 0
attr = A, SA
damage    = 160
guardflag = 
hitflag = MAF
affectteam = F
id = 4610
;nochainid = 4520
priority = 3
pausetime = 0,0
sparkno = 3
givepower = 1000
sparkxy = 0,0
hitsound   = 5,4
guardsound = S120, 0
animtype = heavy
ground.type = high
ground.slidetime = ifelse(var(26) > 2, 0, 8*var(26))
ground.hittime  = ifelse(var(26) > 2, 0, 8*var(26))
ground.velocity = ifelse(var(26) = 2, -6, 0),ifelse(var(26) = 2, 4, 0)
air.velocity = ifelse(var(26) = 2, -6, 0),ifelse(var(26) = 2, 4, 0)
down.hittime = 60
guard.velocity = -28            
guard.hittime = 6*var(26)
guard.slidetime = 6*var(26)
airguard.velocity = -28,10
airguard.hittime = 35
guard.dist = 400
fall = ifelse(var(26) = 2, 1,0)
air.fall = ifelse(var(26) > 1, 1, 0)
fall.recover = 0
kill = 0
guard.kill = 0

;Ride down mechanic
[state 650, Ride down]
type = targetbind
trigger1 = movehit
pos = -20, -100

[state 650, state of ride down]
type = targetstate
trigger1 = movehit
value = 655
;----------------------------------------------

;[state 4520, crush]
;type = targetstate
;trigger1 = movehit
;trigger1 = p2statetype != A
;value = 660

[state 4610, gravity]
trigger1 = 1
type = veladd
y = 1.25

[state 4541, movereversed]
type = changestate
trigger1 = movereversed
value = 4610
ignorehitpause = 1
persistent = 1

[state 4610, end]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y 
value = 4611

;------------------------------------------------------------------------------
;Gethit Land 1
[statedef 4611]
type = L
movetype = A
physics = C
anim = 4611

[state 4611, nothitby]
type = nothitby
value = SCA
trigger1 = 1
ignorehitpause =1 

[state 4601, statetypeset]
type = statetypeset
trigger1 = animelem = 2
movetype = I

[state 4611, playsnd]
type = playsnd
trigger1 = time = 0
value = 4510,1
channel = 1

[State 4611, EnvShake]
type = EnvShake
trigger1 = time = 0
time = 16
freq = 60
ampl = -16
phase = 90
ignorehitpause = 1
persistent = 0

[state 4521, Dust 1]
type = explod
trigger1 = time = 0
anim = 2010
postype = p1
pos = 0,0
scale = 3,2.5
sprpriority = 5

[state 4521, Dust 1]
type = explod
trigger1 = time = 0
anim = 2011
postype = p1
pos = 0,0
scale = 3,2.5
sprpriority = -3


[state 4611, velset]
type = velset
trigger1 = time = 0
y = 0

[State 4611, Hitdef]
type = HitDef
trigger1 = Time = 0
attr = A, SA
damage    = 160
guardflag = 
hitflag = FD
Affectteam = F
nochainid = 4610
givepower = 1000
priority = 4
pausetime = 12,12
sparkno = 1
sparkxy = -10,-40
hitsound   = 5,3
guardsound = S120, 0
animtype = Med
p2stateno = 660
ground.type = High
ground.slidetime = 12
ground.hittime  = 15
ground.velocity = 0
air.velocity = 0,0
kill = 0

[state 4611, posset]
type = posset
trigger1 = time = 0
y = 0

[state 4611, bounce]
type = velset
trigger1 = animelemtime(4) = 0
y = -12

[state 4611, gravity]
type = veladd
trigger1 = animelemtime(4) > 0
y = 1.25

[state 4611, end]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 4612

;--------------------------------------------------------------------------------------------
;Gethit Land 2
[statedef 4612]
type = L
movetype = I
physics = C
anim = 4612

[state 4611, nothitby]
type = nothitby
value = SCA
trigger1 = 1
ignorehitpause =1

[state 4611, playsnd]
type = playsnd
trigger1 = time = 0
value = 4510,1
channel = 1

[State 4611, EnvShake]
type = EnvShake
trigger1 = time = 0
time = 12
freq = 60
ampl = -10
phase = 90
ignorehitpause = 1
persistent = 0

[state 4611, velset]
type = velset
trigger1 = time = 0
y = 0

[state 4611, posset]
type = posset
trigger1 = time = 0
y = 0

[state 4611, turn]
type = turn
trigger1 = animtime = 0


[state 4611, changestate]
type = changestate
trigger1 = animtime = 0
value = 4523
;---------------------------------------------------------------------------
;Hud display
[statedef 4900]
type = A
movetype = I
physics = N
anim = 9999
ctrl = 0

[state 4900, value]
type = varset
trigger1 = 1
fvar(32) = root,var(32)
ignorehitpause = 1
persistent = 1

[state 4900, value]
type = varset
trigger1 = 1
fvar(34) = root,var(34)
ignorehitpause = 1
persistent = 1

[state 0, varset]
type = varset
trigger1 = time = 0
var(0) = 0

[State 0, VarSet]
type = Varadd
trigger1 = numpartner
trigger1 = partner,name = "Katrina Crocodile"
var(0) = 75
persistent = 0

;Eliza health Bar
[state 4900, Icon]
type = explod
trigger1 = !numexplod(4900)
anim = 4900
id = 4900
postype = left
facing = ifelse(teamside = 1,1,-1)
pos = ifelse(teamside = 1, 12, 1268),(130 + var(0)) ;ifelse(teamside =1, (gamewidth0.01),(gamewidth0.99)),floor((gameheight0.18))
sprpriority = 5
OWNPAL = 1
bindtime = -1
removetime = -1



[state 4900, HP BAR]
type = explod
trigger1 = !numexplod(4910)
anim = 4910
id = 4910
postype = left
facing = ifelse(teamside = 1,1,-1)
pos = ifelse(teamside = 1, 102, 1178),(158 + var(0)) ;ifelse(teamside =1,(gamewidth0.08),(gamewidth0.92)),floor((gameheight0.22))
scale = 2, 2
sprpriority = 5
ownpal = 1
removetime = -1
bindtime = -1

[state 4900, HP BAR empty]
type = explod
trigger1 = !numexplod(4911)
anim = 4911
id = 4911
postype = left
facing = ifelse(teamside = 1,1,-1)
pos = ifelse(teamside = 1, 102, 1178),(158 + var(0)) ;ifelse(teamside =1,(gamewidth0.08),(gamewidth0.92)),floor((gameheight0.22))
Scale = 2,2
sprpriority = 5
ownpal = 1
bindtime = -1
removetime = -1

[state 4900, modifier HP bar]
type = modifyexplod
trigger1 = numexplod(4910)
id = 4910
anim = 4910
scale = ifelse(fvar(32)>0,((fvar(32)*1)/(fvar(34)*1))*2,0) , 2
postype = left
pos = ifelse(teamside = 1, 102, 1178),(158 + var(0))



;Alert
;[state 4900, alert]
;type = explod
;trigger1 = root,var(29) = 3
;trigger1 = numexplod(4920) = 0
;trigger1 = root,var(32) > 0
;anim = 4920
;id = 4920
;postype = left
;facing = ifelse(teamside = 1,1,1)
;pos = ifelse(teamside = 1, 192, 1024),130 ;ifelse(teamside =1,(gamewidth*0.15),(gamewidth*0.80)),floor((gameheight*0.18))
;scale = 1,1
;ontop = 1
;ownpal = 1
;removetime = -1

;[state 4900, remove]
;type = removeexplod
;trigger1 = root,var(29) < 3
;id = 4920
;persistent = 1

;==========================================================================
;[Info]
;author = "Inktrebuchet" 
;versiondate = 12/13/2018                  
;goal = Detect enemy projectile (helper). For use with AI. ( M.U.G.E.N | IKEMEN )
;       敵の発射物（helper）を検出する。 AIで使用する場合。
;==========================================================================
;                Notes
;==========================================================================
;notes:
;-Enemy projectile now has a PlayerID use PlayerID(helper(33333333),var(3)) as a redirect.
;
;base examples of trigger use: 
;
;;Enemy projectile helper distance from character.
;trigger1 = PlayerIDExist(helper(33333333),var(3))
;trigger1 = PlayerID(helper(33333333),var(3)), p2bodydist x 
;
;;Enemy projectile helper velocity.
;trigger1 = PlayerIDExist(helper(33333333),var(3))
;trigger1 = PlayerID(helper(33333333),var(3)), Vel X
;
;==========================================================================
;                Helper var usage.
;==========================================================================
; numhelper(33333333) Variable usage:
; This is a record of the variables that are used
;
; var(0) - highest playerid + 1
; var(3) - projectile player id while it exists
; 
;==========================================================================
[Statedef 33333333]
type = A
movetype = I
physics = N
ctrl = 0
velset = 0, 0
 
;==========================================================================
;                Config Section
;==========================================================================
anim = 9999                   ; blank animation
 
;==========================================================================
[state 33333333, Clipboard] 
type = DisplayToClipboard
trigger1 = 1
text = "Highest Playerid = %d , Projectile helper's PlayerId = %d\nBy Inktrebuchet"
params = var(0)-1, var(3)
 
;==========================================================================
;                Detect Enemy Projectile Helper
;==========================================================================
[State 33333333, 0]
type = Null
trigger1 = var(0) = 0
trigger1 = (var(0) := id)
ignorehitpause = 1
 
[state 33333333, 1] 
type = varadd
trigger1 = PlayerIdExist(var(0)) 
trigger2 = PlayerIdExist(var(0)+1) 
trigger3 = PlayerIdExist(var(0)+2) 
trigger4 = PlayerIdExist(var(0)+3) 
trigger5 = PlayerIdExist(var(0)+4) 
trigger6 = PlayerIdExist(var(0)+5) 
trigger7 = PlayerIdExist(var(0)+6) 
trigger8 = PlayerIdExist(var(0)+7) 
trigger9 = PlayerIdExist(var(0)+8) 
trigger10 = PlayerIdExist(var(0)+9) 
trigger11 = PlayerIdExist(var(0)+10) 
trigger12 = PlayerIdExist(var(0)+11) 
trigger13 = PlayerIdExist(var(0)+12) 
trigger14 = PlayerIdExist(var(0)+13) 
trigger15 = PlayerIdExist(var(0)+14) 
trigger16 = PlayerIdExist(var(0)+15) 
trigger17 = PlayerIdExist(var(0)+16) 
trigger18 = PlayerIdExist(var(0)+17) 
trigger19 = PlayerIdExist(var(0)+18) 
trigger20 = PlayerIdExist(var(0)+19) 
trigger21 = PlayerIdExist(var(0)+20) 
trigger22 = PlayerIdExist(var(0)+21) 
trigger23 = PlayerIdExist(var(0)+22) 
trigger24 = PlayerIdExist(var(0)+23) 
trigger25 = PlayerIdExist(var(0)+24) 
trigger26 = PlayerIdExist(var(0)+25) 
v = 0
value = 1
ignorehitpause = 1
 
[State 33333333, 2]
type = Null
triggerall = PlayerIdExist(Root,ID)
trigger1 = PlayerIdExist(var(0)-1)
trigger1 = IfElse(root,teamside = 1, PlayerID(var(0)-1),teamside = 2, PlayerID(var(0)-1),teamside = 1)
trigger1 = PlayerID(var(0)-1),hitdefattr = ASC, NP, SP, HP
trigger1 = var(3) := (var(0)-1)
trigger2 = PlayerIdExist(var(0)-2)
trigger2 = IfElse(root,teamside = 1, PlayerID(var(0)-2),teamside = 2, PlayerID(var(0)-2),teamside = 1)
trigger2 = PlayerID(var(0)-2),hitdefattr = ASC, NP, SP, HP
trigger2 = var(3) := (var(0)-2)
trigger3 = PlayerIdExist(var(0)-3)
trigger3 = IfElse(root,teamside = 1, PlayerID(var(0)-3),teamside = 2, PlayerID(var(0)-3),teamside = 1)
trigger3 = PlayerID(var(0)-3),hitdefattr = ASC, NP, SP, HP
trigger3 = var(3) := (var(0)-3)
trigger4 = PlayerIdExist(var(0)-4)
trigger4 = IfElse(root,teamside = 1, PlayerID(var(0)-4),teamside = 2, PlayerID(var(0)-4),teamside = 1)
trigger4 = PlayerID(var(0)-4),hitdefattr = ASC, NP, SP, HP
trigger4 = var(3) := (var(0)-4)
trigger5 = PlayerIdExist(var(0)-5)
trigger5 = IfElse(root,teamside = 1, PlayerID(var(0)-5),teamside = 2, PlayerID(var(0)-5),teamside = 1)
trigger5 = PlayerID(var(0)-5),hitdefattr = ASC, NP, SP, HP
trigger5 = var(3) := (var(0)-5)
trigger6 = PlayerIdExist(var(0)-6)
trigger6 = IfElse(root,teamside = 1, PlayerID(var(0)-6),teamside = 2, PlayerID(var(0)-6),teamside = 1)
trigger6 = PlayerID(var(0)-6),hitdefattr = ASC, NP, SP, HP
trigger6 = var(3) := (var(0)-6)
trigger7 = PlayerIdExist(var(0)-7)
trigger7 = IfElse(root,teamside = 1, PlayerID(var(0)-7),teamside = 2, PlayerID(var(0)-7),teamside = 1)
trigger7 = PlayerID(var(0)-7),hitdefattr = ASC, NP, SP, HP
trigger7 = var(3) := (var(0)-7)
trigger8 = PlayerIdExist(var(0)-8)
trigger8 = IfElse(root,teamside = 1, PlayerID(var(0)-8),teamside = 2, PlayerID(var(0)-8),teamside = 1)
trigger8 = PlayerID(var(0)-8),hitdefattr = ASC, NP, SP, HP
trigger8 = var(3) := (var(0)-8)
trigger9 = PlayerIdExist(var(0)-9)
trigger9 = IfElse(root,teamside = 1, PlayerID(var(0)-9),teamside = 2, PlayerID(var(0)-9),teamside = 1)
trigger9 = PlayerID(var(0)-9),hitdefattr = ASC, NP, SP, HP
trigger9 = var(3) := (var(0)-9)
trigger10 = PlayerIdExist(var(0)-10)
trigger10 = IfElse(root,teamside = 1, PlayerID(var(0)-10),teamside = 2, PlayerID(var(0)-10),teamside = 1)
trigger10 = PlayerID(var(0)-10),hitdefattr = ASC, NP, SP, HP
trigger10 = var(3) := (var(0)-10)
ignorehitpause = 1
 
[State 33333333, BindToRoot]
type = BindToRoot
trigger1 = PlayerIdExist(Root,ID)
time = 1
facing = 1
pos =0,-2
ignorehitpause = 1 

;---------------------------------------------------------------------------
; Override common states (use same number to override) :
;---------------------------------------------------------------------------

;---------------------------------------------------------------------------
; States that are always executed (use statedef -2)
;---------------------------------------------------------------------------
[statedef -2]

;bodyblock
[state -2, bodyblock]
type = nothitby
triggerall = numhelper(4500)
triggerall = helper(4500),stateno = 4500
trigger1 = helper(4500),parentdist x = [-350,60]  
trigger1 = helper(4500),parentdist y = [-120,0]
value = ,AA,AP
time = 4
ignorehitpause = 1

[state -2, copyright]
type = displaytoclipboard 
trigger1 = numhelper(4500)
params = helper(4500),parentdist x, helper(4500),parentdist y, var(20) 
text = "Eliza Distance X: %d, Y: %d , Eliza Armor HP: %d"
;text = "Twiggi Bunny is (c) Kazecat 2019"

[state -2, First Aid Spray]
type = lifeadd
triggerall = numhelper(4500)
triggerall = helper(4500),parentdist x = [-725,100]
triggerall = helper(4500),parentdist y = [-300,0]
trigger1 = helper(4500),stateno = 4541
trigger1 = helper(4500),animelemtime(14) >= 0 && helper(4500),animelemtime(15) < 0
trigger1 = (movetype != H)  || (movetype = H && stateno = [120,159])
value = 5 ;80 HP
ignorehitpause = 0
persistent = 1

[state -2, First Aid Spray]
type = poweradd
triggerall = numhelper(4500)
triggerall = helper(4500),parentdist x = [-725,100]
triggerall = helper(4500),parentdist y = [-300,0]
trigger1 = helper(4500),stateno = 4541
trigger1 = helper(4500),animelemtime(14) >= 0 && helper(4500),animelemtime(15) < 0
trigger1 = (movetype != H)  || (movetype = H && stateno = [120,159])
value = 12 ;320 MP
ignorehitpause = 0
persistent = 1


[state -2, copyright]
type = null; displaytoclipboard
trigger1 = 1
params = p2bodydist x, p2bodydist y, pos y, var(20) 
text = "Distance X: %d, Y: %d  pos y is %f, Eliza Armor HP: %d"
;text = "Twiggi Bunny is (c) Kazecat 2019"


;====================================================
; Victory quotes
;====================================================
[state -2, win quotes]
type = victoryquote
trigger1 = 1
value = 1+(random%6)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Jumbo Elephant"
value = 8+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Ana 'Jiggly' Bunny"
value = 11+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Bertha Hippo"
value = 14+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Katrina Crocodile"
value = 17+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Enorma Pig"
value = 20+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Aroma Skunk"
value = 23+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Lardo Rat"
value = 26+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Zafta Giraffe"
value = 29+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Makuyama"
value = 32+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Pastilla Skunk"
value = 35+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Jumba Elephant"
value = 38+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Twiggi Bunny"
value = 41+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Ra Lord"
value = 44+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Violet 'Tyla' Bunny"
value = 47+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Battu Tri-red"
value = 50+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Julian Hippo"
value = 53+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Rapid Bunny"
value = 56+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Akai R. Panda"
value = 59+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Noah Sharker"
value = 62+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Andy Armadillo"
value = 65+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Montana Moth"
value = 68+(random%3)
ignorehitpause
persistent = 1

[state -2, win quote]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Texas Stanton"
value = 71+(random%3)
ignorehitpause
persistent = 1




;====================================================
;combo Scaling
;====================================================

;[state -2, helper SD]
;type = changestate
;triggerall = numhelper(4500)
;trigger1 = helper(4500),stateno = 0
;trigger2 = helper(4500),stateno = 5030
;ignorehitpause = 1
;value = 4610

[State -2, attack scaling]
type = attackMulSet
trigger1 = 1
value = fvar(10) * fvar(35)
ignorehitpause = 1

[state -2, combo points]
type = varset
trigger1 = numenemy
trigger1 = (enemynear, movetype != H)
trigger2 = !numenemy
ignorehitpause = 1
v = 18
value = 100

[state -2, gradual lowering]
type= varset
trigger1 =  var(18) >= 100
fvar(10) = 1

[state -2, gradual lowering]
type= varset
trigger1 = var(18) < 100 && var(18) >= 90
fvar(10) = 0.9
ignorehitpause = 1

[state -2, gradual lowering]
type= varset
trigger1 = var(18) < 90 && var(18) >= 80
fvar(10) = 0.8
ignorehitpause = 1

[state -2, gradual lowering]
type= varset
trigger1 = var(18) < 80 && var(18) >= 70
fvar(10) = 0.7
ignorehitpause = 1

[state -2, gradual lowering]
type= varset
trigger1 = var(18) < 70 && var(18) >= 60
fvar(10) = 0.6
ignorehitpause = 1

[state -2, gradual lowering]
type= varset
trigger1 = var(18) < 60 && var(18) >= 50
fvar(10) = 0.5
ignorehitpause = 1

[state -2, gradual lowering]
type= varset
trigger1 = var(18) < 50 && var(18) >= 40
fvar(10) = 0.4
ignorehitpause = 1

[state -2, gradual lowering]
type= varset
trigger1 = var(18) < 40 && var(18) >= 30
fvar(10) = 0.3
ignorehitpause = 1

[state -2, gradual lowering]
type= varset
trigger1 = var(18) < 30 && var(18) >= 20
fvar(10) = 0.2
ignorehitpause = 1

[state -2, gradual lowering]
type= varset
trigger1 = var(18) < 20 && var(18) >= 10
fvar(10) = 0.1
ignorehitpause = 1

[state -2, gradual lowering]
type= varset
trigger1 = var(18) < 10
fvar(10) = 0.05
ignorehitpause = 1

; Combo Inhibitors
[state -2, Jumping HP limiter for infinites]
type = varset
triggerall = numenemy
trigger1 = enemy,movetype != H
var(29) = 3
ignorehitpause = 1

[state -2, Air Jump Counter]
type = varset
trigger1 = stateno = 0  || stateno = 52
var(4) = const(movement.airjump.num)
ignorehitpause = 1

[state -2, Flip/slide Kick limiter]
type = varset
triggerall = numenemy
trigger1 = (enemynear, movetype != H)
var(6) = 2
ignorehitpause = 1

[state -2, Wall bounce limiter]
type = varset
triggerall = numenemy
trigger1 = (enemynear, movetype != H)
var(7) = 2
ignorehitpause = 1

[state -2, Ground Bounce limiter]
type = varset
triggerall = numenemy
trigger1 = (enemynear, movetype != H)
var(8) = 2
ignorehitpause = 1

[state -2, Launcher limiter]
type = varset
triggerall = numenemy
trigger1 = (enemynear, movetype != H)
var(11) = 2
ignorehitpause = 1

[state -2, teleport limiter]
type = varset
trigger1 = var(14) != 3
trigger1 = statetype = S || statetype = C
var(14) = 2
ignorehitpause = 1

[state -2, teleport limiter]
type = varset
triggerall = numenemy
trigger1 = (enemynear,movetype != H)
var(15) = 0
ignorehitpause = 1

;===============================================================================
; Simple Counter
;===============================================================================

[state -2, counter]
type = varset
trigger1 = numhelper(4500)
trigger1 = helper(4500),gethitvar(damage) != 0
v = 31
value = 0
ignorehitpause = 1

[state -2, count up]
type = varadd
trigger1 = numhelper(4500)
trigger1 = var(31) < var(33)
v = 31
value = 1
ignorehitpause = 0

[state -2, delay conter set]
type = varset
trigger1 = numhelper(4500)
trigger1 = 1
v = 33
value = 180


;===========================================================================
;Eliza Hud
;===========================================================================
[state -2, helper]
type = helper
triggerall = roundstate = 2
trigger1 = !numhelper(4900)
name = "Eliza Hud"
helpertype = normal
stateno = 4900
postype = p1
pos = 0,0
id = 4900
persistent = 300
ignorehitpause = 1

[state -2, Eliza healing]
type = varadd
triggerall = !numhelper(4500)
triggerall = roundstate = 2
triggerall = var(32) > 0
trigger1 = gametime%60 = 5
trigger1 = var(32) < var(34)
v = 32
value = 4 

[state -2, Twiggi calm]
type = varset
trigger1 = var(32) >=  floor(var(34)/2)
value = 1
fv = 35

[state -2, Twiggi Angry]
type = varset
trigger1 = var(32) <  floor(var(34)/2)
value = 1.25
fv = 35

[state -2, Twiggi Pissed]
type = varset
trigger1 = var(32) <= 0
value = 2
fv = 35

;==========================================================================
;Remove Explods
;==========================================================================

;Light Beam
[state 1001, removeexplod]
type = removeexplod
triggerall = numexplod(4000)
trigger1 = stateno != [1000,1001] 
id = 4000
ignorehitpause = 1

[state 1001, removeexplod]
type = removeexplod
triggerall = numexplod(4001)
trigger1 = stateno != [1000,1001]
id = 4001

[state 1001, removeexplod]
type = removeexplod
triggerall = numexplod(4002)
trigger1 = stateno != [1000,1001]
id = 4002

; Heavy Beam
[state 1001, removeexplod]
type = removeexplod
triggerall = numexplod(4010)
trigger1 = stateno != [1010,1011]
id = 4010

[state 1001, removeexplod]
type = removeexplod
triggerall = numexplod(4011)
trigger1 = stateno != [1010,1011]
id = 4011

[state 1001, removeexplod]
type = removeexplod
triggerall = numexplod(4012)
trigger1 = stateno != [1010,1011]
id = 4012

;[state -2, helper error]
;type = destroyself
;triggerall = numhelper(4500)
;trigger1 = helper(4500),stateno = 5100
;trigger2 = helper(4500),stateno = 0
;trigger3 = helper(4500),stateno = [3000,3999]
;ignorehitpause = 1
;persistent = 1

;---------------------------------------------------------------------------
; States that are executed when in self's state file (use statedef -3)
;---------------------------------------------------------------------------

[Statedef -3]

[state -3, AI Detect Projectile System]
type = helper
trigger1 = ailevel ;M.U.G.E.N 1.0+
;trigger1 = var(59) = 1 ;M.U.G.E.N below 1.0 that uses Winane's AI Activation Method.
trigger1 = !numhelper(33333333)
name = "AI Detect Projectile System"
ID = 33333333
stateno = 33333333
postype = p1
ownpal = 1
keyctrl = 0
size.xscale = 1.0
size.yscale = 1.0
supermovetime = 2147483647
pausemovetime = 2147483647
ignorehitpause = 1

;This controller plays a sound everytime KFM lands from a jump, or
;from his back-dash.
[State -3, Landing Sound]
type = PlaySnd
triggerall = Time = 1
trigger1 = stateno = 52 ;Jump land
trigger2 = stateno = 106 ;Run-back land
value = 40, 0

[state -3, gravity]
type = gravity
trigger1 = stateno = 5620
trigger1 = time > 0

[state -3, land]
type = changestate
triggerall = stateno = 5620
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 52
