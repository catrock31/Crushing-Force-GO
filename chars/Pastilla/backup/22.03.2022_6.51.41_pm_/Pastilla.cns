
; KFM's constants and state file.
; There are comments scattered through this file, so you may like to
; take a look if would like to learn more about the cns.

[Data]
;Amount of life to start with
life = 1000
power = 5000
;attack power (more is stronger)
attack = 100
;defensive power (more is stronger)
defence = 100
;Percentage to increase defense everytime player is knocked down
fall.defence_up = 50
;Time which player lies down for, before getting up
liedown.time = 60
;Number of points for juggling
airjuggle = 40
;Default hit spark number for HitDefs
sparkno = 2
;Default guard spark number
guard.sparkno = 40
;1 to enable echo on KO
KO.echo = 0
;Volume offset (negative for softer)
volume = 0
;Variables with this index and above will not have their values
;reset to 0 between rounds or matches. There are 60 int variables,
;indexed from 0 to 59, and 40 float variables, indexed from 0 to 39.
;If omitted, then it defaults to 60 and 40 for integer and float
;variables repectively, meaning that none are persistent, i.e. all
;are reset. If you want your variables to persist between matches,
;you need to override state 5900 from common1.cns.
IntPersistIndex = 60
FloatPersistIndex = 40

[Size]
xscale = 1.1           ;Horizontal scaling factor.
yscale = 1.1           ;Vertical scaling factor.
ground.back = 340    ;Player width (back, ground)
ground.front = 60    ;Player width (front, ground)
air.back = 200        ;Player width (back, air)
air.front = 65      ;Player width (front, air)
height = 240          ;Height of player (for opponent to jump over)
attack.dist = 640    ;Default attack distance
proj.attack.dist = 360 ;Default attack distance for projectiles
proj.doscale = 0     ;Set to 1 to scale projectiles too
head.pos = -6, -420   ;Approximate position of head
mid.pos = 16, -232    ;Approximate position of midsection
shadowoffset = 0     ;Number of pixels to vertically offset the shadow
draw.offset = 0,0    ;Player drawing offset in pixels (x, y). Recommended 0,0

[Velocity]
walk.fwd  = 6.5      ;Walk forward
walk.back = -5.5     ;Walk backward
run.fwd  = 22, 0    ;Run forward (x, y)
run.back = -15,-8 ;Hop backward (x, y)
jump.neu = 0,-28    ;Neutral jumping velocity (x, y)
jump.back = -7   ;Jump back Speed (x, y)
jump.fwd = 7       ;Jump forward Speed (x, y)
runjump.back = -2.55,-8.1 ;Running jump speeds (opt)
runjump.fwd = 12,-8.1      ;.
airjump.neu = 0,-26      ;.
airjump.back = -8      ;Air jump speeds (opt)
airjump.fwd = 8         ;.
air.gethit.groundrecover = -.15,-3.5  ;Velocity for ground recovery state (x, y) **MUGEN 1.0**
air.gethit.airrecover.mul = .5,.2     ;Multiplier for air recovery velocity (x, y) **MUGEN 1.0**
air.gethit.airrecover.add = 0,-4.5    ;Velocity offset for air recovery (x, y) **MUGEN 1.0**
air.gethit.airrecover.back = -1       ;Extra x-velocity for holding back during air recovery **MUGEN 1.0**
air.gethit.airrecover.fwd = 0         ;Extra x-velocity for holding forward during air recovery **MUGEN 1.0**
air.gethit.airrecover.up = -2         ;Extra y-velocity for holding up during air recovery **MUGEN 1.0**
air.gethit.airrecover.down = 2      ;Extra y-velocity for holding down during air recovery **MUGEN 1.0**

[Movement]
airjump.num = 0       ;Number of air jumps allowed (opt)
airjump.height = 35   ;Minimum distance from ground before you can air jump (opt)
yaccel = 1.25          ;Vertical acceleration
stand.friction = .80  ;Friction coefficient when standing
crouch.friction = .78 ;Friction coefficient when crouching
stand.friction.threshold = 2          ;If player's speed drops below this threshold while standing, stop his movement **MUGEN 1.0**
crouch.friction.threshold = .05       ;If player's speed drops below this threshold while crouching, stop his movement **MUGEN 1.0**
air.gethit.groundlevel = 25           ;Y-position at which a falling player is considered to hit the ground **MUGEN 1.0**
air.gethit.groundrecover.ground.threshold = -20 ;Y-position below which falling player can use the recovery command **MUGEN 1.0**
air.gethit.groundrecover.groundlevel = 10   ;Y-position at which player in the ground recovery state touches the ground **MUGEN 1.0**
air.gethit.airrecover.threshold = -1  ;Y-velocity above which player may use the air recovery command **MUGEN 1.0**
air.gethit.airrecover.yaccel = 1.25    ;Vertical acceleration for player in the air recovery state **MUGEN 1.0**
air.gethit.trip.groundlevel = 15      ;Y-position at which player in the tripped state touches the ground **MUGEN 1.0**
down.bounce.offset = 0, 20            ;Offset for player bouncing off the ground (x, y) **MUGEN 1.0**
down.bounce.yaccel = 1.25              ;Vertical acceleration for player bouncing off the ground **MUGEN 1.0**
down.bounce.groundlevel = 12          ;Y-position at which player bouncing off the ground touches the ground again **MUGEN 1.0**
down.friction.threshold = .05         ;If the player's speed drops below this threshold while lying down, stop his movement **MUGEN 1.0**

;Default language victory quotes (optional).  **MUGEN 1.0**
;If this section is included, the default language victory quotes must be in English.
[Quotes]
; Up to 100 victory quotes can be specified per language (victory0 - victory99)
victory1 = "You must defeat your own sense of smell to stand a chance against us!"
victory2 = "On your tombstone its gonna say you ate ass in the worst way possible and died."
victory3 = "Our poisons are unparalleled, you never stood a chance."
victory4 = "Now what should we subject you to? Shall we crush you under our weight, or befoul you with gas?"
victory5 = "Bad mouth our body again, and you'll need a machine to breathe for you!"
victory6 = "Breathe it all in... Such potent fumes shouldn't go to waste."
victory7 = "With the powers we command, it's no wonder you couldn't compete!"

; Jumbo Elephant
Victory8 = "We've seen glaciers move faster than you! You'll never escape our gasses with such pitiful speed."
Victory9 = "Magic and poison don't care how big you are, you will fall just like the rest."
Victory10 = "Remember this moment, elephant. Your impressive strength was helpless against our magic and poison!"

; Jiggly Bunny
Victory11 = "We've never seen a big girl move like you do... Shame you can't outrun our gasses."
Victory12 = "Oh the potency of poisons... Your bothersome speed will always be outclassed by us!"
Victory13 = "We must be testing your speed with our vast array of magic and poisons, hmm?"

; Katrina Crocodile
Victory14 = "That was an enjoyable two-on-two match up."
Victory15 = "Your teeth are quite intimidating, but our poisons and spells have you outmatched!"
Victory16 = "We may have wiped the floor with you, but we can't help but admire your excessively large chest... "

; Bertha Hippo
Victory17 = "We are half hippo, are hippos really supposed to get that big?"
Victory18 = "What power is behind your gigantic ass? Are you a magic user as well?"
Victory19 = "We don't know how you ignore flinching from our attacks by spinning, and it's quite annoying."

;Aroma Skunk
Victory20 = "Don't you dare try to take some moral high ground! You poison your enemies just as we do!"
Victory21 = "Normally skunks don't gas each other, but for you? We are willing to make an exception."
Victory22 = "Our gasses reach is far more potent than yours!"

;Enorma Pig
Victory23 = "What the hell is with the guns? You're far worse than that petty skunk."
victory24 = "Your arsenal cannot compare to the firepower we bring!"
victory25 = "Your tactics bore us. Anyone can pick up a gun, not everyone can use magic."

;Lardo Rat
Victory26 = "You're quite fast for a slob! Unfortunately for you, your speed cannot escape our abilities."
Victory27 = "Enjoy that tremendous dosage of poison for trying to eat us!"
Victory28 = "We may have an affinity for gassing, but we still don't reek like you! Go take a shower!"

;Zafta Giraffe
Victory29 = "Your long legs have failed to save you, thunder thighs!"
victory30 = "Don't make us come up there ever again!"
victory31 = "Not even your height can escape from our toxic gasses!"

;Makuyama
Victory32 = "Pandas are supposed to be cute, not intimidating. Yet your attacks and techniques say otherwise."
victory33 = "Your appearance is deceiving... The looks of a panda, the power of a kodiak."
victory34 = "How did that keen sense of smell work out for you, panda?"

; Jumba
Victory38 = "An elephant ninja? Curious."
victory39 = "You're going to have to get past spells and poisons to get to us!"
victory40 = "Not so confident when we've shrunken you down, are you?"

; Twiggi
Victory41 = "You were cursed, hmm? We commend you for not having it hold you back."
Victory42 = "Your reach with your spells is amazing! We wouldn't mind trading spells with you."
victory43 = "We may have vastly different body shapes, but you aren't so different from us."

; Ra Lord
victory44 = "Your projectile reflection trick could serve use to us.. After you recover, we should share techniques."
victory45 = "Our hippo hide is too thick for your fangs to penetrate!"
Victory46 = "There is nowhere you can position yourself where we can't punish you!"

; Violet Bunny
Victory47 = "I have a friend who would love to swap bodies with you... Now hold still for a moment."
victory48 = "You can't defeat us with simple tricks like yours!"
victory49 = "You had two minds bent on beating you, no trickery can save you from us!" 

; Battu
Victory50 = "If your tech is capable of fixing our predicament, you had best start talking before we suffocate you!"
victory51 = "I don't know what you are, but taking your tech will lead us to more power and knowledge! Be seeing you, rodent."
victory52 = "A bounty hunter, hmm? The only bounty you'll be getting is our nauseating stench!"

; Julian
victory53 = "Another hippo? Perhaps we could salvage one of our halves by transferring to your body..."
victory54 = "We find your shrunken size to be much more manageable; we suggest you get used to it."
victory55 = "Leave this battle knowing to never challenge me again." 

;Rapid
victory56 = "Where were heroes like you when I was mutilated, and where is my justice!?"
victory57 = "Your optimisim is misplaced and your speed won't help you against my poison."
victory58 = "Your strikes are mearly an annoyance and my magic will find you no mater where you run."

;Noah
victory59 = "For demons you guys aren't doing much to make me worried."
victory60 = "I gotta simple magic trick for ya, wanna see me make this small shark boi disappear?"
victory61 = "That burning sensation in your lungs from my gas will give you something to remember me by."

;Akai
victory62 = "I have no quarrel with you fem boy panda.  You were just in my way."
victory63 = "I don't know who you are but damn do you have an ass on you."
Victory64 = "Super speed and mass is pretty dangerous.  Still Magic and poison beats it."

;Andy
Victory65 = "Magic is just Science that isn't understood.  You should keep an open mind about it."
victory66 = "You're armor is no match for the melting effect of our poison.  You will fall just like everyone else."
victory67 = "You're armor handles my magic quite well.  I assume you've done research into magic defense."

;Montana
Victory68 = "Fighting against you is a pleasure, you got style and can teach me a few things."
victory69 = "You're gas is potent, but not poisonous.  For that you will not be able to keep up with mine."
Victory70 = "Wow, you're only a moth and yet so heavy and agile in the skies. That's really impressive."

;Texas
victory71 = "I don't want justice!  I want revenge for what they caused me!"
Victory72 = "I don't know who this Molly is but if her voodoo scares you so much then she's alright with me...You know what, I think I'll look her up next."
Victory73 = "You've been crushed by the massive ass of a hippo armed with the stink of a skunk.  I know what handled in Gold Springs but I want to know you've been crushed by the best." 

;Mirror Match
Victory35 = "What manner of sorcery duplicated us?"
victory36 = "We are irreplaceable, and we will not be insulted by some fake!"
Victory37 = "Suppose the only skunk hippo hybrid we'd run into would be ourselves." 
;Alternate language victory quotes (optional).
;0 or more alternate language sections may be added, preceded by the
;ISO 639-1 code followed by a ".", e.g. "[ja.Quotes]".
;See language setting in mugen.cfg.
[ja.Quotes]
victory1 = "カンフー突き手を破らぬ限り、お前に勝ち目はない！"
victory2 = "十年早いんだぞ"
victory3 = "お前は見覚えがあるな。テレビにでも…？"
victory4 = "お前の動きは見破りやすすぎる。　なに、カンフー突き手が覚えたいんだと？　素人には無理だぞ"
victory5 = "ふー。　いい汗だった"
victory6 = "もっと強い相手に挑戦したい"
victory7 = "なんだと！彼女はここにもいないと？"

;---------------------------------------------------------------------------
; Variable usage:
; This is a record of the variables that KFM uses. Keeping a record of your
; variable usage helps you avoid careless mistakes later.
; var(1)  - Used in kfm.cmd for combo condition (updated every tick)
; var(2)  - Used in Kung Fu Throw (state 800) to remember if fwd was being
;           held (remembered from state 800 through state 810).
; var(6) - wall/ground/
; var(7) - wall/ground/
; var(5) - Don't shoot warning
; var(10) - Standing Fierce Charge Power
; var(11)  - wall/ground/ check
; var(13) - Curse Check
; Var(14) - Stun check
; Var(20) - armor count
; var(21) - armor intitiate
; var(22) - frame number
; var(26) - projectile armor
; var(25) - Shrunk check 
; var(36) - AV KO check
; var(37) - oppponents name check

;---------------------------------------------------------------------------
; Lose by Time Over
; CNS difficulty: basic
[Statedef 170]
type = S
ctrl = 0
anim = 170
velset = 0,0

[State 170, 1]
type = NotHitBy
trigger1 = 1
value = SCA
time = 1

;---------------------------------------------------------------------------
; Win state decider
; CNS difficulty: basic
[Statedef 180]
type = S

[State 180, 1]
type = ChangeState
trigger1 = Time = 0
trigger1 = var(36) = 0 
value = 181

[State 180, 1]
type = ChangeState
trigger1 = Time = 0
trigger1 = var(36) = 1 
value = 186


;----------------------------------------------------------------------------
; Summon Chair
[statedef 181]
type = S
ctrl = 0
anim = 180

[state 181, width]
type = width
trigger1 = 1
edge = 20,400

[state 181, explod]
type = explod
trigger1 = animelemtime(5)=0
anim = 192
postype = p1
pos = -50,-80
scale = 2,2
ontop = 1
persistent = 0

[state 191, playsnd]
type = playsnd
trigger1 = animelemtime(5) = 0
value = S210,1

[state 181, explod]
type = explod
trigger1 = animelemtime(6)=0
anim = 185
id = 180
postype = p1
pos = 0,-68
scale = const(size.xscale),const(size.yscale)
ownpal = 1
sprpriority = 2
removetime = -1
persistent = 0

[state 181, announce]
type = playsnd
triggerall = teammode = single
trigger1 = time = 10
trigger1 = life != lifemax
value = S180,1

[state 181, announce]
type = playsnd
triggerall = teammode = single
trigger1 = time = 10
trigger1 = life = lifemax
value = S180,1

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = roundnotover

[state 181, end]
type = changestate
trigger1 = animtime = 0
value = 182






;---------------------------------------------------------------------------
; Recline
; CNS difficulty: basic
[Statedef 182]
type = S
ctrl = 0
anim = 40
velset = 0,0

[state 181, width]
type = width
trigger1 = 1
edge = 20,400

[State 0, VelSet]
type = VelSet
trigger1 = anim = 40
trigger1 = animtime = 0
y = -24

[State 0, ChangeAnim]
type = ChangeAnim
trigger1 = anim = 40
trigger1 = animtime = 0
value = 41

[State 0, ChangeAnim]
type = ChangeAnim
trigger1 = anim = 41
trigger1 = vel y > 0 
value = 45

[State 0, Gravity]
type = Gravity
trigger1 = Pos Y < -1 

[State 0, ChangeState]
type = ChangeState
trigger1 = anim = 45
trigger1 = animelemtime(1) = 6
value = 183
ctrl = 0
;anim =
;ignorehitpause = 
;persistent = 


[state 181, assertspecial]
type = assertspecial
trigger1 = 1
flag = roundnotover


[State 181, 1]
type = NotHitBy
trigger1 = 1
value = SCA
time = 1

;-------------------------------------------------------------------------
; Recline
; CNS difficulty: basic
[Statedef 183]
type = S
movetype = I
physics = N
ctrl = 0 
anim = 181

[state 181, width]
type = width
trigger1 = 1
edge = 20,400

[state 182, gravity]
type = gravity
trigger1 = time >= 0  && time < 8

;[state 182, velmul]
;type = velmul
;trigger1 = time = 0
;y = 0.5


;[state 182, velstop]
;type = veladd
;trigger1 = time = 8
;y = 2
;persistent = 0
[state 182, velmul]
type = velmul
trigger1 = time > 16
y = 0.75
persistent = 8

[state 182, veladd]
type = veladd
triggerall = time > 16
trigger1 = pos y > -40
trigger2 = pos y > -80
y = 2.8 * -1
persistent = 2

[state 182, veladd]
type = veladd
triggerall = time > 16
trigger1 = pos y < -120
trigger2 = pos y < -80
y = 2.6 * 1
persistent = 2



;[state 182, ground snd]
;type = playsnd
;trigger1 = pos y < 0
;value = S5100,0
;persistent = 30

[state 182, changeanim]
type = changeanim
trigger1 = time = 8
value = 182

[state 183, removeexplod]
type = removeexplod
trigger1 = time = 8
id = 180

[state 181, playsnd]
type = playsnd
trigger1 = time = 8
value = S181,0

[state 181, explod]
type = explod
trigger1 = time = 8
anim = 185
id = 181
postype = p1
pos = 0,0
ownpal = 1
scale = const(size.xscale),const(size.yscale)
sprpriority = -1
bindtime = -1
removetime = -1

[state 182, end]
type = assertspecial
trigger1 = time < 180
flag = roundnotover

;---------------------------------------------------------------------------
;AV lay down pose
[statedef 186]
type = S
ctrl = 0
velset = 0,0
sprpriority = 1

[state 186, width]
type = width
trigger1 = 1
edge = 300,700

[state 186, anim]
type = changeanim
trigger1 = time = 0
trigger1 = var(37) != 1
value = 186

[state 186, changeanim]
type = changeanim
trigger1 = var(37) = 1
trigger1 = time = 0
value = 3083


[state 186, playsnd]
type = playsnd
trigger1 = var(37) != 1
trigger1 = animelemtime(5) =0
value = 52,0
persistent = 0

[state 186, envshake]
type = envshake
trigger1 = var(37) != 1
trigger1 = animelemtime(5) = 0
ampl = -10
time = 16
persistent = 0

[state 186, explod]
type = explod
trigger1 = time = 0
trigger1 = var(37) != 1
trigger1 = !numexplod(186)
id = 186
anim = 1860+var(37)
scale = const(size.xscale),const(size.yscale)
bindtime = -1
postype = p1
pos = 0,0
sprpriority = 2

[state 186, announce]
type = playsnd
triggerall = teammode = single
trigger1 = time = 10
trigger1 = life != lifemax
value = S180,1

[state 186, announce]
type = playsnd
triggerall = teammode = single
trigger1 = time = 10
trigger1 = life = lifemax
value = S180,1

[state 182, end]
type = assertspecial
trigger1 = time < 300
flag = roundnotover

;---------------------------------------------------------------------------
; Introduction
; CNS difficulty: basic
[Statedef 191]
type = S
ctrl = 0
anim = 190
velset = 0,0
sprpriority = 1

[state 191, version]
type = explod
trigger1 = time = 0
anim = ifelse(facing = -1,9101,9100)
scale = 1,1
postype = Back
pos = ifelse(facing =1, 20, 157),360 ; Nice!
ontop = 1

[State 191, 1] ;Freeze animation until PreIntro is over
type = ChangeAnim
trigger1 = RoundState = 0
value = 190

[state 191, explod]
type = explod
trigger1 = time = 0
anim = 191
pos = 0,0
sprpriority  = 2
scale = const(size.xscale),const(size.yscale)

[state 191, playsnd]
type = playsnd
trigger1 = time = 144
value = S210,1

[state 191, explod]
type = explod
trigger1 = time = 144
anim = 192
pos = -400,-320
scale = 1.25,1.25
sprpriority = 3

[state 191, width]
type = width
trigger1 = 1
edge = 10,-350



[State 191, 2] ;Assert this until you want "round 1, fight" to begin
type = AssertSpecial
trigger1 = 1
flag = Intro

[State 191, 3] ;Change to stand state when done
type = ChangeState
trigger1 = AnimTime = 0
value = 1910

;---------------------------------------------------------------------------
[statedef 1910]
type = A
movetype = I
physics = N
anim = 44

[state 191, width]
type = width
trigger1 = 1
edge = 10,-350

[state 1910, velset]
type = velset
trigger1 = time = 0
y = -14

[State 191, 2] 
type = AssertSpecial
trigger1 = 1
flag = Intro

[state 1910, gravity]
type = gravity
trigger1 = pos y < -1 

[state 1910, landing]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 1911

;---------------------------------------------------------------------------
;landing
[statedef 1911]
type = S
movetype = I
physics = S
anim = 47
velset = 0,0

[state 1911, sound]
type = playsnd
trigger1 = time = 0
value = S52,0
volume = 100

[State 191, 2] 
type = AssertSpecial
trigger1 = 1
flag = Intro

[State 1911, 4]
type = EnvShake
trigger1 = time = 0
time = 14
ampl = 8
freq = 100
phase = 100

[state 1911, posset]
type = posset
trigger1 = time = 0
y = 0

[state 1911, end]
type = changestate
trigger1 = animtime = 0
value = 0



;---------------------------------------------------------------------------
; Taunt
; CNS difficulty: easy
[Statedef 195]
type = S
ctrl = 0
anim = 195
velset = 0,0
movetype = I
physics = S
sprpriority = 2

[State 195, 1]
type = CtrlSet
trigger1 = Time = 40
value = 1

[State 195, 2]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1


;---------------------------------------------------------------------------
; Stand Light Punch
; CNS difficulty: easy
[Statedef 200]
type    = S                      ;State-type: S-stand, C-crouch, A-air, L-liedown
movetype= A                      ;Move-type: A-attack, I-idle, H-gethit
physics = S                      ;Physics: S-stand, C-crouch, A-air
juggle  = 1                      ;Number of air juggle points move takes
;Commonly-used controllers:
velset = 0,0                     ;Set velocity (x,y) (Def: no change)
ctrl = 0                         ;Set ctrl (Def: no change)
anim = 200                       ;Change animation (Def: no change)
poweradd = 10                    ;Power to add (Def: 0)
sprpriority = 2                  ;Set p1's sprite layering priority to 2 (in front)

[State 200, 1]
type = HitDef
trigger1 = AnimElem = 3
attr = S, NA                     ;Attribute: Standing, Normal Attack
damage = 18, 0                   ;Damage that move inflicts, guard damage
animtype = Light                 ;Animation type: Light, Medium, Heavy, Back (def: Light)
guardflag = MA                   ;Flags on how move is to be guarded against
hitflag = MAF                    ;Flags of conditions that move can hit
priority = 3, Hit                ;Attack priority: 0 (least) to 7 (most), 4 default
;Hit/Miss/Dodge type (Def: Hit)
pausetime = 6, 6                 ;Time attacker pauses, time opponent shakes
sparkno = 0                      ;Spark anim no (Def: set above)
sparkxy = -10, -350               ;X-offset for the "hit spark" rel. to p2,
;Y-offset for the spark rel. to p1
hitsound = S5000, 0                  ;Sound to play on hit
guardsound = 6, 0                ;Sound to play on guard
ground.type = High               ;Type: High, Low, Trip (def: Normal)
ground.slidetime = 14             ;Time that the opponent slides back
ground.hittime  = 14             ;Time opponent is in hit state
ground.velocity = -8          ;Velocity at which opponent is pushed
guard.velocity = -10
guard.hittime = 14
guard.slidetime = 14
airguard.velocity = -4,-2    ;Guard velocity in air (def: (air.xvel*1.5, air.yvel/2))
air.type = High                  ;Type: High, Low, Trip (def: same as ground.type)
air.velocity = -4,-4           ;X-velocity at which opponent is pushed,
;Y-velocity at which opponent is pushed
air.hittime = 16                 ;Time before opponent regains control in air
fall.recovertime = 20


[State 200, 2]
type = PlaySnd
trigger1 = Time = 1
value = 0, 0

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -9
persistent = 0
ignorehitpause = 1

[State 200, 3]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
; Standing strong punch
[Statedef 210]
type    = S
movetype= A
physics = S
poweradd= 25
ctrl = 0
velset = 0,0
anim = 210
sprpriority = -1

[state 210, varset]
type = varset
trigger1 = time = 0
v = 10
value = 1
ignorehitpause

[state 210, varset]
type = varset
trigger1 = time = 0
v = 23
value = 0
ignorehitpause =1

[State 210, strike]
type = ChangeState
triggerall = AnimTime = 0
trigger1 = command != "holdy"
trigger1 = ailevel = 0
trigger2 = ailevel > 0
trigger2 = p2statetype != L || p2movetype = A
value = 213

[State 210, level 2 charge]
type = ChangeState
triggerall= AnimTime = 0
trigger1 = command = "holdy"
trigger1 = ailevel = 0
trigger2 = ailevel > 0
trigger2 = p2statetype = L || p2bodydist x > 300
value = 211

;---------------------------------------------------------------------------
; Level 2
[Statedef 211]
type    = S
movetype= A
physics = S
poweradd= 15
ctrl = 0
velset = 0,0
anim = 211
sprpriority = -1

[state 211, snd]
type = playsnd
trigger1 = time = 0
value = S210,0
ignorehitpause = 1

[state 211, varset]
type = varset
trigger1 = time = 0
v = 10
value = 1
ignorehitpause

[state 211, explod]
type = explod
trigger1 = time = 0
trigger1 = numexplod < 1
anim = 21000
id = 21000
postype = p1
pos = 110*const(size.xscale),-240*const(size.yscale)
bindtime = -1
removeongethit = 1
removetime = -1


[State 210, strike]
type = ChangeState
triggerall = AnimTime = 0
trigger1 = command != "holdy"
trigger1 = ailevel = 0
trigger2 = p2statetype != L || p2movetype = A
trigger2 = AIlevel > 0
value = 213

[State 210, level 2 charge]
type = ChangeState
triggerall = AnimTime = 0
trigger1 = command = "holdy"
trigger1 = ailevel = 0
trigger2 = AIlevel > 0 
trigger2 = p2statetype = L || p2bodydist x > 300
value = 212

;---------------------------------------------------------------------------
; Level 3
[Statedef 212]
type    = S
movetype= A
physics = S
poweradd= 15
ctrl = 0
velset = 0,0
anim = 212
sprpriority = -1

[state 211, snd]
type = playsnd
trigger1 = time = 0
value = S210,0
ignorehitpause = 1

[state 210, varset]
type = varset
trigger1 = animtime = 0
trigger1 = numhelper(21000) = 0
v = 10
value = 3
ignorehitpause

[state 213, varset]
type = varset
trigger1 = animtime = 0
v = 23
value = 1
ignorehitpause

[State 210, strike]
type = ChangeState
trigger1 = ailevel = 0
trigger1 = command != "holdy"
trigger2 = time > 24
trigger3 = ailevel > 0
trigger3 = p2statetype != L
value = 213


;--------------------------------------------------------------------------
;Strike
[Statedef 213]
type = S
movetype = A
physics = S
ctrl = 0
velset = 0,0
poweradd = 25

[state 213, anim]
type = changeanim
trigger1 = time = 0
trigger1 = var(10) < 2
value = 213

[state 213, anim]
type = changeanim
trigger1 = time = 0
trigger1 = var(10) >= 2
value = 214

[state 213, removexplod]
type = removeexplod
trigger1 = time = 0
id = 21000
ignorehitpause = 1

[state 213, nothitby]
type = nothitby
trigger1 = numhelper(21000) = 1
value = ,AP
ignorehitpause = 1


[state 213, playsnd]
type = playsnd
trigger1 = animelem = 3
value = S210,1
ignorehitpause = 1

[State 213, 2]
type = HitDef
trigger1 = Time = 0
attr = S, NA
animtype  = heavy
damage    = 10
guardflag = MA
pausetime = 6,6
sparkno = 0
sparkxy = -10,-350
hitsound = S5000, 1
guardsound = S120, 0
ground.type = high
ground.slidetime = 22
ground.hittime  = 22
ground.velocity = -16
air.velocity = -12,-4
fall.recovertime = 20

[State 213, 2]
type = Helper
trigger1 =!numhelper(21000)
trigger1 = animelemtime(3) = 0
helpertype = normal
name = "Standing Fierce Proj"
ID = 21000
stateno = 21000
pos = 380*const(size.xscale),-250*const(size.yscale)
postype = p1
ownpal = 1
persistent = 0
ignorehitpause = 1

[state x, combo damage score]
type = varadd
triggerall = numhelper(21000) 
trigger1 = helper(21000),movehit = 1
v = 18
value = -3
persistent = 0
ignorehitpause = 1

[state 213, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1
;--------------------------------------------------------------------------
;Projectile Helper
[statedef 21000]
type = S
movetype = A
physics = N
ctrl = 0
movehitpersist


[state 21100, no shadow]
type = assertspecial
trigger1 = 1
flag = noshadow
ignorehitpause = 1

[state 21100, speed]
type = varset
triggerall = parent,stateno = 213
trigger1 = time = 0
v = 22
value = ifelse(var(10)=3,0.65,2)
persistent = 0

[state 21100, anim]
type = changeanim
trigger1 = anim != 21100 && anim != 21102
value = ifelse(parent,var(23)=1,21102,21100)
ignorehitpause = 1
persistent = 1

[state 21100, movement]
type = velset
trigger1 = animelemtime(4) = 0
x = var(22)
ignorehitpause = 1

[state 21100, attack mul]
type = attackmulset
trigger1 = 1
value = parent,fvar(10)
persistent = 1


[State 21100, 2]
type = HitDef
trigger1 = !movecontact
attr = S, NP
animtype  = heavy
damage    = ifelse(parent,var(10)=1,50,15),ifelse(parent,var(10)=1,10,5)
guardflag = MA
pausetime = ifelse(parent,var(10)=1,10,4),ifelse(parent,var(10)=1,10,4)
sparkno = 2
sparkxy = 40,0
hitsound   = F5,2
guardsound = S120, 0
ground.type = high
ground.slidetime = ifelse(parent,var(10)=1,22,4)
ground.hittime  = ifelse(parent,var(10)=1,22,4)
p1sprpriority = 3
ground.velocity = ifelse(parent,var(10)=1,-38,2)
air.velocity = ifelse(parent,var(10)=1,-12,2),-4
guard.velocity = ifelse(parent,var(10)=1,-45,2)             
guard.hittime = ifelse(parent,var(10)=1,14,4)
guard.slidetime = ifelse(parent,var(10)=1,14,4)
airguard.velocity = ifelse(parent,var(10)=1,-14,2),-2 
airguard.hittime = ifelse(parent,var(10)=1,28,8)
air.fall =1
fall = 0
fall.recover = 0
guard.dist = 315
guard.kill = 0
ground.cornerpush.veloff = 0
fall.recovertime = 20

[state 21000, parentvaradd]
type = parentvaradd
trigger1 = movecontact || movereversed
trigger2 = gethitvar(damage) != 0
v = 10
value = -1
ignorehitpause = 1
persistent = 0

[state 21000, hitoverride]
type = hitoverride
trigger1 = 1
attr = SCA, AP
time = 1
stateno = 21000
ignorehitpause = 1
persistent = 1

[state 21000, nothitby]
type = nothitby
trigger1 = 1
value = ,AA,AT
ignorehitpause = 1

[state 21000, changestate]
type = changestate
trigger1 = movecontact || movereversed
trigger1 = parent,var(10) > 0
value = 21000

[state 21000, changestate]
type = changestate
trigger1 = parent,var(10) <= 0
trigger2 = animtime = 0
value = 21001
;--------------------------------------------------------------------------
;Projectile End
[statedef 21001]
type = U
movetype = I
anim = 21101
velset = 0,0

[state 21100, no shadow]
type = assertspecial
trigger1 = 1
flag = noshadow
ignorehitpause = 1

[state 21001, end]
type = destroyself
trigger1 = animtime = 0

;------------------------------------------------------------------------
;Alt Standing Fierce
[Statedef 215]
type    = S
movetype= A
physics = S
juggle  = 6
poweradd= 25
ctrl = 0
anim = 215
sprpriority = 2

[State 215, 1]
type = PlaySnd
trigger1 = Time = 1
value = 0, 0

;This is the first hit, triggered on the 3rd element of animation.
[State 215, 2]
type = HitDef
trigger1 = !movecontact
persistent = 0
attr = S, NA
damage    = 45
animtype  = up
hitflag = MAF
guardflag = MA
pausetime = 18,18
priority = 6,hit
sparkno = 1
sparkxy = -10,-320
hitsound   = 5,4
guardsound = S120, 0
ground.type = high
ground.slidetime = 12
ground.hittime  = 24
air.hittime = 30
air.fall = 1
envshake.ampl = 8
envshake.time = 18
fall.recover = 1
fall.recovertime = 30
ground.velocity = -8,-34
air.velocity = -8,-26
ground.cornerpush.veloff = -40
guard.hittime = 14
guard.slidetime = 14
guard.velocity = -10

[state 215, Jump Cancel]
type = changestate
triggerall = movehit
trigger1 = command = "holdup"
trigger2 = ailevel
trigger2 = random < ailevel * 8
value = 40

[State 215, 4]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1





;---------------------------------------------------------------------------
; Standing light kick
; CNS difficulty: easy
[Statedef 230]
type    = S
movetype= A
physics = S
juggle  = 4
poweradd= 11
ctrl = 0
velset = 0,0
anim = 230
sprpriority = 2

[State 230, 1]
type = PlaySnd
trigger1 = Time = 2
value = 0, 1

[State 230, 2]
type = HitDef
trigger1 = Time = 0
attr = S, NA
animtype  = Medium
damage    = 25
guardflag = MA
pausetime = 8,8
sparkno = 0
sparkxy = -10,-90
hitsound = S5000, 1
guardsound = S120, 0
ground.type = Low
ground.slidetime = 15
ground.hittime  = 15
ground.velocity = -12
guard.velocity = -14
airguard.velocity = -4,-4
air.velocity = -2.5,-3.5
guard.hittime = 13
guard.slidetime = 13
fall.recovertime = 20

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -9
persistent = 0
ignorehitpause = 1

[State 230, 3]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
; Standing strong kick
; CNS difficulty: easy
[Statedef 240]
type    = S
movetype= A
physics = S
poweradd= 60
ctrl = 0
velset = 0,0
sprpriority = 2

;===========
;Armor start
;===========
[state 240, animation]
type = changeanim
trigger1 = anim != 240
value = 240

[state 240, armor counter]
type = varset
triggerall = prevstateno != 240
trigger1 = time = 0
trigger1 = Var(21) = 1
V = 20
value = 1

[state 240, excess armor check]
type = varset
trigger1 = var(20) > 1
var(20) = 1
persistent = 1
ignorehitpause = 1

[state x, armor over]
type = varset
trigger1 = animelem = 7
v = 20
value = 0
ignorehitpause 

[state 240, armor intiator turn off]
type = varset
trigger1 = time = 1
V = 21
value = 0

;determine what frame
[state 240, remember frame]
type = varset
trigger1 = time <= 0
v = 22
value = animelemno(0)
ignorehitpause = 1

;delay effect
[state 240, delay]
type = changeanim 
trigger1 = var(31) < floor(gethitvar(hittime)*1.1)
value = anim
elem = var(22)

[state 240, freeze location]
type = posfreeze
trigger1 = var(31) < floor(gethitvar(hittime)*1.1)
value = 1
;--------------------------

[state 240, still take damage]
type = lifeadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) != 0
value = floor(-gethitvar(damage)*0.5)
persistent = 1

[state 240, armor count down]
type = varadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) > 0
V = 20
value = -1
persistent = 1

[state 240, Unstoppable]
type = hitoverride
trigger1 = Life > 1
trigger1 = Var(20) > 0
trigger1 = animelemtime(2) > 0  && animelemtime(10) < 0
attr = SCA, AA, AP
stateno = 240
time = 1
persistent = 1

[State 1050, flash red]
type = PalFX
trigger1 = Time = 0
trigger1 = gethitvar(damage) != 0
time = 7
add = 100,0,0
IgnoreHitPause = 1


[State 240, 1]
type = PlaySnd
trigger1 = animelemTime(5) = 0
value = 240, 0

[State 240, 2]
type = HitDef
trigger1 = Time = 0
attr = S, NA
animtype  = Heavy
damage    = 85,9
id = 240
nochainid = 240
guardflag = MA
hitflag = MAF
pausetime = 14,14
sparkno = 3
sparkxy = -10,-310
hitsound   = S240,1
guardsound = S120, 0
ground.type = high
ground.slidetime = 22
ground.hittime  = 22
ground.velocity = -40,-15
air.velocity = -40,-15
fall = 1
guard.kill = 0
fall.recovertime = 45
fall.recover = 1
guard.slidetime = 15
guard.hittime = 15
guard.velocity = -64
airguard.velocity = -25,-6
envshake.ampl = 12
envshake.time = 18
guard.dist = 720

[state 240, sprpriority]
type = sprPriority
trigger1 = animelem = 9
value = -2

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -3
persistent = 0
ignorehitpause = 1

[state 240, Not Active]
type = statetypeset
trigger1 = animelemtime(8) = 0
movetype = I


[State 240, 4]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
;Crouching light punch
; CNS difficulty: easy
; Description: Simple crouching attack. The HitDef's guardflag parameter
;     is set to "L", meaning that the move can only be guarded low
;     (crouching), and not by standing or jumping opponents.
;     Like for all light attacks, it's a good idea to keep the slidetime
;     and hittime parameters at a smaller number, so the opponent isn't
;     stunned for too long. For all crouching attacks you have to
;     remember to set the attr parameter to indicate that it is crouching
;     attack. In this case, "C, NA" stands for "crouching, normal attack".
;     The HitDef's priority is set at 3, instead of the default of 4,
;     so this attack has a lower priority than most others, meaning
;     KFM will get hit instead of trading hits with his opponent if
;     their attack collision boxes (Clsn1) intersect each other's Clsn2
;     boxes at the same time.
[Statedef 400]
type    = C
movetype= A
physics = C
juggle  = 5
poweradd= 8
ctrl = 0
anim = 400
sprpriority = 2

[State 400, 1]
type = PlaySnd
trigger1 = Time = 1
value = 0, 0

[State 400, 2]
type = HitDef
trigger1 = Time = 0
attr = C, NA
damage    = 18
priority  = 3
animtype  = Light
hitflag = MAF
guardflag = MA
pausetime = 8,8
sparkno = 0
sparkxy = -10,-170
hitsound = S5000, 0
guardsound = S120, 0
ground.type = Low
ground.slidetime = 12
ground.hittime  = 12
ground.velocity = -12
air.velocity = -4,-2
guard.hittime = 12
guard.slidetime = 12
fall.recovertime = 20



[State 400, 4]
type = ChangeState
trigger1 = AnimTime = 0
value = 11
ctrl = 1
;---------------------------------------------------------------------------
;Alt Standing Fierce
[Statedef 410]
type    = C
movetype= A
physics = C
poweradd= 40
ctrl = 0
anim = 410
sprpriority = 2

[State 410, 1]
type = PlaySnd
trigger1 = Time = 15
value = S410, 0

;This is the first hit, triggered on the 3rd element of animation.
[State 410, 2]
type = HitDef
trigger1 = AnimElem = 4
attr = C, NA
damage    = 85
animtype  = up
hitflag = MAF
guardflag = M
pausetime = 18,18
sparkno = 1
sparkxy = -10,-380
hitsound   = 5,4
guardsound = S120, 0
ground.type = high
ground.slidetime = 12
ground.hittime  = 45
air.hittime = 45
fall.recover = 1
ground.velocity = -2,ifelse(var(11) > 0,-40,-10)
air.velocity = -2,ifelse(var(11) > 0,-34,-8)
guard.velocity = -35
guard.slidetime = 11
guard.hittime = 11
fall.recovertime = 34

[state 410, super jump]
type = changestate
triggerall = movehit
trigger1 = command = "holdup"
trigger2 = ailevel > 0
value = 42
ctrl = 0

[state 410, launcher infinite]
type = varadd
trigger1 = movehit
v = 11
value = -1
ignorehitpause = 1
persistent = 0

[state 410, Not Active]
type = statetypeset
trigger1 = animelemtime(6) = 0
movetype = I

[State 410, 4]
type = ChangeState
trigger1 = AnimTime = 0
value = 11
ctrl = 1

;---------------------------------------------------------------------------
;Crouching light kick
; CNS difficulty: easy
[Statedef 430]
type    = C
movetype= A
physics = C
juggle  = 5
poweradd= 11
ctrl = 0
anim = 430
sprpriority = 2

[State 430, 1]
type = PlaySnd
trigger1 = Time = 1
value = 0, 0

[State 430, 2]
type = HitDef
trigger1 = Time = 0
attr = C, NA
damage    = 24
animtype  = Light
hitflag = MAFD
guardflag = LA
pausetime = 10,10
sparkno = 0
nochainid = 1400
sparkxy = -10,-8
hitsound = S5000, 1
guardsound = S120, 0
ground.type = Low
ground.slidetime = 15
ground.hittime  = 15
ground.velocity = -12
air.velocity = -6,-4
down.velocity = -5,0
down.hittime = 22
guard.hittime = 11
guard.slidetime = 11
fall.recovertime = 20

[State 430, 3]
type = ChangeState
trigger1 = AnimTime = 0
value = 11
ctrl = 1

;---------------------------------------------------------------------------
;Crouch Strong Kick
; CNS difficulty: easy
; Description: This move uses "Trip" for the "ground.type" parameter in
;     its HitDef. It's a special type that puts the opponent in a tripped
;     animation as he falls. Also, the hitflag parameter in the HitDef
;     is set to "MAFD". The "D" indicates that a downed opponent can be
;     hit by the attack.
[Statedef 440]
type    = C
movetype= A
physics = C
juggle  = 7
poweradd= 35
ctrl = 0
anim = 440
sprpriority = 2

[State 440, 2]
type = PlaySnd
trigger1 = animelemtime(3) = 0
value = 240, 0

[state 440, velset]
type = velset
trigger1 = animelemtime(3) = 0
x = 25


[State 440, 3]
type = HitDef
trigger1 = Time = 0
attr = C, NA
damage    = 80
hitflag = MAFD
guardflag = L
pausetime = 12,12
sparkno = 2
nochainid = 1400,800
sparkxy = -5,-170
hitsound   = 5,2
guardsound = S120, 0
ground.type = Trip
ground.slidetime = 10
ground.hittime  = 17
ground.velocity = -16,-12
air.velocity = -16,-8
down.velocity = -52,0
guard.velocity = -32
guard.hittime = 10 ;-14 Terrible Recovery: zoner archetype, high range
guard.slidetime = 10
fall = 1

[state 240, sprpriority]
type = sprPriority
trigger1 = animelem = 6
value = -2



[State 440, 4]
type = ChangeState
trigger1 = AnimTime = 0
value = 11
ctrl = 1

;---------------------------------------------------------------------------
;Jump Light Punch
; CNS difficulty: easy
[Statedef 600]
type    = A
movetype= A
physics = A
juggle  = 2
poweradd= 5
ctrl = 0
anim = 600
sprpriority = 2

[State 600, 1]
type = PlaySnd
trigger1 = Time = 1
value = 0, 0

[State 600, 2]
type = HitDef
trigger1 = Time = 0
attr = A, NA
damage    = 15
guardflag = HA
priority = 3
pausetime = 8,8
sparkno = 0
sparkxy = -10,-320
hitsound = S5000, 0
guardsound = S120, 0
ground.type = High
ground.slidetime = 12
ground.hittime  = 12
ground.velocity = -4
air.velocity = -1.3,-3
air.hittime = 12
guard.hittime = 13
guard.slidetime = 13
fall.recovertime = 20

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -9
persistent = 0
ignorehitpause = 1

[State 600, 3]
type = changestate
trigger1 = animtime = 0
value = 50
ctrl = 1

;---------------------------------------------------------------------------
;Jump Strong Punch
; CNS difficulty: easy
[Statedef 610]
type    = A
movetype= A
physics = N
poweradd= 50
ctrl = 0
juggle = 5
anim = 610
sprpriority = 2

[State 610, 2]
type = PlaySnd
trigger1 = Time = 2
value = S610, 0

[state 610, gravity]
type = gravity
trigger1 = 1

[state 610, jumping Fierce infinite inhibitor]
type = varadd
trigger1 = movehit
trigger1 = enemynear,statetype != A
v = 29
value = 1

[State 610, 3]
type = HitDef
trigger1 = Time = 0
attr = A, NA
damage = 90
guardflag = HA
hitflag = MAFD
priority = 4
pausetime = 18,18
sparkno = 3
id = 610
nochainid = 1400
sparkxy = -10,-80
hitsound   = S240,1
guardsound = S120, 0
animtype = heavy
ground.type = High
ground.slidetime = 26
ground.hittime  = floor(26/var(29))
ground.velocity = -12
air.velocity = -4,60
down.bounce = ifelse(var(8) > 0, 0, 1)
fall.yvelocity = -40
fall.xvelocity = -2
fall.recover = 1
fall.recovertime = 30
envshake.ampl = -12
envshake.time = 18
air.fall = 1
guard.hittime = 17
guard.slidetime = 17
fall.recovertime = 30
down.velocity = 0,ifelse(var(8) > 0, -36,0)
down.hittime = 24

[state 610, playsnd]
type = playsnd
trigger1 = movehit
value = S240,1
ignorehitpause = 1
persistent = 0

[state 610, playsnd]
type = playsnd
trigger1 = movehit
value = S240,1
ignorehitpause = 1
persistent = 0


[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = ifelse(enemynear,statetype = A && var(8) > 0, -9,-3)
persistent = 0
ignorehitpause = 1

[state 610, ground bounce state]
type = targetstate
triggerall = movehit
triggerall = numtarget(610)
triggerall = var(8) > 0
trigger1 = hitpausetime = 13
trigger1 = target(610),statetype = A
value = 683
ignorehitpause = 1

[state 610, Uplift]
type = veladd
triggerall = numtarget(610)
trigger1 = movehit
trigger1 = target(610),statetype = A
trigger1 = command = "holdup"
y = -45
persistent = 0

[state 610, Uplift]
type = velmul
trigger1 = movehit
trigger1 = enemynear,statetype = A
trigger1 = command = "holdup"
x = 0.25
persistent = 0

[state 610, Ground Bounce limiter]
type = varadd
trigger1 = movehit
trigger1 = enemynear,statetype = A
v = 8
value = -1
ignorehitpause = 1
persistent = 0

[state 610, bounce limiter]
type = varadd
trigger1 = movehit
trigger1 = p2statetype = L
var(8) = -1
ignorehitpause = 1
persistent = 0

[state 610, end]
type = changestate
trigger1 = animtime = 0
value = 50
ctrl = 1

[state 610, end2]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > 80
value = 52

;---------------------------------------------------------------------------
;Jumping Belly Splash
[statedef 611]
type = A
movetype = A
physics = N
anim = 611
ctrl = 0
sprpriority = 1

[State 611, Afterimage]
type = AfterImage
trigger1 = animelemtime(3) = 0
length = 20
TimeGap  = 1
time = -1
framegap = 3
palcolor = 256
PalAdd      = 0,256,0
PalBright   =  192, 192,  192
PalContrast =  256, 256, 256
Trans = "none"
persistent = 0
ignorehitpause = 1

[state 1020, velmul]
type = velmul
trigger1 = time = 0
x = 0.1
y = 0.1

[state 611, gravity]
type = gravity
trigger1 = animelemtime(4) >= 0

[state 611, veladd]
type = veladd
trigger1 = animelemtime(4) = 0
x = 12
y = 24
persistent = 0

[state 611, playerpush]
type = playerpush
trigger1 = 1
value = 0

[state 611, fvarset]
type = varset
trigger1 = time = 0
fv = 12
value = 1.00

[state 611, fvadd]
type = varadd
trigger1 = animelemtime(4) > 0
fv = 12
value = 0.05
persistent = 2

[state 611, angledraw]
type = angledraw
trigger1 = animelemtime(4) > 0
value = 0
scale = fvar(12),fvar(12)
ignorehitpause = 1



[State 611, 2]
type = HitDef
trigger1 = !movecontact
attr = A, SA
damage = ifelse(var(13)=1,ceil(fvar(12)*130),ceil(fvar(12)*110)),11
guardflag = HA
hitflag = MAF
priority = 3
id = 611
nochainid = 1400
pausetime = 0,0
sparkno = -1
sparkxy = -5,-35
hitsound   = 5,4
guardsound = S120, 0
ground.type = High
guard.velocity = -80
guard.slidetime = 42
airguard.velocity = -12,-6
guard.hittime = 42
fall = 1
guard.dist = 240

[state 611, getpower]
type = poweradd
trigger1 = var(13) = 1
trigger1 = movehit
value = 500
ignorehitpause = 0
persistent = 0

;Ride down mechanic
[state 650, Ride down]
type = targetbind
trigger1 = movehit
trigger1 = enemy,statetype = A
pos = 0, -20

[state 650, state of ride down]
type = targetstate
trigger1 = movehit
trigger1 = enemy,statetype = A
value = 655
;-------------------------------------

[state 611, targetstate]
type = targetstate
trigger1 = movehit
trigger1 = target,statetype != A
value = 660

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -9
persistent = 0
ignorehitpause = 1

[state 611, end]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 612

;--------------------------------------------------------------------------
;1st Landing
[Statedef 612]
type    = C
movetype= A
physics = N
anim = 612
movehitpersist = 1
sprpriority = 1



[state 612, width]
type = width
trigger1 = 1
value = 0,0

[state 611, angledraw]
type = angledraw
trigger1 = 1
value = 0
scale = fvar(12),fvar(12)
ignorehitpause = 1

[state 612, on floor]
type = posset
trigger1 = time = 0
y = 0

[state 612, dust]
type = explod
trigger1 = time = 0
anim = 2010
pos = -50,0
sprpriority = 4
ownpal = 1
scale = 2,2

[state 612, dust]
type = explod
trigger1 = time = 0
anim = 2011
pos = -50,0
sprpriority = -2 
ownpal = 1
scale = 2,2

[State 612, 3]
type = HitDef
trigger1 = !movecontact
attr = C, SA
HitFlag = FD
getpower = 120
damage    = Ceil(fvar(12)*140)
guardflag = HA
priority = 4
nochainid = 1400
pausetime = 0,0
sparkno = -1
hitsound = 5,4
guardsound = S120, 0
animtype = Heavy
ground.type = High
p2stateno = 661
ground.slidetime = 12
ground.hittime  = 15
ground.velocity = -7
air.velocity = -3,-4

[state 612, freeze]
type = velset
trigger1 = time = 0
y = 0

[state 612, slow down x]
type = velmul
trigger1 = time = 0
x = 0.5

[State 612, 1]
type = EnvShake
trigger1 = time = 0
persistent = 0
time = 20
ampl = 16



[State 612, thud]
type = PlaySnd
trigger1 = time = 0
value = S5100, 0


[state 612, 2]
type = velset
trigger1 = animelemtime(4) = 0
y = -12

[state 612, setstateset]
type= statetypeset
trigger1 = animelemtime(4) = 0
statetype = A

[state 612, gravity]
type = gravity
trigger1 = pos y < -1

[state 612, no push]
type = playerpush
trigger1 = 1
value = 0

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -3
persistent = 0
ignorehitpause = 1

[state 612, 3]
type = ChangeState
trigger1 = time > 8
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 613

;------------------------------------------------------------------------------------
;2nd Landing
[Statedef 613]
type  = C
movetype = I
physics = C
anim = 613
velset = 0,0
sprpriority = 2

[state 612, afterimage]
type = afterimage
trigger1 = animtime = 0
time = 0

[state 611, angledraw]
type = angledraw
trigger1 = animelemtime(11)< 0
value = 0
scale = fvar(12),fvar(12)
ignorehitpause = 1

[state 613, shrink]
type = varadd 
trigger1 = animelemtime(10)>= 0 && animelemtime(11) < 0
trigger1 = fvar(12) > 1.00
fv = 12
value = -0.025
ignorehitpause

[state 613, shrink]
type = varset 
trigger1 = fvar(12) < 1.00
fv = 12
value = 1.00
ignorehitpause




[state 614, on floor]
type = posset
trigger1 = time = 0
y = 0

[state 613, width]
type = width
trigger1 = 1
value = 0,0

[State 613, thud]
type = PlaySnd
trigger1 = time = 1
value = 52, 0

[state 613, no push]
type = playerpush
trigger1 = time >= 0
value = 0


[State 613, shake]
type = EnvShake
trigger1 = Time = 1
time = 10
ampl = 8

[state 613, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1









;---------------------------------------------------------------------------
;Jump Light Kick
; CNS difficulty: easy
[Statedef 630]
type    = A
movetype= A
physics = A
juggle  = 3
poweradd= 10
ctrl = 0
anim = 630
sprpriority = 2

[State 630, 1]
type = PlaySnd
trigger1 = Time = 1
value = 0, 0

[State 630, 2]
type = HitDef
trigger1 = Time = 0
attr = A, NA
damage = 25
guardflag = HA
priority = 3
pausetime = 8,8
sparkno = 1
sparkxy = -5,-35
hitsound = S5000, 0
guardsound = S120, 0
ground.type = High
ground.slidetime = 14
ground.hittime  = 14
ground.velocity = -4
air.velocity = -2,-3
air.hittime = 18
guard.hittime = 13
guard.slidetime = 13
fall.recovertime = 20

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -9
persistent = 0
ignorehitpause = 1

[State 600, 3]
type = changestate
trigger1 = animtime = 0
value = 50
ctrl = 1

;---------------------------------------------------------------------------
;Jump Strong Kick
; CNS difficulty: easy
[Statedef 640]
type    = A
movetype= A
physics = A
juggle  = 4
poweradd= 50
ctrl = 0
anim = 640
sprpriority = 2

[State 240, 1]
type = PlaySnd
trigger1 = animelemTime(4) = 0
value = 240, 0

[state 610, jumping Fierce infinite inhibitor]
type = varadd
trigger1 = movehit
trigger1 = enemynear,statetype != A
v = 29
value = 1


[State 640, 3]
type = HitDef
trigger1 = Time = 0
attr = A, NA
damage    = 85
guardflag = HA
priority = 4
pausetime = 14,14
sparkno = 3
sparkxy = -10,-170
hitsound   = 5,4
guardsound = S120, 0
animtype = heavy
ground.type = High
ground.slidetime = 24
envshake.time = 8
envshake.ampl = 8
ground.hittime  = floor(24/var(29))
ground.velocity = -18
air.velocity = -70,ifelse(var(7) > 1, -12, 3)
guard.velocity = -8
airguard.velocity = -6,-4
down.bounce = 1
fall.xvelocity = -5
fall.yvelocity = -8
air.fall = 1
fall.recover = 0
fall.recovertime = 60
guard.hittime = 17
guard.slidetime = 17
fall.recovertime = 30

[state 640, wall bounce]
type = targetstate
triggerall = var(7) > 0
trigger1 = movehit
trigger1 = enemy,statetype = A
trigger1 = hitpausetime = 13
ignorehitpause = 1
value = 675

[state 640, wall bounce limiter]
type = varadd
trigger1 = movehit
trigger1 = enemy,statetype = A
ignorehitpause = 1
v = 7
value = -1

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = ifelse(var(7) > 0,-9,-3)
persistent = 0
ignorehitpause = 1

[state 640, end]
type = changestate
trigger1 = animtime = 0
value = 50
ctrl = 1


;---------------------------------------------------------------------------
;Rode down
[statedef 655]
type = A
movetype = H
physics = N

[state 655, anim]
type = changeanim2
trigger1 = time = 0
value = 655

[State 655, 2]
type = changeState
trigger1 = !gethitvar(isbound)
value = 660



;===========================================================================
;---------------------------Crushed State-----------------------------------
;===========================================================================
; Crush state
[statedef 660]
type    = L
movetype= H
physics = N
ctrl = 0
velset = 0,0

[state 660, 1]
type = changeanim
trigger1 = time = 0
value = 5110

[State 660, flatten]
type = AngleDraw
trigger1 = time > 0
value = 0
scale = 1.3,0.1

[state 660, on ground]
type = posset
trigger1 = 1
y = 0

[state 660, passthrough]
type = playerpush
trigger1 = 1
value = 0
time = 600

[State 660, Width]
type = Width
trigger1 = time > 0
value = 0,0

[state 660, invunerable]
type = nothitby
trigger1 = 1
value = SCA


[State 660, 1] ;For hit up/up-diag type (from state 5081)
type = ChangeAnim
persistent = 0
trigger1 = SelfAnimExist(5110 + (anim % 10))
trigger1 = anim = [5081,5089]
value = 5110 + (anim % 10)

[State 660, 2] ;Hit ground anim (normal)
type = ChangeAnim
triggerall = time = 0
triggerall = anim != [5110,5119] ;Not already changed anim
trigger1 = anim != [5161,5169]
trigger2 = !SelfAnimExist(5170 + (anim % 10))
value = 5170

[State 660, 3] ;Hit ground anim (for hit up)
type = ChangeAnim
triggerall = time = 0
triggerall = anim != [5110,5119] ;Not already changed anim
trigger1 = anim = [5161,5169]
trigger1 = SelfAnimExist(5170 + (anim % 10))
value = 5170 + (anim % 10)


[State 660, 5]
type = PosSet
trigger1 = Time = 0
y = 0

[State 660, 7]
type = GameMakeAnim
trigger1 = Time = 0
trigger1 = !SysVar(0)
value = 60 + (sysvar(1) > 5) + (sysvar(1) > 14)
pos = 0, 0
under = sysvar(1) <= 10

[State 660, 8]
type = VelSet
trigger1 = Time = 0
y = 0

[State 660, 9] ;For hit up type
type = ChangeAnim
persistent = 0
triggerall = anim = [5171,5179]
triggerall = SelfAnimExist(5110 + (anim % 10))
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground anim
value = 5110 + (anim % 10)

[State 660, 10] ;For normal
type = ChangeAnim
persistent = 0
triggerall = Anim != [5111,5119]
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground frame
value = 5110

[State 660, 11] ;If just died
type = ChangeState
triggerall = !alive && p2stateno = 0 && roundstate = 3
trigger1 = AnimTime = 0 
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground frame
trigger3 = Anim = [5110,5119]
value = 5150

;[State 660, 12]
;type = VarSet
;trigger1 = SysVar(0)
;trigger1 = Time = 0
;sysvar(0) = 0

[State 660, 13] ;Friction
type = VelMul
trigger1 = 1
x = 0.85

[State 660, 14]
type = ForceFeedback
trigger1 = alive
trigger1 = Time = 0
time = 8
ampl = 240
waveform = sine

[State 660, 15]
type = ForceFeedback
trigger1 = !alive
trigger1 = Time = 0
ampl = 200, 7, -.467
time = 30
waveform = sine

[state 1108, nothitby]
type = nothitby
trigger1 = 1
value = SCA


[State 660, get up]
type = selfstate
trigger1 = life >= 1
trigger1 = time > 115 ;95
value = 5120

[state 660, flat death]
type = changestate
trigger1 = !alive
trigger1 = time > 40
value = 5150

;---------------------------------------------------------------------------
;Shrunken Crushed State
[statedef 661]
type    = L
movetype= H
physics = N
ctrl = 0
velset = 0,0

[state 661, 1]
type = changeanim
trigger1 = time = 0
value = 5110

[State 661, flatten]
type = AngleDraw
trigger1 = time > 0
value = 0
scale = 0.3,0.1

[state 661, on ground]
type = posset
trigger1 = 1
y = 0

[state 1108, nothitby]
type = nothitby
trigger1 = time > 10
value = SCA

[state 661, passthrough]
type = playerpush
trigger1 = 1
value = 0
time = 600

[State 661, Width]
type = Width
trigger1 = time > 0
value = 0,0


[State 661, 1] ;For hit up/up-diag type (from state 5081)
type = ChangeAnim
persistent = 0
trigger1 = SelfAnimExist(5110 + (anim % 10))
trigger1 = anim = [5081,5089]
value = 5110 + (anim % 10)

[State 661, 2] ;Hit ground anim (normal)
type = ChangeAnim
triggerall = time = 0
triggerall = anim != [5110,5119] ;Not already changed anim
trigger1 = anim != [5161,5169]
trigger2 = !SelfAnimExist(5170 + (anim % 10))
value = 5170

[State 661, 3] ;Hit ground anim (for hit up)
type = ChangeAnim
triggerall = time = 0
triggerall = anim != [5110,5119] ;Not already changed anim
trigger1 = anim = [5161,5169]
trigger1 = SelfAnimExist(5170 + (anim % 10))
value = 5170 + (anim % 10)


[State 661, 5]
type = PosSet
trigger1 = Time = 0
y = 0

;[State 661, Var] ;Get fall velocity
;type = VarSet
;trigger1 = Time = 0
;trigger1 = GetHitVar(fall.yvel) != 0
;sysvar(1) = floor(vel y)

;[State 661, 6]
;type = PlaySnd
;trigger1 = Time = 0
;trigger1 = !SysVar(0)
;value = F7, 0 ;Hit ground
;value = F7, (sysvar(1) > 5) + (sysvar(1) > 14)
;persistent = 0

[State 661, 7]
type = GameMakeAnim
trigger1 = Time = 0
trigger1 = !SysVar(0)
value = 60 + (sysvar(1) > 5) + (sysvar(1) > 14)
pos = 0, 0
under = sysvar(1) <= 10

[State 661, 8]
type = VelSet
trigger1 = Time = 0
y = 0

[State 661, 9] ;For hit up type
type = ChangeAnim
persistent = 0
triggerall = anim = [5171,5179]
triggerall = SelfAnimExist(5110 + (anim % 10))
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground anim
value = 5110 + (anim % 10)

[State 661, 10] ;For normal
type = ChangeAnim
persistent = 0
triggerall = Anim != [5111,5119]
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground frame
value = 5110

[State 661, 11] ;If just died
type = ChangeState
triggerall = !alive && p2stateno = 0 && roundstate = 3
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground frame
trigger3 = Anim = [5110,5119]
value = 5150

;[State 661, 12]
;type = VarSet
;trigger1 = SysVar(0)
;trigger1 = Time = 0
;sysvar(0) = 0

[State 661, 13] ;Friction
type = VelMul
trigger1 = 1
x = 0.85

[State 661, 14]
type = ForceFeedback
trigger1 = alive
trigger1 = Time = 0
time = 8
ampl = 240
waveform = sine

[State 661, 15]
type = ForceFeedback
trigger1 = !alive
trigger1 = Time = 0
ampl = 200, 7, -.467
time = 30
waveform = sine

[state 661, nothitby]
type = nothitby
trigger1 = 1
value = SCA

[State 661, get up]
type = selfstate
trigger1 = life >= 1
trigger1 = time > 110
trigger2 = time > 140
value = 5120

;---------------------------------------------------------------------------
;Super Crushed State
[statedef 662]
type    = L
movetype= H
physics = N
ctrl = 0
velset = 0,0

[state 661, 1]
type = changeanim
trigger1 = time = 0
value = 5110

[State 661, flatten]
type = AngleDraw
trigger1 = time > 0  && time <25
value = 0
scale = 1.25,0.2

[state 661, on ground]
type = posset
trigger1 = 1
y = 0

[state 661, passthrough]
type = playerpush
trigger1 = 1
value = 0
time = 600

[State 661, Width]
type = Width
trigger1 = time > 0
value = 0,0


[State 661, 1] ;For hit up/up-diag type (from state 5081)
type = ChangeAnim
persistent = 0
trigger1 = SelfAnimExist(5110 + (anim % 10))
trigger1 = anim = [5081,5089]
value = 5110 + (anim % 10)

[State 661, 2] ;Hit ground anim (normal)
type = ChangeAnim
triggerall = time = 0
triggerall = anim != [5110,5119] ;Not already changed anim
trigger1 = anim != [5161,5169]
trigger2 = !SelfAnimExist(5170 + (anim % 10))
value = 5170

[State 661, 3] ;Hit ground anim (for hit up)
type = ChangeAnim
triggerall = time = 0
triggerall = anim != [5110,5119] ;Not already changed anim
trigger1 = anim = [5161,5169]
trigger1 = SelfAnimExist(5170 + (anim % 10))
value = 5170 + (anim % 10)


[State 661, 5]
type = PosSet
trigger1 = Time = 0
y = 0

;[State 661, Var] ;Get fall velocity
;type = VarSet
;trigger1 = Time = 0
;trigger1 = GetHitVar(fall.yvel) != 0
;sysvar(1) = floor(vel y)

;[State 661, 6]
;type = PlaySnd
;trigger1 = Time = 0
;trigger1 = !SysVar(0)
;value = F7, 0 ;Hit ground
;value = F7, (sysvar(1) > 5) + (sysvar(1) > 14)
;persistent = 0

[State 661, 7]
type = GameMakeAnim
trigger1 = Time = 0
trigger1 = !SysVar(0)
value = 60 + (sysvar(1) > 5) + (sysvar(1) > 14)
pos = 0, 0
under = sysvar(1) <= 10

[State 661, 8]
type = VelSet
trigger1 = Time = 0
y = 0

[State 661, 9] ;For hit up type
type = ChangeAnim
persistent = 0
triggerall = anim = [5171,5179]
triggerall = SelfAnimExist(5110 + (anim % 10))
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground anim
value = 5110 + (anim % 10)

[State 661, 10] ;For normal
type = ChangeAnim
persistent = 0
triggerall = Anim != [5111,5119]
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground frame
value = 5110

[State 661, 11] ;If just died
type = ChangeState
triggerall = !alive && p2stateno = 0 && roundstate = 3
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground frame
trigger3 = Anim = [5110,5119]
value = 5150

;[State 661, 12]
;type = VarSet
;trigger1 = SysVar(0)
;trigger1 = Time = 0
;sysvar(0) = 0

[State 661, 13] ;Friction
type = VelMul
trigger1 = 1
x = 0.85

[State 662, 14]
type = ForceFeedback
trigger1 = alive
trigger1 = Time = 0
time = 8
ampl = 240
waveform = sine

[State 662, 15]
type = ForceFeedback
trigger1 = !alive
trigger1 = Time = 0
ampl = 200, 7, -.467
time = 30
waveform = sine

[state 662, hitby]
type = hitby
trigger1 = time > 0
value = SCA, AA
ignorehitpause = 1

[State 662, get up]
type = selfstate
trigger1 = life >= 1
trigger1 = time > 180
trigger2 = time > 360
value = 5110


;---------------------------------------------------------------------------
;Winning Crushed State
[statedef 665]
type    = L
movetype= H
physics = N
ctrl = 0
velset = 0,0

[state 665, 1]
type = changeanim
trigger1 = time = 0
value = 5110

[state 665, scream]
type = playsnd
trigger1 = 1
value = 11,0
persistent = 0


[State 665, flatten]
type = AngleDraw
trigger1 = time > 0  && time <25
value = 0
scale = 1.3,0.1

[state 665, on ground]
type = posset
trigger1 = 1
y = 0

[state 665, passthrough]
type = playerpush
trigger1 = 1
value = 0
time = 600

[State 665, Width]
type = Width
trigger1 = time > 0
value = 0,0

[State 665, 5]
type = PosSet
trigger1 = Time = 0
y = 0

;[State 661, Var] ;Get fall velocity
;type = VarSet
;trigger1 = Time = 0
;trigger1 = GetHitVar(fall.yvel) != 0
;sysvar(1) = floor(vel y)

;[State 665, 6]
;type = PlaySnd
;trigger1 = Time = 0
;trigger1 = !SysVar(0)
;value = F7, 0 ;Hit ground
;value = F7, (sysvar(1) > 5) + (sysvar(1) > 14)
;persistent = 0

[State 665, 7]
type = GameMakeAnim
trigger1 = Time = 0
trigger1 = !SysVar(0)
value = 60 + (sysvar(1) > 5) + (sysvar(1) > 14)
pos = 0, 0
under = sysvar(1) <= 10

[State 665, 8]
type = VelSet
trigger1 = Time = 0
y = 0

[State 665, 9] ;For hit up type
type = ChangeAnim
persistent = 0
triggerall = anim = [5171,5179]
triggerall = SelfAnimExist(5110 + (anim % 10))
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground anim
value = 5110 + (anim % 10)

[State 665, 10] ;For normal
type = ChangeAnim
persistent = 0
triggerall = Anim != [5111,5119]
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground frame
value = 5110

[State 665, 11] ;If just died
type = ChangeState
triggerall = !alive && p2stateno = 0 && roundstate = 3
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground frame
trigger3 = Anim = [5110,5119]
value = 5150

;[State 661, 12]
;type = VarSet
;trigger1 = SysVar(0)
;trigger1 = Time = 0
;sysvar(0) = 0

[State 665, 13] ;Friction
type = VelMul
trigger1 = 1
x = 0.85

[State 665, 14]
type = ForceFeedback
trigger1 = alive
trigger1 = Time = 0
time = 8
ampl = 240
waveform = sine

[State 665, 15]
type = ForceFeedback
trigger1 = !alive
trigger1 = Time = 0
ampl = 200, 7, -.467
time = 30
waveform = sine

[state 665, hitby]
type = hitby
trigger1 = time > 0
value = SCA, AA
ignorehitpause = 1

[State 665, get up]
type = selfstate
trigger1 = life >= 1
trigger1 = time > 600
trigger2 = time > 900
value = 5120
ctrl = 1

;---------------------------------------------------------------------------
;---------------------------------------------------------------------------
;===========================================================================
;------------------------------Wall Bounce State
;===========================================================================
[statedef 670]
type = A
movetype = H
physics = N

[State 672, Stop moving]
type = PosFreeze
trigger1 = 1
x = 1
y = 1

[state 670]
type = changeanim
trigger1 = time = 0
value = 5030
ignorehitpause = 1

[state 670, changestate]
type = changestate
trigger1 = hitshakeover
value = 671
;------------------------------------------------------------------------

[statedef 671]
type    = A
movetype= H
physics = N

[state 671, anim]
type = changeanim
trigger1 = anim != 5030
value = 5030

[State 670, Velocity]
type = velset
trigger1 = Time = 0
x = facing * gethitvar(xvel)
y = gethitvar(yvel)

[State 670, Gravity]
type = veladd
trigger1 = 1
y = 1.05

;[State 670, No scroll]
;type = ScreenBound
;triggerall = Pos y < -15
;trigger1 = BackEdgeBodyDist < 65
;trigger2 = FrontEdgeBodyDist < 65
;value = 1
;movecamera = 0,1

[State 670, Hit wall]
type = ChangeState
triggerall = Pos y < 0
trigger1 = BackEdgeBodyDist <= 20
trigger2 = FrontEdgeBodyDist <= 20
value = 672

[State 670, Hit ground]
type = SelfState
trigger1 = (Vel y > 0) && (Pos y >= 0)
value = 5100

;---------------------------------------------------------------------------
;Hit wall - part 2 bounce off wall
[statedef 672]
type    = A
movetype= H
physics = N

[State 672, Turn]
type = Turn
trigger1 = (Time = 0) && (FrontEdgeBodyDist <= 30)

[State 672, Pos]
type = PosAdd
trigger1 = Time = 0
x = 15 - BackEdgeBodyDist

[State 672, Stop moving]
type = PosFreeze
trigger1 = 1
x = 1
y = 1

[state 672, envshake]
type = envshake
trigger1 = time = 0
ampl = -12
time = 16

[State 672, No scroll]
type = ScreenBound
trigger1 = 1
value = 1
movecamera = 0,1

[State 672, Spark]
type = Explod
trigger1 = Time = 1
anim = F72
pos = 0,const(size.mid.pos.y)
postype = p1
sprpriority = 3
ownpal = 1

[state 672, anim]
type = changeanim
trigger1 = anim != 5030
value = 5030

[State 672, Sound]
type = PlaySnd
trigger1 = Time = 1
value = F7,0

[State 672, State]
type = ChangeState
trigger1 = time = 10
value = 673
;--------------------------------------------------------------------------
;wall bounce - part 3 fall toward ground
[Statedef 673]
type    = A
movetype= H
physics = N

[State 673, Vel Y]
type = VelSet
trigger1 = Time = 0
y = -24

[State 673, Vel X]
type = VelSet
trigger1 = Time = 0
x = (p2bodydist x * 0.021739)

[State 673, Turn]
type = Turn
trigger1 = (Time = 0) && (BackEdgeDist < 30)

[State 672, Gravity]
type = VelAdd
trigger1 = 1
y = 1.22

;[state 673, gravity]
;type = gravity
;trigger1 = 1

[State 673, Anim 5050] ;Self falling animation
type = ChangeAnim
trigger1 = Time = 0
trigger1 = !SelfAnimExist(5052)
value = 5050

[State 673, Anim 5052] ;Self falling animation (diagup type)
type = ChangeAnim
trigger1 = Time = 0
trigger1 = SelfAnimExist(5052)
value = 5052

[State 673, Anim 5060] ;Coming down - normal
type = ChangeAnim
trigger1 = Vel Y > -2
trigger1 = Anim = 5050
trigger1 = SelfAnimExist(5060)
persistent = 0
value = 5060

[State 673, Anim 5062] ;Coming down - diagup type
type = ChangeAnim
trigger1 = Vel Y > -2
trigger1 = Anim = 5052
trigger1 = SelfAnimExist(5062)
persistent = 0
value = 5062

[State 673, Hit ground]
type = SelfState
trigger1 = (Vel y > 0) && (Pos y >= 0)
value = 5100

;============================================================================
; Neutral Wall Bounce
;============================================================================
[statedef 675]
type = A
movetype = H
physics = N

[State 675, Stop moving]
type = PosFreeze
trigger1 = 1
x = 1
y = 1

[state 675]
type = changeanim
trigger1 = time = 0
value = 5030
ignorehitpause = 1

[state 675, changestate]
type = changestate
trigger1 = hitshakeover
value = 676
;------------------------------------------------------------------------

[statedef 676]
type    = A
movetype= H
physics = N

[state 676, anim]
type = changeanim
trigger1 = anim != 5030
value = 5030

[State 676, Velocity]
type = velset
trigger1 = Time = 0
x = facing * gethitvar(xvel)
y = gethitvar(yvel)

[State 676, Gravity]
type = veladd
trigger1 = 1
y = 1.05

;[State 670, No scroll]
;type = ScreenBound
;triggerall = Pos y < -15
;trigger1 = BackEdgeBodyDist < 65
;trigger2 = FrontEdgeBodyDist < 65
;value = 1
;movecamera = 0,1

[State 676, Hit wall]
type = ChangeState
triggerall = Pos y < 0
trigger1 = BackEdgeBodyDist <= 20
trigger2 = FrontEdgeBodyDist <= 20
value = 677

[State 676, Hit ground]
type = SelfState
trigger1 = (Vel y > 0) && (Pos y >= 0)
value = 5100

;---------------------------------------------------------------------------
;Hit wall - part 2 bounce off wall, No invunerabillity
[statedef 677]
type    = A
movetype= H
physics = N

[State 677, Turn]
type = Turn
trigger1 = (Time = 0) && (FrontEdgeBodyDist <= 30)

[State 677, Pos]
type = PosAdd
trigger1 = Time = 0
x = 15 - BackEdgeBodyDist

[State 677, Stop moving]
type = PosFreeze
trigger1 = 1
x = 1
y = 1

[State 677, No scroll]
type = ScreenBound
trigger1 = 1
value = 1
movecamera = 0,1

[state 677, screenshake]
type = envshake
trigger1 = time = 0
ampl = 12
time = 16

[State 677, Spark]
type = Explod
trigger1 = Time = 1
anim = F72
pos = 0,const(size.mid.pos.y)
postype = p1
sprpriority = 3
ownpal = 1

[state 677, anim]
type = changeanim
trigger1 = anim != 5030
value = 5030

[State 677, Sound]
type = PlaySnd
trigger1 = Time = 1
value = F7,0

[State 677, State]
type = ChangeState
trigger1 = time = 10
value = 678

;---------------------------------------------------------------------------
;Hit wall - part 2 bounce off wall,Invunerabillity
[statedef 6770]
type    = A
movetype= H
physics = N

[state 6770, nothitby]
type = nothitby
trigger1 = 1
value = SCA
ignorehitpause = 1

[State 6770, Turn]
type = Turn
trigger1 = (Time = 0) && (FrontEdgeBodyDist <= 30)

[State 6770, Pos]
type = PosAdd
trigger1 = Time = 0
x = 15 - BackEdgeBodyDist

[State 6770, Stop moving]
type = PosFreeze
trigger1 = 1
x = 1
y = 1

[State 6770, No scroll]
type = ScreenBound
trigger1 = 1
value = 1
movecamera = 0,1

[state 6770, screenshake]
type = envshake
trigger1 = time = 0
ampl = 12
time = 16

[State 6770, Spark]
type = Explod
trigger1 = Time = 1
anim = F72
pos = 0,const(size.mid.pos.y)
postype = p1
sprpriority = 3
ownpal = 1

[state 6770, anim]
type = changeanim
trigger1 = anim != 5030
value = 5030


[State 6770, Sound]
type = PlaySnd
trigger1 = Time = 1
value = F7,0

[State 6770, State]
type = ChangeState
trigger1 = time = 10
value = 6780
;--------------------------------------------------------------------------
;wall bounce - part 3 fall toward ground
[Statedef 678]
type    = A
movetype= H
physics = N

[State 678, Vel Y]
type = VelSet
trigger1 = Time = 0
y = 6

[State 678, Vel X]
type = VelSet
trigger1 = Time = 0
x = 1.5

[State 678, Turn]
type = null;Turn
trigger1 = (Time = 0) && (BackEdgeDist < 30)

[State 672, Gravity]
type = VelAdd
trigger1 = 1
y = 1.22

;[state 678, gravity]
;type = gravity
;trigger1 = 1

[State 678, Anim 5050] ;Self falling animation
type = ChangeAnim
trigger1 = Time = 0
trigger1 = !SelfAnimExist(5052)
value = 5050

[State 678, Anim 5052] ;Self falling animation (diagup type)
type = ChangeAnim
trigger1 = Time = 0
trigger1 = SelfAnimExist(5052)
value = 5052

[State 678, Anim 5060] ;Coming down - normal
type = ChangeAnim
trigger1 = Vel Y > -2
trigger1 = Anim = 5050
trigger1 = SelfAnimExist(5060)
persistent = 0
value = 5060

[State 678, Anim 5062] ;Coming down - diagup type
type = ChangeAnim
trigger1 = Vel Y > -2
trigger1 = Anim = 5052
trigger1 = SelfAnimExist(5062)
persistent = 0
value = 5062

[State 678, Hit ground]
type = SelfState
trigger1 = (Vel y > 0) && (Pos y >= 0)
value = 5100

;--------------------------------------------------------------------------
;wall bounce - part 3 fall toward ground, Invunerable
[Statedef 6780]
type    = A
movetype= H
physics = N

[state 6780, nothitby]
type = nothitby
trigger1 = 1
value = SCA
ignorehitpause = 1

[State 6780, Vel Y]
type = VelSet
trigger1 = Time = 0
y = -12

[State 6780, Vel X]
type = VelSet
trigger1 = Time = 0
x = 3

[State 6780, Turn]
type = Turn
trigger1 = (Time = 0) && (BackEdgeDist < 30)

[State 6780, Gravity]
type = VelAdd
trigger1 = 1
y = 1.22

;[state 678, gravity]
;type = gravity
;trigger1 = 1

[State 6780, Anim 5050] ;Self falling animation
type = ChangeAnim
trigger1 = Time = 0
trigger1 = !SelfAnimExist(5052)
value = 5050

[State 6780, Anim 5052] ;Self falling animation (diagup type)
type = ChangeAnim
trigger1 = Time = 0
trigger1 = SelfAnimExist(5052)
value = 5052

[State 6780, Anim 5060] ;Coming down - normal
type = ChangeAnim
trigger1 = Vel Y > -2
trigger1 = Anim = 5050
trigger1 = SelfAnimExist(5060)
persistent = 0
value = 5060

[State 6780, Anim 5062] ;Coming down - diagup type
type = ChangeAnim
trigger1 = Vel Y > -2
trigger1 = Anim = 5052
trigger1 = SelfAnimExist(5062)
persistent = 0
value = 5062

[State 6780, Hit ground]
type = SelfState
trigger1 = (Vel y > 0) && (Pos y >= 0)
value = 5100

;=============================================================================
;Ground Bounce - Bring to player
;=============================================================================
;Hit Freeze small
[statedef 680]
type = A
movetype = H
physics = N

[State 680, Stop moving]
type = PosFreeze
trigger1 = 1
x = 1
y = 1

[state 680]
type = changeanim
trigger1 = time = 0
value = 5030
ignorehitpause = 1

[state 680, changestate]
type = changestate
trigger1 = hitshakeover
value = 681

;-----------------------------------------------------------------------------
;Soft Ground bounce - Going down
[statedef 681]
;Custom Hit state, ground bounce
type = A
movetype = H
physics = N


[state 681, velocity]
type = hitvelset
trigger1 = time = 0
y = 40

[state 681, anim]
type = changeanim
trigger1 = time = 0
value = 5160


[state 681, stop x]
type = velmul
trigger1 = time = 0
x = 0.25


[state 681]
type = gravity
trigger1 = 1

[state 681, changestate]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 682

;-----------------------------------------------------------------------------
;Ground Bounce - Impact / bouncing
[statedef 682]
type = A
movetype = H
physics = N
anim = 5160

[state 682, impact]
type = velset
trigger1 = time = 0
y = 0

[State 682, 8]
type = Explod
trigger1 = Time = 0
anim = F62 
pos = 0, 0
ontop = 1
scale = 1.7, 0.5
persistent = 0
ownpal = 1

[State 682, 10]
type = PlaySnd
trigger1 = Time = 0
value = F7,2
persistent = 0

[state 682, shake]
type = envshake
trigger1 = time = 0
ampl = 5
freq = 50
phase = 50
time = 10

[state 682, impact 2]
type = posset
trigger1 = time = 0
y = 0

[state 682, bounce]
type = velset
trigger1 = time = 1
y = -45

[state 682, movefwd]
type = velset
trigger1 = time = 1
x = ceil(p2dist x*0.01)

[state 682, gravity]
type = gravity
trigger1 = time > 1

[state 682, down]
type = selfstate
trigger1 = time >= 2 
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 5110

;==========================================================
;Ground Bounce - Vertical Bounce Only
;==========================================================
;Hit Freeze small
[statedef 683]
type = A
movetype = H
physics = N

[State 683, Stop moving]
type = PosFreeze
trigger1 = 1
x = 1
y = 1

[state 683]
type = changeanim
trigger1 = time = 0
value = 5030
ignorehitpause = 1

[state 680, changestate]
type = changestate
trigger1 = hitshakeover
value = 684

;-----------------------------------------------------------------------------
;Soft Ground bounce - Going down
[statedef 684]
;Custom Hit state, ground bounce
type = A
movetype = H
physics = N


[state 684, velocity]
type = hitvelset
trigger1 = time = 0
y = 40

[state 684, anim]
type = changeanim
trigger1 = time = 0
value = 5160


[state 684, stop x]
type = velmul
trigger1 = time = 0
x = 0.25


[state 684]
type = veladd
trigger1 = 1
y = 1.22

[state 684, changestate]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 685

;-----------------------------------------------------------------------------
;Ground Bounce - Impact / bouncing
[statedef 685]
type = A
movetype = H
physics = N
anim = 5160

[state 685, impact]
type = velset
trigger1 = time = 0
y = 0

[State 685, 8]
type = Explod
trigger1 = Time = 0
anim = F62 
pos = 0, 0
ontop = 1
scale = 1.7, 0.5
persistent = 0
ownpal = 1

[State 685, 10]
type = PlaySnd
trigger1 = Time = 0
value = F7,2
persistent = 0

[state 685, shake]
type = envshake
trigger1 = time = 0
ampl = 5
freq = 50
phase = 50
time = 10

[state 685, impact 2]
type = posset
trigger1 = time = 0
y = 0

[state 685, bounce]
type = velset
trigger1 = time = 1
y = -32

[state 685, movefwd]
type = velset
trigger1 = time = 1
x = 0

[state 685, gravity]
type = veladd
trigger1 = time > 1
y = 1.22

[state 685, down]
type = selfstate
trigger1 = time >= 2 
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 5110
;--------------------------------------------------------------------------




;---------------------------------------------------------------------------

;---------------------------------------------------------------------------
;Kung Fu Throw - Attempt
; CNS difficulty: medium-advanced
; Description: Throws are not difficult to make, although then can be
;     tedious at times. Throw attempt states have a HitDef of a
;     special format. The key parameters in a throw are p1stateno
;     and p2stateno. If the HitDef successfully connects, then
;     the attacker will change to the state number specified by
;     p1stateno, and the opponent will be change to the state
;     number assigned to p2stateno. The special thing about p2stateno
;     is that the opponent will be temporarily brought into the
;     attacker's state file. In this case, no matter who the
;     opponent is, he will be taken to state 820 of this file (kfm.cns)
;     and remain here until the end of the throw (look at his debug
;     information when he is being thrown; the text changes to yellow
;     to mean that he is in another player's state file).
[Statedef 800]
type    = S
movetype= A
physics = S
juggle  = 0
velset = 0,0
ctrl = 0
anim = 800
sprpriority = 2

[State 800, 1]
type = HitDef
triggerall = p2movetype != A
Trigger1 = Time = 0
attr = S, NT          
hitflag = M-          
priority = 1, Miss    
sparkno = -1         
p1sprpriority = 1    
id = 800                   
p1facing = 1
p2facing = 1          
p1stateno = 810       
p2stateno = 820       
guard.dist = 0        
fall = 1  


;Attacking- Can't tech
[State 800, 1]
type = HitDef
triggerall = p2movetype = A
Trigger1 = Time = 0
attr = S, NT          
hitflag = M-          
priority = 1, Miss    
sparkno = -1         
p1sprpriority = 1    
id = 800                   
p1facing = 1
p2facing = 1          
p1stateno = 810       
p2stateno = 822       
guard.dist = 0        
fall = 1       

;Stunned - Can't tech
[State 800, 1]
type = HitDef
trigger1 = enemynear,anim = 5300
attr = S, NT          
hitflag = M         
priority = 1, Miss    
sparkno = -1         
p1sprpriority = 1    
id = 800                   
p1facing = 1
p2facing = 1          
p1stateno = 810       
p2stateno = 822       
guard.dist = 0        
fall = 1      

[State 800, 2]
type = ChangeState
Trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
;Grab Escape - p2
[statedef 805]
type = A
movetype = H
physics = S
ctrl = 0
facep2 = 1
sprpriority = 4

[state 805, anim]
type = changeanim
trigger1 = time = 0
trigger1 = SelfAnimExist(805)
value = 805

[state 805, anim]
type = changeanim
trigger1 = time = 0
trigger1 = !selfanimexist(805)
value = 120

;[state 1400, dim]
;type = bgpalfx
;trigger1 = time = 0
;time = 8
;mul = 200,200,200

;[state 805, freeze]
;type = pause
;trigger1 = time = 0
;time = 8
;endcmdbuftime = 8

;[state 805, sound]
;type = playsnd
;trigger1 = time = 0
;value = S805,0

[state 805, pos y]
type = posset
trigger1 = time = 0
y = 0

[state 805, velset]
type = velset
trigger1 = time = 10
x= -24

[state 805, nothitby]
type = nothitby
trigger1 = 1
value = SCA

[state 805, end]
type = selfstate
trigger1 = time = 35
value = 0
ctrl = 1

;---------------------------------------------------------------------------
;Grab Escape - p1
[statedef 806]
type = A
movetype = H
physics = S
ctrl = 0

[state 805, anim]
type = changeanim
trigger1 = time = 0
trigger1 = SelfAnimExist(130)
value = 130

[state 805, anim]
type = changeanim
trigger1 = time = 0
trigger1 = !selfanimexist(805)
value = 130

[state 1400, dim]
type = bgpalfx
trigger1 = time = 0
time = 8
mul = 200,200,200

[state 805, freeze]
type = pause
trigger1 = time = 0
time = 12
endcmdbuftime = 8

[state 805, sound]
type = playsnd
trigger1 = time = 0
value = S805,0

[state 805, pos y]
type = posset
trigger1 = time = 0
y = 0

[state 805, turn]
type = turn
trigger1 = prevstateno = 820
trigger1 = time = 0
persistent = 0
ignorehitpause

[state 805, velset]
type = velset
trigger1 = time = 10
x= -24

[state 805, nothitby]
type = nothitby
trigger1 = 1
value = SCA

[state 805, end]
type = selfstate
trigger1 = time = 35
value = 0
ctrl = 1

;---------------------------------------------------------------------------
;Shrink and Crush
[Statedef 810]
type    = S
movetype= A
physics = N
anim = 810
poweradd = 0

[state 810, tech]
type = changestate
triggerall = numtarget
trigger1 = target(800),stateno = 805
value = 806
persistent = 1


[state 810, explod]
type = explod
trigger1 = time = 0
anim = 2810
id = 810
postype = p1
pos = 0,0
removeongethit = 1
sprpriority = 4
scale = const(size.xscale),const(size.yscale)

[state 810, modifyexplod]
type = modifyexplod
trigger1 = animelemtime(2) = 0
trigger1 = var(2)
id = 810
scale = -const(size.xscale),const(size.yscale)
postype = p1
pos = -1,0
facing = 1


[state 810, snd]
type = playsnd
trigger1 = animelemtime(2) = 0
value = S810,0



[State 810, Holding fwd?]
type = VarSet
trigger1 = Time = 0
var(2) = command = "holdback"

[State 810, Grab Sound]
type = PlaySnd
trigger1 = AnimElem = 2
value = 1, 1

[State 810, Bind 1]
type = TargetBind
trigger1 = AnimElemTime(1) >= 0 && animelemtime(7) < 0
pos = 240, 0

[state 810, velset]
type = velset
trigger1 = animelemtime(7) = 0
x = 3.5
y = -18

[state 810, gravity]
type = gravity
trigger1 = pos y < -1

[state 810, velmul]
type = veladd
trigger1 = vel y > 1
y = 10
persistent = 0




[State 810, Width 2-11]
type = Width
trigger1 = 1
edge = 200,360

[State 810, holdfwd - Turn 6] ;If was holding fwd before, turn now
type = Turn
trigger1 = var(2)
trigger1 = AnimElem = 2

[State 810, holdfwd - Pos 6] ;If was holding fwd before, move a little
type = PosAdd
trigger1 = var(2)
trigger1 = AnimElem = 2
x = -37

[State 810, holdfwd - Turn Target 6] ;If was holding fwd before, turn target too
type = TargetFacing
trigger1 = var(2)
trigger1 = AnimElem = 2
value = -1

;[State 810, Turn 12]
;type = Turn
;trigger1 = AnimElem = 12

[State 810, Pos 15]
type = PosAdd
trigger1 = AnimElem = 15
x = -10

[State 810, State End]
type = ChangeState
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 811
ctrl = 0

;---------------------------------------------------------------------------
;1st Landing
[statedef 811]
type = C
movetype = A
physics = C
velset = 0,0
anim = 811

[state 811, posset]
type = posset
trigger1 = time = 0
y = 0

[State 811, Hurt 11]
type = TargetLifeAdd
trigger1 = time = 1
value = -120

[state 811, hitadd]
type = hitadd
trigger1 = time = 1
value = 1

[State 810, 1]
type = PlaySnd
trigger1 = time = 0
value = S5100, 0

[State 810, 1]
type = PlaySnd
trigger1 = time = 0
value = S660, 0

[state 810, earthquakes]
type = envshake
trigger1 = time = 0
time = 24
ampl = -24
freq = 60

[state 651, fx]
type = explod
trigger1 = time = 0
anim = F61
pos = 240,0
scale = 4,1.5
ownpal = 1

[State 810, Throw 11]
type = TargetState
trigger1 = time = 0
value = 821

[state 810, bounce]
type = velset
trigger1 = time = 8
y = -9

[state 811, gravity]
type = gravity
trigger1 = pos y < -1

[State 811, State End]
type = ChangeState
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 812

;---------------------------------------------------------------------------
;2nd Landing
[statedef 812]
type = C
movetype = A
physics = C
velset = 0,0
anim = 812

[state 812, posset]
type = posset
trigger1 = time = 0
y = 0

[State 810, 1]
type = PlaySnd
trigger1 = time = 0
value = S5100, 0

[state 812, earthquakes]
type = envshake
trigger1 = animelemtime(1) = 0
time = 12
ampl = -12
freq = 60

[State 811, State End]
type = ChangeState
trigger1 = animtime = 0
value = 813



;---------------------------------------------------------------------------
[statedef 813]
type = U
movetype = I
physics = N
velset = -18,-12
ctrl = 0
anim = 44

[state 811, nothitby]
type = nothitby
trigger1 = 1
value = SCA

[state 811, gravity]
type = gravity
trigger1 = time > 0

[state 811, land]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y 
value = 52

;---------------------------------------------------------------------------
;Techable thrown
[Statedef 820]
type    = A
movetype= H
physics = N
velset = 0,0

[State 820, 1]
type = ChangeAnim2
Trigger1 = Time = 0
value = 820

[state 820, tech throw]
type = changestate
triggerall = time < 12
trigger1 = ailevel = 0
trigger1 = command = "holdfwd" || command = "holdback"
trigger1 = command = "y" || command = "b" || command = "z" || command = "c"
trigger2 = command = "x" && command = "a"
trigger3 = ailevel > 4 
trigger3 = random < (ailevel * ifelse(ailevel>7,1,3))
value = 805

[State 1020, Afterimage]
type = AfterImage
trigger1 = Time = 0
length = 13
PalBright   =  30, 60,  30
PalContrast =  70, 70, 20
PalAdd      = -10,-10,-10
PalMul      = .85,.85,.50
TimeGap  = 1
FrameGap = 2
Trans = Add
time = 2

[State 1020, Afterimage]
type = AfterImageTime
trigger1 = AnimElemTime(8) < 0
time = 2

[state 820, shrink]
type = angledraw
trigger1 = animelemtime(2) > 1
trigger1 = animelemtime(12) < 0
scale = (1-((time-16)*0.02125)),(1-((time-16)*0.02125))
persistent = 1
ignorehitpause = 1


[state 820, shrink]
type = angledraw
trigger1 = animelemtime(12) >= 0
scale = 0.1,0.1
persistent = 1
ignorehitpause = 1

;In case attacker loses binding on player for any reason, this controller
;guarantees that the player will never get stuck in this thrown state.
[State 820, 2]
type = SelfState
trigger1 = time > 300
value = 5050

;---------------------------------------------------------------------------
;Untechable Thrown
[Statedef 822]
type    = A
movetype= H
physics = N
velset = 0,0

[State 820, 1]
type = ChangeAnim2
Trigger1 = Time = 0
value = 820

[State 1020, Afterimage]
type = AfterImage
trigger1 = Time = 0
length = 13
PalBright   =  30, 60,  30
PalContrast =  70, 70, 20
PalAdd      = -10,-10,-10
PalMul      = .85,.85,.50
TimeGap  = 1
FrameGap = 2
Trans = Add
time = 2

[State 1020, Afterimage]
type = AfterImageTime
trigger1 = AnimElemTime(8) < 0
time = 2

[state 820, shrink]
type = angledraw
trigger1 = animelemtime(2) > 1
trigger1 = animelemtime(12) < 0
scale = (1-((time-16)*0.02125)),(1-((time-16)*0.02125))
persistent = 1
ignorehitpause = 1


[state 820, shrink]
type = angledraw
trigger1 = animelemtime(12) >= 0
scale = 0.1,0.1
persistent = 1
ignorehitpause = 1


[State 820, 2]
type = SelfState
trigger1 = time > 300
value = 5050

;---------------------------------------------------------------------------
[Statedef 821]
type    = L
movetype= H
physics = N
velset = 0,0
poweradd = 40

[state 821, animation]
type = changeanim2
trigger1 = time = 0
value = 821

[state 821, posset]
type = posset
trigger1 = time = 0
y = 0


[state 821, angledraw]
type = angledraw
trigger1 = 1
scale = 0.2,0.01 


[State 821, 4] ;Hit ground
type = SelfState
trigger1 = alive
trigger1 = time > 140
trigger2 = time > 180
value = 5110 ;Hit ground

;---------------------------------------------------------------------------
;Skunk Cannon
[statedef 1000]
type = S
movetype = A
physics = S
poweradd = 110
velset = 0,0
ctrl = 0
sprpriority = 1

;===========
;Armor start
;===========
[state 1000, animation]
type = changeanim
trigger1 = anim != 1000
value = 1000

[state 1000, armor counter]
type = varset
triggerall = prevstateno != 1000
trigger1 = time = 0
trigger1 = Var(21) = 1
V = 20
value = 3

[state 1000, excess armor check]
type = varset
trigger1 = var(20) > 3
var(20) = 3
persistent = 1
ignorehitpause = 1

[state 1000, armor intiator turn off]
type = varset
trigger1 = time = 1
V = 21
value = 0

;determine what frame
[state 1000, remember frame]
type = varset
trigger1 = time <= 0
v = 22
value = animelemno(0)
ignorehitpause = 1

;delay effect
[state 1000, delay]
type = changeanim 
trigger1 = var(31) < floor(gethitvar(hittime)*1.2)
value = anim
elem = var(22)

[state 1000, freeze location]
type = posfreeze
trigger1 = var(31) < floor(gethitvar(hittime)*1.2)
value = 1
;--------------------------

[state 1000, still take damage]
type = lifeadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) != 0
value = floor(-gethitvar(damage)*1)
persistent = 1

[state 1000, armor count down]
type = varadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) > 0
V = 20
value = -1
persistent = 1

[state 1000, Unstoppable]
type = null;hitoverride
trigger1 = Life > 1
trigger1 = Var(20) > 0
trigger1 = animelemtime(3) > 0  && animelemtime(16) < 0
attr = SCA, AP
stateno = 1000
time = 1
persistent = 1

[State 1050, flash red]
type = PalFX
trigger1 = Time = 0
trigger1 = gethitvar(damage) != 0
time = 7
add = 100,0,0
IgnoreHitPause = 1

[state 1000, settypeset]
type = statetypeset
trigger1 = animelem = 3
statetype = A

[state 1000, statetypeset]
type = statetypeset
trigger1 = animelem = 6
statetype = S

[state 1000, velset]
type = velset
triggerall = ailevel = 0
trigger1 = animelemtime(3) = 1
x = ifelse(command = "holdfwd", 60, ifelse(command = "holdback", -12,0))


;[state 1000, nothitby]
;type = nothitby
;trigger1 = animelemtime(10) >= 0 && animelemtime(15) < 0
;value = ,AP
;ignorehitpause = 1
;persistent = 1 


[state 1000, AI]
type = velset
triggerall = ailevel > 0
triggerall = animelemtime(3) = 1 
trigger1 = enemynear,movetype = H
x = 60
persistent = 1

[state 1000, AI]
type = velset
triggerall = ailevel > 0
triggerall = animelemtime(3) = 1 
trigger1 = enemynear,movetype != H
x = -12
persistent = 1

[State 1000, hitdef]
type = HitDef
trigger1 = animelem = 5
persistent = 0
attr = S, SA
animtype  = Heavy
damage    = 15,2
guardflag = MA
hitflag = MAF
priority = 1,miss
pausetime = 2,2
sparkno = 1
sparkxy = -10,-60
hitsound = S5000, 1
guardsound = S120, 0
ground.type = high
ground.slidetime = 16
ground.hittime  = 16
ground.velocity = -16,0
air.velocity = -12,-10
fall = 0
fall.recovertime = 30
fall.recover = 1
guard.slidetime = 12
guard.hittime = 12
guard.velocity = -20

[State 1000, hitdef]
type = HitDef
trigger1 = animelem = 9
persistent = 0
attr = S, SA
animtype  = Heavy
damage    = 15,2
guardflag = MA
hitflag = MAF
priority = 1,miss
pausetime = 2,2
sparkno = 1
sparkxy = -10,-60
hitsound = S5000, 1
guardsound = S120, 0
ground.type = high
ground.slidetime = 12
ground.hittime  = 12
ground.velocity = -16,0
air.velocity = -12,-10
fall = 0
fall.recovertime = 30
fall.recover = 1
guard.slidetime = 12
guard.hittime = 12
guard.velocity = -20

;------------------------------------
;Projectiles
;
[state 1000, playsnd]
type = playsnd
trigger1 = animelemtime(10) = 0
value = S1300,0;S1000,5
persistent = 0

[state 1000, playsnd]
type = playsnd
trigger1 = animelemtime(10) = 0
value = S1300,0;S1000,5
persistent = 0

[state 1000, Projectile 1]
type = helper
trigger1 = !numhelper(1000)
trigger1 = animelemtime(10) = 0
name = "Pastilla's Skunk Cannon 2"
stateno = 4000
id = 1000
postype = p1
pos = 327,-337
sprpriority = 2

[State 4000, Projectile 2] 
type = projectile
trigger1 = animelemtime(12) = 0
trigger1 = numprojID(1000) < 1 
attr = S, SP
projanim = 3050
projid = 1000
projhitanim = 3051
projscale = const(size.xscale)*2,const(size.yscale)*2
projremovetime = 90
velocity = 24,-1+(random%3)
postype = p1
offset = 327,-337
animtype  = heavy
damage    = 30,6
guardflag = MA
getpower = 10
givepower = 15
hitflag = MAF
pausetime = 1,3
sparkno = -1
sparkxy = -10,-60
hitsound   = F5,3
hitonce = 1
p2facing = 1
p2sprpriority = 1
guardsound = S120, 0
ground.type = high
ground.slidetime = 16
ground.hittime  = 16
ground.velocity = -32,-8
air.velocity = -32,-8
guard.velocity = -27           
guard.hittime = 14
guard.slidetime = 14
airguard.velocity = -12,-4 
airguard.hittime = 16
;p2stateno = 675
guard.kill = 1
guard.dist = 320
fall = 1
fall.recover = 1
fall.recovertime = 30

;[State 4000, Projectile 3] 
;type = projectile
;trigger1 = animelemtime(14) = 0
;attr = S, SP
;projanim = 3050
;projid = 1000
;projhitanim = 3051
;projscale = const(size.xscale)*2,const(size.yscale)*2
;projremovetime = 90
;velocity = 16,-2+(random%3)
;postype = p1
;offset = 327,-337
;animtype  = heavy
;damage    = 20,7
;guardflag = MA
;etpower = 10
;givepower = 15
;hitflag = MAF
;pausetime = 1,3
;sparkno = -1
;sparkxy = -10,-60
;hitsound   = F5,1
;hitonce = 1
;p2facing = 1
;p2sprpriority = 1
;guardsound = S120, 0
;ground.type = high
;ground.slidetime = 14
;ground.hittime  = 14
;ground.velocity = -30,-4
;air.velocity = -28,-2
;guard.velocity = -36           
;guard.hittime = 14
;guard.slidetime = 14
;airguard.velocity = -24,-4
;airguard.hittime = 16
;guard.kill = 1
;guard.dist = 200
;fall = 1
;fall.recover = 1
;fall.recovertime = 30


[state 1000, explod FX]
TYPE = explod
trigger1 = animelemtime(10) = 0
anim = 2050
postype = p1
sprpriority = 2
pos = -110,-210
bindtime = -1
ownpal = 1
scale = const(size.xscale)*1.5,const(size.yscale)*1.5

;[state 1000, helper]
;type = helper
;trigger1 = animelemtime(10) = 0
;name = "Pastilla's Skunk Cannon"
;stateno = 10000
;id = 1000
;postype = p1
;pos = 327,-337
;sprpriority = 2





[state 1000, playsnd]
type = playsnd
trigger1 = animelemtime(6) = 0
value = S52,0

[State 52, 4]
type = EnvShake
trigger1 = animelemtime(6) = 0
time = 14
ampl = 8
freq = 100
phase = 100

[state x, combo damage score]
type = varadd
triggerall = numhelper(1000) > 0
trigger1 = helper(1000),movehit = 1
v = 18
value = -3
persistent = 0
ignorehitpause = 1

[state 1000, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
;Skunk Cannon Heavy
[statedef 1010]
type = S
movetype = A
physics = S
poweradd = 140
velset = 0,0
ctrl = 0
sprpriority = 1


;===========
;Armor start
;===========
[state 1000, animation]
type = changeanim
trigger1 = anim != 1010
value = 1010

[state 1000, armor counter]
type = varset
triggerall = prevstateno != 1010
trigger1 = time = 0
trigger1 = Var(21) = 1
V = 20
value = 3

[state 1010, excess armor check]
type = varset
trigger1 = var(20) > 5
var(20) = 5
persistent = 1
ignorehitpause = 1

[state 1010, armor intiator turn off]
type = varset
trigger1 = time = 1
V = 21
value = 0

;determine what frame
[state 1010, remember frame]
type = varset
trigger1 = time <= 0
v = 22
value = animelemno(0)
ignorehitpause = 1

;delay effect
[state 1010, delay]
type = changeanim 
trigger1 = var(31) < floor(gethitvar(hittime)*1.2)
value = anim
elem = var(22)

[state 1010, freeze location]
type = posfreeze
trigger1 = var(31) < floor(gethitvar(hittime)*1.2)
value = 1
;--------------------------

[state 1010, still take damage]
type = lifeadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) != 0
value = floor(-gethitvar(damage)*1)
persistent = 1

[state 1010, armor count down]
type = varadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) > 0
V = 20
value = -1
persistent = 1

[state 1010, Unstoppable]
type = null;hitoverride
trigger1 = Life > 1
trigger1 = Var(20) > 0
trigger1 = animelemtime(3) > 0 && animelemtime(16) < 0
attr = SCA, AP
stateno = 1010
time = 1
persistent = 1

[State 1010, flash red]
type = PalFX
trigger1 = Time = 0
trigger1 = gethitvar(damage) != 0
time = 7
add = 100,0,0
IgnoreHitPause = 1

[state 1000, settypeset]
type = statetypeset
trigger1 = animelem = 3
statetype = A

[state 1000, statetypeset]
type = statetypeset
trigger1 = animelem = 6
statetype = S

[state 1010, nothitby]
type = nothitby
trigger1 = animelemtime(10) >= 0 && animelemtime(15) < 0
value = ,AP
ignorehitpause = 1
persistent = 1 

[state 1010, velset]
type = velset
triggerall = vel x < 8 && vel x > -4
trigger1 = animelemtime(3) = 1 
x = ifelse(command = "holdfwd", 36, ifelse(command = "holdback", -12,0))
persistent = 1

[state 1010, AI]
type = velset
triggerall = ailevel > 0
triggerall = animelemtime(3) = 1
trigger1 = enemynear,movetype = H
x = 36
persistent = 1

[state 1010, AI]
type = veladd
triggerall = ailevel > 0
triggerall = animelemtime(3) = 1 
trigger1 = enemynear,movetype != H
x = -12
persistent = 1

[State 1010, hitdef]
type = HitDef
trigger1 = animelem = 5
persistent = 0
attr = S, SA
animtype  = Heavy
damage    = 15,1
guardflag = MA
hitflag = MAF
priority = 1,miss
pausetime = 2,2
sparkno = 1
sparkxy = -10,-60
hitsound = S5000, 1
guardsound = S120, 0
ground.type = high
ground.slidetime = 16
ground.hittime  = 16
ground.velocity = -16,0
air.velocity = -12,-10
fall = 0
fall.recovertime = 30
fall.recover = 1
guard.slidetime = 12
guard.hittime = 12
guard.velocity = -20

[State 1010, hitdef]
type = HitDef
trigger1 = animelem = 9
persistent = 0
attr = S, SA
animtype  = Heavy
damage    = 15,2
guardflag = MA
priority = 1,miss
hitflag = MAF
pausetime = 2,2
sparkno = 1
sparkxy = -10,-60
hitsound = S5000, 1
guardsound = S120, 0
ground.type = high
ground.slidetime = 12
ground.hittime  = 12
ground.velocity = -16,0
air.velocity = -12,-10
fall = 0
fall.recovertime = 30
fall.recover = 1
guard.slidetime = 12
guard.hittime = 12
guard.velocity = -20

[state 1000, explod FX]
TYPE = explod
trigger1 = animelemtime(10) = 0
anim = 2050
postype = p1
sprpriority = 2
pos = -110,-210
bindtime = -1
ownpal = 1
scale = const(size.xscale)*1.5,const(size.yscale)*1.5

;------------------------------------
;Projectiles
;

[state 10000, playsnd]
type = playsnd
trigger1 = animelemtime(10) = 0
value = S1300,0;S1000,5
persistent = 0

[state 10000, playsnd]
type = playsnd
trigger1 = animelemtime(10) = 0
value = S1300,0;S1000,5
persistent = 0


[state 1010, Projectile 1]
type = helper
trigger1 = !numhelper(1000)
trigger1 = animelemtime(10) = 0
name = "Pastilla's Skunk Cannon 2"
stateno = 4001
id = 1000
postype = p1
pos = 327,-337
sprpriority = 2



[State 4000, Projectile 3] 
type = projectile
trigger1 = animelemtime(12) = 0
trigger1 = numprojid(1000) < 2
attr = S, SP
projanim = 3050
projid = 1000
projhitanim = 3051
projscale = const(size.xscale)*2,const(size.yscale)*2
projremovetime = 75
velocity = 48,-2+(random%3)
postype = p1
offset = 327,-337
animtype  = heavy
damage    = 30,6
guardflag = MA
getpower = 10
givepower = 15
hitflag = MAF
pausetime = 1,3
sparkno = -1
sparkxy = -10,-60
hitsound   = F5,3
hitonce = 1
p2facing = 1
p2sprpriority = 1
guardsound = S120, 0
ground.type = high
ground.slidetime = 12
ground.hittime  = 12
ground.velocity = -48,-8
air.velocity = -48,-8
guard.velocity = -52            
guard.hittime = 12
guard.slidetime = 12
airguard.velocity = -24,-4 
airguard.hittime = 16
;p2stateno = 675
guard.kill = 1
guard.dist = 320
fall = 1
fall.recover = 1
fall.recovertime = 30



[state 1010, playsnd]
type = playsnd
trigger1 = animelemtime(6) = 0
value = S52,0

[State 1010, 4]
type = EnvShake
trigger1 = animelemtime(6) = 0
time = 14
ampl = 8
freq = 100
phase = 100

[state x, combo damage score]
type = varadd
triggerall = numhelper(1010) > 0
trigger1 = helper(1010),movehit = 1
v = 18
value = -3
persistent = 0
ignorehitpause = 1

[state 1010, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1



;====================================================================
;  Pastilla Skunk Cannon Gas FX
;====================================================================
;Light version
[statedef 10000]
type = S
movetype = A
Physics = N
velset = 0,0
ctrl = 0
anim = 9999

[state 10000, playsnd]
type = playsnd
trigger1 = time = 0
value = S1000,5
persistent = 0

[state 10000, playsnd]
type = playsnd
trigger1 = time = 0
value = S1000,5
persistent = 0

[state 10000, end]
type = destroyself
trigger1 = root,movetype = H

[state 10000, varset]
type = varset
trigger1 = time = 0
v = 10
value = 3

[state 10000, changestate]
type = changestate
trigger1 = time = 1
value = 10001

;-----------------------------------------------------------------------
;Hard version
[statedef 10010]
type = S
movetype = A
Physics = N
velset = 0,0
ctrl = 0
anim = 9999

[state 10000, playsnd]
type = playsnd
trigger1 = time = 0
value = S1000,5
persistent = 0

[state 10000, playsnd]
type = playsnd
trigger1 = time = 0
value = S1000,5
persistent = 0

[state 10010, varset]
type = varset
trigger1 = time = 0
v = 10
value = 5

[state 10000, end]
type = destroyself
trigger1 = root,movetype = H

[state 10010, changestate]
type = changestate
trigger1 = time = 1
value = 10011

;--------------------------------------------------------------------------------
;Light Gas Attack
[statedef 10001]
type = S
movetype = A
physics = N
velset = 0,0
ctrl = 0
sprpriority = 2

[state 10001, nothitby]
type = nothitby
trigger1 = 1
VALUE = SCA, AA,AT
ignorehitpause = 1

[state 10000, attack variable]
type = attackmulset
trigger1 = time = 0
value = parent,fvar(10)

[State 10000, 2]
type = HitDef
triggerall = var(10) > 0
trigger1 = !movecontact
attr = S, SP
animtype  = back
damage    = ifelse(animelemtime(6) < 0, 27,18),6
guardflag = MA
hitflag = MAF
pausetime = 2,ifelse(var(10)=1,6,2)
id = 4000
sparkno = ifelse(var(10) = 1, 3,1)
sparkxy = 40,0
hitsound   = F5,ifelse(var(10) = 1, 3,1)
guardsound = S120, 0
ground.type = high
hitonce = 1
ground.slidetime = 12
ground.hittime  = 12
p1sprpriority = 3
ground.velocity = ifelse(animelemtime(6) < 0, -24,-12),ifelse(animelemtime(6) < 0, -12,0)
air.velocity = ifelse(animelemtime(6) < 0, -24,-12),ifelse(animelemtime(6) < 0, -16,0)
guard.velocity = ifelse(animelemtime(6) < 0, -26,-8)             
guard.hittime = ifelse(animelemtime(6) < 0, 8,6)
guard.slidetime = ifelse(animelemtime(6) < 0, 8,6)
air.hittime = 30
airguard.velocity = ifelse(var(10)=1,-16,-4),ifelse(animelemtime(6) < 0,-6,-2) 
airguard.hittime = 12
air.fall =ifelse(animelemtime(6) < 0, 1,0)
fall = ifelse(animelemtime(6) < 0, 1,0)
fall.recover = 1
fall.recovertime = 30
ground.cornerpush.veloff  = 0
guard.dist = 500
envshake.ampl = -6
envshake.time = 8

[state 10000, attackdist]
type = attackdist
trigger1 = 1
value = 850

[state 10001, varadd]
type = varadd
trigger1 = gethitvar(damage) != 0
trigger2 = movecontact
v = 10
value = -1
ignorehitpause
persistent = 0

[state 10001, hitoverride]
type = hitoverride
trigger1 = 1
attr = SCA, AP,AA,AT
time = 1
stateno = 10001
ignorehitpause = 1
persistent = 1

[state 21000, changestate]
type = changestate
trigger1 = movecontact
trigger1 = var(10) > 0
value = 10001

[State 0, TargetState]
type = TargetState
triggerall = NumTarget(4000)
trigger1 = movehit
trigger1 = var(10) = 1
value = 4020
ID = 4000
ignorehitpause = 1

[State 0, Helper]
type = Helper
trigger1 = NumTarget(4000)
trigger1 = movehit
trigger1 = var(10) = 1
name = "Ranged Poison effect"
ID = 4006
stateno = 4006 
pos = 0,0
postype = p2
facing = -1
ownpal = 1
ignorehitpause = 1

[state 10000, anim]
type = changeanim
trigger1 = anim != 10000
value = 10000

[state 10000, end]
type = destroyself
trigger1 = animtime = 0
trigger2 = root,movetype = H



;---------------------------------------------------------------------------
; Hard version
[statedef 10011]
type = S
movetype = A
physics = N
velset = 0,0
ctrl = 0
sprpriority = 2

[state 10011, nothitby]
type = nothitby
trigger1 = 1
VALUE = SCA, AA,AT
ignorehitpause = 1

[state 10011, attack variable]
type = attackmulset
trigger1 = time = 0
value = parent,fvar(10)

[State 10011, 2]
type = HitDef
triggerall = var(10) > 0
trigger1 = !movecontact
attr = S, SP
animtype  = back
damage    = ifelse(animelemtime(6) < 0, 16,12),4
guardflag = MA
hitflag = MAF
pausetime = 2,ifelse(var(10)=1,6,2)
id = 4000
sparkno = ifelse(var(10) = 1, 3,1)
sparkxy = 40,0
hitsound   = F5,ifelse(var(10) = 1, 3,1)
guardsound = S120, 0
hitonce = 1
ground.type = high
ground.slidetime = 12
ground.hittime  = 12
p1sprpriority = 3
ground.velocity = ifelse(animelemtime(6) < 0, -24,-12),ifelse(animelemtime(6) < 0, -12,0)
air.velocity = ifelse(animelemtime(6) < 0, -24,-12),ifelse(animelemtime(6) < 0, -16,0)
guard.velocity = ifelse(animelemtime(6) < 0, -26,-8)             
guard.hittime = ifelse(animelemtime(6) < 0, 16,8)
guard.slidetime = ifelse(animelemtime(6) < 0, 16,8)
air.hittime = 30
airguard.velocity = ifelse(var(10)=1,-16,-4),ifelse(animelemtime(6) < 0,-6,-2) 
airguard.hittime = 22
air.fall =ifelse(animelemtime(6) < 0, 1,0)
fall = ifelse(animelemtime(6) < 0, 1,0)
fall.recover = 1
fall.recovertime = 30
ground.cornerpush.veloff  = 0
guard.dist = 500
envshake.ampl = -6
envshake.time = 8

[state 10011, attackdist]
type = attackdist
trigger1 = 1
value = 800

[state 10011, varadd]
type = varadd
trigger1 = gethitvar(damage) != 0
trigger2 = movecontact
v = 10
value = -1
ignorehitpause
persistent = 0

[state 10011, hitoverride]
type = hitoverride
trigger1 = 1
attr = SCA, AP,AA,AT
time = 1
stateno = 10011
ignorehitpause = 1
persistent = 1

[state 21000, changestate]
type = changestate
trigger1 = movecontact
trigger1 = var(10) > 0
value = 10011

[State 0, TargetState]
type = TargetState
triggerall = NumTarget(4000)
trigger1 = movehit
trigger1 = var(10) = 3
value = 4020
ID = 4000
ignorehitpause = 1

[State 0, Helper]
type = Helper
trigger1 = NumTarget(4000)
trigger1 = movehit
trigger1 = var(10) = 3
name = "Ranged Poison effect"
ID = 4006
stateno = 4006 
pos = 0,0
postype = p2
facing = -1
ownpal = 1
ignorehitpause = 1

[state 10000, anim]
type = changeanim
trigger1 = anim != 10000
value = 10000

[state 10000, end]
type = destroyself
trigger1 = animtime = 0
trigger2 = parent,movetype = H

;---------------------------------------------------------------------------

;Skunk Cannon EX: Skunk Vaccuum
[statedef 1020]
type = S
movetype = A
physics = S
velset = 0,0
ctrl = 0
sprpriority = 1

[state X, invunerability]
type = NOTHITBY
trigger1 = time < 12
value = SCA
ignorehitpause = 1

[State X, Blink Yellow]
type = PalFX
trigger1 = time%2
time = 1
add = 150,75,0 ;32,16,0
sinadd = 64,32,5,3
ignorehitpause

[state X, metermanagement]
type = helper
trigger1 = time = 0
trigger1 = !numhelper(1021)
stateno = 1021
name = "Skunk Canon Meter Add"
id = 1021
postype = p1
pos = 0,0


;===========
;Armor start
;===========
[state 1020, animation]
type = changeanim
trigger1 = anim != 1020
value = 1020

[state 1020, armor counter]
type = varset
triggerall = prevstateno != 1020
trigger1 = time = 0
trigger1 = Var(21) = 1
V = 20
value = 3

[state 1020, excess armor check]
type = varset
trigger1 = var(20) > 5
var(20) = 5
persistent = 1
ignorehitpause = 1

[state 1020, armor intiator turn off]
type = varset
trigger1 = time = 1
V = 21
value = 0

;determine what frame
[state 1020, remember frame]
type = varset
trigger1 = time <= 0
v = 22
value = animelemno(0)
ignorehitpause = 1

;delay effect
[state 1020, delay]
type = changeanim 
trigger1 = var(31) < floor(gethitvar(hittime)*1.8)
value = anim
elem = var(22)

[state 1020, freeze location]
type = posfreeze
trigger1 = var(31) < floor(gethitvar(hittime)*1.8)
value = 1
;--------------------------

[state 1020, still take damage]
type = lifeadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) != 0
value = floor(-gethitvar(damage)*0.5)
persistent = 1

[state 1020, armor count down]
type = varadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) > 0
V = 20
value = -1
persistent = 1

[state 1020, Unstoppable]
type = hitoverride
trigger1 = Life > 1
trigger1 = Var(20) > 0
trigger1 = animelemtime(16) < 0
attr = SCA, AP
stateno = 1020
time = 1
persistent = 1

[State 1020, flash red]
type = PalFX
trigger1 = Time = 0
trigger1 = gethitvar(damage) != 0
time = 7
add = 100,0,0
IgnoreHitPause = 1

[state 1020, settypeset]
type = statetypeset
trigger1 = animelem = 3
statetype = A

[state 1020, statetypeset]
type = statetypeset
trigger1 = animelem = 6
statetype = S

[state 1020, nothitby]
type = nothitby
trigger1 = animelemtime(10) >= 0 && animelemtime(15) < 0
value = ,AP
ignorehitpause = 1
persistent = 1 

[state 1020, velset]
type = velset
triggerall = vel x < 8 && vel x > -4
trigger1 = animelemtime(3) = 1 
x = ifelse(command = "holdfwd", 36, ifelse(command = "holdback", -12,0))
persistent = 1

[state 1020, AI]
type = velset
triggerall = ailevel > 0
triggerall = animelemtime(3) = 1
trigger1 = enemynear,movetype = H
x = 36
persistent = 1

[state 1020, AI]
type = veladd
triggerall = ailevel > 0
triggerall = animelemtime(3) = 1 
trigger1 = enemynear,movetype != H
x = -12
persistent = 1

[State 1020, hitdef]
type = HitDef
trigger1 = animelem = 5
persistent = 0
attr = S, SA
animtype  = Heavy
damage    = 15,1
guardflag = MA
hitflag = MAF
priority = 1,miss
pausetime = 2,2
sparkno = 1
sparkxy = -10,-60
hitsound = S5000, 1
guardsound = S120, 0
ground.type = high
ground.slidetime = 16
ground.hittime  = 16
ground.velocity = -16,0
air.velocity = -12,-10
fall = 0
fall.recovertime = 30
fall.recover = 1
guard.slidetime = 12
guard.hittime = 12
guard.velocity = -20

[State 1020, hitdef]
type = HitDef
trigger1 = animelem = 9
persistent = 0
attr = S, SA
animtype  = Heavy
damage    = 15,2
guardflag = MA
priority = 1,miss
hitflag = MAF
pausetime = 2,2
sparkno = 1
sparkxy = -10,-60
hitsound = S5000, 1
guardsound = S120, 0
ground.type = high
ground.slidetime = 12
ground.hittime  = 12
ground.velocity = -16,0
air.velocity = -12,-10
fall = 0
fall.recovertime = 30
fall.recover = 1
guard.slidetime = 12
guard.hittime = 12
guard.velocity = -20

[state 1020, explod FX]
TYPE = explod
trigger1 = animelemtime(10) = 0
anim = 2050
postype = p1
sprpriority = 2
pos = -110,-210
bindtime = -1
ownpal = 1
scale = const(size.xscale)*1.5,const(size.yscale)*1.5

;------------------------------------
;Projectiles
;

[state 1020, playsnd]
type = playsnd
trigger1 = animelemtime(10) = 0
value = S1300,0;S1000,5
persistent = 0

[state 1020, playsnd]
type = playsnd
trigger1 = animelemtime(10) = 0
value = S1300,0;S1000,5
persistent = 0


[state 1020, Projectile 1]
type = helper
trigger1 = !numhelper(1000)
trigger1 = animelemtime(10) = 0
name = "Pastilla's Skunk Cannon 2"
stateno = 4002
id = 1000
postype = p1
pos = 327,-337
sprpriority = 2

[State 1020, Projectile 2] 
type = null;projectile
trigger1 = animelemtime(12) = 0
trigger1 = numprojID(1000) < 2
attr = S, SP
projanim = 3050
projid = 1000
projhitanim = 3051
projscale = const(size.xscale)*2,const(size.yscale)*2
projremovetime = 75
velocity = 64,-1+(random%3)
postype = p1
offset = 327,-337
animtype  = heavy
damage    = 20,4
guardflag = MA
getpower = 10
givepower = 15
hitflag = MAF
pausetime = 1,3
sparkno = -1
sparkxy = -10,-60
hitsound   = F5,1
hitonce = 1
p2facing = 1
p2sprpriority = 1
guardsound = S120, 0
ground.type = high
ground.slidetime = 16
ground.hittime  = 16
ground.velocity = -12,0
air.velocity = -10,-4
guard.velocity = -30            
guard.hittime = 12
guard.slidetime = 12
airguard.velocity = -15,-2 
airguard.hittime = 16
guard.kill = 1
guard.dist = 200

[State 1020, Projectile 3] 
type = null;projectile
trigger1 = animelemtime(14) = 0
trigger1 = numprojid(1000) < 2
attr = S, SP
projanim = 3050
projid = 1000
projhitanim = 3051
projscale = const(size.xscale)*2,const(size.yscale)*2
projremovetime = 75
velocity = 64,-1+(random%3)
postype = p1
offset = 327,-337
animtype  = heavy
damage    = 20,4
guardflag = MA
getpower = 10
givepower = 15
hitflag = MAF
pausetime = 1,3
sparkno = -1
sparkxy = -10,-60
hitsound   = F5,3
hitonce = 1
p2facing = 1
p2sprpriority = 1
guardsound = S120, 0
ground.type = high
ground.slidetime = 12
ground.hittime  = 12
ground.velocity = -12,0
air.velocity = -10,-4
guard.velocity = -30            
guard.hittime = 18
guard.slidetime = 18
airguard.velocity = -15,-2 
airguard.hittime = 16
guard.kill = 1
guard.dist = 200
fall = 0
fall.recover = 1
fall.recovertime = 30

[State 1010, Projectile 4] 
type = null;projectile
trigger1 = animelemtime(16) = 0
attr = S, SP
projanim = 3050
projid = 1000
projhitanim = 3051
projscale = const(size.xscale)*2,const(size.yscale)*2
projremovetime = 75
velocity = 64,-1+(random%3)
postype = p1
offset = 327,-337
animtype  = heavy
damage    = 20,4
guardflag = MA
getpower = 10
givepower = 15
hitflag = MAF
pausetime = 1,3
sparkno = -1
sparkxy = -10,-60
hitsound   = F5,1
hitonce = 1
p2facing = 1
p2sprpriority = 1
guardsound = S120, 0
ground.type = high
ground.slidetime = 16
ground.hittime  = 16
ground.velocity = -12,0
air.velocity = -10,-4
guard.velocity = -30           
guard.hittime = 12
guard.slidetime = 12
airguard.velocity = -15,-2
airguard.hittime = 16
guard.kill = 1
guard.dist = 200

[State 4000, Projectile 5] 
type = projectile
trigger1 = animelemtime(12) = 0
attr = S, SP
projanim = 3050
projid = 1000
projhitanim = 3051
projscale = const(size.xscale)*2,const(size.yscale)*2
projremovetime = 75
velocity = 64,-1+(random%3)
postype = p1
offset = 327,-337
animtype  = heavy
damage    = 30,6
guardflag = MA
getpower = 10
givepower = 15
hitflag = MAF
pausetime = 1,3
sparkno = -1
sparkxy = -10,-60
hitsound   = F5,1
hitonce = 1
p2facing = 1
p2sprpriority = 1
guardsound = S120, 0
ground.type = high
ground.slidetime = 16
ground.hittime  = 16
ground.velocity = -120,-36
air.velocity = -120,-36
guard.velocity = -60            
guard.hittime = 12
p2stateno = ifelse(var(7) > 0, 670, 675)
guard.slidetime = 12
airguard.velocity = -30,-4 
guard.kill = 1
guard.dist = 200
fall = 1
fall.recover = 1
fall.recovertime = 40

[state 1010, playsnd]
type = playsnd
trigger1 = animelemtime(6) = 0
value = S52,0

[State 1010, 4]
type = EnvShake
trigger1 = animelemtime(6) = 0
time = 14
ampl = 8
freq = 100
phase = 100

[state 1010, wallbounce check]
type = varadd
trigger1 = animelemtime(18) = 0
var(7) = -1
ignorehitpause = 1
persistent = 0

[state x, combo damage score]
type = varadd
triggerall = numhelper(1010) > 0
trigger1 = helper(1010),movehit = 1
v = 18
value = -9
persistent = 0
ignorehitpause = 1

[state 1010, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
;EX meter management helper
[statedef 1021]
type = U
movetype = I
anim = 9999
ctrl = 0

[state 1021, poweradd]
type = poweradd
trigger1 = time = 0
value = -500

[state 1021, destroyself]
type = destroyself
trigger1 = time = 64
trigger2 = parent,movetype = H





;---------------------------------------------------------------------------
; Booty Hammer Light
[Statedef 1050]
type    = S
movetype= A
physics = S
poweradd= 175
ctrl = 0
velset = 0,0
anim = 1050
sprpriority = -3

[state 1050, push]
type = playerpush
trigger1 = animelemtime(5) >= 0 && animelemtime(9) < 0 
value = 0

[state 1050, proj immune]
type = nothitby
trigger1 = animelemtime(2) >= 0 && animelemtime(9) < 0 
value = ,AP
ignorehitpause = 1

[state 1050, nothitby]
type = nothitby
trigger1 = movehit
value = SCA
IGNOREHITPAUSE =1 

[state 1050, explod]
type = explod
trigger1 = animelemtime(8) = 0
anim = 1051
id = 1050
removeongethit = 1
bindtime = -1
sprpriority = 2
scale = const(size.xscale),const(size.yscale)
ignorehitpause = 1

[State 1050, 1]
type = PlaySnd
trigger1 = animelemTime(8) = 0
value = S5100, 0

[state 1050, earthquakes]
type = envshake
trigger1 = animelemtime(8) = 0
time = 24
ampl = -24
freq = 60
phase = 60

[state 1050, veladd]
type = veladd
trigger1 = animelem = 2
trigger1 = p2bodydist x > 200
x = 12
persistent = 0

[state 1050, posadd]
type = posadd
trigger1 = animelemtime(3) = 0
trigger1 = p2bodydist x > 200
x = 60
ignorehitpause
persistent = 0

[state 1050, posadd]
type = posadd
trigger1 = animelemtime(5) = 0
trigger1 = p2bodydist x > 200
x = 20
ignorehitpause
persistent = 0

[state 1050, posadd]
type = posadd
trigger1 = animelemtime(7) = 0
trigger1 = p2bodydist x > 200
x = 50
ignorehitpause
persistent = 0

[State 1050, 2]
type = HitDef
trigger1 = time = 0
trigger1 = !numtarget(800)
persistent = 0
attr = S, SA
animtype  = Heavy
damage    = ifelse(var(13)=1,180,120),36
guardflag = HA
hitflag = MAFD
id = 1050
nochainid = 1050,1400
hitonce = 1
pausetime = 0,0
guard.pausetime = 8,8
sparkno = 3
getpower = 60
sparkxy = -10,-120
hitsound   = 5,4
guardsound = S120, 0
p1sprpriority = -2
p2sprpriority = -1
;p2facing = -1
ground.type = high
ground.slidetime = 12
ground.hittime  = 12
ground.velocity = -36,-16
air.velocity = -12,-12
fall = 1
fall.recovertime = 30
fall.recover = 1
guard.slidetime = 26
guard.hittime = 26
guard.velocity = -45

[state 1050, varadd]
type = varadd
trigger1 = movehit
var(16) = -1
persistent = 0

[state 1050, getpower]
type = poweradd
trigger1 = var(13) = 1
trigger1 = movehit
value = 250
ignorehitpause = 0
persistent = 0

[state 1050, Heavy FX]
type = explod
trigger1 = animelemtime(8) = 0
anim = 2000
scale = 3,3
sprpriority = 4
postype = p1
pos = 240,20
ignorehitpause = 1

[state 1050, Heavy FX]
type = explod
trigger1 = animelemtime(8) = 0
anim = 2001
scale = 3,3
sprpriority = -4
postype = p1
pos = 240,20
ignorehitpause = 1


[state 1070, enemystate]
type = targetstate
triggerall = var(16) > 0 
trigger1 = movehit
trigger1 = numtarget(1050)
value = ifelse(var(13)=1,1090,1080)
ignorehitpause = 1
persistent = 0

[state 1070, enemystate]
type = targetstate
triggerall = var(16) <= 0 
trigger1 = movehit
trigger1 = numtarget(1050)
value = ifelse(var(13)=1,661,660)
ignorehitpause = 1
persistent = 0


[state 651, fx]
type = explod
trigger1 = animelemtime(8) = 0
anim = F61
pos = 100,0
scale = 6,3
ownpal = 1


[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -9
persistent = 0
ignorehitpause = 1

[state 1050, hit]
type = changestate
triggerall = animelemtime(11) >= 9
triggerall = movehit
trigger1 = numtarget(1050)
trigger1 = target(1050),stateno = 1080 || target(1050),stateno = 1090
value = 1051

[State 1050, 4]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1
;--------------------------------------------------------------------------;
;Gassing Portion
[statedef 1051]
type = C
movetype = A
physics = C
anim = 1055
sprpriority = -2
ctrl = 0

[state 1051, remove explod]
type = removeexplod
trigger1 = time = 0
id = 1050

[state 1051, targetstate]
type = targetstate
trigger1 = time = 0
value = ifelse(var(13)=1,1091,1081)

[state 1051, targetlifeadd]
type = targetlifeadd
trigger1 = animelemtime(3) > 0 && animelemtime(28) < 0
value = -2
persistent = 3

[state 1051, combo add]
type = hitadd
trigger1 = animelemtime(3) > 0 && animelemtime(28) < 0
persistent = 9
value = 1


[state 1050, Heavy FX]
type = explod
trigger1 = animelemtime(3) = 0
anim = 2051
scale = 1.5,1.5
sprpriority = 2
postype = p1
pos = 240,-50
ignorehitpause = 1

[state 1051, bind 1]
type = targetbind
triggerall = numtarget(1050)
trigger1 =  animelemtime(2) < 0
pos = 220,0

[state 1051, bind 1]
type = targetbind
triggerall = numtarget(1050)
trigger1 =  animelemtime(2) >= 0 && animelemtime(28) < 0
pos = 220,0

[state 1051, explod]
type = explod
trigger1 = time = 0
anim = 1056
id = 1051
removeongethit = 1
bindtime = -1
sprpriority = 2
scale = const(size.xscale),const(size.yscale)
ignorehitpause = 1

[state 1051, explod]
type = explod
trigger1 = animelemtime(3) = 0
anim = 2050
id = 2050
removeongethit = 1
bindtime = -1
sprpriority = 3
ignorehitpause = 1

[State 1000, 2]
type = Helper
trigger1 = animelemtime(28) = 0
helpertype = normal
name = "Gas Throw"
ID = 4000
stateno = 4050
pos = 0,0
postype = p2
ownpal = 1
ignorehitpause = 1

[state 1051, invunerabillity]
type = nothitby
trigger1 = 1
value = SCA

;[state 1051, plsy snd]
;type = playsnd
;trigger1 = animelemtime(3) = 0
;value = S1050,4;S1050,4

[state 1051, plsy snd]
type = playsnd
trigger1 = animelemtime(3) = 0
value = S1050,random%6;S1050,4
channel = 2

[state 1051, stop sound]
type = null;stopsnd
trigger1 = animelemtime(28) = 0
channel = 2

[state 1051, vel set]
type = veladd
trigger1 = animelem = 28 || animelem = 29 || animelem = 30
x = -25
persistent = 1

[state 1051, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
; Booty Hammer Heavy
[Statedef 1060]
type    = S
movetype= A
physics = S
poweradd= 175
ctrl = 0
velset = 0,0
anim = 1060
sprpriority = -3

[State 1050, 1]
type = PlaySnd
trigger1 = animelemTime(8) = 0
value = S5100, 0

[state 1050, push]
type = playerpush
trigger1 = animelemtime(5) >= 0 && animelemtime(9) < 0 
value = 0

[state 1050, proj immune]
type = nothitby
trigger1 = animelemtime(2) >= 0 && animelemtime(9) < 1
value = ,AP
ignorehitpause = 1

[state 1050, nothitby]
type = nothitby
trigger1 = movehit
value = SCA
IGNOREHITPAUSE =1 


[state 1050, explod]
type = explod
trigger1 = animelemtime(8) = 0
anim = 1061
removeongethit = 1
bindtime = -1
sprpriority = 2
scale = const(size.xscale),const(size.yscale)
ignorehitpause = 1

[state 1050, earthquakes]
type = envshake
trigger1 = animelemtime(8) = 0
time = 24
ampl = -24
freq = 60
phase = 60

[state 1050, veladd]
type = veladd
trigger1 = animelem = 2
x = 48
persistent = 0

[state 1050, posadd]
type = posadd
trigger1 = animelemtime(3) = 0
x = 60
ignorehitpause
persistent = 0

[state 1050, posadd]
type = posadd
trigger1 = animelemtime(5) = 0
x = 20
ignorehitpause
persistent = 0

[state 1050, posadd]
type = posadd
trigger1 = animelemtime(7) = 0
x = 50
ignorehitpause
persistent = 0



[State 1050, 2]
type = HitDef
trigger1 = Time = 0
trigger1 = !numtarget(800)
persistent = 0
attr = S, SA
animtype  = Heavy
damage    = ifelse(var(13)=1,200,160),48
guardflag = HA
hitflag = MAFD
id = 1050
nochainid = 1050, 1400
hitonce = 1
pausetime = 0,0
sparkno = 3
sparkxy = -10,-120
hitsound   = 5,4
guardsound = S120, 0
getpower = 60
ground.type = high
ground.slidetime = 22
ground.hittime  = 22
ground.velocity = -36,-16
air.velocity = -12,-12
p1sprpriority = -2
p2sprpriority = -1
;p2facing = -1
fall = 1
fall.recovertime = 30
fall.recover = 1
guard.slidetime = 24
guard.hittime = 24
guard.velocity = -60

[state 1050, varadd]
type = varadd
trigger1 = movehit
var(16) = -1
ignorehitpause = 1
persistent = 0

[state 1060, getpower]
type = poweradd
trigger1 = var(13) =1
trigger1 = movehit
value = 250
ignorehitpause = 0
persistent = 0

[state 1050, Heavy FX]
type = explod
trigger1 = animelemtime(8) = 0
anim = 2000
scale = 3,3
sprpriority = 4
postype = p1
pos = 240,20
ignorehitpause = 1

[state 1050, Heavy FX]
type = explod
trigger1 = animelemtime(8) = 0
anim = 2001
scale = 3,3
sprpriority = -4
postype = p1
pos = 240,20
ignorehitpause = 1

[state 1070, enemystate]
type = targetstate
triggerall = var(16) > 0 
trigger1 = movehit
trigger1 = numtarget(1050)
value = ifelse(var(13)=1,1090,1080)
ignorehitpause = 1
persistent = 0

[state 1070, enemystate]
type = targetstate
triggerall = var(16) <= 0 
trigger1 = movehit
trigger1 = numtarget(1050)
value = ifelse(var(13)=1,661,660)
ignorehitpause = 1
persistent = 0

[state 651, fx]
type = explod
trigger1 = animelemtime(8) = 0
anim = F61
pos = 100,0
scale = 6,3
ownpal = 1

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -3
persistent = 0
ignorehitpause = 1

[state 1050, hit]
type = changestate
triggerall = animelemtime(11) >= 9
triggerall = movehit 
trigger1 = numtarget(1050)
trigger1 = target,stateno = 1080 || target,stateno = 1090
value = 1051

[State 1050, 4]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
; Booty Hammer EX
[Statedef 1070]
type    = S
movetype= A
physics = S
poweradd= 0
ctrl = 0
velset = 0,0
anim = 1070
sprpriority = -3

[State 1070, 1]
type = PlaySnd
trigger1 = animelemTime(8) = 0
value = S5100, 0

[State X, Blink Yellow]
type = PalFX
trigger1 = time%2
time = 1
add = 150,75,0 ;32,16,0
sinadd = 64,32,5,3
ignorehitpause

[state 1070, push]
type = playerpush
trigger1 = animelemtime(5) >= 0 && animelemtime(9) < 0 
value = 0

[state 1070, proj immune]
type = nothitby
trigger1 = 1
value = ,AP
ignorehitpause = 1

[state 1050, nothitby]
type = nothitby
trigger1 = movehit
value = SCA
IGNOREHITPAUSE =1 

[state 1070, EX]
type = poweradd
trigger1 = time = 3
value = -500


[state 1070, explod]
type = explod
trigger1 = animelemtime(8) = 0
anim = 1061
removeongethit = 1
bindtime = -1
sprpriority = 2
scale = const(size.xscale),const(size.yscale)
ignorehitpause = 1
removeongethit = 1

[state 1070, earthquakes]
type = envshake
trigger1 = animelemtime(8) = 0
time = 24
ampl = -24
freq = 60
phase = 60

[state 1070, veladd]
type = veladd
trigger1 = animelem = 2
x = 48
persistent = 0

[state 1070, posadd]
type = posadd
trigger1 = animelemtime(3) = 0
x = 60
ignorehitpause
persistent = 0

[state 1070, posadd]
type = posadd
trigger1 = animelemtime(5) = 0
x = 20
ignorehitpause
persistent = 0

[state 1070, posadd]
type = posadd
trigger1 = animelemtime(7) = 0
x = 50
ignorehitpause
persistent = 0



[State 1070, 2]
type = HitDef
triggerall = var(16) > 0
trigger1 = Time = 0
trigger1 = !numtarget(800)
attr = S, ST
animtype  = Heavy
damage    = ifelse(var(13)=1,180,120),36
guardflag = HA
hitflag = MAFD
id = 1050
nochainid = 1050, 1400
pausetime = 0,0
sparkno = 3
getpower = 0
sparkxy = -10,-120
hitsound   = 5,4
guardsound = S120, 0
ground.type = high
ground.slidetime = 22
ground.hittime  = 22
ground.velocity = -36,-16
air.velocity = -12,-12
p1sprpriority = -2
p2sprpriority = -1
;p2facing = -1
fall = 1
fall.recovertime = 30
fall.recover = 1
guard.slidetime = 35
guard.hittime = 35
guard.velocity = -75

[state 1050, varadd]
type = varadd
trigger1 = movehit
var(16) = -1
ignorehitpause = 1
persistent = 0

[state 611, getpower]
type = poweradd
trigger1 = var(13) =1
trigger1 = movehit
value = 250
ignorehitpause = 0
persistent = 0

[state 1070, Heavy FX]
type = explod
trigger1 = animelemtime(8) = 0
anim = 2000
scale = 3,3
sprpriority = 4
postype = p1
pos = 240,20
ignorehitpause = 1

[state 1070, Heavy FX]
type = explod
trigger1 = animelemtime(8) = 0
anim = 2001
scale = 3,3
sprpriority = -4
postype = p1
pos = 240,20
ignorehitpause = 1

[state 1070, enemystate]
type = targetstate
triggerall = var(16) > 0 
trigger1 = movehit
trigger1 = numtarget(1050)
value = ifelse(var(13)=1,1090,1080)
ignorehitpause = 1
persistent = 0

[state 1070, enemystate]
type = targetstate
triggerall = var(16) <= 0 
trigger1 = movehit
trigger1 = numtarget(1050)
value = ifelse(var(13)=1,661,660)
ignorehitpause = 1
persistent = 0

[state 651, fx]
type = explod
trigger1 = animelemtime(8) = 0
anim = F61
pos = 100,0
scale = 6,3
ownpal = 1

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -3
persistent = 0
ignorehitpause = 1

[state 1070, hit]
type = changestate
trigger1 = animelemtime(11) >= 9
trigger1 = movehit 
value = 1051

[State 1070, 4]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1


;---------------------------------------------------------------------------
;Victim Animation
[statedef 1080]
type = L
movetype = H
physics = C
ctrl = 0
velset = 0,0
sprpriority = -1

[state 1080, turn]
type = turn
trigger1 = facing != enemynear,facing
trigger1 = time = 0


[state 1080, change animation]
type = changeanim2 
trigger1 = time = 0
value = 1080

[state 1080, selfstate]
type = selfstate
trigger1 = time > 300
value = 5100




;---------------------------------------------------------------------------
;Victim Animation
[statedef 1081]
type = L
movetype = H
movehitpersist =1
physics = C
ctrl = 0
velset = 0,0
sprpriority = -1

[state 1080, posset]
type = posset
trigger1 = time = 0
y = 0

[state 1080, change animation]
type = changeanim2 
trigger1 = time = 0
value = 1081

;[state 1080,  velset]
;type = veladd
;trigger1 = time = 70
;x = 32

[state 1080, change animation]
type = changeanim
trigger1 = anim = 1081
trigger1 = animtime = 0
value = 5110

[state 1080, change animation]
type = selfstate
trigger1 = time > 140
trigger1 = !alive
value = 5150

[state 1080, selfstate]
type = selfstate
trigger1 = time > 140
trigger1 = alive
value = 5120

;---------------------------------------------------------------------------
;Victim Animation - Shrunk version
[statedef 1090]
type = L
movetype = H
physics = C
ctrl = 0
velset = 0,0
sprpriority = -1

[state 1090, shrunk]
type = angledraw
trigger1 = 1
scale = 0.1,0.1
persistent = 1

[state 1080, turn]
type = turn
trigger1 = facing != enemy,facing
trigger1 = time = 0

[State 4121, Afterimage]
type = AfterImage
trigger1 = Time = 0
length = 13
PalBright   =  30, 60,  30
PalContrast =  70, 70, 20
PalAdd      = -10,-10,-10
PalMul      = .85,.85,.50
TimeGap  = 1
FrameGap = 2
Trans = Add
time = 2

[State 4121, Afterimage]
type = AfterImageTime
trigger1 = 1
time = 2

[state 1090, change animation]
type = changeanim2 
trigger1 = time = 0
value = 1080

[state 1090, selfstate]
type = selfstate
trigger1 = time > 300
value = 5100




;---------------------------------------------------------------------------
;Victim Animation
[statedef 1091]
type = L
movetype = H
movehitpersist =1
physics = C
ctrl = 0
velset = 0,0
sprpriority = -1

[state 1090, posset]
type = posset
trigger1 = time = 0
y = 0

[state 1090, shrunk]
type = angledraw
trigger1 = 1
scale = 0.25,0.25

[State 4121, Afterimage]
type = AfterImage
trigger1 = Time = 0
length = 13
PalBright   =  30, 60,  30
PalContrast =  70, 70, 20
PalAdd      = -10,-10,-10
PalMul      = .85,.85,.50
TimeGap  = 1
FrameGap = 2
Trans = Add
time = 2

[State 4121, Afterimage]
type = AfterImageTime
trigger1 = 1
time = 2


[state 1090, change animation]
type = changeanim2 
trigger1 = time = 0
value = 1081

[state 1090,  velset]
type = veladd
trigger1 = time = 50
x = 32

[state 1090, change animation]
type = changeanim
trigger1 = anim = 1081
trigger1 = animtime = 0
value = 5110

[state 1090, selfstate]
type = selfstate
trigger1 = time > 140
value = 5120

;---------------------------------------------------------------------------
;---------------------------------------------------------------------------
;Gas Geyser Light
[Statedef 1100]
type    = S
movetype= A
physics = S
poweradd= 60
velset = 0,0
anim = 1100
ctrl = 0
sprpriority = 2

[State 1100, 1]
type = PlaySnd
trigger1 = AnimElem = 4
value = 0, 2

[state 1100, distance adjust]
type = varset
triggerall = animelemtime(5) < 0
triggerall = ailevel = 0
trigger1 = command = "holdfwd"
fv = 21
value = ifelse(p2dist x > 650, 650, p2dist x + 200)
persistent = 0
ignorehitpause = 1

[state 1100, distance adjust]
type = varset
triggerall = animelemtime(5) < 0
triggerall = ailevel = 0
trigger1 = command = "holdback"
fv = 21
value = ifelse(p2dist x >  650, 650, p2dist x - 200)
persistent = 0
ignorehitpause = 1

[state 1100, distance adjust]
type = varset
triggerall = animelemtime(5) < 0
trigger1 = command != "holdfwd"  && command != "holdback"
trigger2 = ailevel > 0
fv = 21
value = ifelse(p2dist x > 650, 650, ifelse(enemynear,movetype = H, p2dist x + 150,p2dist x))
persistent = 0
ignorehitpause = 1

[State 1100, Curse Projectile]
type = Helper
triggerall = numhelper(11000) < 1
trigger1 = animelem = 5
helpertype = normal
name = "Light Gas Geyser"
ID = 11000
stateno = 11000
pos = fvar(21), 0
postype = p1
ownpal = 1
persistent = 0
ignorehitpause = 1

[State 1100, 5]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
;Curse
;Projectile Helper - startup
[statedef 11000]
type = S
movetype = A
physics = N
ctrl = 0
velset = 0,0

[state 11000, width]
type = width
trigger1 = time = 0
value = 80,80

[state 1100, snd]
type = playsnd
trigger1 = time = 0
value = S1100,0
ignorehitpause = 1

[state 11000, screenlock]
type = screenbound
trigger1 = 1
value = 1

[state 11000, varset]
type = varset
trigger1 = time = 0
v = 10
value = 3

[state 11000, anim]
type = changeanim
trigger1 = time = 0
value = 11000

[state 11000, end]
type = changestate
trigger1 = animtime = 0
value = 11001

;------------------------------------------------------------------
;Curse version
;Projectile Helper
[statedef 11001]
type = S
movetype = A
physics = N
ctrl = 0
velset = 0,0
;movehitpersist = 1 

[state 11001, angledraw]
type = angledraw
trigger1 = 1
scale = 1, 2
ignorehitpause = 1

[state 11001, anim]
type = changeanim
trigger1 = anim != 11001
value = 11001
ignorehitpause = 1
persistent = 1

[state 11001, attackmulset]
type = attackmulset
trigger1 = 1
value = parent,fvar(10)
Persistent = 1

[State 11001, 2]
type = HitDef
trigger1 = !movecontact
attr = S, SP
animtype  = up
damage    = ceil(parent,fvar(10)*30),6
guardflag = MA
hitflag = MAF
pausetime = ifelse(var(10)=1,8,2),ifelse(var(10)=1,8,2)
sparkno = 2
sparkxy = 0,0
hitsound   = F5,2
guardsound = S120, 0
ground.type = high
ground.slidetime = 8
ground.hittime  = 8
p1sprpriority = 3
ground.velocity = ifelse(var(10)=1,-12,0),ifelse(var(10)=1,-36,0)
air.velocity = ifelse(var(10)=1,-12,0),ifelse(var(10)=1,-16,-4)
guard.velocity = ifelse(var(10)=1,-18,-4)             
guard.hittime = 14
guard.slidetime = 14
air.hittime = 60
airguard.velocity = ifelse(var(10)=1,-16,-4),-6 
airguard.hittime = 12
air.fall =1
fall = ifelse(var(10)=3,1,0)
fall.recover = 1
fall.recovertime = 402
ground.cornerpush.veloff  = 0
guard.dist = 315

[state 21000, parentvaradd]
type = varadd
trigger1 = gethitvar(damage) != 0
v = 10
value = -1
ignorehitpause = 1
persistent = 0

[state 21000, parentvaradd]
type = varadd
trigger1 = movecontact
v = 10
value = -1
ignorehitpause = 1
persistent = 0

[state 11001, hitoverride]
type = hitoverride
trigger1 = 1
attr = SCA, AP
time = 1
stateno = 11001
ignorehitpause = 1
persistent = 1

[state 21001, nothitby]
type = nothitby
trigger1 = 1
value = ,AA,AT
ignorehitpause = 1

[state 21000, changestate]
type = changestate
trigger1 = movecontact
trigger1 = var(10) > 0
value = 11001
ignorehitpause = 1

[state 21000, changestate]
type = changestate
triggerall = hitshakeover
trigger1 = movecontact
trigger1 = var(10) <= 0
trigger2 = animtime = 0
trigger3 = movereversed
value = 11002
ignorehitpause = 1
;--------------------------------------------------------------------------
;Projectile End
[statedef 11002]
type = U
movetype = I
physics = U
velset = 0,0
anim = 11002
movehitpersist = 1

[state 11002, parentcomboscaling]
type = parentvaradd
trigger1 = movehit
v = 18
value = -3
persistent = 0

[state 21001, end]
type = destroyself
trigger1 = animtime = 0

;---------------------------------------------------------------------------
;Poison
;Projectile Helper - startup
[statedef 12000]
type = S
movetype = A
physics = N
ctrl = 0
velset = 0,0

[state 11000, width]
type = width
trigger1 = time = 0
value = 80,80

[state 11000, screenlock]
type = screenbound
trigger1 = 1
value = 1

[state 11000, varset]
type = varset
trigger1 = time = 0
v = 10
value = 3

[state 11000, anim]
type = changeanim
trigger1 = time = 0
value = 11010

[state 11000, end]
type = changestate
trigger1 = animtime = 0
value = 12001

;------------------------------------------------------------------
;Curse version
;Projectile Helper
[statedef 12001]
type = S
movetype = A
physics = N
ctrl = 0
velset = 0,0
;movehitpersist =1

[state 12001, anim]
type = changeanim
trigger1 = anim != 11011
value = 11011
ignorehitpause = 1
persistent = 1

[state 12001, attackmulset]
type = attackmulset
trigger1 = 1
value = parent,fvar(10)
Persistent = 1

[State 12001, 2]
type = HitDef
trigger1 = 1
trigger1 = !moveguarded
persistent = 2
attr = S, SP
animtype  = up
damage    = ceil(parent,fvar(10)*10),2
guardflag = MA
hitflag = MAF
pausetime = ifelse(var(10)=1,8,2),ifelse(var(10)=1,8,2)
sparkno = 2
sparkxy = 40,0
hitsound   = F5,2
guardsound = S120, 0
id = 4000
ground.type = high
ground.slidetime = 22
ground.hittime  = 22
ground.velocity = ifelse(var(10)=1,-12,0),ifelse(var(10)=1,-36,0)
air.velocity = ifelse(var(10)=1,-12,0),ifelse(var(10)=1,-24,-4)
guard.velocity = ifelse(var(10)=1,-18,-4)     
guard.hittime = 16
guard.slidetime = 16
air.hittime = 60
airguard.velocity = -16,-6 
airguard.hittime = 22
fall = 1
fall.recover = 0
fall.recovertime = 402
ground.cornerpush.veloff  = 0
guard.dist = 315

[state 12000, parentvaradd]
type = varadd
trigger1 = movecontact
trigger2 = movereversed
trigger3 = gethitvar(damage) != 0
v = 10
value = -1
ignorehitpause = 1
persistent = 0

[State 0, TargetState]
type = TargetState
triggerall = NumTarget(4000)
trigger1 = movehit
trigger1 = var(10) = 1 
value = 4020
ID = 4000
ignorehitpause = 1


[State 0, Helper]
type = Helper
trigger1 = NumTarget(4000)
trigger1 = movehit
trigger1 = var(10) = 1 
name = "Ranged Poison effect"
ID = 4006
stateno = 4006 
pos = 0,0
postype = p2
facing = -1
ownpal = 1
ignorehitpause = 1


[state 12001, hitoverride]
type = hitoverride
trigger1 = 1
attr = SCA, AP,AA,AT
time = 1
stateno = 12001
ignorehitpause = 1
persistent = 1

[state 12001, nothitby]
type = nothitby
trigger1 = 1
value = ,AA,AT

[state 12000, changestate]
type = changestate
trigger1 = movecontact
trigger1 = var(10) > 0
value = 12001

[state 21000, changestate]
type = changestate
triggerall = hitshakeover
trigger1 = movecontact
trigger1 = var(10) <= 0
trigger2 = animtime = 0
trigger3 = movereversed
value = 12002
;--------------------------------------------------------------------------
;Projectile End
[statedef 12002]
type = U
movetype = I
physics = U
velset = 0,0
anim = 11012

[state 12001, end]
type = destroyself
trigger1 = animtime = 0

;---------------------------------------------------------------------------

; Heavy Geyser
[Statedef 1110]
type    = S
movetype= A
physics = S
juggle  = 4
poweradd= 60
velset = 0,0
anim = 1100
ctrl = 0
sprpriority = 2

[State 1100, 1]
type = PlaySnd
trigger1 = AnimElem = 4
value = 0, 2

[state 1100, distance adjust]
type = varset
triggerall = ailevel = 0
triggerall = animelemtime(5) < 0
trigger1 = command = "holdfwd"
fv = 21
value = ifelse(p2dist x <= 650, 650, p2dist x+200)
persistent = 0
ignorehitpause = 1

[state 1100, distance adjust]
type = varset
triggerall = ailevel = 0
triggerall = animelemtime(5) < 0
trigger1 = command = "holdback"
fv = 21
value = ifelse(p2dist x <= 650, 650, p2dist x-200)
persistent = 0
ignorehitpause = 1

[state 1100, distance adjust]
type = varset
triggerall = animelemtime(5) < 0
trigger1 = command != "holdfwd"  && command != "holdback"
trigger2 = ailevel > 0
fv = 21
value = ifelse(p2dist x <=650, 650, ifelse(enemynear,movetype = H, p2dist x + 150,p2dist x))
persistent = 0
ignorehitpause = 1

[State 1110, Curse Projectile]
type = Helper
triggerall = numhelper(11000) < 1
trigger1 = animelem = 5
helpertype = normal
name = "Hard Gas Geyser"
ID = 11000
stateno = 11000
pos = fvar(21), 0
postype = p1
ownpal = 1
persistent = 0
ignorehitpause = 1

[State 1100, 5]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1
;---------------------------------------------------------------------------
;EX Geyser
[Statedef 1120]
type    = S
movetype= A
physics = S
poweradd= -500
velset = 0,0
anim = 1120
ctrl = 0
sprpriority = 2

[State 1100, 1]
type = PlaySnd
trigger1 = AnimElem = 4
value = 0, 2

[State X, Blink Yellow]
type = PalFX
trigger1 = time%2
time = 1
add = 150,75,0 ;32,16,0
sinadd = 64,32,5,3
ignorehitpause

[State 1100, Projectile]
type = Helper
trigger1 = animelemtime(7) = 0
helpertype = normal
name = "EX Gas Geyser 1"
ID = 11200
stateno = 11200
pos = p2dist x, 0
postype = p1
ownpal = 1
persistent = 0
ignorehitpause = 1

[State 1100, Projectile]
type = Helper
trigger1 = animelemtime(9) = 24
helpertype = normal
name = "EX Gas Geyser 2"
ID = 11200
stateno = 11200
pos = ifelse(p2movetype = H && (p2stateno != [120,159]),p2dist x+250, p2dist x),0
postype = p1
ownpal = 1
persistent = 0
ignorehitpause = 1

[state 1100, snd]
type = playsnd
trigger1 = animelem = 7
value = S1100,0
ignorehitpause = 1

[State 1100, 5]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1
;---------------------------------------------------------------------------
;---------------------------------------------------------------------------
;Projectile Helper - startup
[statedef 11200]
type = S
movetype = A
physics = N
ctrl = 0
velset = 0,0

[state 11200, width]
type = width
trigger1 = time = 0
value = 80,80

[state 11200, screenlock]
type = screenbound
trigger1 = 1
value = 1

[state 112000, varset]
type = varset
trigger1 = time = 0
v = 10
value = 3

[state 11200, anim]
type = changeanim
trigger1 = time = 0
value = 11000

[state 11200, end]
type = changestate
trigger1 = animtime = 0
value = 11201

;------------------------------------------------------------------

;Projectile Helper
[statedef 11201]
type = S
movetype = A
physics = N
ctrl = 0
velset = 0,0
movehitpersist

[state 11201, angledraw]
type = angledraw
trigger1 = 1
scale = 1, 2
ignorehitpause = 1

[state 11201, anim]
type = changeanim
trigger1 = anim != 11001
value = 11001
ignorehitpause = 1
persistent = 1

[state 11001, attackmulset]
type = attackmulset
trigger1 = 1
value = parent,fvar(10)
Persistent = 1



[State 11201, 2]
type = HitDef
trigger1 = !movecontact
attr = S, SP
animtype  = up
damage    = 23,4
guardflag = MA
hitflag = MAF
pausetime = ifelse(var(10)=1,8,2),ifelse(var(10)=1,8,2)
sparkno = 2
sparkxy = 40,0
getpower = 0
hitsound   = F5,2
guardsound = S120, 0
ground.type = high
ground.slidetime = 8
ground.hittime  = 8
p1sprpriority = 3
ground.velocity = ifelse(var(10)=1,-12,2),ifelse(var(10)=1,-36,0)
air.velocity = ifelse(var(10)=1,-12,2),ifelse(var(10)=1,-28,-4)
guard.velocity = ifelse(var(10)=1,-18,-4)             
guard.hittime = 16
guard.slidetime = 16
air.hittime = 60
airguard.velocity = ifelse(var(10)=1,-16,-4),-6 
airguard.hittime = 16
air.fall =1
fall.recovertime = 40
fall = ifelse(var(10)=3,1,0)
fall.recover = 1
ground.cornerpush.veloff  = 0
guard.dist = 315

[state 21000, parentvaradd]
type = varadd
trigger1 = movecontact
trigger2 = movereversed
trigger3 = gethitvar(damage) != 0
v = 10
value = -1
ignorehitpause = 1
persistent = 0

[state 11001, hitoverride]
type = hitoverride
trigger1 = 1
attr = SCA, AP,AA,AT
time = 1
stateno = 11201
ignorehitpause = 1
persistent = 1

[state 21001, nothitby]
type = nothitby
trigger1 = 1
value = ,AA,AT

[state 21000, changestate]
type = changestate
trigger1 = movecontact
trigger1 = var(10) > 0
value = 11201

[state 21000, changestate]
type = changestate
triggerall = hitshakeover
trigger1 = movecontact
trigger1 = var(10) <= 0
trigger2 = animtime = 0
trigger3 = movereversed
value = 11202
;--------------------------------------------------------------------------
;Projectile End
[statedef 11202]
type = U
movetype = I
physics = U
velset = 0,0
anim = 11002

[state 11202, combo score]
type = parentvaradd
trigger1 = 1
v = 18
value = -4
persistent = 0

[state 21001, end]
type = destroyself
trigger1 = animtime = 0


;---------------------------------------------------------------------------
; Curse Element
[Statedef 1150]
type = C
movetype = I
physics = C
anim = 1150
ctrl = 0
velset = 0,0

[state 1150, varset]
type = varset
trigger1 = time = 3
v = 5
value = 1

[state 1150, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
; Poison Element
[Statedef 1160]
type = C
movetype = I
physics = C
anim = 1160
ctrl = 0
velset = 0,0

[state 1150, varset]
type = varset
trigger1 = time = 3
v = 5
value = 2

[state 1150, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1


;---------------------------------------------------------------------------
;Totem Summon Ground
[Statedef 1200]
type    = S
movetype= A
physics = S
juggle  = 4
poweradd= 90
velset = 0,0
anim = 1200
ctrl = 0
sprpriority = 2

[State 0, Explod]
type = Explod
trigger1 = animelemtime(5) = 0
anim = 192
ID = 192
pos = 220,-180
postype = p1  ;p2,front,back,left,right
scale = 1,1
sprpriority = 0
ontop = 1
shadow = 0,0,0
ownpal = 0
removeongethit = 1

[State 0, PlaySnd]
type = PlaySnd
trigger1 = animelemtime(5) = 0
value = S210,1






[State 1200, Curse Projectile]
type = Helper
triggerall = numhelper(4100) < 1
trigger1 = animelemtime(5) = 2
helpertype = normal
name = "Totem Ground"
ID = 4100
stateno = 4100
pos = 220, -180
postype = p1
ownpal = 1
persistent = 0
ignorehitpause = 1

[State 1200, 3]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
;Totem Summon Air
[Statedef 1210]
type    = S
movetype= A
physics = S
juggle  = 4
poweradd= 90
velset = 0,0
anim = 1200
ctrl = 0
sprpriority = 2

[State 1210, Curse Projectile]
type = Helper
triggerall = numhelper(4100) < 1
trigger1 = animelem = 5
helpertype = normal
name = "Totem Air"
ID = 4100
stateno = 4101
pos = 150, -360
postype = p1
ownpal = 1
persistent = 0
ignorehitpause = 1

[State 0, Explod]
type = Explod
trigger1 = animelemtime(5) = 0
anim = 192
ID = 192
pos = 150,-360
postype = p1  ;p2,front,back,left,right
scale = 1,1
sprpriority = 0
ontop = 1
shadow = 0,0,0
ownpal = 0
removeongethit = 1

[State 0, PlaySnd]
type = PlaySnd
trigger1 = animelemtime(5) = 0
value = S210,1

[State 1200, 3]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
;Totem Summon EX
[Statedef 1220]
type    = S
movetype= A
physics = S
poweradd = -500
velset = 0,0
anim = 1200
ctrl = 0
sprpriority = 2

[state 1210, armorset]
type = varset
trigger1 = animelemtime(4) = 0
v = 24
value = 5
ignorehitpause = 1

[State 1210, Curse Projectile]
type = Helper
triggerall = numhelper(4100) < 1
trigger1 = animelem = 5
helpertype = normal
name = "Totem EX"
ID = 4100
stateno = 4102
pos = 150, -360
postype = p1
ownpal = 1
persistent = 0
ignorehitpause = 1

[State 0, Explod]
type = Explod
trigger1 = animelemtime(5) = 0
anim = 192
ID = 192
pos = 150,-360
postype = p1  ;p2,front,back,left,right
scale = 1,1
sprpriority = 0
ontop = 1
shadow = 0,0,0
ownpal = 0
removeongethit = 1

[State 0, PlaySnd]
type = PlaySnd
trigger1 = animelemtime(5) = 0
value = S210,1

[State 1200, 3]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1


;==========================================================================
;Ass Vaccum
;==========================================================================

;Ass Vaccum light
[statedef 1300]
type = S
movetype = A
physics = S
velset = 0,0
poweradd = 150
sprpriority = -3
ctrl = 0
sprpriority = 1

;===========
;Armor start
;===========

[state 1300, set animation]
type  = changeanim
trigger1 = anim != 1300
value = 1300

;determine what frame
[state 1300, remember frame]
type = varset
trigger1 = time <= 0
v = 22
value = animelemno(0)
ignorehitpause = 1

;delay effect
[state 1300, delay]
type = changeanim 
trigger1 = var(31) < floor(gethitvar(hittime)*1.1)
value = anim
elem = var(22)

[state 1300, freeze location]
type = posfreeze
trigger1 = var(31) < floor(gethitvar(hittime)*1.1)
value = 1
;--------------------------

[state 1300, Consume Projectiles]
type = poweradd
trigger1 = gethitvar(damage) != 0
value = floor(gethitvar(damage)*3)
persistent = 1

[state 1300, armor count down]
type = varadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) > 0
V = 20
value = - 1
persistent = 1

[state 1300, Unstoppable]
type = hitoverride
trigger1 = alive
trigger1 = animelemtime(8) >= 0 && animelemtime(39) < 0
attr = SCA, AP
stateno = 1300
time = 1
persistent = 1
ignorehitpause = 1

[State 1050, flash red]
type = PalFX
trigger1 = Time = 0
trigger1 = gethitvar(damage) != 0
time = 7
add = 100,0,0
IgnoreHitPause = 1


[state 1300, Explod]
type = explod
trigger1 = time = 0
anim = 1305
id = 1300
scale = const(size.xscale),const(size.yscale)
pos = 0,0
postype = p1
bindtime = -1
sprpriority = 3
removeongethit = 1

[state 1300, settypeset]
type = statetypeset
trigger1 = animelem = 3
statetype = A

[state 1300, statetypeset]
type = statetypeset
trigger1 = animelem = 6
statetype = S

[state 1300, velset]
type = velset
trigger1 = animelemtime(3) = 1 
x = 24
persistent = 1


[State 1300, hitdef]
type = HitDef
trigger1 = animelem = 4
persistent = 0
attr = S, SA
animtype  = Heavy
damage    = 5,1
guardflag = M
hitflag = MF
pausetime = 4,4
sparkno = 2
sparkxy = -10,-60
hitsound = S5000, 1
guardsound = S120, 0
ground.type = high
ground.slidetime = 18
ground.hittime  = 18
ground.velocity = 16,0
air.velocity = 12,-10
fall = 0
fall.recovertime = 30
fall.recover = 1
guard.slidetime = 4
guard.hittime = 4
guard.velocity = -40
airguard.velocity = -26,-2
guard.kill = 0

[State 1300, hitdef]
type = HitDef
trigger1 = animelem = 6
persistent = 0
attr = S, SA
animtype  = Heavy
damage    = 5,1
guardflag = M
hitflag = MF
pausetime = 4,4
sparkno = 2
id = 1301
sparkxy = -10,-60
hitsound = S5000, 1
guardsound = S120, 0
ground.type = high
ground.slidetime = 18
ground.hittime  = 18
ground.velocity = -16
air.velocity = 12,-10
fall = 0
fall.recovertime = 30
fall.recover = 1
guard.slidetime = 4
guard.hittime = 4
guard.velocity = -40
airguard.velocity = -26,-2
guard.kill = 0

;Normal
[State 1300, 1]
type = HitDef
Triggerall = animelemtime(10) > 0 && animelemtime(39) < 0
trigger1 = p2stateno != [150,155]
attr = S, ST  
persistent = 0        
hitflag = MF-
guardflag =          
priority = 1, Miss    
sparkno = -1
guard.sparkno = -1        
p1sprpriority = 1    
id = 1300                   
p1facing = 1
p2facing = 1 
p1sprpriority = -3
p2sprpriority = 1         
p1stateno = 1302      
p2stateno = 1330      
guard.dist = 0      
guard.velocity = -48
guard.hittime = 24
guard.slidetime = 24
fall = 1 

;stunned
[State 1300, 1]
type = HitDef
Triggerall = animelemtime(10) > 0 && animelemtime(39) < 0
trigger1 = enemynear,anim = 5300
attr = S, ST  
persistent = 0        
hitflag = MF
guardflag =          
priority = 1, Miss    
sparkno = -1
guard.sparkno = -1        
p1sprpriority = 1    
id = 1300                   
p1facing = 1
p2facing = 1 
p1sprpriority = -3
p2sprpriority = 1         
p1stateno = 1302      
p2stateno = 1330      
guard.dist = 0      
guard.velocity = -48
guard.hittime = 24
guard.slidetime = 24
fall = 1 

;Comboed
[State 1300, 1]
type = HitDef
Triggerall = animelemtime(10) > 0 && animelemtime(39) < 0
trigger1 = numtarget(1301)
attr = S, ST  
persistent = 0        
hitflag = MAF
guardflag =          
priority = 1, Miss    
sparkno = -1
guard.sparkno = -1        
p1sprpriority = 1
id = 1300                   
p1facing = 1
p2facing = 1 
p1sprpriority = -3
p2sprpriority = 1         
p1stateno = 1302      
p2stateno = 1330      
guard.dist = 0      
guard.velocity = -48
guard.hittime = 24
guard.slidetime = 24
fall = 1 

[state 1300, helper]
type = helper
triggerall = p2dist x = [20, 1200]
triggerall = p2statetype != L 
triggerall = numhelper(1340) < 2
trigger1 = p2statetype != A
trigger1 = animelemtime(12) > 0  && animelemtime(39) < 0
name = "Pastilla's Vaccuum"
stateno = 1340
id = 1340
postype = p1
pos = p2dist x + 200,0
persistent = 4

[state 1300, explod]
type = explod
trigger1 = animelemtime(9) = 0
anim = 2060
id = 2060
removeongethit = 1
bindtime = -1
removetime = -1
pos = 230,-250
scale = const(size.xscale),const(size.yscale)
sprpriority = 4

[state 1300, removexplod]
type = removeexplod
trigger1 = animelemtime(39) >= 0
id = 2060

[state 1300, playsnd]
type = playsnd
trigger1 = animelemtime(11) = 0
value = S1020,0
channel = 2

[state 1300, playsnd]
type = playsnd
trigger1 = animelemtime(6) = 0
value = S52,0

[State 1300, 4]
type = EnvShake
trigger1 = animelemtime(6) = 0
time = 14
ampl = 8
freq = 100
phase = 100

[state 1300, end]
type = changestate
trigger1 = animtime = 0
value = 1309

;----------------------------------------------------------------------------
;Throw Portion - Light
[Statedef 1302]
type = S
movetype = A
physics = S
anim = 1302
poweradd = 100
sprpriority = -2

[state 1302, removeexplod]
type = removeexplod
trigger1 = time = 0
id = 1300

[state 1302, plsy snd]
type = playsnd
trigger1 = time = 0
value = S1020,1
channel = 1

[state 1302, stopsnd]
type = stopsnd
trigger1 = time = 0
channel = 2

[state 1302, removexplod]
type = removeexplod
trigger1 = time = 0
id = 2060
 

[state 1302, extra]
type = explod
trigger1 = time = 0
anim = 1306
id = 1302
sprpriority = 3
postype = p1
pos = 0,0
scale = const(size.xscale),const(size.yscale)
bindtime = -1

[State 1302, Bind 1]
type = TargetBind
trigger1 = AnimElemTime(1) >= 0 && animelemtime(2) < 0
pos = 186, -332

[State 1302, Bind 2]
type = TargetBind
trigger1 = AnimElemTime(2) >= 0 && animelemtime(3) < 0
pos = 186, -322

[State 1302, Bind 2]
type = TargetBind
trigger1 = AnimElemTime(3) >= 0 && animelemtime(4) < 0
pos = 186, -322

[state 1302, plsy snd]
type = playsnd
trigger1 = animelemtime(4) = 0
value = S1300,0

[state 1302, plsy snd]
type = playsnd
trigger1 = animelemtime(4) = 0
value = S1300,0

[state 1302, explod FX]
TYPE = explod
trigger1 = animelemtime(4) = 0
anim = 2050
postype = p1
sprpriority = 2
pos = -275,-170
bindtime = -1
ownpal = 1
scale = const(size.xscale)*1.5,const(size.yscale)*1.5

[state 1302, explod gas particals 1 of 5]
type = explod
trigger1 = animelemtime(4) = 1
anim = 2052
postype = p1
pos = 176,-264
scale = const(size.xscale)*2,const(size.yscale)*2
ownpal = 1
sprpriority = 2
vel = 5,-20

[state 1302, explod gas particals 2 of 5]
type = explod
trigger1 = animelemtime(4) = 0
anim = 2052
postype = p1
pos = 176,-264
scale = const(size.xscale)*2,const(size.yscale)*2
ownpal = 1
sprpriority = 2
vel = 5,20

[state 1302, explod gas particals 3 of 5]
type = explod
trigger1 = animelemtime(4) = 1
anim = 2052
postype = p1
pos = 176,-264
scale = const(size.xscale)*2,const(size.yscale)*2
ownpal = 1
sprpriority = 2
vel = 10,10

[state 1302, explod gas particals 4 of 5]
type = explod
trigger1 = animelemtime(4) = 0
anim = 2052
postype = p1
pos = 176,-264
scale = const(size.xscale)*2,const(size.yscale)*2
ownpal = 1
sprpriority = 2
vel = 10,-10

[state 1302, explod gas particals 5 of 5]
type = explod
trigger1 = animelemtime(4) = 1
anim = 2052
postype = p1
pos = 176,-264
scale = const(size.xscale)*2,const(size.yscale)*2
ownpal = 1
sprpriority = 2
vel = 20,0

[state 1302, targetlifeadd]
type = targetlifeadd
trigger1 = animelemtime(4) = 0
value = ceil(fvar(10)*-150)

[state 1300, poweradd]
type = poweradd
trigger1 = animelemtime(4) = 0
VALUE = 200


[state 1302, Launch]
type = Targetstate
trigger1 = animelemtime(4) = 0
value = 1335

[state x, combo damage score]
type = varadd
trigger1 = animtime = 0
v = 18
value = -3
persistent = 0
ignorehitpause = 1

[state 1302, end]
type = changestate
trigger1 = animtime = 0
value =  0
ctrl = 1


;----------------------------------------------------------------------------
; Recovery for Vaccum
[statedef 1309]
movetype = I
type = U
anim = 1309
ctrl = 0

[state 1309]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1

;-------------------------------------------------------------------------
;Ass Vaccum Heavy
[statedef 1310]
type = S
movetype = A
physics = S
velset = 0,0
poweradd = 150
sprpriority = -3
ctrl = 0
sprpriority = 1

;===========
;Armor start
;===========

[state 1310, set animation]
type  = changeanim
trigger1 = anim != 1310
value = 1310

;determine what frame
[state 1310, remember frame]
type = varset
trigger1 = time <= 0
v = 22
value = animelemno(0)
ignorehitpause = 1

;delay effect
[state 1310, delay]
type = changeanim 
trigger1 = var(31) < floor(gethitvar(hittime)*1.1)
value = anim
elem = var(22)

[state 1310, freeze location]
type = posfreeze
trigger1 = var(31) < floor(gethitvar(hittime)*1.1)
value = 1
;--------------------------

[state 1310, still take damage]
type = poweradd
trigger1 = gethitvar(damage) != 0
value = floor(gethitvar(damage)*3)
persistent = 1

[state 1310, armor count down]
type = varadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) > 0
V = 20
value = - 1
persistent = 1

[state 1310, Unstoppable]
type = hitoverride
trigger1 = alive
trigger1 = animelemtime(8) >= 0 && animelemtime(39) < 0
attr = SCA, AP
stateno = 1310
time = 1
persistent = 1
ignorehitpause = 1

[State 1310, flash red]
type = PalFX
trigger1 = Time = 0
trigger1 = gethitvar(damage) != 0
time = 7
add = 100,0,0
IgnoreHitPause = 1


[state 1310, Explod]
type = explod
trigger1 = time = 0
anim = 1315
id = 1310
scale = const(size.xscale),const(size.yscale)
pos = 0,0
postype = p1
bindtime = -1
sprpriority = 3
removeongethit = 1

[state 1310, settypeset]
type = statetypeset
trigger1 = animelem = 3
statetype = A

[state 1310, statetypeset]
type = statetypeset
trigger1 = animelem = 6
statetype = S

[state 1310, velset]
type = velset
trigger1 = animelemtime(3) = 1 
x = 24
persistent = 1

[State 1310, hitdef]
type = HitDef
trigger1 = animelem = 4
persistent = 0
attr = S, SA
animtype  = Heavy
damage    = 5,1
guardflag = M
hitflag = MF
pausetime = 4,4
sparkno = 2
sparkxy = -10,-60
hitsound = S5000, 1
guardsound = S120, 0
ground.type = high
ground.slidetime = 18
ground.hittime  = 18
ground.velocity = 16,0
air.velocity = 12,-10
fall = 0
fall.recovertime = 30
fall.recover = 1
guard.slidetime = 4
guard.hittime = 4
guard.velocity = -40
airguard.velocity = -26,-2
guard.kill = 0

[State 1310, hitdef]
type = HitDef
trigger1 = animelem = 6
persistent = 0
attr = S, SA
animtype  = Heavy
damage    = 5,1
guardflag = M
hitflag = MF
pausetime = 4,4
sparkno = 2
sparkxy = -10,-60
hitsound = S5000, 1
guardsound = S120, 0
ground.type = high
ground.slidetime = 18
ground.hittime  = 18
ground.velocity = 16,0
air.velocity = 12,-10
id = 1311
fall = 0
fall.recovertime = 30
fall.recover = 1
guard.slidetime = 4
guard.hittime = 4
guard.velocity = -40
airguard.velocity = -26,-2
guard.kill = 0

;normal
[State 1310, 1]
type = HitDef
Triggerall = animelemtime(10) > 0 && animelemtime(39) < 0
trigger1 = p2stateno != [150,155]
attr = S, ST          
hitflag = MF-
guardflag =          
priority = 1, Miss    
sparkno = -1
guard.sparkno = -1        
p1sprpriority = 1    
id = 1300                   
p1facing = 1
p2facing = 1 
p1sprpriority = -3
p2sprpriority = 1         
p1stateno = 1312      
p2stateno = 1330      
guard.dist = 0      
guard.velocity = -48
guard.hittime = 24
guard.slidetime = 24
fall = 1 

;stunned
[State 1310, 1]
type = HitDef
Triggerall = animelemtime(10) > 0 && animelemtime(39) < 0
trigger1 = enemynear,anim = 5300
attr = S, ST          
hitflag = MF
guardflag =          
priority = 1, Miss    
sparkno = -1
guard.sparkno = -1        
p1sprpriority = 1    
id = 1300                   
p1facing = 1
p2facing = 1 
p1sprpriority = -3
p2sprpriority = 1         
p1stateno = 1312      
p2stateno = 1330      
guard.dist = 0      
guard.velocity = -48
guard.hittime = 24
guard.slidetime = 24
fall = 1 


;combo
[State 1310, 1]
type = HitDef
Triggerall = animelemtime(10) > 0 && animelemtime(39) < 0
trigger1 = numtarget(1311)
attr = S, ST          
hitflag = MAF
guardflag =          
priority = 1, Miss    
sparkno = -1
guard.sparkno = -1        
p1sprpriority = 1    
id = 1300                   
p1facing = 1
p2facing = 1 
p1sprpriority = -3
p2sprpriority = 1         
p1stateno = 1312      
p2stateno = 1330      
guard.dist = 0      
guard.velocity = -48
guard.hittime = 24
guard.slidetime = 24
fall = 1 

[state 1310, helper]
type = helper
triggerall = p2dist x = [0, 1200]
triggerall = p2statetype != L 
triggerall = numhelper(1341) < 2
trigger1 = p2statetype != A
trigger1 = animelemtime(12) > 0  && animelemtime(39) < 0
name = "Pastilla's Vaccuum"
stateno = 1341
id = 1341
postype = p1
pos = p2dist x + 200,0
sprpriority = 2
persistent = 4


[state 1300, explod]
type = explod
trigger1 = animelemtime(9) = 0
anim = 2060
id = 2060
removeongethit = 1
bindtime = -1
removetime = -1
pos = 230,-250
scale = const(size.xscale),const(size.yscale)
sprpriority = 4

[state 1300, removexplod]
type = removeexplod
trigger1 = animelemtime(39) >= 0
id = 2060

[state 1300, playsnd]
type = playsnd
trigger1 = animelemtime(11) = 0
value = S1020,0
channel = 2

[state 1300, playsnd]
type = playsnd
trigger1 = animelemtime(6) = 0
value = S52,0

[State 1300, 4]
type = EnvShake
trigger1 = animelemtime(6) = 0
time = 14
ampl = 8
freq = 100
phase = 100

[state 1300, end]
type = changestate
trigger1 = animtime = 0
value = 1309

;----------------------------------------------------------------------------
;Throw Portion - Light
[Statedef 1312]
type = S
movetype = A
physics = S
anim = 1302
poweradd = 100
sprpriority = -2

[state 1312, removeexplod]
type = removeexplod
trigger1 = time = 0
id = 1310

[state 1312, plsy snd]
type = playsnd
trigger1 = time = 0
value = S1020,1
channel = 1

[state 1312, stopsnd]
type = stopsnd
trigger1 = time = 0
channel = 2

[state 1312, removexplod]
type = removeexplod
trigger1 = time = 0
id = 2060
 

[state 1312, extra]
type = explod
trigger1 = time = 0
anim = 1306
id = 1302
sprpriority = 3
postype = p1
pos = 0,0
scale = const(size.xscale),const(size.yscale)
bindtime = -1

[State 1312, Bind 1]
type = TargetBind
trigger1 = AnimElemTime(1) >= 0 && animelemtime(2) < 0
pos = 186, -332

[State 1312, Bind 2]
type = TargetBind
trigger1 = AnimElemTime(2) >= 0 && animelemtime(3) < 0
pos = 186, -322

[State 1312, Bind 2]
type = TargetBind
trigger1 = AnimElemTime(3) >= 0 && animelemtime(4) < 0
pos = 186, -322

[state 1312, plsy snd]
type = playsnd
trigger1 = animelemtime(4) = 0
value = S1300,0

[state 1312, plsy snd]
type = playsnd
trigger1 = animelemtime(4) = 0
value = S1300,0

[state 1312, explod FX]
TYPE = explod
trigger1 = animelemtime(4) = 0
anim = 2050
postype = p1
sprpriority = 2
pos = -275,-170
bindtime = -1
ownpal = 1
scale = const(size.xscale)*1.5,const(size.yscale)*1.5

[state 1312, explod gas particals 1 of 5]
type = explod
trigger1 = animelemtime(4) = 1
anim = 2052
postype = p1
pos = 176,-264
scale = const(size.xscale)*2,const(size.yscale)*2
ownpal = 1
sprpriority = 2
vel = 5,-20

[state 1312, explod gas particals 2 of 5]
type = explod
trigger1 = animelemtime(4) = 0
anim = 2052
postype = p1
pos = 176,-264
scale = const(size.xscale)*2,const(size.yscale)*2
ownpal = 1
sprpriority = 2
vel = 5,20

[state 1312, explod gas particals 3 of 5]
type = explod
trigger1 = animelemtime(4) = 1
anim = 2052
postype = p1
pos = 176,-264
scale = const(size.xscale)*2,const(size.yscale)*2
ownpal = 1
sprpriority = 2
vel = 10,10

[state 1312, explod gas particals 4 of 5]
type = explod
trigger1 = animelemtime(4) = 0
anim = 2052
postype = p1
pos = 176,-264
scale = const(size.xscale)*2,const(size.yscale)*2
ownpal = 1
sprpriority = 2
vel = 10,-10

[state 1312, explod gas particals 5 of 5]
type = explod
trigger1 = animelemtime(4) = 1
anim = 2052
postype = p1
pos = 176,-264
scale = const(size.xscale)*2,const(size.yscale)*2
ownpal = 1
sprpriority = 2
vel = 20,0

[state 1312, targetlifeadd]
type = targetlifeadd
trigger1 = animelemtime(4) = 0
value = ceil(fvar(10)*-180)

[state 1312, poweradd]
type = poweradd
trigger1 = animelemtime(4) = 0
VALUE = 300

[state 1312, Launch]
type = Targetstate
trigger1 = animelemtime(4) = 0
value = 1335

[state x, combo damage score]
type = varadd
trigger1 = animtime = 0
v = 18
value = -3
persistent = 0
ignorehitpause = 1

[state 1312, end]
type = changestate
trigger1 = animtime = 0
value =  0
ctrl = 1

;-------------------------------------------------------------------------
;Ass Vaccum EX
[statedef 1320]
type = S
movetype = A
physics = S
velset = 0,0
sprpriority = -3
ctrl = 0
sprpriority = 1

[state 1321, meter management]
type = helper
trigger1 = time = 0
trigger1 = !numhelper(1321)
stateno = 1321
id = 1321
postype = p1
pos = 0,0

[state 1300, nothitby]
type = null;nothitby
trigger1 = 1
value = ,AP

[State X, Blink Yellow]
type = PalFX
trigger1 = time%2
time = 1
add = 150,75,0 ;32,16,0
sinadd = 64,32,5,3
ignorehitpause

;===========
;Armor start
;===========

[state 1320, set animation]
type  = changeanim
trigger1 = anim != 1320
value = 1320

;determine what frame
[state 1320, remember frame]
type = varset
trigger1 = time <= 0
v = 22
value = animelemno(0)
ignorehitpause = 1

;delay effect
[state 1320, delay]
type = changeanim 
trigger1 = var(31) < floor(gethitvar(hittime)*1.1)
value = anim
elem = var(22)

[state 1320, freeze location]
type = posfreeze
trigger1 = var(31) < floor(gethitvar(hittime)*1.1)
value = 1
;--------------------------

[state 1320, still take damage]
type = poweradd
trigger1 = gethitvar(damage) != 0
value = floor(gethitvar(damage)*1.5)
persistent = 1

[state 1320, armor count down]
type = varadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) > 0
V = 20
value = - 1
persistent = 1

[state 1320, Unstoppable]
type = hitoverride
trigger1 = alive
trigger1 = animelemtime(1) >= 0 && animelemtime(39) < 0
attr = SCA, AP
stateno = 1320
time = 1
persistent = 1
ignorehitpause = 1

[State 1320, flash red]
type = PalFX
trigger1 = Time = 0
trigger1 = gethitvar(damage) != 0
time = 7
add = 100,0,0
IgnoreHitPause = 1


[state 1320, Explod]
type = explod
trigger1 = time = 0
anim = 1325
id = 1320
scale = const(size.xscale),const(size.yscale)
pos = 0,0
postype = p1
bindtime = -1
sprpriority = 3
removeongethit = 1
ignorehitpause = 1

[state 1320, settypeset]
type = statetypeset
trigger1 = animelem = 3
statetype = A

[state 1320, statetypeset]
type = statetypeset
trigger1 = animelem = 6
statetype = S

[state 1320, velset]
type = velset
trigger1 = animelemtime(3) = 1 
x = 48
persistent = 1



[State 1320, hitdef]
type = HitDef
trigger1 = animelem = 4
persistent = 0
attr = S, SA
animtype  = Heavy
damage    = 5,1
guardflag = M
hitflag = MF
pausetime = 4,4
sparkno = 2
id = 1321
sparkxy = -10,-60
hitsound = S5000, 1
guardsound = S120, 0
ground.type = high
ground.slidetime = 18
ground.hittime  = 18
ground.velocity = 16,0
air.velocity = 12,-10
fall = 0
fall.recovertime = 30
fall.recover = 1
guard.slidetime = 4
guard.hittime = 4
guard.velocity = -40
airguard.velocity = -26,-2
guard.kill = 0

[State 1320, hitdef]
type = HitDef
trigger1 = animelem = 6
persistent = 0
attr = S, SA
animtype  = Heavy
damage    = 5,1
guardflag = M
hitflag = MF
pausetime = 4,4
sparkno = 2
id = 1321
sparkxy = -10,-60
hitsound = S5000, 1
guardsound = S120, 0
ground.type = high
ground.slidetime = 18
ground.hittime  = 18
ground.velocity = 16,0
air.velocity = 12,-10
fall = 0
fall.recovertime = 30
fall.recover = 1
guard.slidetime = 4
guard.hittime = 4
guard.velocity = -40
airguard.velocity = -26,-2
guard.kill = 0

;normal
[State 1320, 1]
type = HitDef
Triggerall = animelemtime(10) > 0 && animelemtime(39) < 0
trigger1 = p2stateno != [150,155]
attr = S, ST          
hitflag = MAF
guardflag =          
priority = 1, Miss    
sparkno = -1
guard.sparkno = -1        
p1sprpriority = 1    
id = 1320                   
p1facing = 1
p2facing = 1 
p1sprpriority = -3
p2sprpriority = 1         
p1stateno = 1322      
p2stateno = 1330      
guard.dist = 0      
guard.velocity = -48
guard.hittime = 24
guard.slidetime = 24
fall = 1 

;Stunned
[State 1320, 1]
type = HitDef
Triggerall = animelemtime(10) > 0 && animelemtime(39) < 0
trigger1 = enemynear,anim = 5300
attr = S, ST          
hitflag = MF-
guardflag =          
priority = 1, Miss    
sparkno = -1
guard.sparkno = -1        
p1sprpriority = 1    
id = 1320                   
p1facing = 1
p2facing = 1 
p1sprpriority = -3
p2sprpriority = 1         
p1stateno = 1322      
p2stateno = 1330      
guard.dist = 0      
guard.velocity = -48
guard.hittime = 24
guard.slidetime = 24
fall = 1 

;comboed
[State 1320, 1]
type = HitDef
Triggerall = animelemtime(10) > 0 && animelemtime(39) < 0
trigger1 = numtarget(1321)
attr = S, ST          
hitflag = MF
guardflag =          
priority = 1, Miss    
sparkno = -1
guard.sparkno = -1        
p1sprpriority = 1    
id = 1320                   
p1facing = 1
p2facing = 1 
p1sprpriority = -3
p2sprpriority = 1         
p1stateno = 1322      
p2stateno = 1330      
guard.dist = 0      
guard.velocity = -48
guard.hittime = 24
guard.slidetime = 24
fall = 1 

[state 1320, helper]
type = helper
triggerall = p2dist x = [0, 1200]
triggerall = p2statetype != L 
triggerall = numhelper(1342) < 2
trigger1 = p2statetype != A
trigger1 = animelemtime(10) > 0  && animelemtime(39) < 0
name = "Pastilla's Vaccuum"
stateno = 1342
id = 1342
postype = p1
pos = p2dist x + 200,0
sprpriority = 2
persistent = 4

[state 1300, helper]
type = null;helper
trigger1 = animelemtime(9) = 0
name = "Pastilla's Vaccuum Poison"
stateno = 1345
id = 1345
postype = p1
pos = 250, 0
sprpriority = 2
persistent = 16

[state 1320, explod]
type = explod
trigger1 = animelemtime(9) = 0
anim = 2060
id = 2060
removeongethit = 1
bindtime = -1
removetime = -1
pos = 230,-250
scale = const(size.xscale),const(size.yscale)
sprpriority = 4

[state 1320, removexplod]
type = removeexplod
trigger1 = animelemtime(39) >= 0
id = 2060

[state 1300, playsnd]
type = playsnd
trigger1 = animelemtime(11) = 0
value = S1020,0
channel = 2

[state 1320, playsnd]
type = playsnd
trigger1 = animelemtime(6) = 0
value = S52,0

[State 1320, 4]
type = EnvShake
trigger1 = animelemtime(6) = 0
time = 14
ampl = 8
freq = 100
phase = 100

[state 1320, end]
type = changestate
trigger1 = animtime = 0
value = 1329

;----------------------------------------------------------------------------
;Meter Management because of armor
[statedef 1321]
movetype = I
anim = 9999
velset = 0,0

[state 1321, poweradd]
type = poweradd
trigger1 = time = 0
value = -500
persistent = 0

[state 1321, removeself]
type = destroyself
trigger1 = time > 80

;----------------------------------------------------------------------------
;Throw Portion - Light
[Statedef 1322]
type = S
movetype = A
physics = S
anim = 1322
sprpriority = -2

[state 1322, removeexplod]
type = removeexplod
trigger1 = time = 0
id = 1320

[state 1322, plsy snd]
type = playsnd
trigger1 = time = 0
value = S1020,1
channel = 1

[state 1322, stopsnd]
type = stopsnd
trigger1 = time = 0
channel = 2

[state 1322, removexplod]
type = removeexplod
trigger1 = time = 0
id = 2060
 

[state 1322, extra]
type = explod
trigger1 = time = 0
anim = 1326
id = 1322
sprpriority = 3
postype = p1
pos = 0,0
scale = const(size.xscale),const(size.yscale)
bindtime = -1

[State 1322, Bind 1]
type = TargetBind
trigger1 = AnimElemTime(1) >= 0 && animelemtime(2) < 0
pos = 186, -332

[State 1322, Bind 2]
type = TargetBind
trigger1 = AnimElemTime(2) >= 0 && animelemtime(3) < 0
pos = 186, -322

[State 1322, Bind 2]
type = TargetBind
trigger1 = AnimElemTime(3) >= 0 && animelemtime(4) < 0
pos = 186, -322

[state 1322, plsy snd]
type = playsnd
trigger1 = animelemtime(4) = 0
value = S1300,0

[state 1322, plsy snd]
type = playsnd
trigger1 = animelemtime(4) = 0
value = S1300,0

[state 1322, explod FX]
TYPE = explod
trigger1 = animelemtime(4) = 0
anim = 2050
postype = p1
sprpriority = 2
pos = -275,-170
bindtime = -1
ownpal = 1
scale = const(size.xscale)*1.5,const(size.yscale)*1.5

[state 1322, explod gas particals 1 of 5]
type = explod
trigger1 = animelemtime(4) = 1
anim = 2052
postype = p1
pos = 176,-264
scale = const(size.xscale)*2,const(size.yscale)*2
ownpal = 1
sprpriority = 2
vel = 5,-20

[state 1322, explod gas particals 2 of 5]
type = explod
trigger1 = animelemtime(4) = 0
anim = 2052
postype = p1
pos = 176,-264
scale = const(size.xscale)*2,const(size.yscale)*2
ownpal = 1
sprpriority = 2
vel = 5,20

[state 1322, explod gas particals 3 of 5]
type = explod
trigger1 = animelemtime(4) = 1
anim = 2052
postype = p1
pos = 176,-264
scale = const(size.xscale)*2,const(size.yscale)*2
ownpal = 1
sprpriority = 2
vel = 10,10

[state 1322, explod gas particals 4 of 5]
type = explod
trigger1 = animelemtime(4) = 0
anim = 2052
postype = p1
pos = 176,-264
scale = const(size.xscale)*2,const(size.yscale)*2
ownpal = 1
sprpriority = 2
vel = 10,-10

[state 1322, explod gas particals 5 of 5]
type = explod
trigger1 = animelemtime(4) = 1
anim = 2052
postype = p1
pos = 176,-264
scale = const(size.xscale)*2,const(size.yscale)*2
ownpal = 1
sprpriority = 2
vel = 20,0

[state 1322, wall bounce limiter]
type = varadd
trigger1 = animelemtime(3) = 16 ;Glass Shatters
var(7) = -1

[state 1322, targetlifeadd]
type = targetlifeadd
trigger1 = animelemtime(4) = 0
value = ceil(fvar(10)*-150)

[state x, combo damage score]
type = varadd
trigger1 = animtime = 0
v = 18
value = -18
persistent = 0
ignorehitpause = 1

[state 1322, Launch]
type = Targetstate
trigger1 = animelemtime(4) = 0
value = ifelse(var(7) > 0, 1336, 1335)

[state 1322, end]
type = changestate
trigger1 = animtime = 0
value =  0
ctrl = 1


;----------------------------------------------------------------------------
; Recovery for Vaccum
[statedef 1329]
movetype = I
type = U
anim = 1329
ctrl = 0

[state 1309]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1


;---------------------------------------------------------------------------
;Victim animation
[Statedef 1330]
type    = A
movetype= H
physics = N
velset = 0,0

[State 1330, 1]
type = ChangeAnim2
Trigger1 = Time = 0
value = 1330

[state 1330, movecamera]
type = screenbound
trigger1 = 1
movecamera = 1,0
value = 0

[state 1330, color]
type = palFX
trigger1 = 1
time = 180
mul = 140,60,60

;In case attacker loses binding on player for any reason, this controller
;guarantees that the player will never get stuck in this thrown state.
[State 1330, 2]
type = SelfState
trigger1 = time > 75
value = 5050

;---------------------------------------------------------------------------
;LAUNCH
[STATEdef 1335]
movetype = H
physics = N
velset = -100,-12

[state 1330, movecamera]
type = screenbound
trigger1 = 1
movecamera = 1,0
value = 0

;[state 1335, changeanim]
;type = changeanim
;trigger1 = time = 0
;value = 5061

[state 1335, nothitby]
type = nothitby
trigger1 = 1
value = SCA

[state 1335, gravity]
type = gravity
trigger1 = 1

[State 676, Hit wall]
type = ChangeState
triggerall = Pos y < 0
trigger1 = BackEdgeBodyDist <= 20
trigger2 = FrontEdgeBodyDist <= 20
value = 6770

[state 1335, selfstate]
type = selfstate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 5100

;---------------------------------------------------------------------------
; EX LAUNCH
[STATEdef 1336]
movetype = H
physics = N
velset = -100,-24

[state 1330, movecamera]
type = screenbound
trigger1 = 1
movecamera = 1,0
value = 0

;[state 1335, changeanim]
;type = changeanim
;trigger1 = time = 0
;value = 5061

[state 1335, nothitby]
type = nothitby
trigger1 = 1
value = SCA

[state 1335, gravity]
type = gravity
trigger1 = 1

[State 676, Hit wall]
type = ChangeState
triggerall = Pos y < 0
trigger1 = BackEdgeBodyDist <= 20
trigger2 = FrontEdgeBodyDist <= 20
value = 672

[state 1335, selfstate]
type = selfstate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 5100

;----------------------------------------------------------------------------
; Vaccuum Wind Box Light
[statedef 1340]
type = A
movetype = I
physics = N
anim = 1401
velset = 0,0

[state 1340, turn]
type = turn
trigger1 = time = 0

[State 1340, Push]
type = posset
trigger1 = time = 0
y = 0

[State 1340, Push]
type = PlayerPush
trigger1 = 1
value = 1

[State 1340, NHB]
type = NotHitBy
Trigger1 = 1
value = SCA
Time = 1

[State 1340, Vel]
type = VelSet
trigger1 = Time >= 1
x = 40

[State 1340, End]
type = DestroySelf
trigger1 = Time = 9
trigger2 = parent,stateno = 1020 && moveguarded

;----------------------------------------------------------------------------
; Vaccuum Wind Box Heavy
[statedef 1341]
type = A
movetype = I
physics = N
anim = 1401
velset = 0,0

[state 1341, turn]
type = turn
trigger1 = time = 0

[State 1341, Push]
type = posset
trigger1 = time = 0
y = 0

[State 1341, Push]
type = PlayerPush
trigger1 = 1
value = 1

[State 1341, NHB]
type = NotHitBy
Trigger1 = 1
value = SCA
Time = 1

[State 1341, Vel]
type = VelSet
trigger1 = Time >= 1
x = 45

[State 1341, End]
type = DestroySelf
trigger1 = Time = 9
trigger2 = parent,stateno = 1020 && moveguarded

;----------------------------------------------------------------------------
; Vaccuum Wind Box EX
[statedef 1342]
type = A
movetype = I
physics = N
anim = 1401
velset = 0,0

[state 1342, turn]
type = turn
trigger1 = time = 0

[State 1342, Push]
type = posset
trigger1 = time = 0
y = 0

[State 1342, Push]
type = PlayerPush
trigger1 = 1
value = 1

[State 1342, NHB]
type = NotHitBy
Trigger1 = 1
value = SCA
Time = 1

[State 1342, Vel]
type = VelSet
trigger1 = Time >= 1
x = 50

[State 1342, End]
type = DestroySelf
trigger1 = Time = 9
trigger2 = parent,stateno = 1020 && moveguarded

;----------------------------------------------------------------------------
; Vaccuum Wind Box SUPER
[statedef 1343]
type = A
movetype = I
physics = N
anim = 1401
velset = 0,0

[state 1343, turn]
type = turn
trigger1 = time = 0

[State 1343, Push]
type = posset
trigger1 = time = 0
y = 0

[State 1343, Push]
type = PlayerPush
trigger1 = 1
value = 1

[State 1343, NHB]
type = NotHitBy
Trigger1 = 1
value = SCA
Time = 1

[State 1343, Vel]
type = VelSet
trigger1 = Time >= 1
x = 60

[State 1343, End]
type = DestroySelf
trigger1 = Time = 9
trigger2 = parent,stateno = 1020 && moveguarded


;------------------------------------------------------------------------------
;Poisoning Effect
[statedef 1345]
type = S
movetype = H
physics = N
ctrl = 0
anim = 1345

[State 1345, 5] 
type = hitdef
trigger1 = 1
trigger1 = !moveguarded
persistent = 0
attr = S, ST
animtype  = Hard
damage    = 0, 0
guardflag = 
hitflag = MF-
getpower = 30
givepower = 50
pausetime = 2,6
sparkno = -1
sparkxy = -10,-60
hitsound   = S1000,4
hitonce = 1
guardsound = S120, 0
ground.type = low
ground.slidetime = 16
ground.hittime  = 16
ground.velocity = 12,0
air.velocity = 12,0
id = 4000
guard.velocity = -24            
guard.hittime = 8
guard.slidetime = 8
airguard.velocity = -24,4
airguard.hittime = 16
guard.kill = 1
guard.dist = 0

[State 1345, TargetState]
type = TargetState
triggerall = NumTarget(4000)
trigger1 = movehit
value = 4020
ID = 4000

[State 1345, Helper]
type = Helper
trigger1 = NumTarget(4000)
trigger1 = movehit
name = "Ranged Poison effect"
ID = 4006
stateno = 4007
pos = 0,0
postype = p2
facing = -1
ownpal = 1
ignorehitpause = 1



[State 1345, 4]
type = DestroySelf
trigger1 = movecontact
trigger2 = movereversed
trigger3 = time > 48




;===========================================================================
;  Hip Bump (Push Block)
;===========================================================================

[Statedef 1400]
type = S
movetype = A
physics = S
velset = 0,0
anim = 1400
facep2 = 1

[state 1400, velset]
type = velset
trigger1 = time = 0
y = -18
x = 6

[state 1400, gravity]
type = gravity
trigger1 = pos y < -1 

[state 1400, pos set]
type = posset
trigger1 = pos y > 0
y = 0

[state 1400, velset]
type = velset
trigger1 = pos y > 0
y = 0
x = 0

[state 1400, poweradd]
type = poweradd
trigger1 = time = 0
value = -1000

[state 1400, awareness pause]
type = pause
trigger1 = time = 0
time = 8
endcmdbuftime = 8

[state 1400, dim]
type = bgpalfx
trigger1 = time = 0
time = 8
mul = 200,200,200

[State 1400, Spark]
type = Explod
trigger1 = AnimElemtime(6) = 0
id = 1410
anim = 1410
postype = p1
pos = 180,-110
sprpriority = 3
bindtime = 1
scale = 3,3
ownpal = 1

[State 1400, 2]
type = HitDef
trigger1 = !movecontact
persistent = 0
attr = S, NA
animtype  = Heavy
damage    = 70
Hitflag = MA
guardflag = MA
id = 1400
pausetime = 0,0
sparkno = -1
ground.Velocity = -20
air.Velocity = -20,5
fall = 1
fall.recover = 0
kill = 0
guard.dist = 640
guard.kill = 0

[state 1400, moveforward]
type = velset
trigger1 = time = 0
x = 0

[state 1400, snd]
type = playsnd
trigger1 = animelemtime(6) = 0
value = 1400,0

[State 1400, Push]
type = Helper
triggerall = numhelper(1401) < 4
trigger1 = animelemTime(6) = 0
trigger2 = animelemtime(6) = 2
ignorehitpause = 1
ID = 1401
name = "Shove"
pos = -20,0
postype = p1
stateno = 1401
keyctrl = 0
ownpal = 1
helpertype = normal


[state 1400, HB]
Type = hitby
trigger1 = 1
value = SCA,AT

[State 1400, 3]
type = ChangeState
trigger1 = vel y > 0
Trigger1 = pos y > -vel y
value = 1402
ctrl = 0

;-----------------------------------------------------------------------------
; Pushing part
[Statedef 1401]
type    = A
movetype= I
physics = N
velset = 0,0
anim = 1401

[State 1440, Push]
type = posset
trigger1 = time = 0
y = 0

[State 1440, Push]
type = PlayerPush
trigger1 = 1
value = 1

[State 1440, NHB]
type = NotHitBy
Trigger1 = 1
value = SCA
Time = 1

[State 1440, Vel]
type = VelSet
trigger1 = Time >= 0
x = 60

[State 345, End]
type = DestroySelf
trigger1 = Time = 15
trigger2 = parentdist x < 0

;--------------------------------------------------------------------------
;Push Block Landing
[statedef 1402]
type = S
movetype = I
physics = C
velset = 0,0
anim = 47

;land backwards
[state 1402, turn]
type = turn
trigger1 = time = 0

[state 52, sound]
type = playsnd
trigger1 = time = 0
value = S52,0
volume = 100

[State 52, 4]
type = EnvShake
trigger1 = time = 0
time = 14
ampl = 8
freq = 100
phase = 100

[state 1400, HB]
Type = hitby
trigger1 = 1
value = SCA,AT

[state 1402, posset]
type = posset
trigger1 = time = 0
y = 0

[state 1402, stand]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1
;=============================================================================
;  SUPERS
;=============================================================================
;Damage: 480 w/ Poison
[statedef 3000]
type    = S
movetype = A
physics = N
ctrl = 0
velset = 0,0
anim = 3000
sprpriority = 0

[state x, Minimum Super combo damage]
type = varset
trigger1 = time = 0
trigger1 = var(18) < 90
v = 18
value = 90

[state 3000, width]
type = width
trigger1 = 1
edge = 450,200

[state x, Minimum Super combo damage]
type = varset
trigger1 = time = 0
trigger1 = var(18) < 90
v = 18
value = 90

[state 3000, nothitby]
type = nothitby
trigger1 = time < 85
value = SCA

[State 3000, Super Pause]
type = SuperPause
trigger1 = animelemtime(3) = 0
sound = S3000, 0
poweradd = -3000
pos = 30,-140
time = 60
movetime = 60


[state 3000, Super Portrait]
type = explod
trigger1 = animelemtime(3) =[0, 14] ;7
anim = 3100
postype = back
sprpriority = -4
supermovetime = 60
removetime = 1
pausemovetime = 60
scale = (3-(time*0.15))*(1),(3-(time*0.15))*(1)
pos = 0,60-time*5
ownpal = 1

[state 1000, Giant Box]
type = helper
trigger1 = animelemtime(4) = 0
trigger1 = numhelper(3010) < 1
stateno = 3010
id = 3010
name = "Pastilla's Smellevator"
sprpriority = -1
postype = p1
pos = ifelse(p2dist x > 325, p2dist x, 325),0
id = 3010
ignorehitpause = 0
scale = const(size.xscale),const(size.yscale)
ownpal = 1

[state 3000, no bg]
type = assertspecial
trigger1 = animelemtime(3) =[0,60]
flag = nobg
ignorehitpause = 1

[state 3000, Super Portrait]
type = explod
trigger1 = animelemtime(3) = 15
anim = 3100
postype = back
vel = -0.1,0
sprpriority = -4
supermovetime = 60
removetime = 45
pausemovetime = 60
pos = 0,0
scale = 1,1
ownpal = 1

[state 3000, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1

[state 3000, change]
type = changestate
trigger1 = animelemtime(5) >= 0
trigger1 = numhelper(3010)
trigger1 = helper(3010),movehit
value = 3001

;-----------------------------------------------------------
;Gassing Portion
[statedef 3001]
type    = S
movetype = A
physics = N
ctrl = 0
velset = 0,0
anim = 3001
sprpriority = -3

[state 3000, simplemath]
type = varset
trigger1 = time = 0
fvar(11) = p2dist x
persistent = 0

[state 3001, explod-butt]
type = explod
trigger1 = time = 0
anim = 3002
id = 3002
postype = p1
pos = 0,0
scale = const(size.xscale),const(size.yscale)
bindtime = -1
sprpriority = 4

[state 3001, settypeset]
type = statetypeset
trigger1 = animelemtime(3) > 0
statetype = A

[state 3001, statetypeset]
type = statetypeset
trigger1 = animelemtime(6) < 0
statetype = S

[state 3001, sound landing]
type = playsnd
trigger1 = animelemtime(6) = 0
value = S52,0

[State 3001, shake landing]
type = EnvShake
trigger1 = animelemtime(6) = 0
time = 14
ampl = 8
freq = 100
phase = 100

[state 3001, Hop forward]
type = posadd
triggerall = p2dist x > 325
trigger1 = animelemtime(3) >= 0 && animelemtime(6) < 0
x = ((fvar(11))/9);5.56
persistent = 1

[state 3001, Hop forward]
type = posadd
triggerall = p2dist x <= 325
trigger1 = animelemtime(3) >= 0 && animelemtime(6) < 0
x = ((fvar(11))/9)
persistent = 1

[state 41, after image]
type = afterimage
trigger1 = animelemtime(3) = 0
time = 30
timegap = 1
framegap = 3
length = 12
palbright= 0,0,0
paladd= 0,196,0
palmul= .9,.9,.9
palcontrast= 256,256,256
trans = "none"

[state 3001, stop afterimages]
type = afterimage
trigger1 = animelemtime(6)=0
time =0

[state 3001, lock in place]
type = posadd
trigger1 = animelemtime(6) = 0
x = p2dist x-130
persistent = 0

[state 3001, Stop]
type = velset
trigger1 = animelemtime(6) = 1
x = 0
persistent = 1

[state 3001, Fart snd 1]
type = playsnd
trigger1 = animelemtime(13) = 1 
value = S3000,3;S3000,2
persistent = 1

[state 3001, Fart snd 2]
type = playsnd
trigger1 = animelemtime(28) = 1 
value = S3000,4;S3000,2
persistent = 1

[state 3001, Fart snd 3]
type = playsnd
trigger1 = animelemtime(48) = 1 
value = S3000,5;S3000,1
persistent = 1

[state 3001, glass Thud]
type = playsnd
trigger1 = animelemtime(10) = 1
trigger2 = animelemtime(25) = 1
trigger3 = animelemtime(45) = 1
value = S3010,0
persistent = 1



[state 3001, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1



;-----------------------------------------------------------
;Elevator
[statedef 3010]
type = S
movetype = A
physics = N
ctrl = 0
sprpriority = 5

[state 3011, palfx]
type = palfx
trigger1 = 1
add = 128,0,0

[state 3011, playerpush]
type = playerpush
trigger1 = 1
value = 0

[state 3010, anim]
type = changeanim
trigger1 = anim != 3010
value = 3010

[state 3010, nothitby]
type = nothitby
trigger1 = 1
value = SCA
ignorehitpause = 1

[State 3010, 1]
type = HitDef
Trigger1 = Time = 0
attr = S, HP          
hitflag = MAFD
guardflag = MA          
priority = 1, Miss    
sparkno = -1         
p1sprpriority = 1    
id = 3000  
nochainid = 1400
hitonce = 1                 
p1facing = 1
p2facing = 1                
p2stateno = 3020      
guard.dist = 400
guard.velocity = -30
guard.slidetime = 30
guard.hittime = 30
airguard.hittime = 34
airguard.velocity = -24,-12
ground.velocity = 0,0
fall = 1
fall.recover = 0 
fall.recovertime = 60
ground.cornerpush.veloff = 0
        


[state 3010, targetpos]
type = targetbind
trigger1 = movehit
id = 3000
pos = 30,0
persistent = 1

[state 3010, changestate]
type = changestate
trigger1 = animelemtime(6) > 0
trigger1 = movehit
trigger1 = numtarget(3000)
value = 3011

[state 4300, end]
type = destroyself
trigger1 = animtime = 0

;-------------------------------------------------------
;Hold Portion
[statedef 3011]
type = S
movetype = A
physics = N
ctrl = 0
anim = 3011
sprpriority = 5
movehitpersist = 1

[state 3011, playerpush]
type = playerpush
trigger1 = 1
value = 0

[state 11001, attackmulset]
type = attackmulset
trigger1 = 1
value = parent,fvar(10)
Persistent = 1

[state 3010, targetpos]
type = targetbind
trigger1 = parent,stateno = 3000 
trigger2 = parent,stateno = 3001  
trigger2 = parent,animelemtime(0) >= 0 && parent,animelemtime(9) < 0
id = 3000
pos = 30,0
persistent = 1

[state 3011, targetstate]
type = targetstate
trigger1 = parent,stateno = 3001
trigger1 = parent,animelemtime(9) = 0
value = 3021

[state 3011, bind]
type = targetbind
trigger1 = parent,stateno = 3001
trigger1 = parent,animelemtime(9) >= 0 && parent,animelemtime(10) < 0
pos = 130,-320

[state 3011, bind]
type = targetbind
trigger1 = parent,stateno = 3001
trigger1 = parent,animelemtime(10) >= 0 && parent,animelemtime(61) < 0
pos = 170,-370

[state 3011, fart fx]
type = explod
trigger1 = parent,animelemtime(10) >= 0 && parent,animelemtime(20) < 0
trigger2 = parent,animelemtime(25) >= 0 && parent,animelemtime(40) < 0
trigger3 = parent,animelemtime(45) >= 0 && parent,animelemtime(60) < 0
anim = 2052
postype = p1
pos = 170,-370
vel = 0,-4
persistent = 8
scale = 1.5,3

[state 3011, fart fx]
type = explod
trigger1 = parent,animelemtime(10) >= 0 && parent,animelemtime(20) < 0
trigger2 = parent,animelemtime(25) >= 0 && parent,animelemtime(40) < 0
trigger3 = parent,animelemtime(45) >= 0 && parent,animelemtime(60) < 0
anim = 2052
postype = p1
pos = 170,-370
vel = 0,8
persistent = 8
scale = 1.5,3

[state 3011, hit add]
type = hitadd
trigger1 = parent,animelemtime(10) >= 0 && parent,animelemtime(20) < 0
trigger2 = parent,animelemtime(25) >= 0 && parent,animelemtime(40) < 0
trigger3 = parent,animelemtime(45) >= 0 && parent,animelemtime(60) < 0
persistent = 4
value = 1

[state 3011, bind]
type = targetlifeadd
triggerall = parent,stateno = 3001
trigger1 = parent,animelemtime(10) = 0
trigger2 = parent,animelemtime(25) = 0 
trigger3 = parent,animelemtime(45) = 0 
value = ceil(parent,fvar(10)*-20);-24
persistent = 2
kill = 0

[state 3011, bind]
type = targetlifeadd
triggerall = parent,stateno = 3001
trigger1 = parent,animelemtime(10) >= 0 && parent,animelemtime(20) < 0
trigger2 = parent,animelemtime(25) >= 0 && parent,animelemtime(40) < 0
trigger3 = parent,animelemtime(45) >= 0 && parent,animelemtime(60) < 0
value = ceil(parent,fvar(10)*-10)
persistent = 2
kill = 0

[state 3011, bind]
type = targetpoweradd
triggerall = parent,stateno = 3001
trigger1 = parent,animelemtime(10) >= 0 && parent,animelemtime(20) < 0
trigger2 = parent,animelemtime(25) >= 0 && parent,animelemtime(40) < 0
trigger3 = parent,animelemtime(45) >= 0 && parent,animelemtime(60) < 0
value = 12
persistent = 1


[state 3011, go shatter]
type = changestate
trigger1 = parent,stateno = 3001
trigger1 = parent,animelemtime(51) = 0
value = 3012

;--------------------------------------------------------
[statedef 3012]
type = S
movetype = A
physics = N
anim = 3012

[state 3012, attackmulset]
type = attackmulset
trigger1 = 1
value = parent,fvar(10)
Persistent = 1

[state 3012, big fart Fx 1]
type = explod
trigger1 = animelemtime(3) = 0
anim = 2052
postype = p1
pos = 170,-370
scale = 3,3
vel = 24,0
sprpriority = 5
removetime = 34

[state 3012, big fart Fx 2]
type = explod
trigger1 = animelemtime(3) = 0
anim = 2052
postype = p1
pos = 170,-370
scale = 3,3
vel = 12,-12
sprpriority = 5
removetime = 34

[state 3011, big fart Fx 3]
type = explod
trigger1 = animelemtime(3) = 0
anim = 2052
postype = p1
pos = 170,-370
scale = 3,3
vel = 0,-24
sprpriority = 5
removetime = 34

[state 3011, big fart Fx 4]
type = explod
trigger1 = animelemtime(3) = 0
anim = 2052
postype = p1
pos = 170,-370
scale = 3,3
vel = -12,-12
sprpriority = 5
removetime = 34

[state 3011, big fart Fx 5]
type = explod
trigger1 = animelemtime(3) = 0
anim = 2052
postype = p1
pos = 170,-370
scale = 3,3
vel = -24,0
sprpriority = 5
removetime = 34

[state 3011, Glass in fart fx]
type = explod
trigger1 = parent,animelemtime(45) >= 0 && parent,animelemtime(60) < 0
anim = 2052
postype = p1
pos = 170,-370
vel = 0,8
persistent = 8
scale = 1.5,3

[state 3011, Glass in fart fx]
type = explod
trigger1 = parent,animelemtime(45) >= 0 && parent,animelemtime(60) < 0
anim = 2052
postype = p1
pos = 170,-370
vel = 0,-4
persistent = 8
scale = 1.5,3

[state 3012, explosion sound]
type = playsnd
trigger1 = animelemtime(3) = 0
value = S3010,1
ignorehitpause = 1

[state 3011, bind]
type = targetlifeadd
triggerall = parent,stateno = 3001
trigger1 = parent,animelemtime(45) >= 0 && parent,animelemtime(60) < 0
value = ceil(parent,fvar(10)*-10)
persistent = 2
kill = 1

[state 3011, bind]
type = targetlifeadd
trigger1 = parent,stateno = 3001
trigger1 = animelemtime(3) = 0
value = -10
persistent = 0



[state 3011, bind]
type = targetbind
trigger1 = anim = 3012
trigger1 = animelemtime(1) >= 0 && animelemtime(3) < 0
pos = 110,-370


[state 3011, bind]
type = targetbind
trigger1 = anim = 3012
trigger1 = animelemtime(1) >= 0 && animelemtime(3) < 0
pos = 110,-370

[state 3011, targetstate]
type = targetstate
id = 3000
trigger1 = animelemtime(3) = 1
value = 3023

;[state 3012, target drop]
;type = targetdrop
;trigger1 = animelemtime(4) = 0

[State 0, Helper]
type = Helper
triggerall = Numtarget(3000)
trigger1 = anim = 3012
trigger1 = animelemtime(3) = 0
name = "Melee Poison effect"
ID = 4006
stateno = 4056
pos = 0,0
postype = p2
facing = -1
ownpal = 1
ignorehitpause = 1

;[state 1010, helper]
;type = helper
;trigger1 = parent,animelemtime(61) = 0
;name = "Pastilla's Vaccuum Poison"
;stateno = 1028
;id = 1028
;postype = p1
;pos = 190, -400
;sprpriority = 2
;persistent = 0


[state 4300, end]
type = destroyself
trigger1 = animtime = 0


;-------------------------------------------------------
;Victim Held Initial
[statedef 3020]
type = A
movetype = H
physics = N
ctrl = 0

[state 3020, anim]
type = changeanim2
trigger1 = time = 0
value = 3020

[state 3001, screenbound]
type = screenbound
trigger1 = 1
movecamera = 1,0

[state 3020, anim]
type = changeanim
trigger1 = time > 12
trigger1 = anim != 5300
value = 5300

;[state 3020, changestate]
;type = changestate
;trigger1 = time = 42
;value = 3021

[state 3020, release]
type = selfstate
trigger1 = time > 300
value = 5030

;---------------------------------------------------------
;Victim Gassed
[statedef 3021]
type = A
movetype = H
physics = U
ctrl = 0

[state 3001, screenbound]
type = screenbound
trigger1 = 1
movecamera = 1,0

[State 1020, Afterimage]
type = AfterImage
trigger1 = Time = 0
length = 28
PalBright   =  30, 60,  30
PalContrast =  70, 70, 20
PalAdd      = -10,-10,-10
PalMul      = .85,.85,.50
TimeGap  = 1
FrameGap = 2
Trans = Add
time = 2

[State 1020, Afterimage]
type = AfterImageTime
trigger1 = 1
time = 2

[state 820, shrink]
type = angledraw
trigger1 = animelemtime(2) > 1 && animelemtime(12) < 0
scale = (1-((time-2)*0.015)),(1-((time-2)*0.015))
persistent = 1
ignorehitpause = 1

[state 820, shrink]
type = angledraw
trigger1 = animelemtime(12) >= 0 && animelemtime(13) < 0
scale = 0.7,0.7
persistent = 1
ignorehitpause = 1


[state 820, shrink]
type = angledraw
trigger1 = animelemtime(13) >= 0 && animelemtime(23) < 0
scale = (0.7-((time-56)*0.015)),(0.7-((time-56)*0.015))
persistent = 1
ignorehitpause = 1

[state 820, shrink]
type = angledraw
trigger1 = animelemtime(23) >= 0 && animelemtime(24) < 0
scale = 0.4,0.4
persistent = 1
ignorehitpause = 1

[state 820, shrink]
type = angledraw
trigger1 = animelemtime(24) > 1 && animelemtime(34) < 0
scale = (0.4-((time-124)*0.015)),(0.4-((time-124)*0.015))
persistent = 1
ignorehitpause = 1


[state 820, shrink]
type = angledraw
trigger1 = animelemtime(34) >= 0
scale = 0.1,0.1
persistent = 1
ignorehitpause = 1

[state 4020, color]
type = palFX
trigger1 = animelem = 2
time = 360
mul = 140,60,60

[state 3020, anim]
type = changeanim2
trigger1 = time = 0
value = 3021

[state 3021, poison]
type = null;changestate
trigger1 = !gethitvar(isbound)
value = 4055

[state 3020, release]
type = selfstate
trigger1 = time > 170
value = 5030

;--------------------------------------------------------
;Victim Launched
[statedef 3023]
type = A
movetype = H
physics = N
velset = -28,-24

[State 5000, 1]
Type = HitDef
Trigger1 = Time = 0
Attr = C, NP
Damage = 0
Priority = 1, Hit
HitFlag = F-
PauseTime = 0,0
SparkNo = -1
Guard.SparkNo = -1
;Ground.SlideTime = 0
Ground.HitTime = 9
;Ground.Velocity = 0
;Guard.Velocity = 0
;Air.Velocity = 0,0

[state 3023, anim]
type = changeanim2
trigger1 = time = 0
value = 4021

[state 3023, gravity]
type = veladd
trigger1 = time > 0
y = 1.22

[state 3023, selfstate]
type = selfstate
trigger1 = movereversed
trigger2 = !alive
value = 5050

[state 3023, selfstate]
type = selfstate
trigger1 = vel y > 0
trigger1 = pos y > -vel y 
value = 5100


;----------------------------------------------------------
;Super Gas Attack
[statedef 3040]
type = A
movetype = A
physics = S
ctrl = 0
anim = 3040
sprpriority = -2
velset = 0,0

[state x, Minimum Super combo damage]
type = varset
trigger1 = time = 0
trigger1 = var(18) < 70
v = 18
value = 70

[state 3040, projectile invunerability]
type = nothitby
trigger1 =  animelemtime(50) < 0
value = ,AP

[State 3040, Super Pause]
type = SuperPause
trigger1 = animelemtime(8) = 0
sound = S3000, 0
poweradd = -1000
pos = 30,-140
time = 60
movetime = 60

[state 3040, explod]
type = explod
trigger1 = animelemtime(10) = 0
anim = 3041
id = 3041
postype = p1
pos = 0,0
bindtime = -1
removeongethit = 1
sprpriority = 3
scale = const(size.xscale),const(size.yscale)

[state 3040, id]
type = removeexplod
trigger1 = animelemtime(52)=0
id = 3041

[state 3040, Super Portrait]
type = explod
trigger1 = animelemtime(8) =[0, 14] 
anim = 3100
postype = back
sprpriority = -4
supermovetime = 60
removetime = 1
pausemovetime = 60
scale = (3-(time*0.15))*(1),(3-(time*0.15))*(1)
pos = 0,60-time*5
ownpal = 1

[state 3040, no bg]
type = assertspecial
trigger1 = animelemtime(8) =[0,60]
flag = nobg
ignorehitpause = 1

[state 3040, Super Portrait]
type = explod
trigger1 = animelemtime(8) = 15
anim = 3100
postype = back
vel = -0.1,0
sprpriority = -4
supermovetime = 60
removetime = 45
pausemovetime = 60
pos = 0,0
scale = 1,1
ownpal = 1

[state 3040, settypeset]
type = statetypeset
trigger1 = animelemtime(3) = 0
statetype = A

[state 3040, statetypeset]
type = statetypeset
trigger1 = animelemtime(6) = 0
statetype = S

[state 3040, velset]
type = veladd
triggerall = ailevel = 0
triggerall = vel x < 16 && vel x > -8
trigger1 = animelemtime(3) >= 0 && animelemtime(6) < 0
x = ifelse(command = "holdfwd", 12, ifelse(command = "holdback", -4,0))
persistent = 1

[state 3040, nothitby]
type = nothitby
trigger1 = animelemtime(9) >= 0 && animelemtime(11) < 0
value = ,AP
ignorehitpause = 1

[state 3040, AI]
type = veladd
triggerall = ailevel > 0
triggerall = vel x < 16 && vel x > -8
triggerall = animelemtime(3) >= 0 && animelemtime(6) < 0
trigger1 = enemynear,movetype = H
trigger2 = p2bodydist x > 750
x = 12
persistent = 1

[state 3040, AI]
type = veladd
triggerall = ailevel > 0
triggerall = vel x < 16 && vel x > -8
triggerall = animelemtime(3) >= 0 && animelemtime(6) < 0
trigger1 = enemynear,movetype != H
trigger2 = p2bodydist x < 100 & enemynear,movetype != H
x = -4
persistent = 1


[State 3040, hitdef]
type = HitDef
trigger1 = animelem = 5
persistent = 0
attr = S, HA
animtype  = Heavy
damage    = 15,1
guardflag = MA
hitflag = MAF
priority = 1,miss
pausetime = 2,2
sparkno = 1
sparkxy = -10,-60
hitsound = S5000, 1
guardsound = S120, 0
ground.type = high
ground.slidetime = 16
ground.hittime  = 16
ground.velocity = -16,0
air.velocity = -12,-10
p1sprpriority = -2
p2sprpriority = 1
fall = 0
fall.recovertime = 30
fall.recover = 1
guard.slidetime = 12
guard.hittime = 12
guard.velocity = -20

[State 3040, hitdef]
type = HitDef
trigger1 = animelem = 9
persistent = 0
attr = S, HA
animtype  = Heavy
damage    = 15,2
guardflag = MA
hitflag = MAF
priority = 1,miss
pausetime = 2,2
sparkno = 1
sparkxy = -10,-60
hitsound = S5000, 1
guardsound = S120, 0
ground.type = high
ground.slidetime = 12
ground.hittime  = 12
ground.velocity = -16,0
air.velocity = -12,-10
p1sprpriority = -2
p2sprpriority = 1
fall = 0
fall.recovertime = 30
fall.recover = 1
guard.slidetime = 12
guard.hittime = 12
guard.velocity = -20

[state 3040, gas snd]
type = playsnd
trigger1 = animelemtime(10) = 0
value = S3040,2;S3040,0
channel = 2

[state 3040, gas snd]
type = playsnd
trigger1 = animelemtime(10) = 0
value = S3040,2;S3040,0
channel = 2

[state 3040, gas snd]
type = playsnd
trigger1 = animelemtime(10) = 0
value = S3040,2;S3040,0
channel = 2

[state 3040, stopsnd]
type = stopsnd
trigger1 = animelemtime(50) = 0
channel = 2


[state 3040, projectile 10 - 40]
type = helper
trigger1 = animelemtime(10) > 0 && animelemtime(48) < 0
postype = p1
stateno = 3050
pos = 327,-337
sprpriority = 2
persistent = 3
ignorehitpause = 1

[state 3040, projectile 10 - 40]
type = helper
trigger1 = animelemtime(49) = 0 
postype = p1
stateno = 3051
pos = 327,-337
sprpriority = 2
persistent = 3
ignorehitpause = 1

[state 3040, projectile 10 - 40]
type = helper
trigger1 = animelemtime(50) = 0 
postype = p1
stateno = 3052
pos = 327,-337
sprpriority = 2
persistent = 3
ignorehitpause = 1


[state 3040, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1

;-------------------------------------------------------
;Gas Projectile No poison
[statedef 3050]
type = S
movetype = A
physics = N
anim = 3050
sprpriority = 2

[state 3050, scale]
type = angledraw
trigger1 = 1
scale = 2,2
ignorehitpause = 1

[state 3050, velset]
type = velset
trigger1 = time = 0
x = 72
y = -2+(random%6)

[state 3050, attackdist]
type = attackdist
trigger1 = 1
value = 200

[state 3050, hitoverride]
type = hitoverride
trigger1 = 1
attr = SCA, AP,AA,AT
time = 1
stateno = 3055
ignorehitpause = 1
persistent = 1

[state 3050, nothitby]
type = nothitby
trigger1 = 1
value = ,AA,AT

[state 3050, attackdist]
type = attackdist
trigger1 = 1
value = 200

[State 3050, 5] 
type = hitdef
trigger1 = 1
trigger1 = !moveguarded
persistent = 0
attr = S, HP
animtype  = back
damage    = 8,3
guardflag = MA
getpower = 0
givepower = 25
hitflag = MAF
pausetime = 2,2
sparkno = -1
sparkxy = -10,-60
hitsound   = F5,1
guardsound = S120, 0
forcestand = 1
p2facing = 1
p2sprpriority = 1
ground.type = high
ground.slidetime = 16
ground.hittime  = 16
ground.velocity = -8,-10
air.velocity = -12,-6
guard.velocity = -16            
guard.hittime = 16
guard.slidetime = 16
airguard.velocity = -16,-2 
airguard.hittime = 16
guard.kill = 1
guard.dist = 200
fall.recover = 0
fall = 0



;[State 0, TargetState]
;type = TargetState
;triggerall = NumTarget(4000)
;trigger1 = movehit
;value = 4020
;ID = 4000

;[State 0, Helper]
;type = Helper
;trigger1 = NumTarget(4000)
;trigger1 = movehit
;name = "Ranged Poison effect"
;ID = 4006
;stateno = 4006 
;pos = 0,0
;postype = p2
;facing = -1
;ownpal = 1
;ignorehitpause = 1

[state 3040, end]
type = changestate
trigger1 = movecontact
trigger2 = movereversed
value = 3055


[State 3040, 4]
type = DestroySelf
trigger1 = movecontact
trigger2 = BackEdgeDist < -10
trigger3 = movereversed
trigger4 = time > 60

;-------------------------------------------------------
;Gas Projectile with poison
[statedef 3051]
type = S
movetype = A
physics = N
anim = 3050
sprpriority = 2

[state 3050, scale]
type = angledraw
trigger1 = 1
scale = 2,2
ignorehitpause = 1

[state 3050, velset]
type = velset
trigger1 = time = 0
x = 72
y = -3+(random%6)

[state 3050, attackdist]
type = attackdist
trigger1 = 1
value = 200

[state 3050, hitoverride]
type = hitoverride
trigger1 = 1
attr = SCA, AP,AA,AT
time = 1
stateno = 3055
ignorehitpause = 1
persistent = 1

[state 3050, nothitby]
type = nothitby
trigger1 = 1
value = ,AA,AT

[State 3050, 5] 
type = hitdef
trigger1 = 1
trigger1 = !moveguarded
persistent = 0
attr = S, HP
animtype  = back
damage    = 8,3
guardflag = MA
getpower = 0
givepower = 50
hitflag = MAF
pausetime = 2,6
sparkno = -1
sparkxy = -10,-60
hitsound   = F5,4
hitonce = 1
id = 4000
p2facing = 1
p2sprpriority = 1
guardsound = S120, 0
ground.type = high
ground.slidetime = 16
ground.hittime  = 16
ground.velocity = -12,-32
air.velocity = -24,-32
guard.velocity = -16            
guard.hittime = 16
guard.slidetime = 16
airguard.velocity = -20,-2 
airguard.hittime = 16
guard.kill = 1
guard.dist = 200
fall = 0
fall.recover = 0
fall.recovertime = 60

[state 3050, attackdist]
type = attackdist
trigger1 = 1
value = 200



[State 0, TargetState]
type = TargetState
triggerall = NumTarget(4000)
trigger1 = movehit
value = 4020
ID = 4000

[State 0, Helper]
type = Helper
trigger1 = NumTarget(4000)
trigger1 = movehit
name = "Ranged Poison effect"
ID = 4006
stateno = 4006 
pos = 0,0
postype = p2
facing = -1
ownpal = 1
ignorehitpause = 1

[state 3040, end]
type = changestate
trigger1 = movecontact
trigger2 = movereversed
value = 3055


[State 3040, 4]
type = DestroySelf
trigger1 = movecontact
trigger2 = BackEdgeDist < -10
trigger3 = movereversed
trigger4 = time > 60

;--------------------------------------------------------
;-------------------------------------------------------
;Gas Projectile No poison Wall Bounce
[statedef 3052]
type = S
movetype = A
physics = N
anim = 3050
sprpriority = 2

[state 3050, scale]
type = angledraw
trigger1 = 1
scale = 2,2
ignorehitpause = 1

[state 3050, velset]
type = velset
trigger1 = time = 0
x = 72
y = -3+(random%6)

[state 3050, attackdist]
type = attackdist
trigger1 = 1
value = 200

[state 3050, hitoverride]
type = hitoverride
trigger1 = 1
attr = SCA, AP,AA,AT
time = 1
stateno = 3055
ignorehitpause = 1
persistent = 1

[state 3050, nothitby]
type = nothitby
trigger1 = 1
value = ,AA,AT

[state 3050, attackdist]
type = attackdist
trigger1 = 1
value = 200

[State 3050, 5] 
type = hitdef
trigger1 = 1
trigger1 = !moveguarded
persistent = 0
attr = S, HP
animtype  = back
damage    = 8,3
guardflag = MA
getpower = 0
givepower = 25
hitflag = MAF
pausetime = 2,2
sparkno = -1
sparkxy = -10,-60
hitsound   = F5,1
guardsound = S120, 0
forcestand = 1
p2facing = 1
p2sprpriority = 1
ground.type = high
ground.slidetime = 16
ground.hittime  = 16
ground.velocity = -150,-24
air.velocity = -150,-24
guard.velocity = -16            
guard.hittime = 16
guard.slidetime = 16
airguard.velocity = -16,-2 
airguard.hittime = 16
guard.kill = 1
p2stateno = 675
guard.dist = 200
fall.recover = 0
fall = 1



;[State 0, TargetState]
;type = TargetState
;triggerall = NumTarget(4000)
;trigger1 = movehit
;value = 4020
;ID = 4000

;[State 0, Helper]
;type = Helper
;trigger1 = NumTarget(4000)
;trigger1 = movehit
;name = "Ranged Poison effect"
;ID = 4006
;stateno = 4006 
;pos = 0,0
;postype = p2
;facing = -1
;ownpal = 1
;ignorehitpause = 1

[state 3040, end]
type = changestate
trigger1 = movecontact
trigger2 = movereversed
value = 3055


[State 3040, 4]
type = DestroySelf
trigger1 = movecontact
trigger2 = BackEdgeDist < -10
trigger3 = movereversed
trigger4 = time > 60

;-------------------------------------------------------


;-------------------------------------------------------
;Destroy self
[statedef 3055]
type = U
movetype = I
physics = U
anim = 3051
velset = 0,0
sprpriority = 2

[state 3050, scale]
type = angledraw
trigger1 = 1
scale = 2,2
ignorehitpause = 1

[state 3055, end]
type = destroyself
trigger1 = animtime = 0
trigger2 = time > 30

;==========================================================================
;Super Ass Vaccum lv1, 220 damage, 180 heal
;==========================================================================

;Ass Vaccum SUPER
[statedef 3080]
type = S
movetype = A
physics = S
velset = 0,0
sprpriority = -3
ctrl = 0
sprpriority = 1

[state x, Minimum Super combo damage]
type = varset
trigger1 = time = 0
trigger1 = var(18) < 70
v = 18
value = 70
ignorehitpause = 1

;===========
;Armor start
;===========

[state 3080, set animation]
type  = changeanim
trigger1 = anim != 3080
value = 3080

[state 3080, Explod]
type = explod
trigger1 = time = 0
anim = 3070
id = 3070
scale = const(size.xscale),const(size.yscale)
pos = 0,0
postype = p1
bindtime = -1
removetime = -1
sprpriority = 3
removeongethit = 1
ignorehitpause = 1

[state 3080, hitoverride]
type = hitoverride
trigger1 = animelemtime(10) >= 0
attr = SCA,AP
slot = 1
stateno = 3080
ignorehitpause =1 



;---------------------------------------
[State 3080, Super Pause]
type = SuperPause
trigger1 = animelemtime(9) = 0
sound = S3000, 0
poweradd = -1000
pos = 30,-140
time = 60
movetime = 60


[state 3080, Super Portrait]
type = explod
trigger1 = animelemtime(9) =[0, 14] ;7
anim = 3100
postype = back
sprpriority = -4
supermovetime = 60
removetime = 1
pausemovetime = 60
scale = (3-(time*0.15))*(1),(3-(time*0.15))*(1)
pos = 0,60-time*5
ownpal = 1

[state 3080, no bg]
type = assertspecial
trigger1 = animelemtime(9) =[0,60]
flag = nobg
ignorehitpause = 1

[state 3080, Super Portrait]
type = explod
trigger1 = animelemtime(9) = 15
anim = 3100
postype = back
vel = -0.1,0
sprpriority = -4
supermovetime = 60
removetime = 45
pausemovetime = 60
pos = 0,0
scale = 1,1
ownpal = 1



;----------------------------------------


[state 3080, settypeset]
type = statetypeset
trigger1 = animelem = 3
statetype = A

[state 3080, statetypeset]
type = statetypeset
trigger1 = animelem = 6
statetype = S

[state 3080, velset]
type = velset
trigger1 = animelemtime(3) = 1 
x = 27
persistent = 1

[State 3080, hitdef]
type = HitDef
trigger1 = animelem = 4
persistent = 0
attr = S, SA
animtype  = Heavy
damage    = 5,1
guardflag = M
hitflag = MF
pausetime = 4,4
sparkno = 2
sparkxy = -10,-60
hitsound = S5000, 1
guardsound = S120, 0
ground.type = high
ground.slidetime = 24
ground.hittime  = 24
ground.velocity = 16,0
air.velocity = 12,-10
fall = 0
fall.recovertime = 30
fall.recover = 1
guard.slidetime = 4
guard.hittime = 4
guard.velocity = -40
airguard.velocity = -26,-2
guard.kill = 0

[State 3080, hitdef]
type = HitDef
trigger1 = animelem = 6
persistent = 0
attr = S, SA
animtype  = Heavy
damage    = 5,1
guardflag = M
hitflag = MF
pausetime = 4,4
sparkno = 2
sparkxy = -10,-60
id = 3081
hitsound = S5000, 1
guardsound = S120, 0
ground.type = high
ground.slidetime = 12
ground.hittime  = 12
ground.velocity = 16,0
air.velocity = 12,-10
fall = 0
fall.recovertime = 30
fall.recover = 1
guard.slidetime = 4
guard.hittime = 4
guard.velocity = -40
airguard.velocity = -26,-2
guard.kill = 0

;normal
[State 3080, 1]
type = HitDef
Triggerall = animelemtime(10) > 0
trigger1 = p2stateno != [150,155]
attr = S, ST          
hitflag = M-
guardflag =          
priority = 1, Miss    
sparkno = -1
guard.sparkno = -1        
p1sprpriority = 1    
id = 3080                   
p1facing = 1
p2facing = 1 
p1sprpriority = -3
p2sprpriority = 1         
p1stateno = 3081      
p2stateno = 3090      
guard.dist = 0      
guard.velocity = -48
guard.hittime = 24
guard.slidetime = 24
fall = 1 

;Vaccum
[State 3080, 1]
type = HitDef
Triggerall = animelemtime(10) > 0
trigger1 = enemynear,anim = 5300
attr = S, ST          
hitflag = M
guardflag =          
priority = 1, Miss    
sparkno = -1
guard.sparkno = -1        
p1sprpriority = 1    
id = 3080                   
p1facing = 1
p2facing = 1 
p1sprpriority = -3
p2sprpriority = 1         
p1stateno = 3081      
p2stateno = 3090      
guard.dist = 0      
guard.velocity = -48
guard.hittime = 24
guard.slidetime = 24
fall = 1 

;comboed
[State 3080, 1]
type = HitDef
Triggerall = animelemtime(10) > 0
trigger1 = numtarget(3081)
attr = S, ST          
hitflag = MAF
guardflag =          
priority = 1, Miss    
sparkno = -1
guard.sparkno = -1        
p1sprpriority = 1    
id = 3080                   
p1facing = 1
p2facing = 1 
p1sprpriority = -3
p2sprpriority = 1         
p1stateno = 3081      
p2stateno = 3090      
guard.dist = 0      
guard.velocity = -48
guard.hittime = 24
guard.slidetime = 24
fall = 1 

[state 3080, helper]
type = helper
triggerall = p2dist x = [0, 1200]
triggerall = p2statetype != L 
triggerall = numhelper(1343) < 2
trigger1 = p2statetype != A
trigger1 = animelemtime(11) > 0  
name = "Pastilla's Vaccuum"
stateno = 1343
id = 1343
postype = p1
pos = p2dist x + 200,0
persistent = 8



[state 3080, explod]
type = explod
trigger1 = animelemtime(9) = 0
anim = 2060
id = 2060
removeongethit = 1
bindtime = -1
removetime = -1
pos = 230,-250
scale = const(size.xscale),const(size.yscale)
sprpriority = 4

[state 3080, removexplod]
type = removeexplod
trigger1 = animelemtime(39) >= 0
id = 2060

[state 3080, playsnd]
type = playsnd
trigger1 = animelemtime(11) = 0
value = S1020,0
channel = 2

[state 3080, playsnd]
type = playsnd
trigger1 = animelemtime(6) = 0
value = S52,0

[State 3080, 4]
type = EnvShake
trigger1 = animelemtime(6) = 0
time = 14
ampl = 8
freq = 100
phase = 100

[state 3080, end]
type = changestate
trigger1 = time > 140
value = 3099

;------------------------------------------------------------------------------------
;MOVE HIT - Absorption Start
[statedef 3081]
type = S
movetype = A
physics = S
anim = 3081
sprpriority = -2

[state 3081, stopsnd]
type = stopsnd
trigger1 = time = 0
channel = 2

[state 3081, playsnd]
type = playsnd
trigger1 = time = 1
value = S1020,1

[state 3081, width]
type = width
trigger1 = time = 0
edge = 640,640

[state 3081, removeexplod]
type = removeexplod
trigger1 = time = 0
id = 3070

[state 3081, explod]
type = explod
trigger1 = time = 0
anim = 3071
id = 3071
scale = const(size.xscale),const(size.yscale)
sprpriority = 2
bindtime = -1
postype = p1
pos = 0,0


;Opponent Check

[state 3081, Default size IE Ryu, Chunli, KFM, basic human]
type = varset
trigger1 = time = 0
v = 37
value = 0

[state 3081, No change- Too small]
type = varset
triggerall = time = 1
triggerall = numtarget(3080)
trigger1 = target(3080),name = "Twiggi Bunny"
trigger2 = target(3080),name = "Rapid Bunny"
trigger3 = target(3080),name = "Noah Sharker"
v = 37
value = 1

[state 3081, Small Chunky, overweight but human standards]
type = varset
triggerall = time = 1
triggerall = numtarget(3080)
trigger1 = target(3080),name = "Ana 'Jiggly' Bunny"
trigger2 = target(3080),name = "Aroma Skunk"
trigger3 = target(3080),name = "Violet 'Tyla' Bunny"
trigger4 = target(3080),name = "Texas Stanton"
trigger5 = target(3080),name = "Ra Lord"
trigger6 = target(3080),name = "Andy Armadillo"
v = 37
value = 2

[state 3081, Medium]
type = varset
triggerall = time = 1
triggerall = numtarget(3080)
trigger1 = target(3080),name = "Enorma Pig"
trigger2 = target(3080),name = "Katrina Crocodile"
trigger3 = target(3080),name = "Lardo Rat"
trigger4 = target(3080),name = "Montana Moth"
v = 37
value = 3

[state 3081, Large]
type = varset
triggerall = time = 1
triggerall = numtarget(3080)
trigger1 = target(3080),name = "Bertha Hippo"
trigger2 = target(3080),name = "Julian Hippo"
trigger3 = target(3080),name = "Makuyama"
trigger4 = target(3080),name = "Pastilla Skunk"
trigger5 = target(3080),name = "Zafta Giraffe"
trigger6 = target(3080),name = "Pig"
v = 37
value = 4

[state 3081, X Large]
type = varset
triggerall = time = 1
triggerall = numtarget(3080)
trigger1 = target(3080),name = "Jumba Elephant"
trigger2 = target(3080),name = "Jumbo Elephant"
trigger3 = target(3080),name = "Sarjiri Sara Dragon"
v = 37
value = 5

[state 3081, targetbind 1]
type = targetbind
trigger1 = animelemtime(2) < 0
pos = 204,-282

[state 3081, targetbind 2]
type = targetbind
trigger1 = animelemtime(2) >= 0 && animelemtime(3) < 0
pos = 204,-282

[state 3081, targetbind 3]
type = targetbind
trigger1 = animelemtime(3) >= 0 && animelemtime(4) < 0
pos = 204,-282

[state 3081, targetbind 4]
type = targetbind
trigger1 = animelemtime(4) >= 0 && animelemtime(5) < 0
pos = 204,-282

[state 3081, targetbind 5]
type = targetbind
trigger1 = animelemtime(5) >= 0 && animelemtime(5) < 26
pos = 204,-282

[state 3081, targetbind 6 - Sink in]
type = targetbind
trigger1 = animelemtime(5) >= 26 && animelemtime(5) < 28
pos = 194,-282

[state 3081, targetbind 7 - Sink in]
type = targetbind
trigger1 = animelemtime(5) >= 28 && animelemtime(5) < 30
pos = 184,-282

[state 3081, targetbind 8 - Sink in]
type = targetbind
trigger1 = animelemtime(5) >= 30 && animelemtime(5) < 32
pos = 174,-282

;[state 3081, targetstate]
;type = targetstate
;trigger1 = animelemtime(5) = 32
;value = 3091

[state 3081, changestate]
type = changestate
trigger1 = animtime = 0
value = 3082
;---------------------------------------------------------------------------
;Growth Asspect
[statedef 3082]
type = S
movetype = A
physics = S
ctrl = 0
sprpriority = -2

[state 3081, targetstate]
type = targetstate
trigger1 = time = 18
value = 3091

[state 3082, targetlifeadd]
type = targetlifeadd
trigger1 = time > 20
value = -floor((fvar(10)*4)*ifelse(life=lifemax, 1.25,1));250
persistent = 2

[state 3082, targetlifeadd]
type = targetlifeadd
trigger1 = animtime  = -3
value = -floor((fvar(10)*20)*ifelse(life=lifemax, 1.25, 1))
persistent = 0

[state 3082, belly gurgles]
type = playsnd
trigger1 = time = 20
value = S3080,1
channel = 2

[state 3082, targetpoweradd]
type = targetpoweradd
trigger1 = time > 20
value = 4
persistent = 2

[state 3082, lifeadd]
type = lifeadd
trigger1 = time > 57
value = 2
persistent = 1

[state 3082, explod]
type = explod
trigger1 = time = 0
anim = 3072+var(37)
id = 3072
scale = const(size.xscale),const(size.yscale)
bindtime = -1
sprpriority = 2

;============================
;Bindings
;============================

;Twiggi
[state 3082, targetbind]
type = targetbind
trigger1 = animelem = 1
pos = 200,-310

;default
[state 3082, targetbind]
type = targetbind
trigger1 = animelem =2 
pos = 230,-330

;small
[state 3082, targetbind]
type = targetbind
trigger1 = animelem =3 
pos = 250,-350

;med
[state 3082, targetbind]
type = targetbind
trigger1 = animelem =4 
pos = 360,-370

;large
[state 3082, targetbind]
type = targetbind
trigger1 = animelem =5 
pos = 380,-420

;X large
[state 3082, targetbind]
type = targetbind
trigger1 = animelem =6 
pos = 540,-620

[state 3082, AV Win Pose]
type = varset
trigger1 = !enemynear,alive
var(36) = 1

[state 3082, end bellysounds]
type = stopsnd
trigger1 = animtime = -2
channel = 2

[state 3082, don't launch out]
type = changestate
trigger1 = !enemynear,alive
trigger1 = animtime = -2
value = 3089

[state 3082, animation]
type = changeanim
trigger1 = time = 0
value = 3082+var(37)

[state 3082, playsnd]
type = playsnd
triggerall = anim != 3083
trigger1 = animelemtime(1) = 2
value = 3080,0


[state 3082, end]
type = changestate
trigger1 = animtime = 0
value = 3083

;---------------------------------------------------------------------------
;Launch back out
[statedef 3083]
type = S
movetype = A
sprpriority = -2

[state 3083, nothitby]
type = nothitby
trigger1 = 1
value = SCA

[state 8083, explod buttcheek]
type = explod
trigger1 = time = 0
anim = 3097
postype = p1
pos = 0,0
scale = const(size.xscale),const(size.yscale)
id = 3083
bindtime = -1
sprpriority = 2


[state 3083, explod FX]
TYPE = explod
trigger1 = time = 0
anim = 2050
postype = p1
sprpriority = 2
pos = -275,-170
bindtime = -1
ownpal = 1
scale = const(size.xscale)*1.5,const(size.yscale)*1.5

[state 3083, explod gas particals 1 of 5]
type = explod
trigger1 = time = 0
anim = 2052
postype = p1
pos = 176,-264
scale = const(size.xscale)*2,const(size.yscale)*2
ownpal = 1
sprpriority = 2
vel = 10,-40

[state 1302, explod gas particals 2 of 5]
type = explod
trigger1 = time = 1
anim = 2052
postype = p1
pos = 176,-264
scale = const(size.xscale)*2,const(size.yscale)*2
ownpal = 1
sprpriority = 2
vel = 10,40

[state 1302, explod gas particals 3 of 5]
type = explod
trigger1 = time = 0
anim = 2052
postype = p1
pos = 176,-264
scale = const(size.xscale)*2,const(size.yscale)*2
ownpal = 1
sprpriority = 2
vel = 20,20

[state 1302, explod gas particals 4 of 5]
type = explod
trigger1 = time = 1
anim = 2052
postype = p1
pos = 176,-264
scale = const(size.xscale)*2,const(size.yscale)*2
ownpal = 1
sprpriority = 2
vel = 20,-20

[state 1302, explod gas particals 5 of 5]
type = explod
trigger1 = time = 0
anim = 2052
postype = p1
pos = 176,-264
scale = const(size.xscale)*2,const(size.yscale)*2
ownpal = 1
sprpriority = 2
vel = 40,0


[state 3083, playsnd]
type = playsnd
trigger1 = time = 0
value = 1300,0

[state 3083, playsnd]
type = playsnd
trigger1 = time = 0
value = 1300,0

[state 3083, changeanim]
type = changeanim
trigger1 = time = 0
value = 3098

[state 3083, targetstate]
type = targetstate
trigger1 = time = 0
value = 3092

[state 3083, changestate]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
;Don't shoot back out
[statedef 3089]
type = S
movetype = I
ctrl = 0

[state 3089, playsnd]
type = playsnd
trigger1 = time = 0
value = S3080,2

[state 3089, changestate]
type = changestate
trigger1 = numenemy > 0
value = 0
ctrl = 1




;---------------------------------------------------------------------------
;Victim animation
[Statedef 3090]
type    = A
movetype= H
physics = N
velset = 0,0

[State 3090, 1]
type = ChangeAnim2
Trigger1 = Time = 0
value = 3090


[state 3090, shrink]
type = angledraw
trigger1 = time > 58 && time <= 60
scale = const(size.xscale)*0.9, const(size.yscale)*0.9

[state 3090, shrink]
type = angledraw
trigger1 = time > 60 && time <= 62
scale = const(size.xscale)*0.8, const(size.yscale)*0.8

[state 3090, shrink]
type = angledraw
trigger1 = time > 62 && time <= 64
scale = const(size.xscale)*0.7, const(size.yscale)*0.7

[state 3090, shrink]
type = angledraw
trigger1 = time > 64 && time <= 66
scale = const(size.xscale)*0.6, const(size.yscale)*0.6

[state 3090, shrink]
type = angledraw
trigger1 = time > 66 && time <= 68
scale = const(size.xscale)*0.5, const(size.yscale)*0.5

[state 3090, shrink]
type = angledraw
trigger1 = time > 68 && time <= 70
scale = const(size.xscale)*0.4, const(size.yscale)*0.4

[state 3090, shrink]
type = angledraw
trigger1 = time > 70 && time <= 72
scale = const(size.xscale)*0.3, const(size.yscale)*0.3

[state 3090, shrink]
type = angledraw
trigger1 = time > 72 && time <= 74
scale = const(size.xscale)*0.2, const(size.yscale)*0.2

[state 3090, shrink]
type = angledraw
trigger1 = time > 74 && time <= 76
scale = const(size.xscale)*0.1, const(size.yscale)*0.1



[State 3090, Afterimage]
type = AfterImage
trigger1 = time = 38
length = 13
PalBright   =  30, 60,  30
PalContrast =  70, 70, 20
PalAdd      = -10,-10,-10
PalMul      = .85,.85,.50
TimeGap  = 1
FrameGap = 2
Trans = Add
time = 2

[State 30901, Afterimage]
type = AfterImageTime
trigger1 = time > 38
time = 2

[state 3090, movecamera]
type = screenbound
trigger1 = 1
movecamera = 0,0
value = 0

;---------------------------------------------------------------------------
;Hidden Victim animation
[Statedef 3091]
type    = A
movetype= H
physics = N
velset = 0,0

[State 3090, 1]
type = ChangeAnim2
Trigger1 = Time = 0
value = 3091

[state 3090, ded]
type = changestate
trigger1 = !alive
value = 18000

[state 3090, movecamera]
type = screenbound
trigger1 = 1
movecamera = 0,0
value = 0

;---------------------------------------------------------------------------
;Launched Victim animation
[Statedef 3092]
type    = A
movetype= H
physics = N
velset = -100,-12

[State 3092, 1]
type = ChangeAnim
Trigger1 = Time = 0
value = 5050

[state 1335, nothitby]
type = nothitby
trigger1 = 1
value = SCA

[state 1335, gravity]
type = gravity
trigger1 = 1

[State 676, Hit wall]
type = ChangeState
triggerall = Pos y < 0
trigger1 = BackEdgeBodyDist <= 20
trigger2 = FrontEdgeBodyDist <= 20
value = 6770

[state 3092, crash]
type = selfstate
trigger1 = vel y > 0
trigger1 = pos y > -vel y 
value = 5100

[state 3091, movecamera]
type = screenbound
trigger1 = 1
movecamera = 0,0
value = 0



;-------------------------------------------------------------------------------------
;Recovery
[statedef 3099]
type = S
movetype = I
physics = S
anim = 3099

[state 3099, removeasscheek]
type = removeexplod
trigger1 = 1
id = 3070

[state 3099, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1



;=====================================================================================


			;Poisoning Gas


;=====================================================================================
;-------------------------------------------------------
;Gas Projectile with poison
[statedef 4000]
type = S
movetype = A
physics = N
anim = 3050
sprpriority = 2

[state 4000, scale]
type = angledraw
trigger1 = 1
scale = 2,2
ignorehitpause = 1

[state 4000, velset]
type = velset
trigger1 = time = 0
x = 24
y = -1+(random%3)

[state 4000, attackdist]
type = attackdist
trigger1 = 1
value = 200

[state 4000, hitoverride]
type = hitoverride
trigger1 = 1
attr = SCA, AP,AA,AT
time = 1
stateno = 3055
ignorehitpause = 1
persistent = 1

[state 4000, nothitby]
type = nothitby
trigger1 = 1
value = ,AA,AT

[State 4000, 5] 
type = hitdef
trigger1 = 1
trigger1 = !moveguarded
persistent = 0
attr = S, SP
animtype  = back
damage    = 30,6
guardflag = MA
getpower = 0
givepower = 50
hitflag = MAF
pausetime = 2,6
sparkno = -1
sparkxy = -10,-60
hitsound   = F5,1
hitonce = 1
id = 4000
p2facing = 1
p2sprpriority = 1
guardsound = S120, 0
ground.type = high
ground.slidetime = 20
ground.hittime  = 20
ground.velocity = -2,0
air.velocity = -2,0
guard.velocity = -30           
guard.hittime = 14
guard.slidetime = 14
fall = 0
fall.recover = 0
fall.recovertime = 45
airguard.velocity = -15,-2 
airguard.hittime = 16
guard.kill = 1
guard.dist = 200


[state 4000, attackdist]
type = attackdist
trigger1 = 1
value = 200



[State 4000, TargetState]
type = TargetState
triggerall = NumTarget(4000)
trigger1 = movehit
value = 4020
ID = 4000

[State 4000, Helper]
type = Helper
trigger1 = NumTarget(4000)
trigger1 = movehit
name = "Ranged Poison effect"
ID = 4006
stateno = 4006 
pos = 0,0
postype = p2
facing = -1
ownpal = 1
ignorehitpause = 1

[state 4000, end]
type = changestate
trigger1 = movecontact
trigger2 = movereversed
value = 3055


[State 4000, 4]
type = DestroySelf
trigger1 = movecontact
trigger2 = BackEdgeDist < -10
trigger3 = movereversed
trigger4 = time > 90



;-------------------------------------------------------
;Hard Gas Projectile with poison
[statedef 4001]
type = S
movetype = A
physics = N
anim = 3050
sprpriority = 2

[state 4001, scale]
type = angledraw
trigger1 = 1
scale = 2,2
ignorehitpause = 1

[state 4001, velset]
type = velset
trigger1 = time = 0
x = 48
y = -1+(random%3)

[state 4001, attackdist]
type = attackdist
trigger1 = 1
value = 200

[state 4001, hitoverride]
type = hitoverride
trigger1 = 1
attr = SCA, AP,AA,AT
time = 1
stateno = 3055
ignorehitpause = 1
persistent = 1

[state 4001, nothitby]
type = nothitby
trigger1 = 1
value = ,AA,AT

[State 4001, 5] 
type = hitdef
trigger1 = 1
trigger1 = !moveguarded
persistent = 0
attr = S, SP
animtype  = back
damage    = 30,6
guardflag = MA
getpower = 0
givepower = 50
hitflag = MAF
pausetime = 2,6
sparkno = -1
sparkxy = -10,-60
hitsound   = F5,1
hitonce = 1
id = 4000
p2facing = 1
p2sprpriority = 1
guardsound = S120, 0
ground.type = high
ground.slidetime = 20
ground.hittime  = 20
ground.velocity = -2,0
air.velocity = -2,0
guard.velocity = -30           
guard.hittime = 14
guard.slidetime = 14
airguard.velocity = -15,-2 
airguard.hittime = 16
fall.recover = 0
fall.recovertime = 45
guard.kill = 1
guard.dist = 200


[state 4001, attackdist]
type = attackdist
trigger1 = 1
value = 200



[State 4001, TargetState]
type = TargetState
triggerall = NumTarget(4000)
trigger1 = movehit
value = 4020
ID = 4000

[State 4001, Helper]
type = Helper
trigger1 = NumTarget(4000)
trigger1 = movehit
name = "Ranged Poison effect"
ID = 4006
stateno = 4006 
pos = 0,0
postype = p2
facing = -1
ownpal = 1
ignorehitpause = 1

[state 4001, end]
type = changestate
trigger1 = movecontact
trigger2 = movereversed
value = 3055


[State 4001, 4]
type = DestroySelf
trigger1 = movecontact
trigger2 = BackEdgeDist < -10
trigger3 = movereversed
trigger4 = time >= 75



;-------------------------------------------------------

;EX Gas Projectile with poison
[statedef 4002]
type = S
movetype = A
physics = N
anim = 3050
sprpriority = 2

[state 4002, scale]
type = angledraw
trigger1 = 1
scale = 2,2
ignorehitpause = 1

[state 4002, velset]
type = velset
trigger1 = time = 0
x = 64
y = -1+(random%3)

[state 4002, attackdist]
type = attackdist
trigger1 = 1
value = 200

[state 4002, hitoverride]
type = hitoverride
trigger1 = 1
attr = SCA, AP,AA,AT
time = 1
stateno = 3055
ignorehitpause = 1
persistent = 1

[state 4002, nothitby]
type = nothitby
trigger1 = 1
value = ,AA,AT

[State 4002, 5] 
type = hitdef
trigger1 = 1
trigger1 = !moveguarded
persistent = 0
attr = S, SP
animtype  = back
damage    = 30,6
guardflag = MA
getpower = 0
givepower = 50
hitflag = MAF
pausetime = 2,6
sparkno = -1
sparkxy = -10,-60
hitsound   = F5,1
hitonce = 1
id = 4000
p2facing = 1
p2sprpriority = 1
guardsound = S120, 0
ground.type = high
ground.slidetime = 20
ground.hittime  = 20
ground.velocity = -2,0
air.velocity = -2,2
guard.velocity = -2           
guard.hittime = 16
guard.slidetime = 16
airguard.velocity = -15,-2 
airguard.hittime = 16
guard.kill = 1
guard.dist = 200


[state 4002, attackdist]
type = attackdist
trigger1 = 1
value = 200



[State 4002, TargetState]
type = TargetState
triggerall = NumTarget(4000)
trigger1 = movehit
value = 4020
ID = 4000

[State 4002, Helper]
type = Helper
trigger1 = NumTarget(4000)
trigger1 = movehit
name = "Ranged Poison effect"
ID = 4006
stateno = 4006 
pos = 0,0
postype = p2
facing = -1
ownpal = 1
ignorehitpause = 1

[state 4002, end]
type = changestate
trigger1 = movecontact
trigger2 = movereversed
value = 3055


[State 4002, 4]
type = DestroySelf
trigger1 = movecontact
trigger2 = BackEdgeDist < -10
trigger3 = movereversed
trigger4 = time >= 75



;-------------------------------------------------------
;Poisoning State
;Thanks to Ralord
[statedef 4020]
type = U
Movetype = H
physics = U
;velset = 0,0

[State 4020, StateTypeSet]
type = StateTypeSet
trigger1 = Time = 0
trigger1 = statetype = S || statetype = C
statetype = S
physics = S
ignorehitpause = 1

[State 4020, StateTypeSet]
type = StateTypeSet
trigger1 = Time = 0
trigger1 = statetype = A || statetype = L
statetype = A 
physics = A
ignorehitpause = 1

[State 4020, 1]
type = ChangeAnim2
;trigger1 = !time
trigger1 = !hitshakeover
value = 4020+(statetype = A || statetype = L)
ignorehitpause = 1


[State 0, HitVelSet]
type = hitVelSet
trigger1 = !time
x = 1
y = 1
ignorehitpause = 1 

[State 4020, PosSet]
type = Posfreeze
trigger1 = 1
ignorehitpause = 1


[state 4020, color]
type = palFX
trigger1 = 1
time = 1
mul = 140,60,60
persistent = 1

;[state 4020, color]
;type = palFX
;trigger1 = 1;root,stateno != [120,159]
;trigger1 = root,movetype = H;root,movetype = H
;time = 0
;mul = 140,60,60

[State 5000, 1]
Type = HitDef
Trigger1 = Time = 0
Attr = C, NP
Damage = 0
Priority = 1, Hit
HitFlag = F-
PauseTime = 0,0
SparkNo = -1
Guard.SparkNo = -1
;Ground.SlideTime = 0
Ground.HitTime = 9
;Ground.Velocity = 0
;Guard.Velocity = 0
;Air.Velocity = 0,0

[State 0, DisplayToClipboard]
type = DisplayToClipboard
trigger1 = 1
text = "vel x = %f vel y = %f"
params = vel x,vel y
ignorehitpause = 1

[State 4020, 2]
type = ChangeAnim
trigger1 = HitShakeOver
value = ifelse(statetype = A,5030,5010)
ignorehitpause = 1

[State 4020, 6]
type = SelfState
trigger1 = HitShakeOver
value = ifelse(statetype = A,5030,5001)
ignorehitpause = 1
;---------------------------------------------------------------------------
;Destroy self all projectiles
[statedef 4005]
type = U
Movetype = U
physics = U
anim = 9999


[state 4005, 1]
type = destroyself
trigger1 = 1


;------------------------------------------------------------
;Poison helper
[statedef 4006]
type = S
Movetype = I
physics = N
velset = 0,0
anim = 4006

[State 0, Reversal]
Type = ReversalDef
Trigger1 = Time = 0
Reversal.Attr = C,NP
PauseTime = 0,0
SparkNo = -1
NumHits = 0

[State 0, DisplayToClipboard]
type = DisplayToClipboard
trigger1 = 1
text = "var(0) = %d fvar(1) = %f  fvar(2) = %f"
params = var(0), var(1), var(2)
ignorehitpause = 1

[State 0, VarAdd]
type = Varadd
triggerall = time
triggerall = var(0)<2
triggerall = numtarget
trigger1 = target,stateno != 4020
trigger2 = target,movetype != H
var(0) = 1

[State 0, VarSet]
type = VarSet
triggerall = var(0)<2
triggerall = time < 2
triggerall = numtarget
trigger1 = movehit
trigger1 = target,vel x > 0
var(1) = 1
persistent = 0
ignorehitpause = 1

[State 0, VelSet]
type = targetVelSet
triggerall = var(0)<2
triggerall = numtarget
triggerall = target,movetype = H
trigger1 = target,stateno = 4020
trigger1 = target,time=1
trigger2 = target,stateno = 5001
trigger2 = target,prevstateno = 4020
trigger2 = target,time=1
trigger3 = target,stateno = 5030
trigger3 = target,prevstateno = 4020
trigger3 = target,time=1
x = ifelse(var(1)=1,24,-24)
y = -5*(target,statetype = A);fvar(2)
ignorehitpause = 1

[State 0, posset]
type = posset
trigger1 = time >= 1
x = enemy,pos x
y = enemy,pos y

[state 4020, smoke]
type = explod
triggerall = numexplod(2052) < 2
trigger1 = Random%15 = 0
postype = p2
id = 2052
anim = 2052
scale = 1, 1
sprpriority = 4
removetime = -2
pos = -50 + (random%100),enemy,const(size.mid.pos.y) - 40 + (random%80)
ownpal = 1

[state 4020, smoke]
type = explod
triggerall = numexplod(2052) < 2
trigger1 = Random%30 = 0
postype = p2
id = 2052
anim = 2052
scale = 1, 1
sprpriority = 4
removetime = -2
pos = -50+(random%100),enemy,const(size.head.pos.y) - 40 + (random%80)
ownpal = 1



[State 0, LifeAdd]
type = targetLifeAdd
trigger1 = time%15=0
trigger1 = enemy,name != "SOR2"
value = -ceil(enemy,const(data.life)*0.002)  ;0.003
kill = 0
absolute = 1
persistent = 5



[State 0, LifeAdd]
type = targetLifeAdd
trigger1 = time%15=0
trigger1 = enemy,name = "SOR2"
value = -6
kill = 1
absolute = 1
persistent = 5

[State 0, Run Damage] ;changed to be a more energy based penalty
type = targetpowerAdd
triggerall = time%15=0
trigger1 = enemy,stateno = 100;Running & jumping burns more oxygen
trigger2 = enemy,stateno =[700,799]
value = ifelse(enemy,vel x > 18,ifelse(enemy, vel x > 27,-120,-60),-30)
persistent = 5

[State 0, Run Damage] ;changed to be a more energy based penalty
type = targetpowerAdd
triggerall = time%15=0
trigger1 = (enemy,stateno = [40,50]) && enemy,vel x > 0
trigger2 = enemy,stateno = 20  && enemy,vel x > 0
value = -15
persistent = 5

;============================================================
;Character Specific - Energy penalty for running in poison gas
;============================================================
;Rapid Bunny
[State 0, Run Drain]
type = targetpowerAdd
triggerall = time%15=0
triggerall = enemynear,name = "Rapid Bunny"
trigger1 = (enemynear,stateno = 1000) || (enemynear,stateno = 1010) || (enemynear,stateno = 1020)
trigger2 = (enemynear,stateno = 1101) || (enemynear,stateno = 1111) || (enemynear,stateno = 1121)
value = ifelse(enemy,vel x > 18,ifelse(enemy, vel x > 27,-120,-60),-30)
persistent = 5

;Violet Bunny
[State 0, Run Drain]
type = targetpowerAdd
triggerall = time%15=0
triggerall = enemynear,name = "Violet 'Tyla' Bunny"
trigger1 = (enemynear,stateno = [1150,1155]) || (enemynear,stateno = 1170) 
value = ifelse(enemy,vel x > 18,ifelse(enemy, vel x > 27,-120,-60),-30)
persistent = 5

;Jumba Elephant
[State 0, Run Drain]
type = targetpowerAdd
triggerall = time%15=0
triggerall = enemynear,name = "Jumba Elephant"
trigger1 = (enemynear,stateno = 1000) || (enemynear,stateno = 1010) || (enemynear,stateno = 1020)
value = ifelse(enemy,vel x > 18,ifelse(enemy, vel x > 27,-120,-60),-30)
persistent = 5

[state 4005, 1]
type = destroyself
trigger1 = time >= 480
trigger2 = roundstate = 3
trigger3 = !enemy,alive
trigger3 = numenemy < 2
trigger4 = time > 8 && root,movetype = H && root,stateno != [120,159]

;------------------------------------------------------------
;Poison helper Knock Forward
[statedef 4007]
type = S
Movetype = I
physics = N
velset = 0,0
anim = 4006

[State 4007, Reversal]
Type = ReversalDef
Trigger1 = Time = 0
Reversal.Attr = C,NP
PauseTime = 0,0
SparkNo = -1
NumHits = 0

[State 4007, DisplayToClipboard]
type = DisplayToClipboard
trigger1 = 1
text = "var(0) = %d fvar(1) = %f  fvar(2) = %f"
params = var(0), var(1), var(2)
ignorehitpause = 1

[State 4007, VarAdd]
type = Varadd
triggerall = time
triggerall = var(0)<2
triggerall = numtarget
trigger1 = target,stateno != 4020
trigger2 = target,movetype != H
var(0) = 1

[State 4007, VarSet]
type = VarSet
triggerall = var(0)<2
triggerall = time < 2
triggerall = numtarget
trigger1 = movehit
trigger1 = target,vel x > 0
var(1) = 1
persistent = 0
ignorehitpause = 1

[State 4007, VelSet]
type = targetVelSet
triggerall = var(0)<2
triggerall = numtarget
triggerall = target,movetype = H
trigger1 = target,stateno = 4020
trigger1 = target,time=1
trigger2 = target,stateno = 5001
trigger2 = target,prevstateno = 4020
trigger2 = target,time=1
trigger3 = target,stateno = 5030
trigger3 = target,prevstateno = 4020
trigger3 = target,time=1
x = 16
y = -5*(target,statetype = A);fvar(2)
ignorehitpause = 1

[State 4007, posset]
type = posset
trigger1 = time >= 1
x = enemy,pos x
y = enemy,pos y

[state 4007, smoke]
type = explod
triggerall = numexplod(2052) < 2
trigger1 = Random%15 = 0
postype = p2
id = 2052
anim = 2052
scale = 1, 1
sprpriority = 4
removetime = -2
pos = -50 + (random%100),enemy,const(size.mid.pos.y) - 40 + (random%80)
ownpal = 1

[state 4007, smoke]
type = explod
triggerall = numexplod(2052) < 2
trigger1 = Random%30 = 0
postype = p2
id = 2052
anim = 2052
scale = 1, 1
sprpriority = 4
removetime = -2
pos = -50+(random%100),enemy,const(size.head.pos.y) - 40 + (random%80)
ownpal = 1



[State 4007, LifeAdd]
type = targetLifeAdd
trigger1 = time%15=0
trigger1 = enemy,name != "SOR2"
value = -ceil(enemy,const(data.life)*0.002)  ;0.003
kill = 0
absolute = 1
persistent = 5



[State 4007, LifeAdd]
type = targetLifeAdd
trigger1 = time%15=0
trigger1 = enemy,name = "SOR2"
value = -6
kill = 1
absolute = 1
persistent = 5

[State 4007, Run Damage] ;changed to be a more energy based penalty
type = targetpowerAdd
triggerall = time%15=0
trigger1 = enemy,stateno = 100;Running & jumping burns more oxygen
trigger2 = enemy,stateno =[700,799]
value = ifelse(enemy,vel x > 18,ifelse(enemy, vel x > 27,-120,-60),-30)
persistent = 5

[State 4007, Run Damage] ;changed to be a more energy based penalty
type = targetpowerAdd
triggerall = time%15=0
trigger1 = (enemy,stateno = [40,50]) && enemy,vel x > 0
trigger2 = enemy,stateno = 20  && enemy,vel x > 0
value = -15
persistent = 5

;============================================================
;Character Specific - Energy penalty for running in poison gas
;============================================================
;Rapid Bunny
[State 4007, Run Drain]
type = targetpowerAdd
triggerall = time%15=0
triggerall = enemynear,name = "Rapid Bunny"
trigger1 = (enemynear,stateno = 1000) || (enemynear,stateno = 1010) || (enemynear,stateno = 1020)
trigger2 = (enemynear,stateno = 1101) || (enemynear,stateno = 1111) || (enemynear,stateno = 1121)
value = ifelse(enemy,vel x > 18,ifelse(enemy, vel x > 27,-120,-60),-30)
persistent = 5

;Violet Bunny
[State 4007, Run Drain]
type = targetpowerAdd
triggerall = time%15=0
triggerall = enemynear,name = "Violet 'Tyla' Bunny"
trigger1 = (enemynear,stateno = [1150,1155]) || (enemynear,stateno = 1170) 
value = ifelse(enemy,vel x > 18,ifelse(enemy, vel x > 27,-120,-60),-30)
persistent = 5

;Jumba Elephant
[State 4007, Run Drain]
type = targetpowerAdd
triggerall = time%15=0
triggerall = enemynear,name = "Jumba Elephant"
trigger1 = (enemynear,stateno = 1000) || (enemynear,stateno = 1010) || (enemynear,stateno = 1020)
value = ifelse(enemy,vel x > 18,ifelse(enemy, vel x > 27,-120,-60),-30)
persistent = 5

[state 4007, 1]
type = destroyself
trigger1 = time >= 480
trigger2 = roundstate = 3
trigger3 = !enemy,alive
trigger3 = numenemy < 2
trigger4 = time > 8 && root,movetype = H && root,stateno != [120,159]

;---------------------------------------------------------------------------

;Gas Poison Trigger throw
[statedef 4050]
type = S
movetype = A
physics = N
velset = 0,0
ctrl = 0
sprpriority = 3


[state 4001, posset]
type = posset
trigger1 = time = 0
y = 0

[state 4001, anim]
type = changeanim
trigger1 = time = 0
value = 4010

[State 4001, 5] 
type = hitdef
trigger1 = 1
persistent = 0
attr = S, SP
animtype  = Hard
damage    = 0
guardflag = 
hitflag = MAFD
pausetime = 0,12
sparkno = -1
sparkxy = -10,-60
p2stateno = 4020
ground.type = high
ground.slidetime = 12
ground.hittime  = 12
ground.velocity = 60,-25
air.velocity = 60,-25
down.velocity = 0,0
down.hittime = 16
id = 4000
hitonce = 1
fall = 1
fall.recover = 0

;Poison Trigger
[State 0, TargetState]
type = TargetState
triggerall = NumTarget(4000)
trigger1 = movehit
value = 4055
ID = 4000

[State 0, Helper]
type = Helper
;trigger1 = !numhelper(4006)
trigger1 = NumTarget(4000)
trigger1 = movehit
name = "Melee Poison effect"
ID = 4006
stateno = 4056
pos = 0,0
postype = p2
facing = -1
ownpal = 1
ignorehitpause = 1
;----

[state 4001, nothitby]
type = nothitby
trigger1 = 1
value = ,AA,AT

[state 4000, hitoverride]
type = hitoverride
attr = SCA, AP
trigger1 = 1
time = 1
stateno = 4005
ignorehitpause = 1

[State 4001, 4]
type = DestroySelf
trigger1 = movecontact || movereversed 

[State 4001, 4]
type = DestroySelf
trigger1 = time > 10

;---------------------------------------------------------------------------
;----------------------Poisonstate THROWS----------------------------------
;Poisoning State
[statedef 4055]
type = U
Movetype = H
physics = U

[State 4020, StateTypeSet]
type = StateTypeSet
trigger1 = Time = 0
trigger1 = statetype = S || statetype = C || statetype = A
statetype = A
physics = A
ignorehitpause = 1


[State 4020, StateTypeSet]
type = StateTypeSet
trigger1 = Time = 0
trigger1 = statetype = L
statetype = L 
physics = C
ignorehitpause = 1

[State 4020, 1]
type = ChangeAnim2
trigger1 = statetype = A
trigger1 = !time
value = 4021
ignorehitpause = 1

[state 4020, 2]
type = ChangeAnim2
trigger1 = statetype = L
trigger1 = !hitshakeover
value = 4051
ignorehitpause = 1

[State 0, HitVelSet]
type = hitVelSet
trigger1 = !time
x = 1
y = 1
ignorehitpause = 1 

[State 4020, PosSet]
type = Posfreeze
trigger1 = 1
ignorehitpause = 1


[state 4020, color]
type = palFX
trigger1 = 1
time = 1
mul = 120,60,60
persistent = 1

[state 4020, color]
type = palFX
trigger1 = enemynear,stateno != [120,159]
trigger1 = enemynear,movetype = H
time = 0
mul = 160,80,80


[State 5000, 1]
Type = HitDef
Trigger1 = Time = 0
Attr = C, NP
Damage = 0
Priority = 1, Hit
HitFlag = F-
PauseTime = 0,0
SparkNo = -1
Guard.SparkNo = -1
;Ground.SlideTime = 0
Ground.HitTime = 9
;Ground.Velocity = 0
;Guard.Velocity = 0
;Air.Velocity = 0,0

[State 0, DisplayToClipboard]
type = DisplayToClipboard
trigger1 = 1
text = "vel x = %f vel y = %f"
params = vel x,vel y
ignorehitpause = 1

[State 4020, 2]
type = ChangeAnim
trigger1 = HitShakeOver
trigger1 = statetype = A
value = 5030
ignorehitpause = 1

[State 4020, 2]
type = ChangeAnim
trigger1 = HitShakeOver
trigger1 = statetype = L
value = 5100
ignorehitpause = 1

[State 4020, 6]
type = SelfState
trigger1 = HitShakeOver
trigger1 = statetype = A
value = 5030
ignorehitpause = 1

[State 4020, 6]
type = SelfState
trigger1 = HitShakeOver
trigger1 = statetype = L
value = 5110
ignorehitpause = 1
;--------------------------------------------------------------------------
;Poison helper
[statedef 4056]
type = S
Movetype = I
physics = N
velset = 0,0
anim = 4006

[State 0, Reversal]
Type = ReversalDef
Trigger1 = Time = 0
Reversal.Attr = C,NP
PauseTime = 0,0
SparkNo = -1
NumHits = 0

[State 0, DisplayToClipboard]
type = DisplayToClipboard
trigger1 = 1
text = "var(0) = %d fvar(1) = %f  fvar(2) = %f"
params = var(0), var(1), var(2)
ignorehitpause = 1

[State 0, VarAdd]
type = Varadd
triggerall = time
triggerall = var(0)<2
trigger1 = target,stateno != 4055
trigger2 = target,movetype != H
var(0) = 1

[State 0, VarSet]
type = VarSet
triggerall = var(0)<2
triggerall = time < 2
triggerall = numtarget
trigger1 = movehit
trigger1 = target,vel x > 0
var(1) = 1
persistent = 0
ignorehitpause = 1

[State 0, VelSet]
type = targetVelSet
triggerall = var(0)<2
triggerall = numtarget
triggerall = target,movetype = H
trigger1 = target,stateno = 4055
trigger1 = target,time=1
trigger2 = target,stateno = 5001
trigger2 = target,prevstateno = 4055
trigger2 = target,time=1
trigger3 = target,stateno = 5030
trigger3 = target,prevstateno = 4055
trigger3 = target,time=1
x = ifelse(var(1)=1,18,-18)
y = -8*(target,statetype = A);fvar(2)
ignorehitpause = 1

[State 0, posset]
type = posset
trigger1 = time >= 1
x = enemy,pos x
y = enemy,pos y

[state 4020, smoke]
type = explod
trigger1 = Random%15 = 0
postype = p2
anim = 2052
scale = 1, 1
sprpriority = 4
removetime = -2
pos = -50 + (random%100),enemy,const(size.mid.pos.y) - 40 + (random%80)
ownpal = 1

[state 4020, smoke]
type = explod
trigger1 = Random%30 = 0
postype = p2
anim = 2052
scale = 1, 1
sprpriority = 4
removetime = -2
pos = -50+(random%100),enemy,const(size.head.pos.y) - 40 + (random%80)
ownpal = 1

[State 0, LifeAdd]
type = targetLifeAdd
trigger1 = time%15=0
trigger1 = enemy,name != "SOR2"
value = -ceil(enemy,const(data.life)*0.003)  ;0.009
kill = 0
absolute = 1
persistent = 5



[State 0, LifeAdd]
type = targetLifeAdd
trigger1 = time%15=0
trigger1 = enemy,name = "SOR2"
value = -24
kill = 1
absolute = 1
persistent = 5

[State 0, Run Damage]
type = targetpowerAdd
triggerall = time%15=0
trigger1 = enemy,stateno = 100;Running & jumping burns more oxygen
value = ifelse(enemy,vel x > 18,ifelse(enemy, vel x > 27,-120,-60),-30)
persistent = 5

[State 0, Run Damage]
type = targetpowerAdd
triggerall = time%15=0
trigger1 = (enemy,stateno = [40,50]) && enemy,vel x > 0
trigger2 = enemy,stateno = 20  && enemy,vel x > 0
value = -15
persistent = 5

;============================================================
;Character Specific - Energy penalty for running in poison gas
;============================================================
;Rapid Bunny
[State 0, Run Drain]
type = targetpowerAdd
triggerall = time%15=0
triggerall = enemynear,name = "Rapid Bunny"
trigger1 = (enemynear,stateno = 1000) || (enemynear,stateno = 1010) || (enemynear,stateno = 1020)
trigger2 = (enemynear,stateno = 1101) || (enemynear,stateno = 1111) || (enemynear,stateno = 1121)
value = ifelse(enemy,vel x > 18,ifelse(enemy, vel x > 27,-120,-60),-30)
persistent = 5

;Violet Bunny
[State 0, Run Drain]
type = targetpowerAdd
triggerall = time%15=0
triggerall = enemynear,name = "Violet 'Tyla' Bunny"
trigger1 = (enemynear,stateno = [1150,1155]) || (enemynear,stateno = 1170) 
value = ifelse(enemy,vel x > 18,ifelse(enemy, vel x > 27,-120,-60),-30)
persistent = 5

;Jumba Elephant
[State 0, Run Drain]
type = targetpowerAdd
triggerall = time%15=0
triggerall = enemynear,name = "Jumba Elephant"
trigger1 = (enemynear,stateno = 1000) || (enemynear,stateno = 1010) || (enemynear,stateno = 1020)
value = ifelse(enemy,vel x > 18,ifelse(enemy, vel x > 27,-120,-60),-30)
persistent = 5

[state 4005, 1]
type = destroyself
trigger1 = time >= 480
trigger2 = roundstate = 3
trigger3 = !enemy,alive
trigger3 = numenemy < 2
trigger4 = root,statetype = L  || root,gethitvar(isbound) || root,hitfall = 1
;====================================================================

;===========================================================================
; Totem Idle
;===========================================================================
; Low Version
[statedef 4100]
type = A
movetype = A
physics = N
ctrl = 0
anim = 4100
sprpriority = 3

[state 4100, On off check]
type = varset
trigger1 = time = 0
v = 3
value = 0

[state 4100, playerpush]
type = playerpush
trigger1 = 1
value = 0

[state 11001, attackmulset]
type = attackmulset
trigger1 = 1
value = parent,fvar(10)
Persistent = 1

[state 4100, no shadows]
type = assertspecial
trigger1 = 1
flag = noshadow
ignorehitpause = 1 

[state 4100, nothitby]
type = nothitby
trigger1 = TIME < 8
value = SCA
ignorehitpause = 1

[state 4100, nothitby]
type = nothitby
trigger1 = time >= 8
value = ,AT
ignorehitpause = 1

[state 4100, velset]
type = velset
trigger1 = time = 0
x = 2
y = 2

[state 4100, stop]
type = velmul
trigger1 = time = 24
x = 0
y = 0


[state 4100, on off]
type = varset
trigger1 = time = 0
trigger1 = p2statetype = S
var(3) = 1

[state 4100, stop]
type = velset
triggerall = time = 48
trigger1 = !var(3)
x = 18
y = 0

;----------------
;Homing Portion
;---------------

[state 4102, turn]
type = turn
triggerall = time >= 48
triggerall = var(3)
trigger1 = p2dist x < 10
persistent = 30

[state 4100, homing]
type = veladd
triggerall = time >= 48
triggerall = var(3)
trigger1 = p2dist x > 0 && vel x < 16
x = 2
persistent = 2

[state 4103, homing]
type = veladd
triggerall = time >= 48
triggerall = var(3)
trigger1 = p2dist y - 400 > pos y
trigger1 = vel y < 16
y = 0.4
persistent = 2

[state 4103, homing]
type = veladd
triggerall = time >= 48
triggerall = var(3)
trigger1 = p2dist y - 200 < pos y
trigger1 = vel y > -16
y = -1.6
persistent = 2

[state 4103, homing]
type = velmul
triggerall = time >= 48
triggerall = var(3)
trigger1 = pos y > -30
y = 0.01
persistent = 30

;----------------
;End homing
;----------------




[State 4110, A]
type = HitDef
trigger1 = !movecontact
attr = S, SP
animtype  = light
damage    = ifelse(parent,var(13)=1,30,10), 1
priority = 1,miss
guardflag = MA
hitflag = MA
pausetime = 8,8
sparkno = 0
sparkxy = -10,-60
hitsound = S5000, 1
guardsound = S120, 0
ground.type = low
ground.hittime = 8
ground.slidetime = 8
ground.velocity = -8
air.hittime = 8
air.velocity = -8,-2
guard.hittime = 4
guard.slidetime = 4
guard.velocity = -18
airguard.velocity = -4,-2

[state 4100, targetstateno]
type = targetstate
triggerall = parent,var(14) > 0
triggerall = hitpausetime = 7
trigger1 = movehit
value = 4120
ignorehitpause = 1

[state 4100, parentvaradd]
type = parentvarset
trigger1 = movehit
v = 13
value = 1
persistent = 0
ignorehitpause = 0

[state 4100, parentvaradd]
type = parentvaradd
trigger1 = movehit
v = 14
value = -1
persistent = 0
ignorehitpause = 0

[State 4121, Afterimage]
type = AfterImage
trigger1 = Time = 0
length = 13
PalBright   =  30, 60,  30
PalContrast =  70, 70, 20
PalAdd      = -10,-10,-10
PalMul      = .85,.85,.50
TimeGap  = 1
FrameGap = 2
Trans = Add
time = 2

[State 4121, Afterimage]
type = AfterImageTime
trigger1 = 1
time = 2

[state 4100, range]
type = attackdist
trigger1 = 1
value = 200

[state 4100, hitoverride]
type = hitoverride
trigger1 = time >= 8
attr = SCA, AA, AP
stateno = 4150
time = 1
persistent = 1
ignorehitpause = 1

[state 4100, parentvaradd]
type = parentvaradd
trigger1 = movehit
v = 18
value = -18

[state 4100, end]
type = changestate
trigger1 = time > 240
trigger2 = movecontact = 1
trigger3 = movereversed = 1
trigger4 = frontedgebodydist < -170 
trigger5 = pos y > 0
;trigger6 = parent,movetype = H && parent,stateno != [120,159]
value = 4150
ctrl = 0

;-------------------------------------------------------------------------

;High Version
[statedef 4101]
type = A
movetype = A
physics = N
ctrl = 0
anim = 4100
sprpriority = 3

[state 4100, on/off]
type = varset
trigger1 = time = 0
var(3) = 0

[state 4100, playerpush]
type = playerpush
trigger1 = 1
value = 0

[state 11001, attackmulset]
type = attackmulset
trigger1 = 1
value = parent,fvar(10)
Persistent = 1

[state 4100, no shadows]
type = assertspecial
trigger1 = 1
flag = noshadow
ignorehitpause = 1 

[state 4100, velset]
type = velset
trigger1 = time = 0
x = 2
y = -2

[state 4100, stop]
type = velmul
trigger1 = time = 24
x = 0
y = 0

[state 4100, homming enable]
type = varset
trigger1 = time = 0
trigger1 = p2statetype = A
var(3) = 1

[state 4100, Slow homing]
type = velset
triggerall = time = 48
trigger1 = !var(3) 
y = -8
x = 16

;----------------
;Homing Portion
;---------------

[state 4102, turn]
type = turn
triggerall = time >= 48
triggerall = var(3)
trigger1 = p2dist x < 10
persistent = 30

[state 4100, homing]
type = veladd
triggerall = time >= 48
triggerall = var(3)
trigger1 = p2dist x > 0 && vel x < 16
x = 2
persistent = 2

[state 4103, homing]
type = veladd
triggerall = time >= 48
triggerall = var(3)
trigger1 = p2dist y - 400 > pos y
trigger1 = vel y < 16
y = 0.4
persistent = 2

[state 4103, homing]
type = veladd
triggerall = time >= 48
triggerall = var(3)
trigger1 = p2dist y - 200 < pos y
trigger1 = vel y > -16
y = -1.6
persistent = 2

[state 4103, homing]
type = velmul
triggerall = time >= 48
triggerall = var(3)
trigger1 = pos y > -30
y = 0.01
persistent = 30

;----------------
;End homing
;----------------

;[state 4100, nothitby]
;type = nothitby
;trigger1 = time < 24
;value = A
;ignorehitpause = 1

[state 4100, nothitby]
type = nothitby
trigger1 = TIME < 8
value = SCA
ignorehitpause = 1

[state 4100, nothitby]
type = hitby
trigger1 = time >= 8
value = SC,AA,AP
ignorehitpause = 1

[State 4110, A]
type = HitDef
trigger1 = !movecontact
attr = S, SP
animtype  = light
damage    = ifelse(parent,var(13)=1,30,10),1
priority = 1,miss
guardflag = MA
hitflag = MA
pausetime = 8,8
sparkno = 0
sparkxy = -10,-60
hitsound = S5000, 1
guardsound = S120, 0
ground.type = low
ground.hittime = 8
ground.slidetime = 8
ground.velocity = -8
air.hittime = 8
air.velocity = - 8,-2
guard.hittime = 4
guard.slidetime = 4
guard.velocity = -4
airguard.velocity = -18,-8
airguard.hittime = 20

[state 4100, targetstateno]
type = targetstate
triggerall = parent,var(14) > 0
triggerall = hitpausetime = 7
trigger1 = movehit
value = 4120
ignorehitpause = 1

[state 4100, parentvaradd]
type = parentvarset
trigger1 = movehit
v = 13
value = 1
persistent = 0
ignorehitpause = 0

[state 4100, parentvaradd]
type = parentvaradd
trigger1 = movehit
v = 14
value = -1
persistent = 0
ignorehitpause = 0

[state 4100, range]
type = attackdist
trigger1 = 1
value = 300

[State 4121, Afterimage]
type = AfterImage
trigger1 = Time = 0
length = 13
PalBright   =  30, 60,  30
PalContrast =  70, 70, 20
PalAdd      = -10,-10,-10
PalMul      = .85,.85,.50
TimeGap  = 1
FrameGap = 2
Trans = Add
time = 2

[State 4121, Afterimage]
type = AfterImageTime
trigger1 = 1
time = 2

[state 4100, hitoverride]
type = hitoverride
trigger1 = time >= 8
attr = SCA, AA, AP,AT
stateno = 4150
time = 1
persistent = 1
ignorehitpause = 1

[state 4100, parentvaradd]
type = parentvaradd
trigger1 = movehit
v = 18
value = -18

[state 4100, end]
type = changestate
trigger1 = time > 300
trigger2 = movecontact = 1
trigger3 = movereversed = 1
trigger4 = frontedgebodydist < -170
trigger5 = pos y > 0
;trigger6 = parent,movetype = H && parent,stateno != [120,159]
value = 4150
ctrl = 0

;-------------------------------------------------------------------------

;Set up portion
;EX Version
[statedef 4102]
type = A
movetype = A
physics = N
ctrl = 0
sprpriority = 3

;===========
;Armor start
;===========
[state 4102, animation]
type = changeanim
trigger1 = anim != 4102
value = 4102

;determine what frame
[state 4102, remember frame]
type = varset
trigger1 = time <= 0
v = 22
value = animelemno(0)
ignorehitpause = 1

;delay effect
[state 4102, delay]
type = changeanim 
trigger1 = parent,var(31) < floor(gethitvar(hittime)*0.2)
value = anim
elem = parent,var(22)

[state 4102, freeze location]
type = posfreeze
trigger1 = parent,var(31) < floor(gethitvar(hittime)*0.2)
value = 1


;------------
;Delay end
;------------


[state 4102, armor count down]
type = parentvaradd
trigger1 = gethitvar(damage) != 0
trigger1 = parent,var(24) > 0
V = 24
value = -1
persistent = 1

[State 4102, flash red]
type = PalFX
trigger1 = Time = 0
trigger1 = gethitvar(damage) != 0
time = 7
add = 100,0,0
IgnoreHitPause = 1

;--------------
;Armor end
;--------------




[state 4102, turn]
type = turn
trigger1 = p2dist x < 10
persistent = 30

[state 4102, playerpush]
type = playerpush
trigger1 = 1
value = 0

[state 4102, attackmulset]
type = attackmulset
trigger1 = 1
value = parent,fvar(10)
Persistent = 1

[state 4102, no shadows]
type = assertspecial
trigger1 = 1
flag = noshadow
ignorehitpause = 1 

[state 4102, velset]
type = velset
trigger1 = animelemtime(1) = 1
x = -12
y = -10

[state 4102, stop]
type = velmul
trigger1 = animelemtime(5) = 0
x = 0
y = 0


[State 4110, A]
type = HitDef
trigger1 = !movecontact
attr = S, SP
animtype  = light
damage    = ifelse(parent,var(13)=1,30,5),1
priority = 1,miss
guardflag = MA
hitflag = MA
pausetime = 8,8
guard.pausetime = 2,2
sparkno = 0
id = 4102
sparkxy = -10,-60
hitsound = S5000, 1
guardsound = S120, 0
ground.type = low
ground.hittime = 8
ground.slidetime = 8
ground.velocity = -8
air.hittime = 8
air.velocity = - 8,-2
guard.hittime = 4
guard.slidetime = 4
guard.velocity = -6
airguard.velocity = -12,-6
airguard.hittime = 10

[state 4100, targetstateno]
type = targetstate
triggerall = parent,var(14) > 0
triggerall = hitpausetime = 7
trigger1 = movehit
value = 4120
ignorehitpause = 1

[state 4100, parentvaradd]
type = parentvarset
trigger1 = movehit
v = 13
value = 1
persistent = 0
ignorehitpause = 0

[state 4100, parentvaradd]
type = parentvaradd
trigger1 = movehit
v = 14
value = -1
persistent = 0
ignorehitpause = 0

[state 4100, range]
type = attackdist
trigger1 = 1
value = 300

[State 4121, Afterimage]
type = AfterImage
trigger1 = Time = 0
length = 13
PalBright   =  30, 60,  30
PalContrast =  70, 70, 20
PalAdd      = -10,-10,-10
PalMul      = .85,.85,.50
TimeGap  = 1
FrameGap = 2
Trans = Add
time = 2

[State 4121, Afterimage]
type = AfterImageTime
trigger1 = 1
time = 2

[state 4100, nothitby]
type = nothitby
trigger1 = animelemtime(5) < 0
value = SCA
ignorehitpause = 1

[state 4100, nothitby]
type = nothitby
trigger1 = animelemtime(5) >= 0
value = ,AT
ignorehitpause = 1

[state 4100, hitoverride]
type = hitoverride
trigger1 = animelemtime(5) >= 0
trigger1 = parent,var(24) <= 0
attr = SCA, AA, AP
stateno = 4150
time = 1
persistent = 1
ignorehitpause = 1

[state 4100, hitoverride]
type = hitoverride
trigger1 = animelemtime(5) >= 0
trigger1 = parent,var(24) > 0
attr = SCA, AA, AP
stateno = 4102
time = 1
persistent = 1
ignorehitpause = 1

[state 4100, parentvaradd]
type = parentvaradd
trigger1 = movehit
v = 18
value = -18
persistent = 0

[state 4102, changestate]
type = parentvaradd
trigger1 = movecontact
v = 24
value = -1
ignorehitpause = 1
persistent = 0

[state 4102, changestate]
type = changestate
trigger1 = movecontact
value = 4102
ignorehitpause = 1

[state 4102, changestate]
type = changestate
trigger1 = animelemtime(5) > 0
trigger1 = time = 48
value = 4103

[state 4100, end]
type = changestate
trigger1 = time > 420
trigger2 = parent,var(24) <= 0
trigger3 = movereversed
trigger4 = frontedgebodydist < -500
trigger5 = numtarget(4102)
trigger5 = target(4102),stateno = 4120
;trigger5 = pos y > 0
;trigger6 = parent,movetype = H && parent,stateno != [120,159]
value = 4150
ctrl = 0

;--------------------------------------------------------------------------
;EX Homing portion only
[statedef 4103]
type = U
movetype = A
physics = U

;===========
;Armor start
;===========
[state 4103, animation]
type = changeanim
trigger1 = anim != 4102
value = 4102

;determine what frame
[state 4103, remember frame]
type = varset
trigger1 = time <= 0
v = 22
value = animelemno(0)
ignorehitpause = 1

;delay effect
[state 4103, delay]
type = changeanim 
trigger1 = parent,var(31) < floor(gethitvar(hittime)*0.2)
value = anim
elem = parent,var(22)

[state 4103, freeze location]
type = posfreeze
trigger1 = parent,var(31) < floor(gethitvar(hittime)*0.2)
value = 1


;------------
;Delay end
;------------


[state 4103, armor count down]
type = parentvaradd
trigger1 = gethitvar(damage) != 0
trigger1 = parent,var(24) > 0
V = 24
value = -1
persistent = 1

[State 4103, flash red]
type = PalFX
trigger1 = Time = 0
trigger1 = gethitvar(damage) != 0
time = 7
add = 100,0,0
IgnoreHitPause = 1



;--------------
;Armor end
;--------------


[State 4103, A]
type = HitDef
trigger1 = !movecontact
attr = S, SP
animtype  = light
damage    = ifelse(parent,var(13)=1,30,10),ifelse(enemynear,statetype = A, 3,1)
priority = 1,miss
guardflag = MA
hitflag = MAF
pausetime = 8,8
guard.pausetime = 2,2
sparkno = 0
id = 4102
sparkxy = -10,-60
hitsound = S5000, 1
guardsound = S120, 0
ground.type = low
ground.hittime = 8
ground.slidetime = 8
ground.velocity = -8
air.hittime = 8
air.velocity = - 8,-2
guard.hittime = 4
guard.slidetime = 4
guard.velocity = -6
airguard.velocity = -12,-6
airguard.hittime = 10

[state 4103, targetstateno]
type = targetstate
triggerall = parent,var(14) > 0
triggerall = hitpausetime = 7
trigger1 = movehit
value = 4120
ignorehitpause = 1

[state 4103, parentvaradd]
type = parentvarset
trigger1 = movehit
v = 13
value = 1
persistent = 0
ignorehitpause = 0

[state 4103, parentvaradd]
type = parentvaradd
trigger1 = movehit
v = 14
value = -1
persistent = 0
ignorehitpause = 0

[state 4103, range]
type = attackdist
trigger1 = 1
value = 300

[State 4103, Afterimage]
type = AfterImage
trigger1 = Time = 0
length = 13
PalBright   =  30, 60,  30
PalContrast =  70, 70, 20
PalAdd      = -10,-10,-10
PalMul      = .85,.85,.50
TimeGap  = 1
FrameGap = 2
Trans = Add
time = 2

[State 4103, Afterimage]
type = AfterImageTime
trigger1 = 1
time = 2

[state 4103, nothitby]
type = nothitby
trigger1 = 1
value = ,AT
ignorehitpause = 1

[state 4103, hitoverride]
type = hitoverride
trigger1 = parent,var(20) <= 0
attr = SCA, AA, AP
stateno = 4150
time = 1
persistent = 1
ignorehitpause = 1

[state 4103, hitoverride]
type = hitoverride
trigger1 = parent,var(20) > 0
attr = SCA, AA, AP
stateno = 4103
time = 1
persistent = 1
ignorehitpause = 1

[state 4103, parentvaradd]
type = parentvaradd
trigger1 = movehit
v = 18
value = -27


;----------------
;Homing Portion
;---------------

[state 4102, turn]
type = turn
trigger1 = p2dist x < 10
persistent = 30

[state 4100, homing]
type = veladd
trigger1 = p2dist x > 0 && vel x < 16
x = 2
persistent = 2

[state 4103, homing]
type = veladd
trigger1 = p2dist y - 400 > pos y
trigger1 = vel y < 16
y = 0.4
persistent = 2

[state 4103, homing]
type = veladd
trigger1 = p2dist y - 200 < pos y
trigger1 = vel y > -16
y = -1.6
persistent = 2

[state 4103, homing]
type = velmul
trigger1 = pos y > -30
y = 0.01
persistent = 30

;----------------
;End homing
;----------------


[state 4103, changestate]
type = parentvaradd
trigger1 = movecontact
v = 24
value = -1
ignorehitpause = 1
persistent = 0

[state 4103, changestate]
type = changestate
trigger1 = movecontact
value = 4103
ignorehitpause = 1

[state 4103, end]
type = changestate
trigger1 = time > 420
trigger2 = parent,var(24) <= 0
trigger3 = movereversed = 1
trigger4 = frontedgebodydist < -500
trigger5 = numtarget(4102)
trigger5 = target(4102),stateno = 4120
;trigger5 = pos y > 0
;trigger6 = parent,movetype = H && parent,stateno != [120,159]
value = 4150
ctrl = 0

;--------------------------------------------------------------------------
;Knock back
[statedef 4120]
type = A
movetype = H
physics = N

[state 4120, animation]
type = changeanim
trigger1 = time = 0
value = 5010

[state 4120, velset]
type = velset
trigger1 = time = 0
x = - 8
y = -12

[state 4120, gravity]
type = veladd
trigger1 = time > 1
y = 1.22


[State 4121, Afterimage]
type = AfterImage
trigger1 = Time = 0
length = 13
PalBright   =  30, 60,  30
PalContrast =  70, 70, 20
PalAdd      = -10,-10,-10
PalMul      = .85,.85,.50
TimeGap  = 1
FrameGap = 2
Trans = Add
time = 2

[State 4121, Afterimage]
type = AfterImageTime
trigger1 = 1
time = 2

[state 4120, land]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 4121


;-----------------------------------------------------------------------------
; Land and stun
[statedef 4121]
type = S
movetype = H
physics = S

[state 4121, playerpush]
type = playerpush
trigger1 = 1
value = 0

[State 4121, Afterimage]
type = AfterImage
trigger1 = Time = 0
length = 13
PalBright   =  30, 60,  30
PalContrast =  70, 70, 20
PalAdd      = -10,-10,-10
PalMul      = .85,.85,.50
TimeGap  = 1
FrameGap = 2
Trans = Add
time = 2

[State 4121, Afterimage]
type = AfterImageTime
trigger1 = 1
time = 2

[state 4121, shrink]
type = angledraw
trigger1 = time < 40
scale = (1-(time*0.0225)),(1-(time*0.0225))
persistent = 1
ignorehitpause = 1

[state 4121, shrink]
type = angledraw
trigger1 = time >= 40
scale = 0.1,0.1
persistent = 1
ignorehitpause = 1

[state 4121, animation]
type = changeanim
trigger1 = time = 0
value = 5300

[state 4121, velset]
type = velset
triggerall = enemynear,name = "Pastilla Skunk"
trigger1 = (enemynear,anim = 1300) || (enemynear,anim = 1310) || (enemynear,anim =1320)
trigger1 = enemynear,animelemtime(10) > 0
trigger2 = enemynear,anim = 3080
trigger2 = enemynear,animelemtime(10) > 0
x = 9
persistent = 1

[state 4121, land]
type = velset
trigger1 = time = 0
y = 0

[state 4121, land2]
type = posset
trigger1 = time = 0
y = 0

[state 4121, end]
type = changestate
trigger1 = time > 112
value = 4122



;--------------------------------------------------------------------------
;Regrow
[statedef 4122]
type = S
movetype = H
physics = S

[state 4122, animation]
type = changeanim
trigger1 = time = 0
value = 5017

[State 4121, Afterimage]
type = AfterImage
trigger1 = Time = 0
length = 13
PalBright   =  30, 60,  30
PalContrast =  70, 70, 20
PalAdd      = -10,-10,-10
PalMul      = .85,.85,.50
TimeGap  = 1
FrameGap = 2
Trans = Add
time = 2

[State 4121, Afterimage]
type = AfterImageTime
trigger1 = 1
time = 2

[state 4121, shrink]
type = angledraw
trigger1 = time >= 0
scale = (0.1+(time*0.1125)),(0.1+(time*0.1125))
persistent = 1
ignorehitpause = 1


[state 4122, end]
type = selfstate
trigger1 = time = 8
value = 0
ctrl = 1



;--------------------------------------------------------------------------
;End
[statedef 4150]
type = A
movetype = H
physics = N
anim = 4150

[state 4100, no shadows]
type = assertspecial
trigger1 = 1
flag = noshadow
ignorehitpause = 1 

[state 4150, varset]
type = varset
trigger1 = time = 0
v = 10
value = 0

[state 4150, velset]
type = velset
trigger1 = time = 0
x = -8
y = -12

[state 4150, veladd]
type = veladd
trigger1 = time > 1
y = 1.22

[state 4150, end]
type = destroyself
trigger1 = time > 30 






;==========================================================================
;[Info]
;author = "Inktrebuchet" 
;versiondate = 12/13/2018                  
;goal = Detect enemy's projectile (helper). For use with AI.
;       敵の発射物（helper）を検出する。 AIで使用する場合。
;==========================================================================
;                Notes
;==========================================================================
;notes:
;-Enemy's projectile now has a PlayerID use PlayerID(helper(33333333),var(3)) as a redirect.
;
;base examples of trigger use: 
;
;;Enemy's projectile helper's distance from character.
;trigger1 = PlayerIDExist(helper(33333333),var(3))
;trigger1 = PlayerID(helper(33333333),var(3)), p2bodydist x 
;
;;Enemy's projectile helper's velocity.
;trigger1 = PlayerIDExist(helper(33333333),var(3))
;trigger1 = PlayerID(helper(33333333),var(3)), Vel X
;
;==========================================================================
;                Helper var usage.
;==========================================================================
; numhelper(33333333) Variable usage:
; This is a record of the variables that are used
;
; var(0) - highest playerid + 1
; var(3) - projectile player id while it exists
; 
;==========================================================================
[Statedef 33333333]
type = A
movetype = I
physics = N
ctrl = 0
velset = 0, 0
 
;==========================================================================
;                Config Section
;==========================================================================
anim = 9741                   ; blank animation
 
;==========================================================================
 
[state 33333333, Clipboard] 
type = DisplayToClipboard
trigger1 = 1
text = "Highest Playerid = %d , Projectile helper's PlayerId = %d\nBy Inktrebuchet"
params = var(0)-1, var(3)


;==========================================================================
;                Detect Enemy's Projectile Helper
;==========================================================================
[State 33333333, 0]
type = Null
trigger1 = var(0) = 0
trigger1 = (var(0) := id)
ignorehitpause = 1
 
[state 33333333, 1] 
type = varadd
trigger1 = PlayerIdExist(var(0)) 
trigger2 = PlayerIdExist(var(0)+1) 
trigger3 = PlayerIdExist(var(0)+2) 
trigger4 = PlayerIdExist(var(0)+3) 
trigger5 = PlayerIdExist(var(0)+4) 
trigger6 = PlayerIdExist(var(0)+5) 
trigger7 = PlayerIdExist(var(0)+6) 
trigger8 = PlayerIdExist(var(0)+7) 
trigger9 = PlayerIdExist(var(0)+8) 
trigger10 = PlayerIdExist(var(0)+9) 
trigger11 = PlayerIdExist(var(0)+10) 
trigger12 = PlayerIdExist(var(0)+11) 
trigger13 = PlayerIdExist(var(0)+12) 
trigger14 = PlayerIdExist(var(0)+13) 
trigger15 = PlayerIdExist(var(0)+14) 
trigger16 = PlayerIdExist(var(0)+15) 
trigger17 = PlayerIdExist(var(0)+16) 
trigger18 = PlayerIdExist(var(0)+17) 
trigger19 = PlayerIdExist(var(0)+18) 
trigger20 = PlayerIdExist(var(0)+19) 
trigger21 = PlayerIdExist(var(0)+20) 
trigger22 = PlayerIdExist(var(0)+21) 
trigger23 = PlayerIdExist(var(0)+22) 
trigger24 = PlayerIdExist(var(0)+23) 
trigger25 = PlayerIdExist(var(0)+24) 
trigger26 = PlayerIdExist(var(0)+25) 
v = 0
value = 1
ignorehitpause = 1
 
[State 33333333, 2]
type = Null
triggerall = PlayerIdExist(Root,ID)
trigger1 = PlayerIdExist(var(0)-1)
trigger1 = cond(root,teamside = 1, PlayerID(var(0)-1),teamside = 2, PlayerID(var(0)-1),teamside = 1)
trigger1 = PlayerID(var(0)-1),hitdefattr = ASC, NP, SP, HP
trigger1 = var(3) := (var(0)-1)
trigger2 = PlayerIdExist(var(0)-2)
trigger2 = cond(root,teamside = 1, PlayerID(var(0)-2),teamside = 2, PlayerID(var(0)-2),teamside = 1)
trigger2 = PlayerID(var(0)-2),hitdefattr = ASC, NP, SP, HP
trigger2 = var(3) := (var(0)-2)
trigger3 = PlayerIdExist(var(0)-3)
trigger3 = cond(root,teamside = 1, PlayerID(var(0)-3),teamside = 2, PlayerID(var(0)-3),teamside = 1)
trigger3 = PlayerID(var(0)-3),hitdefattr = ASC, NP, SP, HP
trigger3 = var(3) := (var(0)-3)
trigger4 = PlayerIdExist(var(0)-4)
trigger4 = cond(root,teamside = 1, PlayerID(var(0)-4),teamside = 2, PlayerID(var(0)-4),teamside = 1)
trigger4 = PlayerID(var(0)-4),hitdefattr = ASC, NP, SP, HP
trigger4 = var(3) := (var(0)-4)
trigger5 = PlayerIdExist(var(0)-5)
trigger5 = cond(root,teamside = 1, PlayerID(var(0)-5),teamside = 2, PlayerID(var(0)-5),teamside = 1)
trigger5 = PlayerID(var(0)-5),hitdefattr = ASC, NP, SP, HP
trigger5 = var(3) := (var(0)-5)
trigger6 = PlayerIdExist(var(0)-6)
trigger6 = cond(root,teamside = 1, PlayerID(var(0)-6),teamside = 2, PlayerID(var(0)-6),teamside = 1)
trigger6 = PlayerID(var(0)-6),hitdefattr = ASC, NP, SP, HP
trigger6 = var(3) := (var(0)-6)
trigger7 = PlayerIdExist(var(0)-7)
trigger7 = cond(root,teamside = 1, PlayerID(var(0)-7),teamside = 2, PlayerID(var(0)-7),teamside = 1)
trigger7 = PlayerID(var(0)-7),hitdefattr = ASC, NP, SP, HP
trigger7 = var(3) := (var(0)-7)
trigger8 = PlayerIdExist(var(0)-8)
trigger8 = cond(root,teamside = 1, PlayerID(var(0)-8),teamside = 2, PlayerID(var(0)-8),teamside = 1)
trigger8 = PlayerID(var(0)-8),hitdefattr = ASC, NP, SP, HP
trigger8 = var(3) := (var(0)-8)
trigger9 = PlayerIdExist(var(0)-9)
trigger9 = cond(root,teamside = 1, PlayerID(var(0)-9),teamside = 2, PlayerID(var(0)-9),teamside = 1)
trigger9 = PlayerID(var(0)-9),hitdefattr = ASC, NP, SP, HP
trigger9 = var(3) := (var(0)-9)
trigger10 = PlayerIdExist(var(0)-10)
trigger10 = cond(root,teamside = 1, PlayerID(var(0)-10),teamside = 2, PlayerID(var(0)-10),teamside = 1)
trigger10 = PlayerID(var(0)-10),hitdefattr = ASC, NP, SP, HP
trigger10 = var(3) := (var(0)-10)
ignorehitpause = 1
 
[State 33333333, BindToRoot]
type = BindToRoot
trigger1 = PlayerIdExist(Root,ID)
time = 1
facing = 1
pos =0,-2
ignorehitpause = 1 


;===========================================================================
;Vored - victim state
[statedef 18000]
movetype = H
type = U
Physics = N
sprpriority = -1

[state 18000, anim]
type = changeanim2
trigger1 = time = 0
value = 9999

[state 18000, posset]
type = posset
trigger1 = time = 0
y = 0

[state 18000, invisible]
type = assertspecial
trigger1 = 1
flag = invisible

[state 18000, end]
type = changestate
trigger1 = time = 20
value = 5150


;---------------------------------------------------------------------------
; Override common states (use same number to override) :
;---------------------------------------------------------------------------

;---------------------------------------------------------------------------
; States that are always executed (use statedef -2)
;---------------------------------------------------------------------------

[statedef -2]

;===========================================================================
; ---------------------------------Victory Quotes---------------------------
;===========================================================================

[state -2, win quotes]
type = victoryquote
trigger1 = 1
value = 1+(random%7)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Jumbo Elephant"
value = 8+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Ana 'Jiggly' Bunny"
value = 11+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Katrina Crocodile"
value = 14+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Bertha Hippo"
value = 17+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Aroma Skunk"
value = 20+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Enorma Pig"
value = 23+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Lardo Rat"
value = 26+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Zafta Giraffe"
value = 29+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Makuyama"
value = 32+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Pastilla Skunk"
value = 35+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Jumba Elephant"
value = 38+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Twiggi Bunny"
value = 41+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Ra Lord"
value = 44+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Violet 'Tyla' Bunny"
value = 47+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Battu Tri-red"
value = 50+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Julian Hippo"
value = 53+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Rapid Bunny"
value = 56+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Noah Sharker"
value = 59+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Akai R. Panda"
value = 62+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Andy Armadillo"
value = 65+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Montana Moth"
value = 68+(random%3)
ignorehitpause
persistent = 1

[state -2, win quote]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Texas Stanton"
value = 71+(random%3)
ignorehitpause
persistent = 1


;=======================AI Detect Projectile System==========================
[state -2, AI Detect Projectile System]
type = helper
trigger1 = ailevel ;M.U.G.E.N 1.0+
trigger1 = !numhelper(33333333)
name = "AI Detect Projectile System"
ID = 33333333
stateno = 33333333
postype = p1
ownpal = 1
keyctrl = 0
size.xscale = 1.0
size.yscale = 1.0
supermovetime = 2147483647
pausemovetime = 2147483647
ignorehitpause = 1


;===============================================================================
; Simple Counter
;===============================================================================

[state -2, counter]
type = varset
trigger1 = gethitvar(damage) != 0
v = 31
value = 0
ignorehitpause = 1

[state -2, count up]
type = varadd
trigger1 = var(31) < var(33)
v = 31
value = 1
ignorehitpause = 0

[state -2, delay conter set]
type = varset
trigger1 = 1
v = 33
value = 300

;===========================================
;  Combo damage reduction
;===========================================

[State -2, attack scaling]
type = attackMulSet
trigger1 = 1
value = fvar (10)
ignorehitpause = 1

[state -2, combo points]
type = varset
trigger1 = numenemy
trigger1 = (enemynear, movetype != H)
trigger2 = !numenemy
ignorehitpause = 1
v = 18
value = 100

[state -2, gradual lowering]
type= varset
trigger1 =  var(18) >= 100
fvar(10) = 1

[state -2, gradual lowering]
type= varset
trigger1 = var(18) < 100 && var(18) >= 90
fvar(10) = 0.9

[state -2, gradual lowering]
type= varset
trigger1 = var(18) < 90 && var(18) >= 80
fvar(10) = 0.8

[state -2, gradual lowering]
type= varset
trigger1 = var(18) < 80 && var(18) >= 70
fvar(10) = 0.7

[state -2, gradual lowering]
type= varset
trigger1 = var(18) < 70 && var(18) >= 60
fvar(10) = 0.6

[state -2, gradual lowering]
type= varset
trigger1 = var(18) < 60 && var(18) >= 50
fvar(10) = 0.5

[state -2, gradual lowering]
type= varset
trigger1 = var(18) < 50 && var(18) >= 40
fvar(10) = 0.4

[state -2, gradual lowering]
type= varset
trigger1 = var(18) < 40 && var(18) >= 30
fvar(10) = 0.3

[state -2, gradual lowering]
type= varset
trigger1 = var(18) < 30 && var(18) >= 20
fvar(10) = 0.2

[state -2, gradual lowering]
type= varset
trigger1 = var(18) < 20 && var(18) >= 10
fvar(10) = 0.1

[state -2, gradual lowering]
type= varset
trigger1 = var(18) < 10
fvar(10) = 0.05

;-----------------------------------------------------
; Inhibitors
;-----------------------------------------------------


[state -2, Wall bounce limiter]
type = varset
triggerall = numenemy
trigger1 = (enemynear, movetype != H)
var(7) = 2
ignorehitpause = 1

[state -2, Ground Bounce limiter]
type = varset
triggerall = numenemy
trigger1 = (enemynear, movetype != H)
var(8) = 2
ignorehitpause = 1

[state -2, Launcher limiter]
type = varset
triggerall = numenemy
trigger1 = (enemynear, movetype != H)
var(11) = 2
ignorehitpause = 1

[state -2, Curse Check]
type = varset
triggerall = numenemy
trigger1 = (enemynear,movetype != H)
var(13) = 0
ignorehitpause =1

[state -2, Stun Limiter]
type = varset
triggerall = numenemy
trigger1 = (enemynear, movetype != H)
var(14) = 1
ignorehitpause = 1

[state -2, butt hammer loop prevention]
type = varset
triggerall = numenemy
trigger1 = (enemynear,movetype != H)
var(16) = 2
ignorehitpause = 1

[state -2, Jump infinite check]
type = varset
triggerall = numenemy
trigger1 = (enemynear, movetype != H)
var(29) = 1
ignorehitpause = 1

[state -2, Jumping Fierce limiter]
type = varset
triggerall = numenemy
trigger1 = (enemynear,movetype != H)
var(41) = 1
ignorehitpause




[state -2, clipboard]
type = displayToClipboard
trigger1 = 1
text = "p2bodydist x is %d , p2bodydist y is %d, pos y is %d, Wall Bounce inhibitor: %d"
params = p2bodydist x, p2bodydist y, pos y, var(7)

[state -2, removeshields]
type = removeexplod
trigger1 = stateno != [120,159]
id = 12000
ignorehitpause = 1

[state -2, removeshields]
type = removeexplod
trigger1 = stateno != [120,159]
id = 12100
ignorehitpause = 1

[state -2, removeshields]
type = removeexplod
trigger1 = stateno != [120,159]
id = 12200
ignorehitpause = 1

[state -2, removeshields]
type = removeexplod
trigger1 = stateno != [120,159]
id = 12010
ignorehitpause = 1

[state -2, removeshields]
type = removeexplod
trigger1 = stateno != [120,159]
id = 12110
ignorehitpause = 1

[state -2, removeshields]
type = removeexplod
trigger1 = stateno != [120,159]
id = 12210
ignorehitpause = 1

;===========================================================================
; Cursed States
;===========================================================================
;Earthquakes
[State -2, quakes]
type = envshake
triggerall = time = 1
trigger1 = stateno = 1521
trigger1 = prevstateno != 1523  
trigger2 = stateno = 1527 && time = 1
time = 12
ampl = -12

;Thuds
[State -2, sfx]
type = PlaySnd
triggerall = Time = 1
trigger1 = stateno = 1521
trigger1 = prevstateno != 1523   
trigger2 = stateno = 1527 && time = 1 
value = S52,0 

[state -2, Bleed Out]
type = lifeadd
trigger1 = stateno = [1521,1549]
value = -1
persistent = 2700

[state -2, projectile shield]
type = nothitby
triggerall = numhelper(21000)
trigger1 = parentdist x = [-500,0]
value = ,AP
time = 16
ignorehitpause = 1



;---------------------------------------------------------------------------
; States that are executed when in self's state file (use statedef -3)
;---------------------------------------------------------------------------

[Statedef -3]


[State -3, quakes]
type = envshake
triggerall = time = 1
trigger1 = stateno = 5100
time = 18
ampl = -12
freq = 60
phase = 60

;This controller plays a sound everytime KFM lands from a jump, or
;from his back-dash.
[State -3, Landing Sound]
type = PlaySnd
triggerall = Time = 1
trigger1 = stateno = 5100
value = S5100, 0

[state -3, gravity]
type = gravity
trigger1 = stateno = 5620
trigger1 = time > 0

[state -3, land]
type = changestate
triggerall = stateno = 5620
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 52

[State -3, Landing Sound]
type = PlaySnd
triggerall = Time = 1
trigger1 = stateno = 52 ;Jump land
trigger2 = stateno = 106 ;Run-back land
value = S52, 0
