 ; KFM's constants and state file.
; There are comments scattered through this file, so you may like to
; take a look if would like to learn more about the cns.

[Data]
;Amount of life to start with
life = 1200
power = 5000
;attack power (more is stronger)
attack = 100
;defensive power (more is stronger)
defence = 100
;Percentage to increase defense everytime player is knocked down
fall.defence_up = 50
;Time which player lies down for, before getting up
liedown.time = 60
;Number of points for juggling
airjuggle = 60
;Default hit spark number for HitDefs
sparkno = 2
;Default guard spark number
guard.sparkno = 40
;1 to enable echo on KO
KO.echo = 0
;Volume offset (negative for softer)
volume = 0
;Variables with this index and above will not have their values
;reset to 0 between rounds or matches. There are 60 int variables,
;indexed from 0 to 59, and 40 float variables, indexed from 0 to 39.
;If omitted, then it defaults to 60 and 40 for integer and float
;variables repectively, meaning that none are persistent, i.e. all
;are reset. If you want your variables to persist between matches,
;you need to override state 5900 from common1.cns.
IntPersistIndex = 60
FloatPersistIndex = 40

[Size]
xscale = 0.72   ;.72      ;Horizontal scaling factor.
yscale = 0.72    ;.72     ;Vertical scaling factor.
ground.back = 100     ;Player width (back, ground)
ground.front = 100   ;Player width (front, ground)
air.back = 140        ;Player width (back, air)
air.front = 105       ;Player width (front, air)
height = 360         ;Height of player (for opponent to jump over)
attack.dist = 480   ;Default attack distance
proj.attack.dist = 240 ;Default attack distance for projectiles
proj.doscale = 0     ;Set to 1 to scale projectiles too
head.pos = -4, -257   ;Approximate position of head
mid.pos = 1, -133    ;Approximate position of midsection
shadowoffset = 0     ;Number of pixels to vertically offset the shadow
draw.offset = 0,0    ;Player drawing offset in pixels (x, y). Recommended 0,0

[Velocity]
walk.fwd  = 4.0   ;3.25 ;Walk forward
walk.back = -3.5     ;Walk backward
run.fwd  = 10.0, 0    ;Run forward (x, y)
run.back = -8,-8 ;Hop backward (x, y)
jump.neu = 0,-20    ;Neutral jumping velocity (x, y)
jump.back = -4,-20    ;Jump back Speed (x, y)
jump.fwd = 4,-20      ;Jump forward Speed (x, y)
runjump.back = -2.55,-8.1 ;Running jump speeds (opt)
runjump.fwd = 7.5,-8.1      ;.
airjump.neu = 0,-8.1      ;.
airjump.back = -2.55      ;Air jump speeds (opt)
airjump.fwd = 2.5         ;.
air.gethit.groundrecover = -.15,-3.5  ;Velocity for ground recovery state (x, y) **MUGEN 1.0**
air.gethit.airrecover.mul = .5,.2     ;Multiplier for air recovery velocity (x, y) **MUGEN 1.0**
air.gethit.airrecover.add = 0,-4.5    ;Velocity offset for air recovery (x, y) **MUGEN 1.0**
air.gethit.airrecover.back = -1       ;Extra x-velocity for holding back during air recovery **MUGEN 1.0**
air.gethit.airrecover.fwd = 0         ;Extra x-velocity for holding forward during air recovery **MUGEN 1.0**
air.gethit.airrecover.up = -2         ;Extra y-velocity for holding up during air recovery **MUGEN 1.0**
air.gethit.airrecover.down = 1.5      ;Extra y-velocity for holding down during air recovery **MUGEN 1.0**

[Movement]
airjump.num = 0       ;Number of air jumps allowed (opt)
airjump.height = 35   ;Minimum distance from ground before you can air jump (opt)
yaccel = 1.0;1.2         ;Vertical acceleration
stand.friction = .775 ;Friction coefficient when standing
crouch.friction = .770 ;Friction coefficient when crouching
stand.friction.threshold = 2          ;If player's speed drops below this threshold while standing, stop his movement **MUGEN 1.0**
crouch.friction.threshold = .05       ;If player's speed drops below this threshold while crouching, stop his movement **MUGEN 1.0**
air.gethit.groundlevel = 25           ;Y-position at which a falling player is considered to hit the ground **MUGEN 1.0**
air.gethit.groundrecover.ground.threshold = -20 ;Y-position below which falling player can use the recovery command **MUGEN 1.0**
air.gethit.groundrecover.groundlevel = 10   ;Y-position at which player in the ground recovery state touches the ground **MUGEN 1.0**
air.gethit.airrecover.threshold = -1  ;Y-velocity above which player may use the air recovery command **MUGEN 1.0**
air.gethit.airrecover.yaccel = 1.0    ;Vertical acceleration for player in the air recovery state **MUGEN 1.0**
air.gethit.trip.groundlevel = 15      ;Y-position at which player in the tripped state touches the ground **MUGEN 1.0**
down.bounce.offset = 0, 20            ;Offset for player bouncing off the ground (x, y) **MUGEN 1.0**
down.bounce.yaccel = 1.2;.4               ;Vertical acceleration for player bouncing off the ground **MUGEN 1.0**
down.bounce.groundlevel = 12          ;Y-position at which player bouncing off the ground touches the ground again **MUGEN 1.0**
down.friction.threshold = .05         ;If the player's speed drops below this threshold while lying down, stop his movement **MUGEN 1.0**

;Default language victory quotes (optional).  **MUGEN 1.0**
;If this section is included, the default language victory quotes must be in English.
[Quotes]
; Up to 100 victory quotes can be specified per language (victory0 - victory99)
victory1 = "You must defeat my ass to stand a chance."
victory2 = "You weren't an opponent, you were just an unwilling seat."
victory3 = "I don't think blocking my ass with your face is going to do you a lot of good..."
victory4 = "How does it feel to have your technique overwhelmed by sheer mass?"
victory5 = "I have a harder time finding outfits than fighting you!"
victory6 = "Respect the booty, or be crushed beneath it!"
victory7 = "Bulk yourself up, then come and challenge me again."

;vs Jumbo
victory8 = "It's nice to be on equal footing every once in a while."
victory9 = "Don't you ever steal my moves again, Jumbo!"
victory10 = "Our fights are getting awfully cramped, but I still had a good time."

;vs Jiggly
victory11 = "I'm glad my teachings have helped you improve, but you've still got a lot to learn."
victory12 = "I'm proud of how far you've come, Jiggly."
victory13 = "Your speed with that body type is impressive, Jiggly!"

;vs Katrina
victory14 = "I can see why your mouth is so big, considering how you're all talk."
victory15 = "I'm more of a fighter than you and your partner combined, you should stick to the trash talk."
victory16 = "All breasts and no brains, right Katrina?"

;vs Herself, Bertha
victory17 = "So that's how my ass looks when I'm falling..."
victory18 = "I might know my own moves, but they still really hurt."
victory19 = "I guess one way to learn how others counter your techniques is to fight yourself."

;vs TMNT
victory20 = "Staying below me is a great way to get your shell shattered, turtle."

;vs Ryu
Victory21 = "That uppercut of yours is impressive, not many can knock me out of the air like that."
Victory22 = "Your fireballs can really put some work in, but they can't hold me back forever."
victory23 = "Everytime there's a brawl, you don't seem too far behind."

;vs Chun-li
Victory24 = "For someone who has a reputation for thunder thighs, I can't say I'm impressed."
Victory25 = "You're out of your league, has been."
Victory26 = "You might have lost your fighters touch, but you're still pretty fashionable."
Victory27 = "Still think you're the icon for fighters with killer thighs? "

;vs Zangief
Victory28 = "I'm impressed you can throw me, but you still can't handle my weight dropping down on you!"
Victory29 = "Can't grab what you can't catch, can you?" 
Victory30 = "Have to say, it's fun getting to fight someone brave enough to pick me up."

;vs Mika
Victory31 = "Nice to see humans making use of techniques like mine."
Victory32 = "You're on the right track, Mika. Maybe we could share our fighting strategies sometime?"


;vs E.Honda
Victory36 = "I'm impressed to see someone balance muscles and fat so expertly, but it just wasn't enough."
victory37 = "You ought to sit this one out, old man."

;vs Deadpool
Victory38 = "I remember the comic where you actually showed an interest in Big Bertha.  I loved that one."
Victory39 = "I can take great pleasure crushing you knowing you have such a fantastic healing factor."

;Vs Renamon
Victory40 = "I miss the card art for you where you had monster thighs."

;Vs TT Lucario
Victory41 = "Always a pleasure to see the representative of thick for pokémon."

;Vs Ryugen
Victory42 = "You look cool, but fighting you is more of a chore."
Victory43 = "Have you tried not being a pain with your projectile orbs!"
Victory44 = "After annoyance that is fighting you, I took great pleasure in sitting on you."

;Vs GokuZ2
Victory45 = "You're pretty flashy, but you seem a little too enthusiastic about this."
Victory46 = "How's that for gravity training?"

;Vs PiccoloZ2
Victory47 = "Your techniques aren't half bad, slug man."
Victory48 = "Don't you know how to dodge?"

;Vs Hulk
Victory49 = "That ought to calm you down, green giant."
Victory50 = "I don't think 'being mad' is a technique."

;vs Ms Fanservice
Victory51 = "I expected more out of someone with a title like yours."

;vs Enorma Pig
Victory52 = "You wouldn't even stand a chance with armor-piercing shells!"
Victory53 = "Quit hiding behind your pea shooters and fight me face to face!"
victory54 = "Must be rough trying to use those guns when you're crushed beneath me."

;vs Aroma Skunk
victory55 = "Oh, well that's just gross."
Victory56 = "A nasty stench is a whole lot more forgiving than broken bones, isn't it?"
victory57 = "Try fighting with something other than your little perfume, and you might get somewhere."

;vs Lardo Rat
victory58 = "Try to eat me again, and I'll crush your bones into dust!"
victory59 = "You got the look of a good heel, you should do pretty well."
victory60 = "You're not intimidating, you're just disgusting."

;vs Zafta Giraffe
victory61 = "No amount of height can save you from my ass, Zafta!"
victory62 = "I'm too heavy for you to stop with a mere kick."
victory63 = "You should be thankful I can't flatten you all at once, Zafta."

;vs Makuyama
Victory64 = "You sumo types always think your weight will do all the work; it's how you throw it that matters!"
Victory65 = "Isn't a proficiency in fighting supposed to be a panda thing?"
Victory66 = "I might be just as fat as you, but at least I don't eat in the middle of a fight!"

;vs Pastilla
Victory67 = "I have no idea how you got your lower half, but I could help you fight more like a hippo."
Victory68 = "Those gassing techniques are gross, and I'm absolutely not gonna copy them."
victory69 = "I have experience fighting you skunks, this ass will run you over just the same."

;vs Jumba
Victory70 = "I'll give you some credit for being so agile at your size, but I've got more power behind my weight!"
Victory71 = "You were always agile.  Being a ninja works for you being such a backstabber."
Victory72 = "You'll never beat me by tossing yourself around so recklessly, Jumba."

;vs Twiggi, no relation
Victory73 = "You keep getting wedged in the ass I'm throwing at you, and you're just gonna become my underwear."
Victory74 = "Girl, I don't think I could flatten you any further if I tried. "
victory75 = "I think you two just de-throned the 'Greatest Size Contrast Couple' title that I have with Rapid. "

;vs Ra Lord, danger snake
victory76 = "I don't care how many heads you have, they're all going to be blinded underneath me!"
Victory77 = "You'd best slither on back to your hole; you can't even penetrate my hide!"
victory78 = "You're going to become a very dangerous game of jump rope if you try me again."

;vs Violet
victory79 = "Manage to get a good view of my outfit before it landed on top of you?."
victory80 = "You're going to need a whole lot more than sewing and stitching to fix what I've done to you, hun."
victory81 = "Guess you really are stealth when you're pinned under me, huh?"

;vs Battu
victory82 = "You've got some serious potential with your ability to manipulate gravity, alien rodent thing."
victory83 = "You're so cute and tiny, I almost regret having to crush you!"
victory84 = "You might be able to equal my size, but you're not as skilled at that weight as me!"

;vs Julian
victory85 = "I'm thrilled that the hippo I run into out here is as charming as you, Julian."
victory86 = "We should share our techniques some time! Only builds like ours have been able to fully utilize butt techniques."
victory87 = "Might be best if you stick to the modeling, hun."

;vs Rapid
Victory88 = "You are a lot more capable than you think.  You may not be hurting my thick skin with each hit but you throw so many its bound to cause damage."
Victory89 = "We may need a safe word in the future hun.  I really don't wanna put my man in a crater...that he can't recover from."
Victory90 = "Chasing you is a pain!  But you do tend to make a habbit of running into my ass.  I sometimes don't know if you are taking our spars seriously."

;Vs Noah
Victory91 = "Demon dogs huh?  My ass doesn't care what it runs over."
Victory92 = "My skin can handle bullets easy so using arrows won't worry me."
victory93 = "Summon all the back up you want, I can probably sit on all of y'all at the same time."

;Vs Akai
Victory94 = "Would you be suprised if I told you I'm actually used to speedsters."
victory95 = "I may have trouble keeping up with you.  But I do not have any difficulty laying the damage on you."
Victory96 = "Rapid is faster than you, Jiggly does the ass assault thing better via my teaching, and I'm the queen of ass attacks.  What did you hope to prove fighting me?"

;vs Bertha
Victory97 = "I've literally crushed an adamantium chair before, don't test what my ass does to things under it."
victory98 = "That shield is pretty durable to stand up to attacks like mine and not have you buckling."
victory99 = "Did my fat ass educate you to how destructible you are."

;vs Montana
Victory49 = "You carry yourself well, look good and can drop a mean ass, but thats still not enough to stop a powerful pearshaped pachyderm like me."
Victory50 = "You do well for yourself with your magic and such Montana.  But I'm the queen of ass attacks."
victory51 = "I better not find you've been eating my outfit during battle.  These outfits aren't much but are still expensive becasue of how they have to be custom."

;vs Texas
Victory33 = "I could jail you too sheriff.  You better be careful not to get wedged back there or it could be a long sentence."
Victory34 = "Sorry Sheriff, but my ass stops for no one.  Maybe don't put yourself in my path next time."
Victory35 = "I should ask your outlaws for tips on how to unwedge you from my ass."
;0 or more alternate language sections may be added, preceded by the
;ISO 639-1 code followed by a ".", e.g. "[ja.Quotes]".
;See language setting in mugen.cfg.
[ja.Quotes]
victory1 = "カンフー突き手を破らぬ限り、お前に勝ち目はない！"
victory2 = "十年早いんだぞ"
victory3 = "お前は見覚えがあるな。テレビにでも…？"
victory4 = "お前の動きは見破りやすすぎる。　なに、カンフー突き手が覚えたいんだと？　素人には無理だぞ"
victory5 = "ふー。　いい汗だった"
victory6 = "もっと強い相手に挑戦したい"
victory7 = "なんだと！彼女はここにもいないと？"

;---------------------------------------------------------------------------
; Variable usage:
; This is a record of the variables that KFM uses. Keeping a record of your
; variable usage helps you avoid careless mistakes later.
; var(1)  - Used in kfm.cmd for combo condition (updated every tick)
; var(2)  - Used in Kung Fu Throw (state 800) to remember if fwd was being
;           held (remembered from state 800 through state 810).
; var(6) - Pique counter
; Var(7-11) ground, wall & launcher check
; var (14) - butt drop damage
; (var 26) - Pique counter
; var(20-21) - Super Armor
;var (5) - Butt dance count
;var (22) - animelem for armor
;var(28) - J Fierce math
;var (29) - Jump inifinite fix
;var(31} - simple counter
;var(33) - delay time
;var(40) - AI spin dodge check - clotheseline distance
;var(41) - spike bounce check - for butt drop combos
;---------------------------------------------------------------------------
; Lose by Time Over
; CNS difficulty: basic
[Statedef 170]
type = S
ctrl = 0
anim = 170
velset = 0,0

[State 170, 1]
type = NotHitBy
trigger1 = 1
value = SCA
time = 1

;---------------------------------------------------------------------------
; Win state decider
; CNS difficulty: basic
[Statedef 180]
type = S

[State 180, 1]
type = ChangeState
triggerall = enemy,name = "Rapid Bunny"
trigger1 = matchover
value = 182

[state 180, not Rapid]
type = changestate
trigger1 = enemy,name != "Rapid Bunny"
trigger2 = !matchover
value = 181

;---------------------------------------------------------------------------
; Spin Pose
[Statedef 181]
type = S
ctrl = 0
anim = 181
velset = 0,0
sprpriority = -3

[state 182, width]
type = width
trigger1 = 1
edge = 200,100

[state 182, width]
type = width
trigger1 = numpartner
trigger1 = partner,name = "Rapid Bunny"
edge = 0,240

[state 181, spr priority]
type = sprpriority
trigger1 = 1
value = -3
persistent = 1


[state 181, changeanim]
type = changeanim
triggerall = anim != 187
trigger1 = numpartner
trigger1 = partner,name = "Rapid Bunny"
trigger1 = partner, anim = 1881
trigger1 = partner, animelemtime(6) > 0
value = 187

[state 181, sprpriority]
type = sprpriority
trigger1 = anim = 187
value = 4

[state 181, Jump]
type = velset
triggerall = numpartner
trigger1 = anim = 187
trigger1 = animelemtime(17) = 0
y = -12
x = facing*(screenpos x - partner,screenpos x) * -0.02

[state 181, gravity]
type = gravity
trigger1 = anim = 187
trigger1 = animelemtime(17) > 0

[state 182, width]
type = width
trigger1 = anim = 187
edge = 120,120

[state 181, end]
type = changestate
trigger1 = anim = 187
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 187


[state 181, announce]
type = playsnd
triggerall = teammode = single
trigger1 = time = 10
trigger1 = life != lifemax
value = S180,1

[state 181, announce]
type = playsnd
triggerall = teammode = single
trigger1 = time = 10
trigger1 = life = lifemax
value = S180,1

[State 181, 1]
type = NotHitBy
trigger1 = 1
value = SCA
time = 1

;--------------------------------------------------------------------------
;Walk Over
[statedef 182]
type = S
ctrl = 0
anim = 20
velset = 0,0
sprpriority = 1

[State 184, Assert: RoundNotOver]
type = AssertSpecial
trigger1 = 1
flag = RoundNotOver

;Walk FXs
[state 182, speed]
type = velset
trigger1 = 1
x = const(velocity.walk.fwd.x)

;Dust
[State 20, front walk back dust 1]
type = explod
trigger1 = animelem = 2 
trigger1 = anim = 20
anim = 2040
pos = 40, 0
scale = 0.3,0.3
sprpriority = 1


[State 20, front walk back dust 1]
type = explod
trigger1 = animelem = 2 
trigger1 = anim = 20
anim = 2040
pos = 130, 0
scale = 0.3,0.3
sprpriority = 1

[State 20, front walk back dust 1]
type = explod
trigger1 = animelem = 9 
trigger1 = anim = 20
anim = 2040
pos = 70, 0
scale = 0.3,0.3
sprpriority = 1


[State 20, front walk back dust 1]
type = explod
trigger1 = animelem = 9 
trigger1 = anim = 20
anim = 2040
pos = 175, 0
scale = 0.3,0.3
sprpriority = 1

;Quakes
[state 20, earthquakes]
type = envshake
trigger1 = animelemtime(1) = 5|| animelemtime(9) = 1
trigger1 = anim = 20
time = 10
ampl = -8
freq = 100
phase = 100
persistent = 1

[state 20, sound1]
type = playsnd
triggerall = anim = 20
trigger1 = animelemtime(1) = 5|| animelemtime(9) = 1
value = S1,2
volumescale = 50
persistent = 1

;-----------------
;End Walk Portion

[State 182, Turn to Enemy]
type = Turn
trigger1 = Enemy, Facing = Facing
trigger1 = Enemy, P2Dist X <= 25 && (Enemy, P2Dist X >= 5)

[State 182, ChangeAnim]
type = ChangeAnim
trigger1 = Enemy, Facing != Facing
trigger1 = Anim = 20
trigger1 = vel x > 0
trigger1 = Enemy, P2Dist X <= 25 && (Enemy, P2Dist X >= 5)
value = 182

[state 182, sprpriority]
type = sprpriority
trigger1 = anim = 182
value = -2


[state 182, Explod]
type = explod
trigger1 = anim = 182
trigger1 = !numexplod(1820)
anim = 1820
scale = const(size.xscale),const(size.yscale)
bindtime = -1
id = 1820
sprpriority = 2

[State 182, PosAdd]
type = PosAdd
trigger1 = Anim = 182
x = ceil(Enemy, P2Dist x - 25)

[State 182, VelSet]
type = VelSet
trigger1 = Anim = 182
x = 0

[state 182, velset]
type = velset
trigger1 = anim = 182
trigger1 = animelemtime(3) = 0
y = const(velocity.jump.y) * 0.3

[state 182, gravity]
type = gravity
trigger1 = anim = 182
trigger1 = animelemtime(3) > 0

[state 182, 182]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y 
value = 183


;---------------------------------------------------------------------------
;small hop
[statedef 183]
type = S
anim = 183
velset = 0,0

[State 184, Assert: RoundNotOver]
type = AssertSpecial
trigger1 = 1
flag = RoundNotOver

[state 183, posset]
type = posset
trigger1 = time = 0
y = 0

[state 182, remove]
type = removeexplod
trigger1 = time = 0
id = 1820

[state 182, Explod]
type = explod
trigger1 = anim = 183
trigger1 = !numexplod(1830)
anim = 1830
scale = const(size.xscale),const(size.yscale)
bindtime = -1
id = 1830
sprpriority = 2

;Facesit Portion
;Quakes
[state 20, earthquakes]
type = envshake
trigger1 = time = 0
time = 10
ampl = -8
freq = 100
phase = 100
persistent = 1

[state 20, sound1]
type = playsnd
trigger1 = time = 0
value = S1,2
volumescale = 50
persistent = 1


[state 182, velset]
type = velset
trigger1 = animelemtime(4) = 0
y = const(velocity.jump.y) * 0.5

[state 182, gravity]
type = gravity
trigger1 = animelemtime(4) > 0

[state 182, Landing]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y 
value = 184
;--------------------------------------------------------------------------- 
;Facesit: Landing 1
[statedef 184]
type = C
anim = 184
velset = 0,0

[state 184, Squeak]
type = playsnd
trigger1 = time = 0
value = 185,0


[State 184, Assert: RoundNotOver]
type = AssertSpecial
trigger1 = 1
flag = RoundNotOver

[state 183, pos y ]
type = posset
trigger1 = time = 0
y = 0

[state 182, removex]
type = removeexplod
trigger1 = time = 0
id = 1830

[state 182, Explod]
type = explod
trigger1 = time = 0
trigger1 = !numexplod(1840)
anim = 1840
scale = const(size.xscale),const(size.yscale)
bindtime = -1
id = 1840
sprpriority = 2

;Custom Dust
[state 183, explod]
type = explod
trigger1 = time = 0
anim = 2000
pos = 30,0
scale = const(size.xscale)*3,const(size.yscale)*2
ontop = 1
ownpal = 1

[state 183, fx]
type = explod
trigger1 = time = 0
anim = F61
pos = 0,0
scale = 6,3
ownpal = 1

[state 183, earthquakes]
type = envshake
trigger1 = time = 0
time = 12
ampl = -12
freq = 60
phase = 60


[state 183, explod]
type = explod
trigger1 = time = 0
anim = 2001
pos = 30,0
scale =  const(size.xscale)*3,const(size.yscale)*2
sprpriority = -4
ownpal = 1
; -------------------

[state 183, snd]
type = playsnd
trigger1 = time = 0
value =S1,1

[state 183, Bounce]
type = velset
trigger1 = time = 12
y = const(velocity.jump.y) * 0.3

[state 183, gravity]
type = gravity
trigger1 = time > 12

[state 183, end]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 185

;---------------------------------------------------------------------------
;Facesit: Landing 2
[statedef 185]
type = C
anim = 185
velset = 0,0

[state 182, removeX]
type = removeexplod
trigger1 = time = 0
id = 1840

[state 182, Explod]
type = explod
trigger1 = !numexplod(1850)
anim = 1850
scale = const(size.xscale),const(size.yscale)
bindtime = -1
id = 1850
sprpriority = 2

[state 185, announce]
type = playsnd
triggerall = teammode = single
trigger1 = time = 10
trigger1 = life != lifemax
value = S180,1

[state 185, announce]
type = playsnd
triggerall = teammode = single
trigger1 = time = 10
trigger1 = life = lifemax
value = S180,1

[State 184, Assert: RoundNotOver]
type = AssertSpecial
trigger1 = time < 180
flag = RoundNotOver

[state 184, posset]
type = posset
trigger1 = time = 0
y = 0

[state 183, earthquakes]
type = envshake
trigger1 = time = 0
time = 8
ampl = -8
freq = 60
phase = 60

[state 183, snd]
type = playsnd
trigger1 = time = 0
value =S1,1

[state 183, snd]
type = playsnd
trigger1 = time = 0
value =S1,1


;----------------------------------------------------------------------------
;Ottoman Landing 1
[statedef 187]
type = S
velset = 0,0
anim = 188
sprpriority = -2

[state 188, explod]
type = explod
trigger1 = time = 0
trigger1 = !numexplod(188)
anim = 2188
postype = p1
pos = 0,0
bindtime = -1
scale = const(size.xscale),const(size.yscale)
id = 188
sprpriority = 0

[state 187, posset]
type = posset
trigger1 = time = 0
y = 0

[State 185, Assert: RoundNotOver]
type = AssertSpecial
trigger1 = 1
flag = RoundNotOver

;Custom Dust
[state 651, explod]
type = explod
trigger1 = time = 0
anim = 2000
pos = 30,0
scale = const(size.xscale)*3,const(size.yscale)*2
ontop = 1
ownpal = 1

[state 651, fx]
type = explod
trigger1 = time = 0
anim = F61
pos = 0,0
scale = 6,3
ownpal = 1


[state 651, explod]
type = explod
trigger1 = time = 0
anim = 2001
pos = 30,0
scale =  const(size.xscale)*3,const(size.yscale)*2
sprpriority = -4
ownpal = 1
; -------------------

[state 651, snd]
type = playsnd
trigger1 = time = 0
value =S1,1

[state 651, vel]
type = velset
trigger1 = time = 0
y = 0
x = 0

[state 651, earthquakes]
type = envshake
trigger1 = time = 0
time = 12
ampl = -12
freq = 60
phase = 60

[state 188, bounce]
type = velset
trigger1 = time = 8
y = -6

[state 188, gravity]
type = gravity
trigger1 = time > 8

[state 188, end]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y 
value = 188

;----------------------------------------------------------------------------
;Ottoman Landing 2
[statedef 188]
type = S
velset = 0,0
anim = 189
sprpriority = -2

[state 188, explod]
type = explod
trigger1 = time = 0
trigger1 = !numexplod(189)
anim = 2189
postype = p1
pos = 0,0
bindtime = -1
scale = const(size.xscale),const(size.yscale)
id = 189
sprpriority = 0

[state 188, removeexplod]
type = removeexplod
trigger1 = time = 0
id = 188

[state 187, posset]
type = posset
trigger1 = time = 0
y = 0

[State 185, Assert: RoundNotOver]
type = AssertSpecial
trigger1 = time < 130
flag = RoundNotOver

[state 651, fx]
type = explod
trigger1 = time = 0
anim = F61
pos = 0,0
scale = 4,2
ownpal = 1

[state 651, snd]
type = playsnd
trigger1 = time = 0
value =S1,1

[state 651, vel]
type = velset
trigger1 = time = 0
y = 0
x = 0

[state 651, earthquakes]
type = envshake
trigger1 = time = 0
time = 8
ampl = -8
freq = 60
phase = 60

;---------------------------------------------------------------------------

; Introduction
; CNS difficulty: basic
[Statedef 191]
type = S
ctrl = 0
anim = 190
velset = 0,0

[state 191, beginning location marker]
type = helper
trigger1 = !numhelper(190)
stateno = 19000
id = 190
name = "Start Position"
postype = p1
pos = 0,0




[state 191, Reaction to Rapid on same team]
type = changestate
trigger1 = numpartner
trigger1 = partner,name = "Rapid Bunny"
value = 1910

[state 191, Reaction to Rapid]
type = changestate
triggerall = numenemy
trigger1 = enemy,name = "Rapid Bunny"
value = 1900



[state 191, version]
type = explod
trigger1 = time = 0
anim = ifelse(facing = -1,9101,9100)
scale = 0.5,0.5
postype = Back
pos = ifelse(facing =1, 20, 157),180 ; Nice!
ontop = 1

[State 191, 1] ;Freeze animation until PreIntro is over
type = ChangeAnim
trigger1 = RoundState = 0
value = 190

[state 191, snd]
type = playsnd
trigger1 = animelemtime(1) = 2
value = S190,0
volumescale = 25


[state 191, snd]
type = playsnd
trigger1 = animelemtime(6) = 0
value = S190,1

[state 191, bench]
type = explod
trigger1 = animelemtime(6) < 0
anim = 19000
id = 19000
pos = 0,0
postype = p1
removetime = -2
bindtime = -1
scale = const(size.xscale),const(size.yscale)
sprpriority  = -1

[state 191, bench]
type = removeexplod
trigger1 = animelemtime(6) = 0
id = 19000

[state 191, bench]
type = explod
trigger1 = animelemtime(6) = 0
anim = 19005
id = 19000
pos = 0,0
postype = p1
removetime = -2
bindtime = -1
scale = const(size.xscale),const(size.yscale)
sprpriority  = -1

[State 191, 2] ;Assert this until you want "round 1, fight" to begin
type = AssertSpecial
trigger1 = time < 180
flag = Intro

[State 191, 3] ;Change to stand state when done
type = ChangeState
trigger1 = AnimTime = 0
value = 0

;---------------------------------------------------------------------------
;Intro - butt smacked by rapid
[statedef 1900]
type = S
ctrl = 0
anim = 191

[State 191, 2] ;Assert this until you want "round 1, fight" to begin
type = AssertSpecial
trigger1 = time < 180
flag = Intro

[State 191, 3] ;Change to stand state when done
type = ChangeState
trigger1 = numenemy
trigger1 = enemy,stateno = 1901
trigger1 = enemy,name = "Rapid Bunny"
value = 1901


;---------------------------------------------------------------------------
; Hit
[statedef 1901]
type = S
anim = 192

[State 191, 2] ;Assert this until you want "round 1, fight" to begin
type = AssertSpecial
trigger1 = 1
flag = Intro

[state 191, end]
type = changestate
trigger1 = animtime = 0
value = 0


;---------------------------------------------------------------------------
;Intro - Buttrest with Rapid
[statedef 1910]
type = C
ctrl = 0
anim = 193
sprpriority = -1

[state 1910, posset]
type = posset
trigger1 = time = 0
x = ifelse(facing = 1, -120, 120)


[state 191, explod]
type = explod
trigger1 = time = 0
trigger1 = !numexplod(190)
id = 190
anim = 173
scale = const(size.xscale),const(size.yscale)
postype = p1
pos = 0,0
sprpriority = 2
removetime = -2

[State 191, 2] ;Assert this until you want "round 1, fight" to begin
type = AssertSpecial
trigger1 = 1
flag = Intro

[state 191, posadd]
type = posadd
triggerall = numhelper(190)
trigger1 = animelemtime(22) >= 0  && animtime < 0
x = floor((helper(190),pos x - pos x) / 8)*facing
persistent = 1

[state 191, posset]
type = posset
trigger1 = animtime = 0
x = helper(190),pos x

[state 191, playerpush]
type = playerpush
trigger1 = 1
value = 0

[state 191, end]
type = changestate
trigger1 = animtime = 0
value = 0

;----------------------------------------------------------------------------
;Start position helper
[statedef 19000]
type = S
ctrl = 0
anim = 9999
velset = 0,0

[state 19000, display]
type = displaytoclipboard
trigger1 = 1
text = "Pos x: %d"
params = pos x 


[state 19000, end]
type = destroyself
trigger1 = roundstate = 2


;---------------------------------------------------------------------------
; Taunt
; CNS difficulty: easy
[Statedef 195]
type = S
movetype = A
ctrl = 0
anim = 195
velset = 0,0
movetype = I
physics = S
sprpriority = 2

[state 195, power]
type = poweradd
trigger1 = time = 1
value = 100

[state 195, power]
type = poweradd
trigger1 = time = 69
value = 400

[state 195, statetypeset]
type = statetypeset
trigger1 = time = 11
movetype = I

[State 195, 2]
type = HitDef
trigger1 = animelem = 3  
attr = S, NA
animtype  = hard
damage    = 10
guardflag = MA
pausetime = 4,4
sparkno = 1
priority = 1,hit
getpower = 250
sparkxy = -40,-120
hitsound   = S1400,0
guardsound = S120, 0
ground.type = Low
ground.slidetime = 56
ground.hittime  = 56
guard.hittime = 8
ground.velocity = -35
guard.velocity = -8
air.velocity = -35,-5
forcenofall = 1

[State 195, 1]
type = CtrlSet
trigger1 = Time = 50
value = 1

[State 195, 2]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1


;---------------------------------------------------------------------------
; Stand Light Punch
; CNS difficulty: easy
[Statedef 200]
type    = S                      ;State-type: S-stand, C-crouch, A-air, L-liedown
movetype= A                      ;Move-type: A-attack, I-idle, H-gethit
physics = S                      ;Physics: S-stand, C-crouch, A-air                    ;Number of air juggle points move takes
velset = 0,0                     ;Set velocity (x,y) (Def: no change)
ctrl = 0                         ;Set ctrl (Def: no change)
anim = 200                       ;Change animation (Def: no change)
poweradd = 10                    ;Power to add (Def: 0)
sprpriority = 2                  ;Set p1's sprite layering priority to 2 (in front)

[State 200, 1]
type = HitDef
trigger1 = AnimElem = 3
attr = S, NA                     ;Attribute: Standing, Normal Attack
damage = 30               ;Damage that move inflicts, guard damage
animtype = medium              ;Animation type: Light, Medium, Heavy, Back (def: Light)
guardflag = MA                   ;Flags on how move is to be guarded against
hitflag = MAF                    ;Flags of conditions that move can hit
priority = 3, Hit                ;Attack priority: 0 (least) to 7 (most), 4 default
;Hit/Miss/Dodge type (Def: Hit)
pausetime = 8, 8                 ;Time attacker pauses, time opponent shakes
sparkno = 0                      ;Spark anim no (Def: set above)
sparkxy = -10, -155            ;X-offset for the "hit spark" rel. to p2,
;Y-offset for the spark rel. to p1
hitsound = S5000, 0                  ;Sound to play on hit
guardsound = S120, 0                ;Sound to play on guard
ground.type = High               ;Type: High, Low, Trip (def: Normal)
ground.slidetime = 8             ;Time that the opponent slides back
ground.hittime  = 16             ;Time opponent is in hit state
ground.velocity = -8            ;Velocity at which opponent is pushed
airguard.velocity = -3,-1     ;Guard velocity in air (def: (air.xvel*1.5, air.yvel/2))
air.type = High                  ;Type: High, Low, Trip (def: same as ground.type)
air.velocity = -4,-4           ;X-velocity at which opponent is pushed,
;Y-velocity at which opponent is pushed
air.hittime = 18              ;Time before opponent regains control in air
guard.velocity = -9             
guard.hittime = 15
guard.slidetime = 15
guard.dist = 270
fall.recovertime = 30

[State 200, 2]
type = PlaySnd
trigger1 = Time = 1
value = 0, 0

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -9
persistent = 0
ignorehitpause = 1

[state 20X, Not Active]
type = statetypeset
trigger1 = animelemtime(5) = 4
movetype = I


[State 200, 3]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
; Standing strong punch
; CNS difficulty: easy
; Note the width controller. It makes KFM's push box larger, so he doesn't
; stand so close to the opponent. Hit Ctrl-C and look at the red bar at his
; feet.
; The sprpriority for this state is at -1, instead of the usual 2 for
; attacks. This makes KFM appear behind the opponent initially.
; The SprPriority controller in [State 210, 4] brings KFM to the front when
; his arm has swung over.
; To stop KFM from pausing in his swing frame, there is a ChangeAnim in
; [State 210, 3] that detects if the hit has come in contact with the
; opponent during that frame, and switches to the next animation element
; (notice the elem=6 parameter). If you don't see what I mean, try commenting
; out that controller, then hit someone with this attack.
[Statedef 210]
type    = S
movetype= A
physics = S
poweradd= 70
ctrl = 0
velset = 0,0
anim = 210

[State 210, 1]
type = PlaySnd
trigger1 = animelemtime(5) = 0
value = S210, 0

[State 210, 2]
type = HitDef
trigger1 = !movecontact
attr = S, NA
animtype  = heavy
damage    = 90,9
guardflag = MA
hitflag = MAF
id = 210
pausetime = 14,14
guard.pausetime = 12, 12
sparkno = 2
sparkxy = -10,-140
hitsound   = S5000,2
guardsound = S120,0
ground.type = low
ground.slidetime = 24
ground.hittime  = 28
ground.velocity = -6
air.velocity = 0,15
fall = 0
air.fall = 1
down.bounce = 1
fall.yvelocity = -8
fall.xvelocity = -2
fall.recover = 0
guard.velocity = -8              
guard.hittime = 21
guard.slidetime = 21
airguard.hittime = 26
guard.slidetime = 18
envshake.freq = 60
envshake.ampl = 8
envshake.time = 10
guard.dist = 340
guard.kill = 0
fall.recovertime = 30 

[state 210, helper]
type = helper
trigger1 = animelemtime(6) = 0
pos = 0,0
postype = p1
stateno = 211
ID = 211

[state 210, ground bounce counter]
type = varadd
triggerall = numenemy
trigger1 = enemy,statetype = A
trigger1 = movehit
v = 8
value = -1
persistent = 0
ignorehitpause = 1

[state 210, target state]
type = targetstate
triggerall = var(8) > 0
trigger1 = enemy,statetype = A
trigger1 = movehit
value = 685
ignorehitpause = 1
persistent = 0

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = ifelse(enemy,statetype = A, -9,-3)
persistent = 0
ignorehitpause = 1

[state 21X, Not Active]
type = statetypeset
trigger1 = animelemtime(8) = 0
movetype = I

[State 210, 5]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;--------------------------------------------------------------------------
;Gag butt bump, standing behing Bertha durring her S. Fierce
[Statedef 211]
type = S
movetype = A
physics = S
anim = 211

[State 211, 2]
type = HitDef
trigger1 = !movecontact
id = 211
nochainid = 210
attr = S, NA
animtype  = back
damage    = 60
guardflag = HA
pausetime = 8,8
sparkno = 1
sparkxy = -10,-140
hitsound   = S240,0
guardsound = S120,0
ground.type = high
ground.slidetime = 12
ground.hittime  = 28
ground.velocity = 24,-6
air.velocity = 28,-6
fall = 1
fall.recover = 0

[state 211, nothitby]
type = nothitby
trigger1 = 1
value = SCA

[state 211, hitoverride]
type = hitoverride
trigger1 = 1
attr = SCA, AA,AP,AT
stateno = 212
time = 1

[state 211, destroyself]
type = destroyself
trigger1 = animtime = 0
trigger2 = time = 6
trigger3 = movereversed

;--------------------------------------------------------------------------
[statedef 212]
type = U
movetype = U
physics = U

[state 212, end]
type = destroyself
trigger1 = 1




;---------------------------------------------------------------------------
; Standing light kick
; CNS difficulty: easy
[Statedef 230]
type    = S
movetype= A
physics = S
poweradd= 11
ctrl = 0
velset = 0,0
anim = 230
sprpriority = 2

[State 230, 1]
type = PlaySnd
trigger1 = Time = 2
value = 0, 1

[State 230, 2]
type = HitDef
trigger1 = Time = 0
attr = S, NA
animtype  = Heavy
damage    = 32
guardflag = MA
pausetime = 10,10
sparkno = 0
sparkxy = -10,-70
hitsound   = S5000,0
guardsound = S120,0
ground.type = Low
ground.slidetime = 18
ground.hittime  = 18
ground.velocity = -8
air.velocity = -4,-1
guard.velocity = -9             
guard.hittime = 16
guard.slidetime = 16
guard.dist = 330
fall.recovertime = 20 

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -9
persistent = 0
ignorehitpause = 1

[state 23X, Not Active]
type = statetypeset
trigger1 = animelemtime(6) = 0
movetype = I

[State 230, 3]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
; Standing Medium kick
; CNS difficulty: easy
[Statedef 232]
type    = S
movetype= A
physics = S
poweradd= 25
ctrl = 0
velset = 0,0
sprpriority = 2


[state 240, animation]
type = changeanim
trigger1 = anim != 232
value = 232

[State 230, 1]
type = PlaySnd
trigger1 = Time = 2
value = 0, 1

[State 230, 2]
type = HitDef
trigger1 = animelem = 3
persistent = 0
attr = S, NA
animtype  = Heavy
damage    = 45
guardflag = MA
pausetime = 8,8
priority = 4, hit
id = 232
sparkno = 2
sparkxy = -10,-70
hitsound   = S5000,2
guardsound = S120,0
ground.type = Low
ground.slidetime = 24
ground.hittime  = 24
ground.velocity = 2
air.velocity = -12,-4
airguard.velocity = -2,-6
guard.velocity = 0             
guard.hittime = 20
guard.slidetime = 20
guard.dist = 640
fall.recovertime = 20
air.fall = 1

[state 230, veladd]
type = velset
trigger1 = animelemtime(3) > 0  && animelemtime(6) < 0
x = 16
persistent = 0

[state 230, envshake]
type = envshake
trigger1 = animelemtime(6) = 0
ampl = -8
time = 12

[state 230, footstep]
type = playsnd
trigger1 = animelemtime(6) = 0
value = S1,2

[state x, combo damage score]
type = varadd
trigger1 = movehit
v = 18
value = -6
persistent = 0
ignorehitpause = 1

[state 232, Not Active]
type = statetypeset
trigger1 = animelemtime(4) = 0
movetype = I

[state 230, continue?]
type = changestate
triggerall = animelemtime(6) > 0
trigger1 = !ailevel
trigger1 = command = "add on hip"
trigger2 = ailevel
trigger2 = random < ailevel * 24
value = 233
ignorehitpause = 1
persistent = 1


[State 230, 3]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1
;---------------------------------------------------------------------------
;Standing Hip Check 1 hit armor
[statedef 233]
type    = S
movetype= A
physics = S
poweradd= 25
ctrl = 0
velset = 0,0
sprpriority = 2

;===========
;Armor start
;===========
[state 233, animation]
type = changeanim
trigger1 = anim != 233
value = 233

[state 233, armor counter]
type = varset
trigger1 = time = 0
trigger1 = Var(21) = 1
V = 20
value = 1

[state 233, excess armor check]
type = varset
trigger1 = var(20) > 1
var(20) = 1
persistent = 1
ignorehitpause = 1

[state x, armor over]
type = varset
trigger1 = animelem = 4
v = 20
value = 0
ignorehitpause = 1

[state 233, armor intiator turn off]
type = varset
trigger1 = time = 1
V = 21
value = 0

;determine what frame
[state 233, remember frame]
type = varset
trigger1 = time <= 0
v = 22
value = animelemno(0)
ignorehitpause = 1

;delay effect
[state 233, delay]
type = changeanim 
trigger1 = var(31) < floor(gethitvar(hittime)*0.8)
value = anim
elem = var(22)

[state 233, freeze location]
type = posfreeze
trigger1 = var(31) < floor(gethitvar(hittime)*0.8)
value = 1
;--------------------------

[state 233, still take damage]
type = lifeadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) != 0
value = floor(-gethitvar(damage)*1)
persistent = 1

[state 233, armor count down]
type = varadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) > 0
V = 20
value = - 1
persistent = 1

[state 233, Unstoppable]
type = hitoverride
trigger1 = alive
trigger1 = Var(20) > 0
trigger1 = animelemtime(4) > 0
attr = SCA, AA, AP
stateno = 233
time = 1
persistent = 1

[State 1050, flash red]
type = PalFX
trigger1 = Time = 0
trigger1 = gethitvar(damage) != 0
time = 7
add = 100,0,0
IgnoreHitPause = 1

;------------------------------------------------------

[State 230, 1]
type = PlaySnd
trigger1 = Time = 2
value = 0, 1

[State 230, 2]
type = HitDef
trigger1 = animelemtime(3) >= 0 && animelemtime(4) < 0
persistent = 0
attr = S, NA
animtype  = Heavy
damage    = 70,7
guardflag = MA
pausetime = 8,8
sparkno = 0
id = 233
priority = 5, hit
sparkxy = -10,-70
hitsound   = S240,0
guardsound = S120,0
ground.type = high
ground.slidetime = 30
ground.hittime  = 30
air.hittime = 34
airguard.hittime = 25
ground.velocity = -30,0
air.velocity = -30,12
airguard.velocity = -4,-2
guard.velocity = -24        
guard.hittime = 12
guard.slidetime = 16
guard.dist = 640
fall.recovertime = 45
air.fall = 1
down.bounce = 1
fall.xvelocity = -10
fall.yvelocity = -12


[state 230, veladd]
type = velset
trigger1 = animelemtime(2) > 0  && animelemtime(4) < 0
x = 27
persistent = 0

[state 233, pushblock counter]
type = playerpush
trigger1 = animelemtime(2) > 0
value = 0
persistent = 0
ignorehitpause = 1

[State 20,  front foot]
type = MakeDust
trigger1 = animelemtime(2) > 0 && animelemtime(4) < 0
pos = 98, 0
spacing = 2

[State 20, Back foot]
type = MakeDust
trigger1 = animelemtime(2) > 0 && animelemtime(4) < 0
pos = -108, 0
spacing = 2


[state x, combo damage score]
type = varadd
trigger1 = movehit
v = 18
value = -6
persistent = 0
ignorehitpause = 1

[state 233, Not Active]
type = statetypeset
trigger1 = animelemtime(4) = 0
movetype = I

[State 233, 3]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1


;---------------------------------------------------------------------------
; Low Crush (Overhead)
[Statedef 235]
type    = A
movetype= A
physics = N
poweradd= 30
ctrl = 0
anim = 235
velset = 0,0
sprpriority = 2

[State X, Blink Yellow]
type = PalFX
trigger1 = time%2
trigger1 = time < 8
time = 1
add = 128,128,128 ;32,16,0
ignorehitpause

[state 235, velset]
type = velset
trigger1 = animelem = 3
y = -10
x = 9
persistent = 0

[state 235, width]
type = width
trigger1 = animelemtime(3) > 0
value = -100,-100
ignorehitpause = 1

[State 235, 2]
type = HitDef
trigger1 = vel y > 0
persistent = 0
attr = A, NA
animtype  = Heavy
damage    = 80,8
guardflag = HA
pausetime = 12,12
guard.pausetime = 8,8
sparkno = ifelse(enemy,movetype = A, 3,2)
sparkxy = -10,-70
hitsound   = S5000,ifelse(enemy,movetype = A,2,1)
guardsound = S120,0
ground.type = Low
ground.slidetime = 22
ground.hittime  = ifelse(enemy,movetype=A,26,22)
ground.velocity = -12
air.velocity = -8,2
guard.velocity = -42            
guard.hittime = 5
guard.slidetime = 5
guard.dist = 260
guard.kill = 0
fall.recovertime = 20 
guard.cornerpush.veloff = -60
airguard.cornerpush.veloff = -60

[state 235, gravity]
type = gravity
trigger1 = pos y < -1

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -3
persistent = 0
ignorehitpause = 1

[State 235, 3]
type = ChangeState
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 52

;---------------------------------------------------------------------------
; Standing strong kick - Hip check
; CNS difficulty: easy
[Statedef 240]
type    = S
movetype= A
physics = S
poweradd= 30
ctrl = 0
velset = 0,0
sprpriority = 2

[State 240, 1]
type = PlaySnd
trigger1 = Time = 16
value = 0, 1

;===========
;Armor start
;===========
[state 240, animation]
type = changeanim
trigger1 = anim != 240
value = 240

[state 240, armor counter]
type = varset
trigger1 = time = 0
trigger1 = Var(21) = 1
V = 20
value = 1

[state 240, excess armor check]
type = varset
trigger1 = var(20) > 1
var(20) = 1
persistent = 1
ignorehitpause = 1

[state x, armor over]
type = varset
trigger1 = animelem = 7
v = 20
value = 0
ignorehitpause 

[state 240, armor intiator turn off]
type = varset
trigger1 = time = 1
V = 21
value = 0

;determine what frame
[state 240, remember frame]
type = varset
trigger1 = time <= 0
v = 22
value = animelemno(0)
ignorehitpause = 1

;delay effect
[state 240, delay]
type = changeanim 
trigger1 = var(31) < floor(gethitvar(hittime)*1.1)
value = anim
elem = var(22)

[state 240, freeze location]
type = posfreeze
trigger1 = var(31) < floor(gethitvar(hittime)*1.1)
value = 1
;--------------------------

[state 240, still take damage]
type = lifeadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) != 0
value = floor(-gethitvar(damage)*1)
persistent = 1

[state 240, armor count down]
type = varadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) > 0
V = 20
value = - 1
persistent = 1

[state 240, Unstoppable]
type = hitoverride
trigger1 = Life > 1
trigger1 = Var(20) > 0
trigger1 = animelemtime(9) < 0
attr = SCA, AA, AP
stateno = 240
time = 1
persistent = 1

[State 1050, flash red]
type = PalFX
trigger1 = Time = 0
trigger1 = gethitvar(damage) != 0
time = 7
add = 100,0,0
IgnoreHitPause = 1


[State 240, 2]
type = HitDef
trigger1 = animelemno(0) = 5
trigger1 = !movecontact
attr = S, NA
animtype  = Heavy
damage    = 80,8
id = 240
nochainid = 240
guardflag = MA
pausetime = 14,14
sparkno = 2
sparkxy = -10,-140
hitsound   = S240,0
guardsound = S120,0
ground.type = High
ground.slidetime = 30
ground.hittime  = 30
air.hittime = 32
ground.velocity = -14
air.velocity = -6,-8
guard.velocity = -18              
guard.hittime = 24
guard.slidetime = 24
envshake.ampl = 6
envshake.time = 14
guard.kill = 0
guard.dist = 350
fall.recovertime = 45 

[state 240, count]
type = varadd
trigger1 = movecontact = 1
v = 5
value = -1

[state 240, changestate]
type = changestate
triggerall = animelemtime(9) < 0
trigger1 = movecontact = 1
trigger1 = command = "b"
trigger1 = var(5) > 0
value = 241

[state x, armor over]
type = varset
trigger1 = animelem = 8
v = 20
value = 0
ignorehitpause

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -6
persistent = 0
ignorehitpause = 1

[state 240, Not Active]
type = statetypeset
trigger1 = animelemtime(7) = 0
movetype = I

[state 240, slide]
type = velset
trigger1 = animelemtime(4) = 1
x = 20

[State 240, 4]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
; Additional Bumps
; CNS difficulty: easy
[Statedef 241]
type    = S
movetype= A
physics = S
poweradd= 30
ctrl = 0
anim = 240
velset = 0,0
sprpriority = 2

[state 241, anim]
type = changeanim
trigger1 = var(5) > 1
trigger1 = time = 0
value = 242

[state 241, anim]
type = changeanim
trigger1 = var(5) <= 1
trigger1 = time = 0
value = 241

[State 241, 1]
type = PlaySnd
trigger1 = Time = 2
value = 0, 1

[State 241, 2]
type = HitDef
trigger1 = Time = 0
trigger1 = var(5) != 1
attr = S, NA
animtype  = Heavy
damage    = 40,4
guardflag = MA
pausetime = 10,10
sparkno = 2
sparkxy = -10,-140
hitsound   = S240,0
guardsound = S120,0
ground.type = High
ground.slidetime = 26
ground.hittime  = 26
air.hittime = 30
ground.velocity = -12
air.velocity = -8,-12
guard.velocity = -18             
guard.hittime = 20
guard.slidetime = 20
envshake.freq = 60
envshake.ampl = 4
envshake.time = 15
fall = 0
guard.kill = 0
guard.dist = 350
fall.recovertime = 30 

[State 241, 2]
type = HitDef
trigger1 = Time = 0
trigger1 = var(5) = 1
attr = S, NA
animtype  = Heavy
damage    = 40,4
guardflag = MA
pausetime = 16,16
sparkno = 2
sparkxy = -10,-140
hitsound   = S240,0
guardsound = S120,0
ground.type = High
ground.slidetime = 12
ground.hittime  = 24
air.hittime = 28
ground.velocity = -22, -6
air.velocity = -22,-6
guard.velocity = -24              
guard.hittime = 22
guard.slidetime = 22
envshake.freq = 60
envshake.ampl = 4
envshake.time = 15
fall = 1
fall.recover = 1
fall.recovertime = 30
guard.kill = 0
guard.dist = 350


[state 241, count]
type = varadd
trigger1 = movecontact
v = 5
value = -1

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -9
persistent = 0
ignorehitpause = 1

[state 241, Not Active]
type = statetypeset
trigger1 = animelemtime(6) = 0
movetype = I

[state 241, changestate]
type = changestate
triggerall = animelemtime(8) < 0
trigger1 = movecontact
trigger1 = command = "b"
trigger1 = var(5) > 0
value = 241

[state 241, slide]
type = velset
trigger1 = animelem = 3
x = ifelse (var(5) > 1,10,16)

[State 241, 4]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1




;---------------------------------------------------------------------------
;Crouching light punch
; CNS difficulty: easy
; Description: Simple crouching attack. The HitDef's guardflag parameter
;     is set to "L", meaning that the move can only be guarded low
;     (crouching), and not by standing or jumping opponents.
;     Like for all light attacks, it's a good idea to keep the slidetime
;     and hittime parameters at a smaller number, so the opponent isn't
;     stunned for too long. For all crouching attacks you have to
;     remember to set the attr parameter to indicate that it is crouching
;     attack. In this case, "C, NA" stands for "crouching, normal attack".
;     The HitDef's priority is set at 3, instead of the default of 4,
;     so this attack has a lower priority than most others, meaning
;     KFM will get hit instead of trading hits with his opponent if
;     their attack collision boxes (Clsn1) intersect each other's Clsn2
;     boxes at the same time.
[Statedef 400]
type    = C
movetype= A
physics = C
poweradd= 8
ctrl = 0
anim = 400
sprpriority = 2

[State 400, 1]
type = PlaySnd
trigger1 = Time = 1
value = 0, 0

[State 400, 2]
type = HitDef
trigger1 = Time = 0
attr = C, NA
damage    = 30
priority  = 3
animtype  = Light
hitflag = MAF
guardflag = MA
pausetime = 10,10
sparkno = 0
sparkxy = -40,-160
hitsound   = S5000,0
guardsound = S120,0
ground.type = Low
ground.slidetime = 13
ground.hittime  = 13
ground.velocity = -6
air.velocity = -1.5,-3
guard.velocity = -8              
guard.hittime = 15
guard.slidetime = 15
guard.dist = 340
fall.recovertime = 20

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -9
persistent = 0
ignorehitpause = 1

[state 400, Not Active]
type = statetypeset
trigger1 = animelemtime(3) = 0
movetype = I

[State 400, 4]
type = ChangeState
trigger1 = AnimTime = 0
value = 11
ctrl = 1

;---------------------------------------------------------------------------
;Crouching strong punch
; CNS difficulty: easy
; Description: This is a 2-hit move. It is done by having two HitDefs
;     triggered, one for each frame of animation that hits.
;     Notice how the first hit cannot be guarded by an opponent in the
;     air, because of the "M" in the guardflag, meaning it can only
;     be guarded "middle". The second hit has an "MA" guardflag, so
;     it can be guarded both on the ground and in the air.
[Statedef 410]
type    = C
movetype= A
physics = C
poweradd= 25
ctrl = 0
anim = 410
sprpriority = 2

[State 410, 1]
type = PlaySnd
trigger1 = Time = 12
value = S210, 0

[state 410, spike check]
type = varset
trigger1 = movehit
v = 41
value = 0
ignorehitpause

;This is the first hit, triggered on the 3rd element of animation.
[State 410, 2]
type = HitDef
trigger1 = var(11) > 0
trigger1 = time = 0
attr = C, NA
damage    = 90
animtype  = up
hitflag = MAF
guardflag = MA
pausetime = 18,18
sparkno = 2
sparkxy = -40,-220
hitsound   = S5000,2
guardsound = S120,0
ground.type = Low
ground.slidetime = 12
ground.hittime  = 45
air.hittime = 45
ground.velocity = -1,-22
air.velocity = -1,-18
airguard.velocity = -6,-4
guard.velocity = -18              
guard.hittime = 18
guard.slidetime = 18
guard.dist = 325
fall.recovertime = 30

[State 410, 2]
type = HitDef
trigger1 = var(11) <= 0
trigger1 = time = 0
attr = C, NA
damage    = 90
animtype  = up
hitflag = MAF
guardflag = MA
pausetime = 12,12
sparkno = 2
sparkxy = -40,-220
hitsound   = S5000,2
guardsound = S120,0
ground.type = Low
ground.slidetime = 12
ground.hittime  = 45
air.hittime = 45
ground.velocity = -1,-3
air.velocity = -1,-3
airguard.velocity = -6,-4
guard.velocity = -6              
guard.hittime = 18
guard.slidetime = 18
fall = 1
fall.recover = 0
guard.dist = 325
fall.recovertime = 30

[state 410, 5]
type = changestate
triggerall = hitshakeover
triggerall = movehit
trigger1 = command = "holdup"
trigger1 = ailevel = 0
trigger2 = ailevel > 0
trigger2 = 1
value = 42
ctrl = 1



[state 410, launcher limiter]
type = varadd
trigger1 = movehit
v = 11
value = -1
ignorehitpause = 1

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = 3
persistent = 0
ignorehitpause = 1

[state 410, Not Active]
type = statetypeset
trigger1 = animelemtime(7) = 0
movetype = I

[State 410, 4]
type = ChangeState
trigger1 = AnimTime = 0
value = 11
ctrl = 1

;---------------------------------------------------------------------------
;Crouching light kick
; CNS difficulty: easy
[Statedef 430]
type    = C
movetype= A
physics = C
poweradd= 11
ctrl = 0
anim = 430
sprpriority = 2

[State 430, 1]
type = PlaySnd
trigger1 = Time = 1
value = 0, 0

[State 430, 2]
type = HitDef
trigger1 = Time = 0
attr = C, NA
damage    = 32
animtype  = Light
hitflag = MAFD
guardflag = LA
pausetime = 10,10
sparkno = 0
nochainid = 1400
sparkxy = -20,-60
hitsound   = S5000,1
guardsound = S120,0
ground.type = Low
ground.slidetime = 14
ground.hittime  = 20
ground.velocity = -5
air.velocity = -2,-3
down.velocity = -7,0
down.hittime = 22
guard.velocity = -6              
guard.hittime = 15
guard.slidetime = 15
guard.dist = 360
fall.recovertime = 20

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -9
persistent = 0
ignorehitpause = 1

[state 430, Not Active]
type = statetypeset
trigger1 = animelemtime(4) = 0
movetype = I

[State 430, 3]
type = ChangeState
trigger1 = AnimTime = 0
value = 11
ctrl = 1

;---------------------------------------------------------------------------
;Crouch Strong Kick
; CNS difficulty: easy
; Description: This move uses "Trip" for the "ground.type" parameter in
;     its HitDef. It's a special type that puts the opponent in a tripped
;     animation as he falls. Also, the hitflag parameter in the HitDef
;     is set to "MAFD". The "D" indicates that a downed opponent can be
;     hit by the attack.
[Statedef 440]
type    = C
movetype= A
physics = N
ctrl = 0
velset = 0,0
;anim = 440
sprpriority = 2

;===========
;Armor start
;===========
[state 240, animation]
type = changeanim
trigger1 = anim != 440
value = 440

[state 440, poweradd]
type = poweradd
trigger1 = prevstateno != 440
trigger1 = time = 0
value = 60

[state 240, armor counter]
type = varset
trigger1 = time = 0
trigger1 = Var(21) = 1
V = 20
value = 1

[state 1000, excess armor check]
type = varset
trigger1 = var(20) > 1
var(20) = 1
persistent = 1
ignorehitpause = 1

[state x, armor over]
type = varset
trigger1 = animelem = 7
v = 20
value = 0
ignorehitpause 

[state 240, armor intiator turn off]
type = varset
trigger1 = time = 1
V = 21
value = 0

;determine what frame
[state 240, remember frame]
type = varset
trigger1 = time <= 0
v = 22
value = animelemno(0)
ignorehitpause = 1

;delay effect
[state 240, delay]
type = changeanim 
trigger1 = var(31) < ifelse(animelemtime(4) > 0, floor(gethitvar(hittime)*0.2),floor(gethitvar(hittime)*0.9))
value = anim
elem = var(22)

[state 240, freeze location]
type = posfreeze
trigger1 = var(31) < ifelse(animelemtime(4) > 0, floor(gethitvar(hittime)*0.2),floor(gethitvar(hittime)*0.9))
value = 1
;--------------------------

[state 240, still take damage]
type = lifeadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) != 0
value = floor(-gethitvar(damage)*1)
persistent = 1

[state 240, armor count down]
type = varadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) > 0
V = 20
value = - 1
persistent = 1

[state 240, Unstoppable]
type = hitoverride
trigger1 = Life > 1
trigger1 = Var(20) > 0
attr = SCA, AA, AP
stateno = 440
time = 1
persistent = 1

[State 1050, flash red]
type = PalFX
trigger1 = Time = 0
trigger1 = gethitvar(damage) != 0
time = 7
add = 100,0,0
IgnoreHitPause = 1

[state 440, velset]
type = velset
trigger1 = time > 8 
x = 7

[State 440, 2]
type = PlaySnd
trigger1 = Time = 2
value = 0, 0

[state 440, jump]
type = velset
trigger1 = animelemtime(4) = 0
x = 20
y = -3

[state 440, gravity]
type = gravity
trigger1 = animelemtime(4) > 0

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -3
persistent = 0
ignorehitpause = 1

[State 440, 4]
type = ChangeState
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 441
;--------------------------------------------------------------------------
[statedef 441]
type = C
movetype = A
physics = C
anim = 441

[state 441, posadd]
type = posadd
trigger1 = time = 0
x = 20

[state 441, velset]
type = velset
trigger1 = time = 0
x = 0
y = 0

[state 441, velset]
type = posset
trigger1 = time = 0
y = 0

[state 641, fx]
type = explod
trigger1 = time = 0
anim = F61
pos = 0,0
scale = 4,3
ownpal = 1

[state 441, earthquakes]
type = envshake
trigger1 = time  = 0
time = 12
ampl = -10
freq = 75
phase = 75
persistent = 0

[state 441, snd]
type = playsnd
trigger1 = time = 0
value = S1,1
persistent = 0

[State 4410, 3]
type = HitDef
trigger1 = animelem = 1
persistent =0
attr = C, NA
damage    = 120
hitflag = D
guardflag = 
nochainid = 1400
pausetime = 12,12
sparkno = -1
sparkxy = -5,-10
hitsound   = S5000,1
guardsound = S120, 0
ground.type = Trip
p2stateno = 660
ground.slidetime = 10
ground.hittime  = 17
ground.velocity = 0,0
air.velocity = 0,0
guard.velocity = -5
fall.recovertime = 45

[State 441, 3]
type = HitDef
trigger1 = animelem = 2
persistent = 0
attr = C, NA
damage    = ifelse(p2statetype = L,60,ifelse(p2statetype = A, 50, 100))
hitflag = MAFD
guardflag = L
id = 440
nochainid = 440,800
pausetime = 12,12
sparkno = 2
sparkxy = -20,-50
hitsound   = S5000,2
guardsound = S120,0
ground.type = Trip
ground.slidetime = 30
ground.hittime  = 30
ground.velocity = -2,-14
air.velocity = -2,-12
down.velocity = -6,0
guard.velocity = -14              
guard.hittime = 30 ;-14  Terrible Recovery; High Risk, leads to super, armored
guard.slidetime = 30
fall = 1
fall.recover = 0
guard.dist = 580
fall.recovertime = 45
down.hittime = 33

[state 441, Not Active]
type = statetypeset
trigger1 = animelemtime(3) = 0
movetype = I


[state 441, end]
type = changestate
trigger1 = animtime = 0
value = 442

;---------------------------------------------------------------------------
;Get up
[statedef 442]
type = C
movetype = I
physics = C
velset = 0,0
ctrl = 0

[state 442, anim]
type = changeanim
trigger1 = time = 0
value = 442

[state 442, end]
type = changestate
trigger1 = animtime = 0
ctrl = 1
value = 11

;---------------------------------------------------------------------------
;Jump Light Punch
; CNS difficulty: easy
[Statedef 600]
type    = A
movetype= A
physics = A
poweradd= 20
ctrl = 0
anim = 600
sprpriority = 2

[State 600, 1]
type = PlaySnd
trigger1 = Time = 1
value = 0, 0

[State 600, 2]
type = HitDef
trigger1 = Time = 0
attr = A, NA
damage    = 22
guardflag = HA
hitflag = MAF
priority = 3
pausetime = 8,8
sparkno = 0
sparkxy = -10,-180
hitsound   = S5000,0
guardsound = S120,0
ground.type = High
ground.slidetime = 5
ground.hittime  = 16
ground.velocity = -4
air.velocity = -1,-4
air.hittime = 12
guard.velocity = -5             
guard.hittime = 15
guard.slidetime = 15
airguard.velocity = -6,-4
airguard.hittime = 16
guard.dist = 320
fall.recovertime = 20



[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -9
persistent = 0
ignorehitpause = 1

[state 600, Not Active]
type = statetypeset
trigger1 = animelemtime(3) = 0
movetype = I

[state 600, end]
type = changestate
trigger1 = animtime = 0
value = 50
ctrl = 1

;---------------------------------------------------------------------------
;Jump Strong Punch
; CNS difficulty: easy
[Statedef 610]
type    = A
movetype= A
physics = A
poweradd= 30
ctrl = 0
anim = 610
sprpriority = 2

[state 610, jump combo infinite check]
type = varadd
trigger1 = movehit
trigger1 = enemy,statetype != A
v = 29
value = 1
ignorehitpause = 1
persistent = 0

[State 610, 2]
type = PlaySnd
trigger1 = Time = 8
value = S210, 0

[state 610, width]
type = width
trigger1 = animelem = 1
trigger2 = animelem = 2
value = -150,-50

[state 610, width]
type = width
trigger1 = animelem = 3
trigger2 = animelem = 4
value = -100,-50

[State 610, 3]
type = HitDef
trigger1 = Time = 0
trigger1 = numenemy
attr = A, NA
damage = 85
guardflag = HA
hitflag = MAF
priority = 4
pausetime = 14,14
sparkno = 2
sparkxy = -20,-55
hitsound   = S5000,2
guardsound = S120,0
animtype = Med
ground.type = High
ground.slidetime = 12
ground.hittime  =  floor(24/var(29))
air.hittime = 24
ground.velocity = -12
air.velocity = -2,35;-floor(p2dist x / (enemynear,pos y / 28)),35;ifelse(var(41)=1,2.5,-8),35
envshake.freq = 60
envshake.ampl = 8
envshake.time = 10
guard.velocity = -14             
guard.hittime = 19
guard.slidetime = 19
airguard.velocity = -12,10
airguard.hittime = 20
air.fall = 1
down.bounce = ifelse(var(41)=1,0,1)
fall.recover = ifelse(var(41)=1,0,1)
fall.recovertime = 25
fall.yvelocity = -18
fall.xvelocity = 0
guard.dist = 380
fall.recovertime = 40


[state 610, bounce on hit]
type = velset
trigger1 = movehit
trigger1 = enemy, statetype = A
y = -10
persistent = 0

;[state 610, targetstate]
;type = targetstate
;trigger1 = movehit && hitpausetime = 11
;trigger1 = enemy,statetype = A
;trigger1 = var(8) > 0
;ignorehitpause = 1
;value = 680

[state 610, limiter]
type = varadd
trigger1 = movehit
trigger1 = enemy,statetype = A
var(8) = -1
ignorehitpause = 1
persistent = 0

[state 610, combo damage]
type = varadd
trigger1 = time = 0
v = 18
value = -3

[state 610, Not Active]
type = statetypeset
trigger1 = animelemtime(5) = 0
movetype = I

[state 610, end]
type = changestate
trigger1 = animtime = 0
value = 50
ctrl = 1

;---------------------------------------------------------------------------
;Jumping Chomp
; CNS difficulty: easy
[Statedef 620]
type    = A
movetype= A
physics = A
poweradd= 30
ctrl = 0
anim = 620
sprpriority = 2

[State 620, 3]
type = HitDef
trigger1 = animelem = 5
persistent = 2
attr = A, NA
damage = ifelse(!movecontact,150,1),ifelse(!movecontact,30,1)
guardflag = HA
hitflag = MAF
priority = 4
pausetime = 18,18
sparkno = 3
sparkxy = -20,-55
hitsound   = F5,4
guardsound = S120,0
animtype = Med
ground.type = High
ground.slidetime = 12
ground.hittime  = floor(24/var(29))
air.hittime = 24
ground.velocity = -2,-12
air.velocity = -2,-12;-floor(p2dist x / (enemynear,pos y / 28)),35;ifelse(var(41)=1,2.5,-8),35
envshake.freq = 60
envshake.phase = 60
envshake.ampl = 16
envshake.time = 18
guard.velocity = -14             
guard.hittime = 19
guard.slidetime = 19
airguard.velocity = -12,10
airguard.hittime = 20
guard.dist = 380
guard.kill = 0
fall = ifelse(var(13) > 1, 0, 1)

[state 620, playsnd]
type = playsnd
trigger1 = animelemtime(5) = 0
value = S620,0


[state 620, targetstate]
type = targetstate
trigger1 = movehit && hitpausetime = 17
trigger1 = var(13) > 1
ignorehitpause = 1
value = 690

[state 620, stun limiter]
type = varadd
trigger1 = movehit
var(13) = -1
ignorehitpause 
persistent = 0

[state 620, combo damage]
type = varadd
trigger1 = time = 0
v = 18
value = -3

[state 620, Not Active]
type = statetypeset
trigger1 = animelemtime(6) = 0
movetype = I

[state 620, end]
type = changestate
trigger1 = animtime = 0
value = 50
ctrl = 1



;---------------------------------------------------------------------------
;Jump Light Kick
; CNS difficulty: easy
[Statedef 630]
type    = A
movetype= A
physics = A
poweradd= 10
ctrl = 0
anim = 630
sprpriority = 2

[State 630, 1]
type = PlaySnd
trigger1 = Time = 1
value = 0, 0

[State 630, 2]
type = HitDef
trigger1 = Time = 0
attr = A, NA
damage = 30
guardflag = HA
hitflag = MAF
priority = 3
pausetime = 8,8
sparkno = 1
sparkxy = -5,-40
hitsound   = S5000,0
guardsound = S120,0
animtype = medium
ground.type = High
ground.slidetime =18
ground.hittime  = 18
ground.velocity = -4
air.velocity = -4,-4
air.hittime = 18
guard.velocity = -6            
guard.hittime = 14
guard.slidetime = 14
airguard.velocity = -6,-4
airguard.hittime = 15
guard.dist = 320
fall.recovertime = 20


[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -9
persistent = 0
ignorehitpause = 1

[state 630, Not Active]
type = statetypeset
trigger1 = animelemtime(3) = 0
movetype = I

[state 630, end]
type = changestate
trigger1 = animtime = 0
value = 50
ctrl = 1

;---------------------------------------------------------------------------
;Jump Strong Kick
; CNS difficulty: easy
[Statedef 640]
type    = A
movetype= A
physics = A
poweradd= 30
ctrl = 0
anim = 640
sprpriority = 2

[State 640, 2]
type = PlaySnd
trigger1 = Time = 10
value = 0, 1

[state 640, width]
type = width
trigger1 = animelemtime(2) > 0
value = -100,-100
ignorehitpause = 1

[state 611, jump combo infinite check]
type = varadd
trigger1 = movehit = 1
trigger1 = enemy,statetype != A
v = 29
value = 1
ignorehitpause = 1
persistent = 0

[State 640, 3]
type = HitDef
trigger1 = animelem = 3
persistent = 0
attr = A, NA
damage    = 90
guardflag = HA
id = 640
hitflag = MAF
priority = 4
pausetime = 14,14
sparkno = 3
sparkxy = -20,-60
hitsound   = S5000,2
guardsound = S120,0
animtype = heavy
ground.type = high
ground.slidetime = 22
ground.hittime  = floor(22/var(29))
ground.velocity = -12
air.velocity = -36,60
air.fall = 1
fall.recover = 1
fall.recovertime = 30
envshake.freq = 60
envshake.ampl = 8
envshake.time = 12
guard.velocity = -13            
guard.hittime = 18
guard.slidetime = 18
airguard.velocity = -13,10
airguard.hittime = 18

guard.dist = 280
fall.recovertime = 40

[state 640, counter]
type = varadd
trigger1 = movehit
trigger1 = enemy,statetype = A
trigger1 = !numtarget(641)
var(8) = -1
persistent = 0
ignorehitpause = 1

[state 640, bounce]
type = targetstate
trigger1 = movehit
trigger1 = enemy,statetype = A
trigger1 = NumTarget(640)
trigger1 = hitpausetime = 13
trigger1 = var(8) > 0
ignorehitpause = 1
value = 685
id = 640



[State 640, 3]
type = HitDef
trigger1 = animelem = 5
trigger1 = !movecontact
persistent = 0
attr = A, NA
damage    = 50
guardflag = HA
hitflag = MA
priority = 4
id = 641
pausetime = 6,6
sparkno = 2
sparkxy = -10,-40
hitsound   = S5000,2
guardsound = S120,0
animtype = heavy
ground.type = low
ground.slidetime = 26
ground.hittime  = floor(26/var(29))
ground.velocity = -8
air.velocity = 0,4
fall = 0
guard.velocity = -9             
guard.hittime = 17
guard.slidetime = 17
airguard.velocity = -9,5
airguard.hittime = 14
guard.dist = 280
fall.recovertime = 40


[state 640, combo damage]
type = varadd
trigger1 = movehit =1
trigger1 = enemy,statetype = A
trigger1 = NumTarget(640)
V = 18
value = -9
persistent = 0
ignorehitpause = 1

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
trigger1 = enemy,statetype != A
v = 18
value = -3
persistent = 0
ignorehitpause = 1

[state 640, end]
type = changestate
trigger1 = animtime = 0
value = 50
ctrl = 1

;---------------------------------------------------------------------------
;Butt Drop
[statedef 650]
type    = A
movetype= A
physics = N
poweradd= 50
ctrl = 0
sprpriority = 2

[state 42, explod]
type = explod
trigger1 = animelemtime(2) = 0
bindtime = -1
anim = 8040
scale = 0.5,-1.5
id = 8040
postype = p1
pos = 10,-90
removeongethit = 1


[state 650, animation]
type = changeanim
trigger1 = anim != 650
value = 650

[state 650, armor counter]
type = varset
trigger1 = time = 0
trigger1 = Var(21) = 1
V = 20
value = 2

[state 240, armor intiator turn off]
type = varset
trigger1 = time = 1
V = 21
value = 0

;=================================
;-      Damage Set
;=================================

;Out of Range even more, Max damage
[state 650, damage set]
type = varset
trigger1 = ceil(pos y) <= -800 
trigger1 = time = 0
var(14) = 1300


;Out of Range
[state 650, damage set]
type = varset
trigger1 = ceil(pos y) <= -500 && ceil(pos y) > -800
trigger1 = time = 0
var(14) = 480

; Peak Super Jump
[state 650, damage set]
type = varset
trigger1 = ceil(pos y) <= -340 && ceil(pos y) > -500
trigger1 = time = 0
var(14) = 240

; Super Jump
[state 650, damage set]
type = varset
trigger1 = ceil(pos y) <= -220 && ceil(pos y) > -340
trigger1 = time = 0
var(14) = 220

; Peak Normal Jump
[state 650, damage set]
type = varset
trigger1 = ceil(pos y) <= -160 && ceil(pos y) > -220
trigger1 = time = 0
var(14) = 200


; small Normal Jump
[state 650, damage set]
type = varset
trigger1 = ceil(pos y) <= 0 && ceil(pos y) > -160
trigger1 = time = 0
var(14) = 180

;-----------------------

[state 640, armor count down]
type = varadd
trigger1 = gethitvar(damage) != 0
V = 20
value = -1
persistent = 1

[state 650, still take damage]
type = lifeadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) != 0
value = floor(-gethitvar(damage)*0.5)
persistent = 1
ignorehitpause

[state 650, Unstoppable]
type = hitoverride
trigger1 = Life > 1
trigger1 = var(20) > 0
attr = SCA, AA, AP
stateno = 650
time = 1
persistent = 1
ignorehitpause

;[State -2, Super Jump Indicator]
;type = helper
;triggerall = !numhelper(4000)
;name = "WARNING"
;helpertype = normal
;trigger1 = time = 0
;trigger1 = pos y < -220
;persistent = 0
;stateno = 4000
;ID = 4000
;ownpal = 1

[state 650, vel x stop]
type = velset
trigger1 = time = 0
trigger1 = prevstateno = 1070 || prevstateno = 1060
x = 0

[State 650, flash red]
type = PalFX
trigger1 = Time = 0
trigger1 = gethitvar(damage) != 0
time = 7
add = 150,0,0
IgnoreHitPause = 1

[State 650, 3]
type = HitDef
trigger1 = vel y > 0
trigger1 = !movecontact || !movereversed
persistent = 0
attr = A, SA
damage    = ifelse(enemy,movetype = H,floor(var(14)*0.75),var(14)) ,floor(Var(14)*0.3)
guardflag = MA
hitflag = MAFD
getpower = floor(var(14) * 0.75)
givepower = floor(var(14))
id = 650
nochainid = 650,800
priority = 4
pausetime = 0,0
sparkno = 3
sparkxy = 0,0
hitsound   = S240,0
guardsound = S120,0
animtype = heavy
ground.type = high
ground.slidetime = 22
ground.hittime  = 22
ground.velocity = 0
air.velocity = 0,0
down.hittime = 60
guard.velocity = -45            
guard.hittime = 42
guard.slidetime = 42
airguard.velocity = -28,10
airguard.hittime = 35
guard.dist = 320

[state 650, slow]
type = velmul
trigger1 = time = 1
x = 0.9
y = 0
persistent = 0
ignorehitpause = 1

;determine what frame
[state 650, remember frame]
type = varset
trigger1 = time <= 0
v = 22
value = animelemno(0)
ignorehitpause = 1

;delay effect
[state 650, delay]
type = changeanim 
trigger1 = var(31) < floor(gethitvar(hittime)*1.1)
value = anim
elem = var(22)

[state 650, freeze location]
type = posfreeze
trigger1 = var(31) < floor(gethitvar(hittime)*1.1)
value = 1
;--------------------------

[state 650, enemy state]
type = targetstate
triggerall = vel y > 0
trigger1 = movehit
trigger1 = enemy,statetype != A
value = 660

;Ride down mechanic
[state 650, Ride down]
type = targetbind
trigger1 = movehit
trigger1 = enemy,statetype = A
pos = 0, -20

[state 650, state of ride down]
type = targetstate
trigger1 = movehit
trigger1 = enemy,statetype = A
value = 655
;----------------------------------------------

;[state 650, targetstate]
;type = targetstate
;trigger1 = movehit
;trigger1 = enemy,statetype = A
;trigger1 = var(8) > 0
;trigger1 = p2bodydist x >= 30
;trigger2 = movehit
;trigger2 = enemy,statetype != A
;trigger2 = var(8) > 0
;trigger2 = p2bodydist x>= 30
;ignorehitpause = 1
;value = 685

[state 650, limiter]
type = varadd
trigger1 = movehit
trigger1 = enemy,statetype = A
trigger1 = p2bodydist x >= 30
var(8) = -1
ignorehitpause = 1
persistent = 0

[state 650, fast fall]
type = veladd
trigger1 = animelemtime(3) = 0
y = 30

[state 650, aim]
type = veladd
trigger1 = animelemtime(3) = 0
trigger1 = command = "holdfwd"
trigger1 = ailevel = 0
x = 0.2

[state 650, aim]
type = veladd
trigger1 = animelemtime(3) = 0
trigger1 = command = "holdback"
trigger1 = ailevel = 0
x = -0.2

[state 650, gravity]
type = gravity
trigger1 = animelemtime(3) > 0

[state 650, playerpush]
type = playerpush
trigger1 = 1
value = 0

[state 650, combo damage]
type = varadd
trigger1 = time = 0
v = 18
value = -9

[state 650, end]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 651

;--------------------------------------------------------------------------
; 1st Landing
[statedef 651]
type    = C
movetype= A
physics = N
poweradd= 30

[state 651, removeexplod]
type = removeexplod
trigger1 = time = 0
id = 8040

[state 651, anim]
type = changeanim
trigger1 = time = 0
value = 651

;Custom Dust
[state 651, explod]
type = explod
trigger1 = time = 0
anim = 2000
pos = 30,0
scale = const(size.xscale)*3,const(size.yscale)*2
ontop = 1
ownpal = 1

[state 651, fx]
type = explod
trigger1 = time = 0
anim = F61
pos = 0,0
scale = 6,3
ownpal = 1


[state 651, explod]
type = explod
trigger1 = time = 0
anim = 2001
pos = 30,0
scale =  const(size.xscale)*3,const(size.yscale)*2
sprpriority = -4
ownpal = 1
; -------------------

[state 651, snd]
type = playsnd
trigger1 = time = 0
value =S1,1

[state 651, snd]
type = playsnd
trigger1 = time = 0
value =S1,1

[state 651, pos]
type = posset
trigger1 = time = 0
y = 0

[state 651, playerpush]
type = playerpush
trigger1 = 1
value = 0

[State 651, 3]
type = HitDef
trigger1 = Time = 0
attr = A, NA
damage    = var(14) 
guardflag = 
hitflag = FD
priority = 4
nochainid = 1400
pausetime = 12,12
sparkno = 1
sparkxy = -10,-40
hitsound   = S240,0
guardsound = S120,0
animtype = Med
p2stateno = 660
ground.type = High
ground.slidetime = 12
ground.hittime  = 15
ground.velocity = 0
air.velocity = 0,0

[state 651, vel]
type = velset
trigger1 = time = 0
y = 0
x = 0

[state 651, earthquakes]
type = envshake
trigger1 = time = 0
trigger1 = var(14) < 200 
time = 24
ampl = -24
freq = 60
phase = 60

[state 651, earthquakes]
type = envshake
trigger1 = time = 0
trigger1 = var(14) >= 200 
time = 48
ampl = -32
freq = 75
phase = 75


[state 651, end]
type = changestate
trigger1 = animtime = 0
value = 652

;--------------------------------------------------------------------------
;Bounce
[statedef 652]
type    = A
movetype= I
physics = N

[state 652, anim]
type = changeanim
trigger1 = time = 0
value = 652

[state 652, playerpush]
type = playerpush
trigger1 = 1
value = 0


[state 652, velset]
type = velset
trigger1 = time = 0
y = -8

[state 652, gravity]
type = gravity
trigger1 = time > 2

[state 652, end]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 653

;--------------------------------------------------------------------------
;Landing Rest
[statedef 653]
type    = C
movetype= I
physics = N

[state 653, anim]
type = changeanim
trigger1 = time = 0
value = 653

[state 653, posset]
type = posset
trigger1 = time = 0
y = 0

[state 653, playerpush]
type = playerpush
trigger1 = 1
value = 0


[state 653, velset]
type = velset
trigger1 = time = 0
y = 0
x = 0

[state 653, snd]
type = playsnd
trigger1 = time = 0
value =S1,1

[state 653, earthquakes]
type = envshake
trigger1 = time = 0
time = 15
ampl = 12
freq = 100
phase = 100

[state 653, end]
type = changestate
trigger1 = animtime = 0
value = 656


;---------------------------------------------------------------------------
;Rode down
[statedef 654]
type = A
movetype = H
physics = N

[state 654, anim]
type = changeanim2
trigger1 = time = 0
value = 655

[State 655, 2]
type = changeState
trigger1 = !gethitvar(isbound)
value = 663

;---------------------------------------------------------------------------
;Rode down
[statedef 655]
type = A
movetype = H
physics = N

[state 655, anim]
type = changeanim2
trigger1 = time = 0
value = 655

[State 655, 2]
type = changeState
trigger1 = !gethitvar(isbound)
value = 660


;-----------| Butt recovery |----------------------------------------------
;Face forward recovery
[statedef 656]
type = C
movetype = I
physics = C
velset = 0,0

[state 656, player push]
type = playerpush
trigger1 = 1
value = 0


[state 656, anim]
type = changeanim
trigger1 = time = 0
value = 656

[state 656, velset]
type = velset
trigger1 = animelemtime(1)>= 0 && animelemtime(4) < 0
x = 4

[state 656, velset]
type = velset
trigger1 = animelem = 4
x = 0

[state 656, change]
type = statetypeset
trigger1 = time = 30
statetype = C

[state 656, change]
type = statetypeset
trigger1 = time = 34
statetype = S

[state 656, velset]
type = velset
trigger1 = animelemtime(10)>= 0 && animelemtime(11) < 6
x = -18


;[state 656, velset]
;type = velset
;trigger1 = animelem = 10
;trigger2 = animelem = 11
;x = -10

[state 656, end]
type = changestate
trigger1 = animtime = 0
ctrl = 1
value = 0

;-------| Facing Away|-------------------------------------------------------

[statedef 657]
type = C
movetype = I
physics = C
velset = 0,0
movehitpersist = 1

[state 657, player push]
type = playerpush
trigger1 = 1
value = 0

[state 657, anim]
type = changeanim
trigger1 = time = 0
value = 657

[state 656, change]
type = statetypeset
trigger1 = time = 0
statetype = C

[state 656, change]
type = statetypeset
trigger1 = animelemtime(7) = 0
statetype = S


[state 656, velset]
type = velset
trigger1 = animelem = 7
trigger2 = animelem = 8
x = -20

[state 656, end]
type = changestate
trigger1 = animtime = 0
ctrl = 1
value = 0
;--------------|Super version|---------------------------------------------
[statedef 658]
type = C
movetype = I
physics = C
velset = 0,0
sprpriority = 2

[state 658, player push]
type = playerpush
trigger1 = 1
value = 0

[state 658, nothitby]
type = nothitby
trigger1 = numtarget(3000)
trigger1 = target(3000),stateno = [3010,3022]
value = SCA


[state 658, anim]
type = changeanim
trigger1 = time = 0
value = 658

[state 658, explod]
type = explod
trigger1 = time = 0
anim = 659
sprpriority = -2
bindtime = -1
id = 658
ignorehitpause = 0
scale =  Const(size.xscale),Const(size.yscale)
removetime = -2

[state 656, change]
type = statetypeset
trigger1 = animelemtime(5) = 0
statetype = S

[state 656, removeexplod]
type = removeexplod
trigger1 = animtime = 0
id = 658

[state 656, velset]
type = velset
trigger1 = animelem = 5
x = -20

[state 656, end]
type = changestate
trigger1 = animtime = 0
ctrl = 1
value = 0





;===========================================================================
;---------------------------Crushed State-----------------------------------
;===========================================================================
; Moderate Crushed State
[statedef 660]
type    = L
movetype= H
physics = N
ctrl = 0
velset = 0,0

[state 660, 1]
type = changeanim
trigger1 = time = 0
value = 5110

[State 660, flatten]
type = AngleDraw
trigger1 = time > 0
value = 0
scale = 1.3,0.1

[state 660, on ground]
type = posset
trigger1 = 1
y = 0

[state 660, passthrough]
type = playerpush
trigger1 = 1
value = 0
time = 600

[State 660, Width]
type = Width
trigger1 = time > 0
value = 0,0

[state 660, invunerable]
type = nothitby
trigger1 = 1
value = SCA


[State 660, 1] ;For hit up/up-diag type (from state 5081)
type = ChangeAnim
persistent = 0
trigger1 = SelfAnimExist(5110 + (anim % 10))
trigger1 = anim = [5081,5089]
value = 5110 + (anim % 10)

[State 660, 2] ;Hit ground anim (normal)
type = ChangeAnim
triggerall = time = 0
triggerall = anim != [5110,5119] ;Not already changed anim
trigger1 = anim != [5161,5169]
trigger2 = !SelfAnimExist(5170 + (anim % 10))
value = 5170

[State 660, 3] ;Hit ground anim (for hit up)
type = ChangeAnim
triggerall = time = 0
triggerall = anim != [5110,5119] ;Not already changed anim
trigger1 = anim = [5161,5169]
trigger1 = SelfAnimExist(5170 + (anim % 10))
value = 5170 + (anim % 10)


[State 660, 5]
type = PosSet
trigger1 = Time = 0
y = 0

[State 660, 7]
type = GameMakeAnim
trigger1 = Time = 0
trigger1 = !SysVar(0)
value = 60 + (sysvar(1) > 5) + (sysvar(1) > 14)
pos = 0, 0
under = sysvar(1) <= 10

[State 660, 8]
type = VelSet
trigger1 = Time = 0
y = 0

[State 660, 9] ;For hit up type
type = ChangeAnim
persistent = 0
triggerall = anim = [5171,5179]
triggerall = SelfAnimExist(5110 + (anim % 10))
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground anim
value = 5110 + (anim % 10)

[State 660, 10] ;For normal
type = ChangeAnim
persistent = 0
triggerall = Anim != [5111,5119]
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground frame
value = 5110

[State 660, 11] ;If just died
type = ChangeState
triggerall = !alive && p2stateno = 0 && roundstate = 3
trigger1 = AnimTime = 0 
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground frame
trigger3 = Anim = [5110,5119]
value = 5150

;[State 660, 12]
;type = VarSet
;trigger1 = SysVar(0)
;trigger1 = Time = 0
;sysvar(0) = 0

[State 660, 13] ;Friction
type = VelMul
trigger1 = 1
x = 0.85

[State 660, 14]
type = ForceFeedback
trigger1 = alive
trigger1 = Time = 0
time = 8
ampl = 240
waveform = sine

[State 660, 15]
type = ForceFeedback
trigger1 = !alive
trigger1 = Time = 0
ampl = 200, 7, -.467
time = 30
waveform = sine

[state 1108, nothitby]
type = nothitby
trigger1 = time = 140
value = SCA
time = 4

[State 660, get up]
type = selfstate
trigger1 = life >= 1
trigger1 = time > 110 ;95
value = 5120

[state 660, flat death]
type = changestate
trigger1 = !alive
trigger1 = time > 40
value = 5150

;---------------------------------------------------------------------------
;Brief Crushed State
[statedef 661]
type    = L
movetype= H
physics = N
ctrl = 0
velset = 0,0

[state 661, 1]
type = changeanim
trigger1 = time = 0
value = 5110

[State 661, flatten]
type = AngleDraw
trigger1 = time > 0
value = 0
scale = 1.25,0.2

[state 661, on ground]
type = posset
trigger1 = 1
y = 0

[state 661, passthrough]
type = playerpush
trigger1 = 1
value = 0
time = 600

[State 661, Width]
type = Width
trigger1 = time > 0
value = 0,0


[State 661, 1] ;For hit up/up-diag type (from state 5081)
type = ChangeAnim
persistent = 0
trigger1 = SelfAnimExist(5110 + (anim % 10))
trigger1 = anim = [5081,5089]
value = 5110 + (anim % 10)

[State 661, 2] ;Hit ground anim (normal)
type = ChangeAnim
triggerall = time = 0
triggerall = anim != [5110,5119] ;Not already changed anim
trigger1 = anim != [5161,5169]
trigger2 = !SelfAnimExist(5170 + (anim % 10))
value = 5170

[State 661, 3] ;Hit ground anim (for hit up)
type = ChangeAnim
triggerall = time = 0
triggerall = anim != [5110,5119] ;Not already changed anim
trigger1 = anim = [5161,5169]
trigger1 = SelfAnimExist(5170 + (anim % 10))
value = 5170 + (anim % 10)


[State 661, 5]
type = PosSet
trigger1 = Time = 0
y = 0

;[State 661, Var] ;Get fall velocity
;type = VarSet
;trigger1 = Time = 0
;trigger1 = GetHitVar(fall.yvel) != 0
;sysvar(1) = floor(vel y)

;[State 661, 6]
;type = PlaySnd
;trigger1 = Time = 0
;trigger1 = !SysVar(0)
;value = F7, 0 ;Hit ground
;value = F7, (sysvar(1) > 5) + (sysvar(1) > 14)
;persistent = 0

[State 661, 7]
type = GameMakeAnim
trigger1 = Time = 0
trigger1 = !SysVar(0)
value = 60 + (sysvar(1) > 5) + (sysvar(1) > 14)
pos = 0, 0
under = sysvar(1) <= 10

[State 661, 8]
type = VelSet
trigger1 = Time = 0
y = 0

[State 661, 9] ;For hit up type
type = ChangeAnim
persistent = 0
triggerall = anim = [5171,5179]
triggerall = SelfAnimExist(5110 + (anim % 10))
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground anim
value = 5110 + (anim % 10)

[State 661, 10] ;For normal
type = ChangeAnim
persistent = 0
triggerall = Anim != [5111,5119]
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground frame
value = 5110

[State 661, 11] ;If just died
type = ChangeState
triggerall = !alive && p2stateno = 0 && roundstate = 3
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground frame
trigger3 = Anim = [5110,5119]
value = 5150

;[State 661, 12]
;type = VarSet
;trigger1 = SysVar(0)
;trigger1 = Time = 0
;sysvar(0) = 0

[State 661, 13] ;Friction
type = VelMul
trigger1 = 1
x = 0.85

[State 661, 14]
type = ForceFeedback
trigger1 = alive
trigger1 = Time = 0
time = 8
ampl = 240
waveform = sine

[State 661, 15]
type = ForceFeedback
trigger1 = !alive
trigger1 = Time = 0
ampl = 200, 7, -.467
time = 30
waveform = sine

[State 661, get up]
type = selfstate
trigger1 = life >= 1
trigger1 = time > 65
value = 5110

[state 660, flat death]
type = changestate
trigger1 = !alive
trigger1 = time > 40
value = 5150

;---------------------------------------------------------------------------
;Super Crushed State
[statedef 662]
type    = L
movetype= H
physics = N
ctrl = 0
velset = 0,0

[state 661, 1]
type = changeanim
trigger1 = time = 0
value = 5110

[State 661, flatten]
type = AngleDraw
trigger1 = time > 0  && time <25
value = 0
scale = 1.25,0.2

[state 661, on ground]
type = posset
trigger1 = 1
y = 0

[state 661, passthrough]
type = playerpush
trigger1 = 1
value = 0
time = 600

[State 661, Width]
type = Width
trigger1 = time > 0
value = 0,0


[State 661, 1] ;For hit up/up-diag type (from state 5081)
type = ChangeAnim
persistent = 0
trigger1 = SelfAnimExist(5110 + (anim % 10))
trigger1 = anim = [5081,5089]
value = 5110 + (anim % 10)

[State 661, 2] ;Hit ground anim (normal)
type = ChangeAnim
triggerall = time = 0
triggerall = anim != [5110,5119] ;Not already changed anim
trigger1 = anim != [5161,5169]
trigger2 = !SelfAnimExist(5170 + (anim % 10))
value = 5170

[State 661, 3] ;Hit ground anim (for hit up)
type = ChangeAnim
triggerall = time = 0
triggerall = anim != [5110,5119] ;Not already changed anim
trigger1 = anim = [5161,5169]
trigger1 = SelfAnimExist(5170 + (anim % 10))
value = 5170 + (anim % 10)


[State 661, 5]
type = PosSet
trigger1 = Time = 0
y = 0

;[State 661, Var] ;Get fall velocity
;type = VarSet
;trigger1 = Time = 0
;trigger1 = GetHitVar(fall.yvel) != 0
;sysvar(1) = floor(vel y)

;[State 661, 6]
;type = PlaySnd
;trigger1 = Time = 0
;trigger1 = !SysVar(0)
;value = F7, 0 ;Hit ground
;value = F7, (sysvar(1) > 5) + (sysvar(1) > 14)
;persistent = 0

[State 661, 7]
type = GameMakeAnim
trigger1 = Time = 0
trigger1 = !SysVar(0)
value = 60 + (sysvar(1) > 5) + (sysvar(1) > 14)
pos = 0, 0
under = sysvar(1) <= 10

[State 661, 8]
type = VelSet
trigger1 = Time = 0
y = 0

[State 661, 9] ;For hit up type
type = ChangeAnim
persistent = 0
triggerall = anim = [5171,5179]
triggerall = SelfAnimExist(5110 + (anim % 10))
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground anim
value = 5110 + (anim % 10)

[State 661, 10] ;For normal
type = ChangeAnim
persistent = 0
triggerall = Anim != [5111,5119]
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground frame
value = 5110

[State 661, 11] ;If just died
type = ChangeState
triggerall = !alive && p2stateno = 0 && roundstate = 3
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground frame
trigger3 = Anim = [5110,5119]
value = 5150

;[State 661, 12]
;type = VarSet
;trigger1 = SysVar(0)
;trigger1 = Time = 0
;sysvar(0) = 0

[State 661, 13] ;Friction
type = VelMul
trigger1 = 1
x = 0.85

[State 662, 14]
type = ForceFeedback
trigger1 = alive
trigger1 = Time = 0
time = 8
ampl = 240
waveform = sine

[State 662, 15]
type = ForceFeedback
trigger1 = !alive
trigger1 = Time = 0
ampl = 200, 7, -.467
time = 30
waveform = sine

[state 662, hitby]
type = hitby
trigger1 = time > 0
value = SCA, AA
ignorehitpause = 1

[State 662, get up]
type = selfstate
trigger1 = life >= 1
trigger1 = time > 180
value = 5110

[state 660, flat death]
type = changestate
trigger1 = !alive
trigger1 = time > 40
value = 5150

;------------------------------------------------------------------------------
; Moderate Crushed State
[statedef 663]
type    = L
movetype= H
physics = N
ctrl = 0
velset = 0,0

[state 660, 1]
type = changeanim
trigger1 = time = 0
value = 5110

[State 660, flatten]
type = AngleDraw
trigger1 = time > 0
value = 0
scale = 1.3,0.1

[state 660, on ground]
type = posset
trigger1 = 1
y = 0

[state 660, passthrough]
type = playerpush
trigger1 = 1
value = 0
time = 600

[State 660, Width]
type = Width
trigger1 = time > 0
value = 0,0

[state 660, invunerable]
type = nothitby
trigger1 = 1
value = SCA


[State 660, 1] ;For hit up/up-diag type (from state 5081)
type = ChangeAnim
persistent = 0
trigger1 = SelfAnimExist(5110 + (anim % 10))
trigger1 = anim = [5081,5089]
value = 5110 + (anim % 10)

[State 660, 2] ;Hit ground anim (normal)
type = ChangeAnim
triggerall = time = 0
triggerall = anim != [5110,5119] ;Not already changed anim
trigger1 = anim != [5161,5169]
trigger2 = !SelfAnimExist(5170 + (anim % 10))
value = 5170

[State 660, 3] ;Hit ground anim (for hit up)
type = ChangeAnim
triggerall = time = 0
triggerall = anim != [5110,5119] ;Not already changed anim
trigger1 = anim = [5161,5169]
trigger1 = SelfAnimExist(5170 + (anim % 10))
value = 5170 + (anim % 10)


[State 660, 5]
type = PosSet
trigger1 = Time = 0
y = 0

[State 660, 7]
type = GameMakeAnim
trigger1 = Time = 0
trigger1 = !SysVar(0)
value = 60 + (sysvar(1) > 5) + (sysvar(1) > 14)
pos = 0, 0
under = sysvar(1) <= 10

[State 660, 8]
type = VelSet
trigger1 = Time = 0
y = 0

[State 660, 9] ;For hit up type
type = ChangeAnim
persistent = 0
triggerall = anim = [5171,5179]
triggerall = SelfAnimExist(5110 + (anim % 10))
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground anim
value = 5110 + (anim % 10)

[State 660, 10] ;For normal
type = ChangeAnim
persistent = 0
triggerall = Anim != [5111,5119]
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground frame
value = 5110

[State 660, 11] ;If just died
type = ChangeState
triggerall = !alive && p2stateno = 0 && roundstate = 3
trigger1 = AnimTime = 0 
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground frame
trigger3 = Anim = [5110,5119]
value = 5150

;[State 660, 12]
;type = VarSet
;trigger1 = SysVar(0)
;trigger1 = Time = 0
;sysvar(0) = 0

[State 660, 13] ;Friction
type = VelMul
trigger1 = 1
x = 0.85

[State 660, 14]
type = ForceFeedback
trigger1 = alive
trigger1 = Time = 0
time = 8
ampl = 240
waveform = sine

[State 660, 15]
type = ForceFeedback
trigger1 = !alive
trigger1 = Time = 0
ampl = 200, 7, -.467
time = 30
waveform = sine

[state 1108, nothitby]
type = nothitby
trigger1 = time = 160
value = SCA
time = 4

[State 660, get up]
type = selfstate
trigger1 = life >= 1
trigger1 = time > 160 ;95
value = 5120

[state 660, flat death]
type = changestate
trigger1 = !alive
trigger1 = time > 40
value = 5150


;---------------------------------------------------------------------------
;Winning Crushed State
[statedef 665]
type    = L
movetype= H
physics = N
ctrl = 0
velset = 0,0

[state 665, 1]
type = changeanim
trigger1 = time = 0
value = 5110

[state 665, scream]
type = playsnd
trigger1 = 1
value = 11,0
persistent = 0


[State 665, flatten]
type = AngleDraw
trigger1 = time > 0  && time <25
value = 0
scale = 1.3,0.1

[state 665, on ground]
type = posset
trigger1 = 1
y = 0

[state 665, passthrough]
type = playerpush
trigger1 = 1
value = 0
time = 600

[State 665, Width]
type = Width
trigger1 = time > 0
value = 0,0

[State 665, 5]
type = PosSet
trigger1 = Time = 0
y = 0

;[State 661, Var] ;Get fall velocity
;type = VarSet
;trigger1 = Time = 0
;trigger1 = GetHitVar(fall.yvel) != 0
;sysvar(1) = floor(vel y)

;[State 665, 6]
;type = PlaySnd
;trigger1 = Time = 0
;trigger1 = !SysVar(0)
;value = F7, 0 ;Hit ground
;value = F7, (sysvar(1) > 5) + (sysvar(1) > 14)
;persistent = 0

[State 665, 7]
type = GameMakeAnim
trigger1 = Time = 0
trigger1 = !SysVar(0)
value = 60 + (sysvar(1) > 5) + (sysvar(1) > 14)
pos = 0, 0
under = sysvar(1) <= 10

[State 665, 8]
type = VelSet
trigger1 = Time = 0
y = 0

[State 665, 9] ;For hit up type
type = ChangeAnim
persistent = 0
triggerall = anim = [5171,5179]
triggerall = SelfAnimExist(5110 + (anim % 10))
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground anim
value = 5110 + (anim % 10)

[State 665, 10] ;For normal
type = ChangeAnim
persistent = 0
triggerall = Anim != [5111,5119]
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground frame
value = 5110

[State 665, 11] ;If just died
type = ChangeState
triggerall = !alive && p2stateno = 0 && roundstate = 3
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground frame
trigger3 = Anim = [5110,5119]
value = 5150

;[State 661, 12]
;type = VarSet
;trigger1 = SysVar(0)
;trigger1 = Time = 0
;sysvar(0) = 0

[State 665, 13] ;Friction
type = VelMul
trigger1 = 1
x = 0.85

[State 665, 14]
type = ForceFeedback
trigger1 = alive
trigger1 = Time = 0
time = 8
ampl = 240
waveform = sine

[State 665, 15]
type = ForceFeedback
trigger1 = !alive
trigger1 = Time = 0
ampl = 200, 7, -.467
time = 30
waveform = sine

[state 665, hitby]
type = hitby
trigger1 = time > 0
value = SCA, AA
ignorehitpause = 1

[State 665, get up]
type = selfstate
trigger1 = life >= 1
trigger1 = time > 600
value = 5120

[state 660, flat death]
type = changestate
trigger1 = !alive
trigger1 = time > 40
value = 5150


;---------------------------------------------------------------------------
;---------------------------------------------------------------------------
;===========================================================================
;------------------------------Wall Bounce State
;===========================================================================
[statedef 670]
type = A
movetype = H
physics = N

[State 672, Stop moving]
type = PosFreeze
trigger1 = 1
x = 1
y = 1

[state 670]
type = changeanim
trigger1 = time = 0
value = 5030
ignorehitpause = 1

[state 670, changestate]
type = changestate
trigger1 = hitshakeover
value = 671
;------------------------------------------------------------------------

[statedef 671]
type    = A
movetype= H
physics = N

[state 671, anim]
type = changeanim
trigger1 = anim != 5030
value = 5030

[State 670, Velocity]
type = velset
trigger1 = Time = 0
x = facing * gethitvar(xvel)
y = gethitvar(yvel)

[State 670, Gravity]
type = veladd
trigger1 = 1
y = 1.05

;[State 670, No scroll]
;type = ScreenBound
;triggerall = Pos y < -15
;trigger1 = BackEdgeBodyDist < 65
;trigger2 = FrontEdgeBodyDist < 65
;value = 1
;movecamera = 0,1

[State 670, Hit wall]
type = ChangeState
triggerall = Pos y < 0
trigger1 = BackEdgeBodyDist <= 60
trigger2 = FrontEdgeBodyDist <= 60
value = 672

[State 670, Hit ground]
type = SelfState
trigger1 = (Vel y > 0) && (Pos y >= 0)
value = 5100

;---------------------------------------------------------------------------
;Hit wall - part 2 bounce off wall
[statedef 672]
type    = A
movetype= H
physics = N

[State 672, Turn]
type = Turn
trigger1 = (Time = 0) && (FrontEdgeBodyDist <= 30)

[State 672, Pos]
type = PosAdd
trigger1 = Time = 0
x = 15 - BackEdgeBodyDist

[State 672, Stop moving]
type = PosFreeze
trigger1 = 1
x = 1
y = 1

[State 672, No scroll]
type = ScreenBound
trigger1 = 1
value = 1
movecamera = 0,1

[State 672, Spark]
type = Explod
trigger1 = Time = 1
anim = F72
pos = 0,const(size.mid.pos.y)
postype = p1
sprpriority = 3
ownpal = 1

[state 672, anim]
type = changeanim
trigger1 = anim != 5030
value = 5030

[State 672, Sound]
type = PlaySnd
trigger1 = Time = 1
value = F7,0

[State 672, State]
type = ChangeState
trigger1 = time = 10
value = 673
;--------------------------------------------------------------------------
;wall bounce - part 3 fall toward ground
[Statedef 673]
type    = A
movetype= H
physics = N

[State 673, Vel Y]
type = VelSet
trigger1 = Time = 0
y = -18

[State 673, Vel X]
type = VelSet
trigger1 = Time = 0
x = ceil(abs(p2dist x *0.02))

[State 673, Turn]
type = Turn
trigger1 = (Time = 0) && (BackEdgeDist < 30)

[State 672, Gravity]
type = VelAdd
trigger1 = 1
y = 1.05

;[state 673, gravity]
;type = gravity
;trigger1 = 1

[State 673, Anim 5050] ;Self falling animation
type = ChangeAnim
trigger1 = Time = 0
trigger1 = !SelfAnimExist(5052)
value = 5050

[State 673, Anim 5052] ;Self falling animation (diagup type)
type = ChangeAnim
trigger1 = Time = 0
trigger1 = SelfAnimExist(5052)
value = 5052

[State 673, Anim 5060] ;Coming down - normal
type = ChangeAnim
trigger1 = Vel Y > -2
trigger1 = Anim = 5050
trigger1 = SelfAnimExist(5060)
persistent = 0
value = 5060

[State 673, Anim 5062] ;Coming down - diagup type
type = ChangeAnim
trigger1 = Vel Y > -2
trigger1 = Anim = 5052
trigger1 = SelfAnimExist(5062)
persistent = 0
value = 5062

[State 673, Hit ground]
type = SelfState
trigger1 = (Vel y > 0) && (Pos y >= 0)
value = 5100

;============================================================================
; Neutral Wall Bounce
;============================================================================
[statedef 675]
type = A
movetype = H
physics = N

[State 675, Stop moving]
type = PosFreeze
trigger1 = 1
x = 1
y = 1

[state 675]
type = changeanim
trigger1 = time = 0
value = 5030
ignorehitpause = 1

[state 675, changestate]
type = changestate
trigger1 = hitshakeover
value = 676
;------------------------------------------------------------------------

[statedef 676]
type    = A
movetype= H
physics = N

[state 676, anim]
type = changeanim
trigger1 = anim != 5030
value = 5030

[State 676, Velocity]
type = velset
trigger1 = Time = 0
x = facing * gethitvar(xvel)
y = gethitvar(yvel)

[State 676, Gravity]
type = veladd
trigger1 = 1
y = 1.05

;[State 670, No scroll]
;type = ScreenBound
;triggerall = Pos y < -15
;trigger1 = BackEdgeBodyDist < 65
;trigger2 = FrontEdgeBodyDist < 65
;value = 1
;movecamera = 0,1

[State 676, Hit wall]
type = ChangeState
triggerall = Pos y < 0
trigger1 = BackEdgeBodyDist <= 60
trigger2 = FrontEdgeBodyDist <= 60
value = 677

[State 676, Hit ground]
type = SelfState
trigger1 = (Vel y > 0) && (Pos y >= 0)
value = 5100

;---------------------------------------------------------------------------
;Hit wall - part 2 bounce off wall
[statedef 677]
type    = A
movetype= H
physics = N

[State 677, Turn]
type = Turn
trigger1 = (Time = 0) && (FrontEdgeBodyDist <= 30)

[State 677, Pos]
type = PosAdd
trigger1 = Time = 0
x = 15 - BackEdgeBodyDist

[State 677, Stop moving]
type = PosFreeze
trigger1 = 1
x = 1
y = 1

[State 677, No scroll]
type = ScreenBound
trigger1 = 1
value = 1
movecamera = 0,1

[State 677, Spark]
type = Explod
trigger1 = Time = 1
anim = F72
pos = 0,const(size.mid.pos.y)
postype = p1
sprpriority = 3
ownpal = 1

[state 677, anim]
type = changeanim
trigger1 = anim != 5030
value = 5030

[State 677, Sound]
type = PlaySnd
trigger1 = Time = 1
value = F7,0

[State 677, State]
type = ChangeState
trigger1 = time = 10
value = 678
;--------------------------------------------------------------------------
;wall bounce - part 3 fall toward ground
[Statedef 678]
type    = A
movetype= H
physics = N

[State 678, Vel Y]
type = VelSet
trigger1 = Time = 0
y = -18

[State 678, Vel X]
type = VelSet
trigger1 = Time = 0
x = 2

[State 678, Turn]
type = Turn
trigger1 = (Time = 0) && (BackEdgeDist < 30)

[State 672, Gravity]
type = VelAdd
trigger1 = 1
y = 1.05

;[state 678, gravity]
;type = gravity
;trigger1 = 1

[State 678, Anim 5050] ;Self falling animation
type = ChangeAnim
trigger1 = Time = 0
trigger1 = !SelfAnimExist(5052)
value = 5050

[State 678, Anim 5052] ;Self falling animation (diagup type)
type = ChangeAnim
trigger1 = Time = 0
trigger1 = SelfAnimExist(5052)
value = 5052

[State 678, Anim 5060] ;Coming down - normal
type = ChangeAnim
trigger1 = Vel Y > -2
trigger1 = Anim = 5050
trigger1 = SelfAnimExist(5060)
persistent = 0
value = 5060

[State 678, Anim 5062] ;Coming down - diagup type
type = ChangeAnim
trigger1 = Vel Y > -2
trigger1 = Anim = 5052
trigger1 = SelfAnimExist(5062)
persistent = 0
value = 5062

[State 678, Hit ground]
type = SelfState
trigger1 = (Vel y > 0) && (Pos y >= 0)
value = 5100

[state 678, selfstate]
type = selfstate
trigger1 = time > 240
value = 5050

;============================================================================
; Super Wall Bounce
;============================================================================
[statedef 6750]
type = A
movetype = H
physics = N

[State 675, Stop moving]
type = PosFreeze
trigger1 = 1
x = 1
y = 1

[state 675]
type = changeanim
trigger1 = time = 0
value = 5030
ignorehitpause = 1

[state 675, changestate]
type = changestate
trigger1 = hitshakeover
value = 6760
;------------------------------------------------------------------------

[statedef 6760]
type    = A
movetype= H
physics = N

[state 676, anim]
type = changeanim
trigger1 = anim != 5030
value = 5030

[State 676, Velocity]
type = velset
trigger1 = Time = 0
x = facing * gethitvar(xvel)
y = gethitvar(yvel)

[State 676, Gravity]
type = veladd
trigger1 = 1
y = 1.05

;[State 670, No scroll]
;type = ScreenBound
;triggerall = Pos y < -15
;trigger1 = BackEdgeBodyDist < 65
;trigger2 = FrontEdgeBodyDist < 65
;value = 1
;movecamera = 0,1

[State 676, Hit wall]
type = ChangeState
triggerall = Pos y < 0
trigger1 = BackEdgeBodyDist <= 20
trigger2 = FrontEdgeBodyDist <= 20
value = 6770

[State 6760, Hit ground]
type = SelfState
trigger1 = (Vel y > 0) && (Pos y >= 0)
value = 5100

;---------------------------------------------------------------------------
;Hit wall - part 2 bounce off wall
[statedef 6770]
type    = A
movetype= H
physics = N

[State 677, Turn]
type = Turn
trigger1 = (Time = 0) && (FrontEdgeBodyDist <= 30)

[State 677, Pos]
type = PosAdd
trigger1 = Time = 0
x = 15 - BackEdgeBodyDist

[State 677, Stop moving]
type = PosFreeze
trigger1 = 1
x = 1
y = 1

[State 677, No scroll]
type = ScreenBound
trigger1 = 1
value = 1
movecamera = 0,1

[State 677, Spark]
type = Explod
trigger1 = Time = 1
anim = F72
pos = 0,const(size.mid.pos.y)
postype = p1
sprpriority = 3
ownpal = 1

[state 677, anim]
type = changeanim
trigger1 = anim != 5030
value = 5030

[State 677, Sound]
type = PlaySnd
trigger1 = Time = 1
value = F7,0

[State 677, State]
type = ChangeState
trigger1 = time = 10
value = 6780
;--------------------------------------------------------------------------
;wall bounce - part 3 fall toward ground
[Statedef 6780]
type    = A
movetype= H
physics = N

[State 678, Vel Y]
type = VelSet
trigger1 = Time = 0
y = -18

[State 678, Vel X]
type = VelSet
trigger1 = Time = 0
x = 2

[State 678, Turn]
type = Turn
trigger1 = (Time = 0) && (BackEdgeDist < 30)

[State 672, Gravity]
type = VelAdd
trigger1 = 1
y = 1.05

;[state 678, gravity]
;type = gravity
;trigger1 = 1

[State 678, Anim 5050] ;Self falling animation
type = ChangeAnim
trigger1 = Time = 0
trigger1 = !SelfAnimExist(5052)
value = 5050

[State 678, Anim 5052] ;Self falling animation (diagup type)
type = ChangeAnim
trigger1 = Time = 0
trigger1 = SelfAnimExist(5052)
value = 5052

[State 678, Anim 5060] ;Coming down - normal
type = ChangeAnim
trigger1 = Vel Y > -2
trigger1 = Anim = 5050
trigger1 = SelfAnimExist(5060)
persistent = 0
value = 5060

[State 678, Anim 5062] ;Coming down - diagup type
type = ChangeAnim
trigger1 = Vel Y > -2
trigger1 = Anim = 5052
trigger1 = SelfAnimExist(5062)
persistent = 0
value = 5062

[State 678, Hit ground]
type = SelfState
trigger1 = (Vel y > 0) && (Pos y >= 0)
value = 5100




;=============================================================================
;Ground Bounce
;=============================================================================
;Hit Freeze small
[statedef 680]
type = A
movetype = H
physics = N

[State 680, Stop moving]
type = PosFreeze
trigger1 = 1
x = 1
y = 1

[state 680]
type = changeanim
trigger1 = time = 0
value = 5030
ignorehitpause = 1

[state 680, changestate]
type = changestate
trigger1 = hitshakeover
value = 681

;-----------------------------------------------------------------------------
;Soft Ground bounce - Going down
[statedef 681]
;Custom Hit state, ground bounce
type = A
movetype = H
physics = N


[state 681, velocity]
type = hitvelset
trigger1 = time = 0
y = 40

[state 681, anim]
type = changeanim
trigger1 = time = 0
value = 5160


[state 681, stop x]
type = velmul
trigger1 = time = 0
x = 0.25


[state 681]
type = veladd
trigger1 = 1
y = 1.05

[state 681, changestate]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 682

;-----------------------------------------------------------------------------
;Ground Bounce - Impact / bouncing
[statedef 682]
type = A
movetype = H
physics = N
anim = 5160

[state 682, impact]
type = velset
trigger1 = time = 0
y = 0

[State 682, 8]
type = Explod
trigger1 = Time = 0
anim = F62 
pos = 0, 0
ontop = 1
scale = 1.7, 0.5
persistent = 0
ownpal = 1

[State 682, 10]
type = PlaySnd
trigger1 = Time = 0
value = F7,2
persistent = 0

[state 682, shake]
type = envshake
trigger1 = time = 0
ampl = 5
freq = 50
phase = 50
time = 10

[state 682, impact 2]
type = posset
trigger1 = time = 0
y = 0

[state 682, bounce]
type = velset
trigger1 = time = 1
y = -30

[state 682, gravity]
type = veladd
trigger1 = time > 1
y = 1.05

[state 682, down]
type = selfstate
trigger1 = time >= 2 
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 5110
;--------------------------------------------------------------------------


;Hit Freeze big
[statedef 685]
type = A
movetype = H
physics = N

[State 685, Stop moving]
type = PosFreeze
trigger1 = 1
x = 1
y = 1

[state 685]
type = changeanim
trigger1 = time = 0
value = 5030
ignorehitpause = 1

[state 685, changestate]
type = changestate
trigger1 = hitshakeover
value = 686
;---------------------------------------------------------------------------
;Hard Ground bounce - going down
[statedef 686]
;Custom Hit state, ground bounce
type = A
movetype = H
physics = N


[state 686, anim]
type = changeanim
trigger1 = time = 0
value = 5160

[state 686, velocity]
type = hitvelset
trigger1 = time = 0
y = 20
x = 0

[state 686]
type = veladd
trigger1 = 1
y = 1.05

[state 686, changestate]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 687

;-----------------------------------------------------------------------------
;Hard Ground Bounce - Impact/bounce
[statedef 687]
type = A
movetype = H
physics = N
anim = 5160

[state 687, impact]
type = velset
trigger1 = time = 0
y = 0

[state 685, velmul]
type = velmul
trigger1 = time = 0
x = 0.1
persistent = 0

[State 687, 8]
type = Explod
trigger1 = Time = 0
anim = F62 
pos = 0, 0
ontop = 1
scale = 2, 1
persistent = 0
ownpal = 1

[State 687, 10]
type = PlaySnd
trigger1 = Time = 0
value = F7,2
persistent = 0

[state 687, shake]
type = envshake
trigger1 = time = 0
ampl = 5
freq = 50
phase = 50
time = 10

[state 687, impact 2]
type = posset
trigger1 = time = 0
y = 0

[state 687, bounce]
type = velset
trigger1 = time = 1
y = -20

[state 687, gravity]
type = veladd
trigger1 = time > 1
y = 0.9

[state 687, down]
type = selfstate
trigger1 = time >= 2 
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 5100

;==========================================================================
;Stun
;==========================================================================
;--------------------------------------------------------------------------
;Stun Knockback
[statedef 690]
type = A
movetype = H
physics = N
anim = 5061

[state 690, hitvelset]
type = hitvelset
trigger1 = time = 0
x = 1
y = 1

[state 690, hitfallset]
type = hitfallset
trigger1 = time = 0
value = 1


[state 690, gravity]
type = gravity
trigger1 = 1

[state 690, end]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 691
persistent = 0

;---------------------------------------------------------------------------
; Downed get-hit (hit ground from fall)
[Statedef 691]
type    = L
movetype= H
physics = N

[state 691, hitfallset]
type = hitfallset
trigger1 = time = 0
value = 0

[State 691, Var] ;Save fall velocity
type = VarSet
trigger1 = Time = 0
sysvar(1) = floor(vel y)

[State 691, 2] ;Hit ground anim (normal)
type = ChangeAnim
trigger1 = time = 0
value = 5100

[State 691, 4]
type = PosSet
trigger1 = Time = 0
y = 0

[State 691, 5]
type = VelSet
trigger1 = Time = 0
y = 0

[State 691, 6] ;Reduce speed
type = VelMul
trigger1 = Time = 0
x = 0.5

[state 691, shockwave]
type = explod
trigger1 = time = 0
anim = F61
scale = 2,2
pos = 0,0
postype = p1

[State 691, 10]
type = PlaySnd
trigger1 = Time = 1
value = F7, 1

[State 691, 11]
type = PosFreeze
trigger1 = 1

[State 691, 12]
type = ChangeState
trigger1 = time = 4
value = 692 ;Downed get-hit (bounce off ground)

[State 691, 13]
type = ForceFeedback
trigger1 = Time = 0
waveform = sinesquare
ampl = 128,-3,-.2,.005
time = 20

;---------------------------------------------------------------------------
; Downed get-hit (bounce off ground)
[Statedef 692]
type    = L
movetype= H
physics = N

[State 692, 1] ;Coming hit ground anim (normal)
type = ChangeAnim
triggerall = time = 0
trigger1 = anim != [5101,5109]
trigger2 = !SelfAnimExist(5160 + (anim % 10))
value = 5160

[State 692, 2] ;Coming hit ground anim (for hit up)
type = ChangeAnim
triggerall = time = 0
trigger1 = anim = [5101,5109]
trigger1 = SelfAnimExist(5160 + (anim % 10))
value = 5160 + (anim % 10)

[State 692, 4]
type = PosSet
trigger1 = Time = 0
y = -8;Const(movement.down.bounce.offset.y)

[State 692, 5]
type = PosAdd
trigger1 = Time = 0
x = 0;Const(movement.down.bounce.offset.x)

[State 692, 6] ;Acceleration
type = VelAdd
trigger1 = 1
y = Const(movement.down.bounce.yaccel)

[State 692, 7] ;Hit ground
trigger1 = Vel Y > 0
trigger1 = Pos Y >= Const(movement.down.bounce.groundlevel)
type = ChangeState
value = 693

;---------------------------------------------------------------------------
; Downed get-hit (lying down)
[Statedef 693]
type    = L
movetype= H
physics = N

[State 693, EnvShake]
type = FallEnvShake
trigger1 = Time = 0

[State 693, 1] ;For hit up/up-diag type (from state 5081)
type = ChangeAnim
persistent = 0
trigger1 = time = 0
value = 5110

[State 693, 5]
type = PosSet
trigger1 = Time = 0
y = 0


[State 693, 6]
type = PlaySnd
trigger1 = Time = 0
trigger1 = !SysVar(0)
value = F7, (sysvar(1) > Const720p(20)) + (sysvar(1) > Const720p(56))

[State 693, 8]
type = VelSet
trigger1 = Time = 0
y = 0

[State 693, 9] ;For hit up type
type = ChangeAnim
persistent = 0
triggerall = anim = [5171,5179]
triggerall = SelfAnimExist(5110 + (anim % 10))
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground anim
value = 5110 + (anim % 10)

[State 693, 10] ;For normal
type = ChangeAnim
persistent = 0
triggerall = Anim != [5111,5119]
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground frame
value = 5110

[State 693, 12]
type = VarSet
trigger1 = SysVar(0)
trigger1 = Time = 0
sysvar(0) = 0

[State 693, 13] ;Friction
type = VelMul
trigger1 = 1
x = 0.85

[State 693, 14] ;Friction
type = VelSet
trigger1 = abs(Vel x) < Const(movement.down.friction.threshold)
persistent = 0
x = 0

[State 693, 15]
type = ForceFeedback
trigger1 = alive
trigger1 = Time = 0
time = 8
ampl = 240
waveform = sine

[State 693, 16]
type = ForceFeedback
trigger1 = !alive
trigger1 = Time = 0
ampl = 200, 7, -.467
time = 30
waveform = sine

[State 5110, 11] ;If just died
type = ChangeState
trigger1 = time = 4
;trigger1 = AnimTime = 0
;trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground frame
;trigger3 = Anim = [5110,5119]
value = 694

;---------------------------------------------------------------------------
; Downed get-hit (getting up)
[Statedef 694]
type    = L
movetype= H
physics = N

[State 694, 1a] ;Get up anim (normal)
type = ChangeAnim
triggerall = time = 0
trigger1 = anim != [5111,5119]
trigger2 = !SelfAnimExist(5120 + (anim % 10))
value = 5120

[State 694, 1b] ;Get up anim (for hit up/diag-up)
type = ChangeAnim
triggerall = time = 0
trigger1 = anim = [5111,5119]
trigger1 = SelfAnimExist(5120 + (anim % 10))
value = 5120 + (anim % 10)

[State 694, 2]
type = VelSet
trigger1 = Time = 0
x = 0

[State 694, 3]
type = NotHitBy
trigger1 = 1
value = SCA
time = 1

[state 690, hitfallset]
type = hitfallset
trigger1 = time = 0
value = 0

[State 694, 7]
type = ChangeState
trigger1 = AnimTime = 0
value = 695
;--------------------------------------------------------------------------
;Stun
[statedef 695]
type = S
movetype = H
physics = S
anim = 5300
velset = 0,0

[state 695, on ground]
type = posset
trigger1 = time = 0
y = 0

[state 695, end]
type = selfstate
trigger1 = time = 120
value = 0
ctrl = 1


;---------------------------------------------------------------------------
;Belly to Belly Suplex
[Statedef 800]
type    = S
movetype= A
physics = S
juggle  = 0
velset = 0,0
ctrl = 0
anim = 800
sprpriority = 2

[State 800, 1]
type = HitDef
triggerall = p2movetype != A
Trigger1 = Time = 0
attr = S, NT          
hitflag = M-         
priority = 1, Miss    
sparkno = -1          
p1sprpriority = 1              
p1facing = 1
p2facing = 1          
id = 800
p1stateno = 810      
p2stateno = 820       
guard.dist = 0       
fall = 1   

[State 800, 1]
type = HitDef
triggerall = p2movetype = A
Trigger1 = Time = 0
attr = S, NT          
hitflag = M-         
priority = 1, Miss    
sparkno = -1          
p1sprpriority = 1              
p1facing = 1
p2facing = 1          
id = 800
p1stateno = 810      
p2stateno = 822       
guard.dist = 0       
fall = 1      

[State 800, 1]
type = HitDef
triggerall = enemynear,anim = 5300
Trigger1 = Time = 0
attr = S, NT          
hitflag = M         
priority = 1, Miss    
sparkno = -1          
p1sprpriority = 1              
p1facing = 1
p2facing = 1          
id = 800
p1stateno = 810      
p2stateno = 822       
guard.dist = 0       
fall = 1      

[state 232, Not Active]
type = statetypeset
trigger1 = animelemtime(3) = 0
movetype = I

[State 800, 2]
type = ChangeState
Trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
;Grab Escape - p2
[statedef 805]
type = A
movetype = H
physics = S
ctrl = 0
facep2 = 1
sprpriority = 4

[state 805, anim]
type = changeanim
trigger1 = time = 0
trigger1 = SelfAnimExist(805)
value = 805

[state 805, anim]
type = changeanim
trigger1 = time = 0
trigger1 = !selfanimexist(805)
value = 120

;[state 1400, dim]
;type = bgpalfx
;trigger1 = time = 0
;time = 8
;mul = 200,200,200

;[state 805, freeze]
;type = pause
;trigger1 = time = 0
;time = 8
;endcmdbuftime = 8

;[state 805, sound]
;type = playsnd
;trigger1 = time = 0
;value = S805,0

[state 805, pos y]
type = posset
trigger1 = time = 0
y = 0

[state 805, velset]
type = velset
trigger1 = time = 10
x= -24

[state 805, nothitby]
type = nothitby
trigger1 = 1
value = SCA

[state 805, end]
type = selfstate
trigger1 = time = 35
value = 0
ctrl = 1

;---------------------------------------------------------------------------
;Grab Escape - p1
[statedef 806]
type = A
movetype = H
physics = S
ctrl = 0


[state 806, anim]
type = changeanim
trigger1 = time = 0
trigger1 = SelfAnimExist(130)
value = 130

[state 806, anim]
type = changeanim
trigger1 = time = 0
trigger1 = !selfanimexist(805)
value = 130

[state 1400, dim]
type = bgpalfx
trigger1 = time = 0
time = 12
mul = 200,200,200

[state 805, freeze]
type = pause
trigger1 = time = 0
time = 12
endcmdbuftime = 12

[state 805, sound]
type = playsnd
trigger1 = time = 0
value = S805,0

[state 805, pos y]
type = posset
trigger1 = time = 0
y = 0

[state 805, velset]
type = velset
trigger1 = time = 10
x= -24

[state 805, nothitby]
type = nothitby
trigger1 = 1
value = SCA

[state 805, end]
type = selfstate
trigger1 = time = 35
value = 0
ctrl = 1


;---------------------------------------------------------------------------
;Throw animation
[Statedef 810]
type    = S
movetype= A
physics = N
anim = 810
poweradd = 150

[state 810, tech]
type = changestate
triggerall = numtarget
trigger1 = target(800),stateno = 805
value = 806
persistent = 1

[State 810, Holding Direction?]
type = VarSet
trigger1 = Time = 0
var(2) = command = "holdfwd"

[state 810, width]
type = width
trigger1 = time > 0
value = 100,150

[State 810, Bind 1]
type = TargetBind
trigger1 = AnimElemTime(2) < 0
pos = 150, -140

[State 810, Bind 2]
type = TargetBind
trigger1 = AnimElemTime(2) >= 0 && AnimElemTime(3) < 0
pos = 130, -140


[State 810, holdfwd - Turn 6] ;If was holding fwd before, turn now
type = Turn
trigger1 = var(2)
trigger1 = AnimElem = 2

[State 810, holdfwd - Pos 6] ;If was holding fwd before, move a little
type = PosAdd
trigger1 = var(2)
trigger1 = AnimElemtime(2) = 2
x = -37

[State 810, holdfwd - Turn Target 6] ;If was holding fwd before, turn target too
type = TargetFacing
trigger1 = var(2)
trigger1 = AnimElem = 2
value = -1

[State 810, Bind 3]
type = TargetBind
trigger1 = AnimElemTime(3) >= 0 && AnimElemTime(4) < 0
pos = 125, -140

[State 810, Bind 4]
type = TargetBind
trigger1 = AnimElemTime(4) >= 0 && AnimElemTime(5) < 0
pos = 125, -140

[state 810, Jump]
type = velset
trigger1 =time = 20
y = -15
x = -4

[state 810, gravity]
type = gravity
trigger1 = time > 22

[State 810, Bind 5]
type = TargetBind
trigger1 = AnimElemTime(5) >= 0 && AnimElemTime(6) < 0
pos = 10, -290

[State 810, Bind 6]
type = TargetBind
trigger1 = AnimElemTime(6) >= 0 && AnimElemTime(7) < 0
pos = 0, -310

[State 810, Bind 7]
type = TargetBind
trigger1 = AnimElemTime(7) >= 0 
pos = -75, -90

[State 810, State End]
type = ChangeState
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 811


;---------------------------------------------------------------------------
;Landing
[Statedef 811]
type = C
movetype = A
physics = N

[state 811, anim]
type = changeanim
trigger1 = time = 0
value = 812

[state 1001, fx]
type = explod
trigger1 = time = 0
anim = F61
pos = 0,0
scale = 2,1
ownpal = 1

;Custom Dust
[state 651, explod]
type = explod
trigger1 = time = 0
anim = 2000
pos = 0,0
scale = const(size.xscale)*2,const(size.yscale)*1
ontop = 1
ownpal=1

[state 651, explod]
type = explod
trigger1 = time = 0
anim = 2001
pos = 0,0
scale = const(size.xscale)*2,const(size.yscale)*1
sprpriority = -4
ownpal=1

[State 811, Hurt 11]
type = TargetLifeAdd
trigger1 = time = 0
value = -140

[state 811, pos]
type = posset
trigger1 = time = 0
y = 0

[state 811, vel]
type = velset
trigger1 = time = 0
x = 0
y = 0

[state 641, snd]
type = playsnd
trigger1 = time = 0
value =S1,1

[state 811, crushed]
type = targetstate
trigger1 = time = 1
value = 821

[state 811, earthquakes]
type = envshake
trigger1 = time = 0
time = 25
ampl = 20
freq = 100
phase = 100

[state 811, end]
type = changestate
trigger1 = time = 18
value = 812

;--------------------------------------------------------------------------
[statedef 812]
type = A
movetype = I
physics = N

[state 812, invun]
type = nothitby
trigger1 = 1
value = SCA

[state 812, turn]
type = turn
trigger1 = time = 0

[state 812, jump]
type = velset
trigger1 = time = 0
x = -3
y = -12

[state 812, gravity]
type = gravity
trigger1 = pos y < 0

[state 812, change animation]
type = changeanim
trigger1 = time = 0
value = 44

[state 812, end]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y

value = 813

;-----------------------------------------
[statedef 813, land]
type = S
movetype = I
physics = S
anim = 47
velset = 0,0

[state 813, pos]
type = posset
trigger1 = time = 0
y = 0

[state x, combo dampener]
type = varadd
trigger1 = time = 2
v = 18
value = -18
persistent = 0
ignorehitpause =1

[state 813, end]
type = changestate
trigger1 = time = 2
value = 0
ctrl = 1




;---------------------------------------------------------------------------
;Techable Thrown
[Statedef 820]
type    = A
movetype= H
physics = N
velset = 0,0

[State 820, 1]
type = ChangeAnim2
Trigger1 = Time = 0
value = 820

[state 810, screenbound]
type = screenbound
trigger1 = 1
movecamera = 1,0
value = 0

[state 820, tech throw]
type = changestate
triggerall = time < 12
trigger1 = ailevel = 0
trigger1 = command = "holdfwd" || command = "holdback"
trigger1 = command = "y" || command = "b" || command = "z" || command = "c"
trigger2 = command = "x" && command = "a"
trigger3 = ailevel > 4 
trigger3 = random < (ailevel * ifelse(ailevel>7,1,3))
value = 805

[State 820, 2]
type = SelfState
trigger1 = !gethitvar(isbound)
value = 5050

;---------------------------------------------------------------------------
;UnTechable Thrown
[Statedef 822]
type    = A
movetype= H
physics = N
velset = 0,0

[State 820, 1]
type = ChangeAnim2
Trigger1 = Time = 0
value = 820

[state 810, screenbound]
type = screenbound
trigger1 = 1
movecamera = 1,0
value = 0

[State 820, 2]
type = SelfState
trigger1 = !gethitvar(isbound)
value = 5050

;---------------------------------------------------------------------------
[Statedef 821]
type    = A
movetype= H
physics = C
velset = 0,0

[state 821, posset]
type = posset
trigger1 = time = 0
y = 0

[state 821, anim]
type = changeanim 
trigger1 = time = 0
value = 5100

[state 821, vel set]
type = velset
trigger1 = time = 18
y = -10

[state 821, gravity]
type = gravity
trigger1 = time > 19

[state 821, anim]
type = changeanim
trigger1 = time >= 18
value = 5160

[State 821, 4] ;Hit ground
type = SelfState
trigger1 = time >= 18
trigger1 = pos y > 0
trigger1 = vel y > - pos y
value = 5110 

;---------------------------------------------------------------------------
;Belly to Belly Suplex Air
[Statedef 830]
type    = A
movetype= A
physics = A
ctrl = 0
anim = 830
sprpriority = 2

[State 830, 1]
type = HitDef
triggerall = p2movetype != A
Trigger1 = Time = 0
attr = A, NT          
hitflag = A-         
priority = 1, Miss    
sparkno = -1          
p1sprpriority = 1              
p1facing = 1
p2facing = 1          
id = 800
p1stateno = 840      
p2stateno = 850       
guard.dist = 0       
fall = 1   

[State 800, 1]
type = HitDef
triggerall = p2movetype = A
Trigger1 = Time = 0
attr = A, NT          
hitflag = A-         
priority = 1, Miss    
sparkno = -1          
p1sprpriority = 1              
p1facing = 1
p2facing = 1          
id = 800
p1stateno = 840      
p2stateno = 852       
guard.dist = 0       
fall = 1           

[State 800, 2]
type = ChangeState
Trigger1 = AnimTime = 0
value = 50
ctrl = 1

;---------------------------------------------------------------------------
;--------------------------------------------------------------------------
;Grab Escape - p2
[statedef 835]
type = A
movetype = H
physics = N
ctrl = 0

[state 835, changeanim]
type = changeanim
trigger1 = time = 0
value = ifelse(animexist(43),43, 41)

;[state 1400, dim]
;type = bgpalfx
;trigger1 = time = 0
;time = 8
;mul = 200,200,200

;[state 805, freeze]
;type = pause
;trigger1 = time = 0
;time = 8
;endcmdbuftime = 8

;[state 805, sound]
;type = playsnd
;trigger1 = time = 0
;value = S805,0

[state 835, playerpush]
type = playerpush
trigger1 = 1
value = 0

[state 835, posset]
type = posset
trigger1 = time = 0
y = enemynear,pos y 
persistent = 0
ignorehitpause = 1


[state 835, targetfacing]
type = targetfacing
trigger1 = time = 0
value = -1
persistent = 1

[state 835, velset]
type = velset
trigger1 = time = 1
x= -6
y= -2

[state 835, gravity]
type = gravity
trigger1 = time > 0

[state 835, nothitby]
type = nothitby
trigger1 = 1
value = SCA

[state 835, end1]
type = selfstate
trigger1 = time >= 30
value = 50
ctrl = 1

[state 835, end]
type = selfstate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 52

;--------------------------------------------------------------------------
;Grab Escape - p1
[statedef 836]
type = A
movetype = H
physics = N
anim = 43
ctrl = 0

[state 1400, dim]
type = bgpalfx
trigger1 = time = 0
time = 12
mul = 200,200,200

[state 805, freeze]
type = pause
trigger1 = time = 0
time = 12
endcmdbuftime = 8

[state 805, sound]
type = playsnd
trigger1 = time = 0
value = S805,0

[state 835, targetfacing]
type = targetfacing
trigger1 = time = 0
value = -1
persistent = 1

[state 835, velset]
type = velset
trigger1 = time = 1
x= -6
y= -2

[state 835, gravity]
type = gravity
trigger1 = time > 0

[state 835, nothitby]
type = nothitby
trigger1 = 1
value = SCA

[state 835, end1]
type = selfstate
trigger1 = time >= 29
value = 50
ctrl = 1

[state 835, end]
type = selfstate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 52

;---------------------------------------------------------------------------
;Throw animation
[Statedef 840]
type    = A
movetype= A
physics = N
anim = 810
poweradd = 170

[state 840, tech]
type = changestate
triggerall = numtarget
trigger1 = target(800),stateno = 835
value = 836
persistent = 1

[State 840, Holding Direction?]
type = VarSet
trigger1 = Time = 0
var(2) = command = "holdfwd"

[state 840, width]
type = width
trigger1 = time > 0
edge = 100,150

[state 840, velset]
type = velmul
trigger1 = time = 0
x = 0.1
y = 0.1

[State 840, Bind 1]
type = TargetBind
trigger1 = AnimElemTime(2) < 0
pos = 150, -140

[State 840, Bind 2]
type = TargetBind
trigger1 = AnimElemTime(2) >= 0 && AnimElemTime(3) < 0
pos = 130, -140


[State 840, holdfwd - Turn 6] ;If was holding fwd before, turn now
type = Turn
trigger1 = var(2)
trigger1 = AnimElem = 2

[State 840, holdfwd - Pos 6] ;If was holding fwd before, move a little
type = PosAdd
trigger1 = var(2)
trigger1 = AnimElemtime(2) = 2
x = -37

[State 840, holdfwd - Turn Target 6] ;If was holding fwd before, turn target too
type = TargetFacing
trigger1 = var(2)
trigger1 = AnimElem = 2
value = -1

[State 840, Bind 3]
type = TargetBind
trigger1 = AnimElemTime(3) >= 0 && AnimElemTime(4) < 0
pos = 125, -140

[State 840, Bind 4]
type = TargetBind
trigger1 = AnimElemTime(4) >= 0 && AnimElemTime(5) < 0
pos = 125, -140

[state 840, Jump]
type = velset
trigger1 = animelemtime(5) = 0
y = -18
x = -2

[state 840, gravity]
type = gravity
trigger1 = animelemtime(5) > 0

[State 840, Bind 5]
type = TargetBind
trigger1 = AnimElemTime(5) >= 0 && AnimElemTime(6) < 0
pos = 10, -290

[State 840, Bind 6]
type = TargetBind
trigger1 = AnimElemTime(6) >= 0 && AnimElemTime(7) < 0
pos = 0, -310

[State 840, Bind 7]
type = TargetBind
trigger1 = AnimElemTime(7) >= 0 
pos = -75, -90

[State 840, State End]
type = ChangeState
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 841


;---------------------------------------------------------------------------
;Landing
[Statedef 841]
type = C
movetype = A
physics = N

[state 841, anim]
type = changeanim
trigger1 = time = 0
value = 812

[state 841, fx]
type = explod
trigger1 = time = 0
anim = F61
pos = 0,0
scale = 3,1.5
ownpal = 1

;Custom Dust
[state 841, explod]
type = explod
trigger1 = time = 0
anim = 2000
pos = 0,0
scale = const(size.xscale)*2,const(size.yscale)*1
ontop = 1
ownpal=1

[state 841, explod]
type = explod
trigger1 = time = 0
anim = 2001
pos = 0,0
scale = const(size.xscale)*2,const(size.yscale)*1
sprpriority = -4
ownpal=1

[State 841, Hurt 11]
type = TargetLifeAdd
trigger1 = time = 0
value = -150

[state 841, pos]
type = posset
trigger1 = time = 0
y = 0

[state 841, vel]
type = velset
trigger1 = time = 0
x = 0
y = 0

[state 841, snd]
type = playsnd
trigger1 = time = 0
value =S1,1

[state 841, snd]
type = playsnd
trigger1 = time = 0
value =S1,1

[state 841, crushed]
type = targetstate
trigger1 = time = 0
value = 851

[state 841, earthquakes]
type = envshake
trigger1 = time = 0
time = 30
ampl = 25


[state 841, end]
type = changestate
trigger1 = time = 18
value = 842

;--------------------------------------------------------------------------
[statedef 842]
type = A
movetype = I
physics = N

[state 842, invun]
type = nothitby
trigger1 = 1
value = SCA

[state 842, turn]
type = turn
trigger1 = time = 0

[state 842, jump]
type = velset
trigger1 = time = 0
x = -2
y = -8

[state 842, gravity]
type = gravity
trigger1 = pos y < 0

[state 842, change animation]
type = changeanim
trigger1 = time = 0
value = 44

[state x, combo dampener]
type = varadd
trigger1 = time = 2
v = 18
value = -18
persistent = 0
ignorehitpause =1

[state 842, end]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
trigger1 = time > 2
value = 52

;---------------------------------------------------------------------------
;Techable Thrown
[Statedef 850]
type    = A
movetype= H
physics = N
velset = 0,0

[State 850, 1]
type = ChangeAnim2
Trigger1 = Time = 0
value = 820

[state 850, screenbound]
type = screenbound
trigger1 = 1
movecamera = 1,0
value = 0

[state 850, tech throw]
type = changestate
triggerall = time < 12
trigger1 = ailevel = 0
trigger1 = command = "holdfwd" || command = "holdback"
trigger1 = command = "y" || command = "b" || command = "z" || command = "c"
trigger2 = command = "x" && command = "a"
trigger3 = ailevel > 4 
trigger3 = random < (ailevel * ifelse(ailevel>7,1,3))
value = 835

[State 850, 2]
type = SelfState
trigger1 = !gethitvar(isbound)
value = 5050

;---------------------------------------------------------------------------
[Statedef 851]
type    = A
movetype= H
physics = C
velset = 0,0

[state 851, posset]
type = posset
trigger1 = time = 0
y = 0

[state 851, anim]
type = changeanim 
trigger1 = time = 0
value = 5100

[state 851, vel set]
type = velset
trigger1 = time = 18
y = -21

[state 851, gravity]
type = gravity
trigger1 = time > 19

[state 851, anim]
type = changeanim
trigger1 = time >= 18
value = 5160


[State 851, 4] ;Hit ground
type = SelfState
trigger1 = time >= 18
trigger1 = pos y > 0
trigger1 = vel y > - pos y
value = 5110 

;---------------------------------------------------------------------------
;UnTechable Thrown
[Statedef 852]
type    = A
movetype= H
physics = N
velset = 0,0

[State 820, 1]
type = ChangeAnim2
Trigger1 = Time = 0
value = 820

[state 810, screenbound]
type = screenbound
trigger1 = 1
movecamera = 1,0
value = 0

[State 820, 2]
type = SelfState
trigger1 = !gethitvar(isbound)
value = 5050



;---------------------------------------------------------------------------
;Butt bump Light
[Statedef 1000]
type = S
movetype = A
physics = N
sprpriority = 2
ctrl = 0
velset = 0,0
poweradd = 140

[state 1000, unthrowable time]
type = nothitby
trigger1 = animelemtime(1) > 0  && animelemtime(4) < 0
value = ,AT

[state 1000, playerpush]
type = playerpush
trigger1 = enemy,statetype = L
value = 0

[state 1000, playerpush]
type = playerpush
trigger1 = enemy,statetype != L
value = 1

[state 1000, animation]
type = changeanim
trigger1 = anim != 1000
value = 1000

[state 1000, armor counter]
type = varset
trigger1 = time = 0
trigger1 = Var(21) = 1
V = 20
value = 1

[state 1000, excess armor check]
type = varset
trigger1 = var(20) > 3
var(20) = 1
persistent = 1
ignorehitpause = 1

[state 1000, snd]
type = playsnd
trigger1 = animelem = 4
value = S1000,0
ignorehitpause 


[state 1000, change]
type = statetypeset
trigger1 = pos y < -1
statetype = A

[state 1000, armor intiator turn off]
type = varset
trigger1 = time = 1
V = 21
value = 0

[state 1000, still take damage]
type = lifeadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) != 0
value = floor(-gethitvar(damage)*0.5)
persistent = 1

[state 1000, armor count down]
type = varadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) > 0
V = 20
value = -1
persistent = 1

[state 1000, Unstoppable]
type = hitoverride
trigger1 = alive
trigger1 = Var(20) > 0
attr = SCA, AA, AP
stateno = 1000
time = 1
persistent = 1

[State 1000, flash red]
type = PalFX
trigger1 = Time = 0
trigger1 = gethitvar(damage) != 0
time = 7
add = 100,0,0
IgnoreHitPause = 1

;determine what frame
[state 1000, remember frame]
type = varset
trigger1 = time <= 0
v = 22
value = animelemno(0)
ignorehitpause = 1

;delay effect
[state 1000, delay]
type = changeanim 
trigger1 = var(31) < ifelse(animelemtime(4) < 0, floor(gethitvar(hittime)*0.75),floor(gethitvar(hittime)*0.05))
value = anim
elem = var(22)

[state 1000, freeze location]
type = posfreeze
trigger1 = var(31) < ifelse(animelemtime(4) < 0, floor(gethitvar(hittime)*0.75),floor(gethitvar(hittime)*0.05))
value = 1
;--------------------------

[state 1000, explod]
type = explod
trigger1 = animelem = 6
anim = 1001
sprpriority = -1
bindtime = -1
id = 1001
ignorehitpause = 0
scale =  Const(size.xscale),Const(size.yscale)


[state 1000, velset]
type = velset
trigger1 = animelem = 4
trigger2 = animelem = 5
y = -7
x = 21

;[state 1000, wind]
;type = explod
;trigger1 = animelem = 6
;anim = 2050
;pos = 180,-160
;postype = p1
;bindtime = -1
;removetime = 24
;scale = const(size.xscale)*2, const(size.yscale)*2
;sprpriority = 4
;ownpal = 1
;removeongethit = 1

[state 1000, no autoturn]
type = assertspecial
trigger1 = 1
flag = noautoturn

[state 1000, velset]
type = velset
triggerall = !movecontact
trigger1 = animelem = 6
trigger2 = animelem = 7
x = 21

[state 1000, slowdown impact]
type = velmul
trigger1 = moveguarded 
x = 0.6

;[state 1000, slowdown impact]
;type = velmul
;trigger1 = movehit
;x = 0.8

[state 1000, gravity]
type = gravity
trigger1 = pos y < -1

[state 1010, set]
type = statetypeset
trigger1 = pos y < -1
statetype = A

[State 1000, Hitdef]
type = HitDef
trigger1 = !movecontact
persistent = 0
attr = A, SA
damage    = 160,32
guardflag = MA
hitflag = MAF
priority = 4
pausetime = ifelse(!enemynear,ishelper,16,2),ifelse(!enemynear,ishelper,18,2)
guard.pausetime = ifelse(!enemynear,ishelper, 14, 2),14
sparkno = 3
id = 1000
nochainid = 1000
sparkxy = -10,-100
hitsound   = S240,0
guardsound = S120,0
animtype = back
ground.type = High
ground.slidetime = ifelse(!enemynear,ishelper,35,2)
ground.hittime  = ifelse(!enemynear,ishelper,40,2)
ground.velocity = -50,ifelse(var(7) > 1, -20, -4)
air.velocity = -50,ifelse(var(7) > 1, -15, -4)
fall = 1
p2facing = 1
fall.recover = 0
envshake.freq = 80
envshake.ampl = 8
envshake.time = 12
guard.velocity = -54       
guard.hittime = 40
guard.slidetime = 40
airguard.velocity = -18,-10
airguard.hittime = 40
guard.dist = 380

[state 1000, wall bound]
type = targetstate
trigger1 = movehit
trigger1 = var(7) > 0
trigger1 = hitpausetime = 1
value = 675
ignorehitpause = 1

[state 1000, width]
type = width
trigger1 = animelem = 1 
trigger2 = animelem = 2
trigger3 = animelem = 3
value = 130,0

[state 1000, width]
type = width
trigger1 = animelem = 4 
trigger2 = animelem = 5
value = 110,0

[state 1000, width]
type = width
trigger1 = animelem = 6 
trigger2 = animelem = 7
value = 110,0

[state 1000, wall bounce count]
type = varadd
trigger1 = movehit
var(7) = -1 
persistent = 0
ignorehitpause = 1


[state -2, removeexplod]
type = removeexplod
trigger1 = vel y > 0
trigger1 = pos y > -vel y
id = 1001

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -3
persistent = 0
ignorehitpause = 1

[state 1000, end]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 1001
ignorehitpause

;----------------------------------0
; Landing
[statedef 1001]
type = S
movetype = A
physics = S
ctrl = 0
anim = 1002
movehitpersist = 1
velset = 0,0

[state 1001, fx]
type = explod
trigger1 = time = 0
anim = F61
pos = 0,0
scale = 4,2
ownpal = 1

;Custom Dust
[state 651, explod]
type = explod
trigger1 = time = 0
anim = 2000
pos = 0,0
scale = const(size.xscale)*2.75,const(size.yscale)*1.5
ontop = 1
ownpal=1

[state 651, explod]
type = explod
trigger1 = time = 0
anim = 2001
pos = 0,0
scale = const(size.xscale)*2.75,const(size.yscale)*1.5
sprpriority = -4
ownpal=1

[state 1001, playerpush]
type = playerpush
trigger1 = enemy, statetype = L
value = 0

[state 1001, playerpush]
type = playerpush
trigger1 = enemy, statetype != L
value = 1

[state 1000, width]
type = width
trigger1 = 1
value = 80,50

[State 1011, 3]
type = HitDef
trigger1 = Time = 0
trigger1 = !movecontact
attr = A, SA
damage    = 180
hitflag = FD
priority = 4
nochainid = 1400
pausetime = 0,0
hitsound   = S240,0
guardsound = S120, 0
animtype = back
p2stateno = 661
ground.type = High
ground.slidetime = 30
ground.hittime  = 20
ground.velocity = 0,0
guard.hittime = 20
guard.velocity = -40
airguard.velocity = 0,0
air.velocity = 0,0

[state 1001, quake]
type = envshake
trigger1 = time = 0
time = ifelse (var(15)=0, 15, 20)
ampl = ifelse (var(15)=0, -15, -20)
freq = 100
phase = 100

[state 1001, snd]
type = playsnd
trigger1 = time = 0
value = S1,2


[state 1001, pos]
type = posset
trigger1 = time = 0
y = 0

[state 1001, end]
type = changestate
trigger1 = time = 4
value = 1002
;--------------------------------------------------------------------------
;bounce
[statedef 1002]
type = A
movetype = I
physics = S
anim = 1003
movehitpersist = 1

[state 1002, playerpush]
type = playerpush
trigger1 = enemy, statetype = L
value = 0

[state 1002, playerpush]
type = playerpush
trigger1 = enemy, statetype != L
value = 1

[state 1011, velset]
type = velset
trigger1 = time = 0
y = -4

[state 1012, gravity]
type = gravity
trigger1 = time > 2

[state 1012, end]
type = changestate
triggerall = time > 2
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 1003
;-------------------------------
; Landing
[statedef 1003]
type = S
movetype = I
physics = S
ctrl = 0
anim = 1004
movehitpersist = 1

[state 1001, playerpush]
type = playerpush
trigger1 = enemy, statetype = L
value = 0

[state 1001, playerpush]
type = playerpush
trigger1 = enemy, statetype != L
value = 1


[state 1003, quake]
type = envshake
trigger1 = time = 0
time = 10
ampl = -8
freq = 100
phase = 100

[state 1003, velset]
type = velset
trigger1 = time = 0
y = 0

[state 1003, velset]
type = velset
trigger1 = time = 0
x = 0

[state 1003, snd]
type = playsnd
trigger1 = time = 0
value = S1,2


[state 1003, pos]
type = posset
trigger1 = time = 0
y = 0

[state 1003, end]
type = changestate
trigger1 = animtime = 0
value = 657

;---------------------------------------------------------------------------
;Butt Bump Heavy
[Statedef 1010]
type = S
movetype = A
physics = N
sprpriority = 2
ctrl = 0
velset = 0,0
poweradd = 140

[state 1000, snd]
type = playsnd
trigger1 = animelem = 4
value = S1000,0
ignorehitpause

[state 1010, unthrowable time]
type = nothitby
trigger1 = animelemtime(1) > 0  && animelemtime(4) < 0
value = ,AT

[state 1010, playerpush]
type = playerpush
trigger1 = enemy,statetype = L
value = 0

[state 1010, playerpush]
type = playerpush
trigger1 = enemy,statetype != L
value = 1

[state 1000, no autoturn]
type = assertspecial
trigger1 = 1
flag = noautoturn
ignorehitpause

[state 1010, animation]
type = changeanim
trigger1 = anim != 1010
value = 1010

[state 1010, armor counter]
type = varset
trigger1 = time = 0
trigger1 = Var(21) = 1
V = 20
value = 2

[state 1000, excess armor check]
type = varset
trigger1 = var(20) > 5
var(20) = 2
persistent = 1
ignorehitpause = 1

[state 1010, change]
type = statetypeset
trigger1 = animelemtime(4) = 1
statetype = A

[state 1010, armor intiator turn off]
type = varset
trigger1 = time = 1
V = 21
value = 0

[state 1010, still take damage]
type = lifeadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) != 0
value = floor(-gethitvar(damage)*0.5)
persistent = 1

[state 1010, armor count down]
type = varadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) > 0
V = 20
value = - 1
persistent = 1

[state 1010, Unstoppable]
type = hitoverride
trigger1 = Life > 1
trigger1 = Var(20) > 0
attr = SCA, AA, AP
stateno = 1010
time = 1
persistent = 1

[State 1010, flash red]
type = PalFX
trigger1 = Time = 0
trigger1 = gethitvar(damage) != 0
time = 7
add = 100,0,0
IgnoreHitPause = 1

;determine what frame
[state 1010, remember frame]
type = varset
trigger1 = time <= 0
v = 22
value = animelemno(0)
ignorehitpause = 1

;delay effect
[state 1010, delay]
type = changeanim 
trigger1 = var(31) < ifelse(animelemtime(4) < 0, floor(gethitvar(hittime)*0.9),floor(gethitvar(hittime)*0.05))
value = anim
elem = var(22)

[state 1010, freeze location]
type = posfreeze
trigger1 = var(31) < ifelse(animelemtime(4) < 0, floor(gethitvar(hittime)*0.9),floor(gethitvar(hittime)*0.05))
value = 1
;--------------------------

[state 1010, explod]
type = explod
trigger1 = animelem = 6
anim = 1011
sprpriority = -1
bindtime = -1
id = 1011
ignorehitpause = 1
scale =  Const(size.xscale),Const(size.yscale)

[state 1010, forward]
type = velset
trigger1 = animelem = 4
trigger2 = animelem = 5
x = 27
y = -7

;[state 1000, wind]
;type = explod
;trigger1 = animelem = 6
;anim = 2050
;pos = 180,-160
;postype = p1
;bindtime = -1
;removetime = 24
;scale = const(size.xscale)*1.5, const(size.yscale)*1.5
;sprpriority = 4
;ownpal = 1
;removeongethit = 1

[state 1010, velset]
type = velset
triggerall = !movecontact
trigger1 = animelem = 6
trigger2 = animelem = 7
x = 27

[state 1010, set]
type = statetypeset
trigger1 = pos y < -1
statetype = A

[state 1010, slowdown impact]
type = velmul
trigger1 = moveguarded
x = 0.6

[state 1010, gravity]
type = gravity
trigger1 = pos y < -1

[State 1010, Hitdef]
type = HitDef
trigger1 = !movecontact
attr = A, SA
damage    =  200,40
persistent = 0
guardflag = MA
hitflag = MAF
priority = 4
id = 1010
nochainid = 1010
pausetime = ifelse(!enemynear,ishelper,16,2),ifelse(!enemynear,ishelper,18,2)
guard.pausetime = ifelse(!enemynear,ishelper, 14, 2),14
sparkno = 3
p2facing = 1
sparkxy = -10,-100
hitsound   = S240,0
guardsound = S120,0
animtype = back
ground.type = High
ground.slidetime = ifelse(!enemynear,ishelper,40,2)
ground.hittime  = ifelse(!enemynear,ishelper,50,2)
ground.velocity = -75,ifelse(var(7) > 1, -25, -4)
air.velocity = -75,ifelse(var(7) > 1, -20, -4)
fall = 1
fall.recover = 0
envshake.freq = 60
envshake.ampl = 12
envshake.time = 12
guard.velocity = -63        
guard.hittime = 30
guard.slidetime = 30
airguard.velocity = -20,-10
airguard.hittime = 40
guard.dist = 380

[state 1010, wall bound]
type = targetstate
trigger1 = movehit
trigger1 = var(7) > 0
trigger1 = hitpausetime = 1
value = 675
ignorehitpause = 1

[state 1010, wall bounce count]
type = varadd
trigger1 = movehit
var(7) = -1 
persistent = 0
ignorehitpause = 1

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -3
persistent = 0
ignorehitpause = 1

[state 1000, width]
type = width
trigger1 = animelem = 1 
trigger2 = animelem = 2
trigger3 = animelem = 3
value = 130,0

[state 1000, width]
type = width
trigger1 = animelem = 4 
trigger2 = animelem = 4
value = 100,0

[state 1000, width]
type = width
trigger1 = animelem = 6 
trigger2 = animelem = 7
value = 120,0


[state -2, removeexplod]
type = removeexplod
trigger1 = vel y > 0
trigger1 = pos y > -vel y
id = 1001

[state 1000, end]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 1011

;----------------------------------0
; Landing
[statedef 1011]
type = S
movetype = A
physics = S
ctrl = 0
anim = 1012

[state 1001, fx]
type = explod
trigger1 = time = 0
anim = F61
pos = 0,0
scale = 4,2
ownpal = 1

;Custom Dust
[state 651, explod]
type = explod
trigger1 = time = 0
anim = 2000
pos = 0,0
scale = const(size.xscale)*2.75,const(size.yscale)*1.5
ontop = 1
ownpal=1

[state 651, explod]
type = explod
trigger1 = time = 0
anim = 2001
pos = 0,0
scale = const(size.xscale)*2.75,const(size.yscale)*1.5
sprpriority = -4
ownpal=1

[state 1011, playerpush]
type = playerpush
trigger1 = enemy, statetype = L
value = 0

[state 1011, playerpush]
type = playerpush
trigger1 = enemy, statetype != L
value = 1


[state 1011, quake]
type = envshake
trigger1 = time = 0
time = 20
ampl = -15
freq = 100
phase = 100

[State 1011, 3]
type = HitDef
trigger1 = Time = 0
trigger1 = !movecontact
attr = A, SA
damage    = 180
hitflag = FD
priority = 4
nochainid = 1400
pausetime = 0,0
hitsound   = S240,0
guardsound = S120, 0
animtype = back
p2stateno = 661
ground.type = High
ground.slidetime = 30
ground.hittime  = 20
ground.velocity = 0,0
guard.hittime = 20
guard.velocity = -40
airguard.velocity = 0,0
air.velocity = 0,0


[state 1011, velset]
type = velset
trigger1 = time = 0
y = 0

[state 1011, velset]
type = velmul
trigger1 = time = 0
x = 0.5

[state 1011, snd]
type = playsnd
trigger1 = time = 0
value = S1,2


[state 1011, pos]
type = posset
trigger1 = time = 0
y = 0

[state 1011, end]
type = changestate
trigger1 = time = 6
value = 1012
;---------------------------------------------------------------------------
;bounce
[statedef 1012]
type = A
movetype = I
physics = S
anim = 1013

[state 1012, playerpush]
type = playerpush
trigger1 = enemy, statetype = L
value = 0

[state 1012, playerpush]
type = playerpush
trigger1 = enemy, statetype != L
value = 1

[state 1011, velset]
type = velset
trigger1 = time = 0
y = -4

[state 1012, gravity]
type = gravity
trigger1 = time > 2

[state 1012, end]
type = changestate
triggerall = time > 2
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 1013
;-------------------------------
; Landing
[statedef 1013]
type = S
movetype = I
physics = S
ctrl = 0
anim = 1014

[state 1011, quake]
type = envshake
trigger1 = time = 0
time = 10
ampl = -8
freq = 100
phase = 100

[state 1011, velset]
type = velset
trigger1 = time = 0
y = 0

[state 1011, velset]
type = velset
trigger1 = time = 0
x = 0

[state 1011, snd]
type = playsnd
trigger1 = time = 0
value = S1,2


[state 1011, pos]
type = posset
trigger1 = time = 0
y = 0

[state 1011, end]
type = changestate
trigger1 = animtime = 0
value = 657


;---------------------------------------------------------------------------
;Butt Bump EX version
[Statedef 1020]
type = C
movetype = A
physics = N
sprpriority = 2
ctrl = 0
velset = 0,0

[state 1000, snd]
type = playsnd
trigger1 = animelem = 4
value = S1000,0
ignorehitpause

[state 1000, unthrowable time]
type = nothitby
trigger1 = animelemtime(1) > 0  && animelemtime(4) < 0
value = ,AT

[State 1020, Blink Yellow]
type = PalFX
trigger1 = time%2
time = 1
add = 150,75,0 ;32,16,0
sinadd = 64,32,5,3
ignorehitpause

[state 1000, no autoturn]
type = assertspecial
trigger1 = 1
flag = noautoturn

[state 1020, poweradd]
type = poweradd
triggerall = prevstateno != 1020
trigger1 = time = 5
value = -500

[state 1010, change]
type = statetypeset
trigger1 = 14
statetype = A

;Armor Status

[state 1020, animation]
type = changeanim
trigger1 = anim != 1020
value = 1020

[state 1020, armor counter]
type = varset
trigger1 = time = 0
trigger1 = Var(21) = 1
V = 20
value = 1

[state 1020, excess armor check]
type = varset
trigger1 = var(20) > 3
var(20) = 1
persistent = 1
ignorehitpause = 1

[state 1020, armor intiator turn off]
type = varset
trigger1 = time = 1
V = 21
value = 0

[state 1020, still take damage]
type = lifeadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) != 0
value = floor(-gethitvar(damage)*0.5)
persistent = 1

[state 1020, armor count down]
type = varadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) > 0
V = 20
value = - 1
persistent = 1

[state 1020, Unstoppable]
type = hitoverride
trigger1 = Life > 1
trigger1 = var(20) > 0
attr = SCA, AA, AP
stateno = 1020
time = 1
persistent = 1

[State 1020, flash red]
type = PalFX
trigger1 = gethitvar(damage) != 0
time = 8
add = 140,0,0
IgnoreHitPause = 1

[state 1020, explod]
type = explod
trigger1 = animelemtime(6) = 0
anim = 1021
sprpriority = -1
bindtime = -1
id = 1021
ignorehitpause = 0
scale =  Const(size.xscale),Const(size.yscale)

[state 1000, Aura Front]
type = explod
trigger1 = animelem = 6
anim = 2030
sprpriority = 3
scale =  Const(size.xscale),Const(size.yscale)
id = 2030
bindtime = -1
removeongethit = 1
ignorehitpause = 1

[state 1000, Aura Back]
type = explod
trigger1 = animelem = 6
anim = 2031
sprpriority = -2
scale =  Const(size.xscale),Const(size.yscale)
id = 2031
bindtime = -1
removeongethit = 1
ignorehitpause = 1

[state 1020, velset]
type = velset
trigger1 = time = 14
y = -7

[state 1020, velset]
type = velset
trigger1 = time > 14 && time < 37
trigger1 = !movecontact
x = 30

[state 1010, brakes]
type = velset
trigger1 = time = 37
trigger1 = !movecontact
x = 0

[state 1020, slowdown impact]
type = velmul
trigger1 = movecontact
x = 0.1

[state 1020, gravity]
type = gravity
trigger1 = time > 15

[State 1020, 3]
type = HitDef
trigger1 = Time = 0
attr = A, SA
damage    = 150,30
persistent = 0
guardflag = MA
hitflag = MAF
priority = 4
id = 1020
p2facing = 1
nochainid = 1020
getpower = 0
pausetime = 16,18
sparkno = 3
sparkxy = -10,-100
hitsound   = S240,0
guardsound = S120,0
animtype = back
ground.type = High
ground.slidetime = 12
ground.hittime  = 20
ground.velocity = -100,ifelse(var(7) > 1, -30, -4)
guard.hittime = 45
guard.velocity = -52
airguard.velocity = -30,-10
air.velocity = -100,ifelse(var(7)>1,-25,-4)
fall = 1
fall.recover = 0
envshake.freq = 80
envshake.ampl = -15
envshake.time = 18
guard.dist = 380

[state 1022, wall bound]
type = targetstate
trigger1 = movehit
trigger1 = var(7) > 0
trigger1 = hitpausetime = 1
value = 670
ignorehitpause = 1

[state 1022, wall bounce count]
type = varadd
trigger1 = movehit
var(7) = -1 
persistent = 0
ignorehitpause = 1

[state 1020, removeexplod]
type = removeexplod
trigger1 = vel y > 0
trigger1 = pos y > -vel y
id = 1021

[state 210, combo damage]
type = varadd
trigger1 = movehit
v = 18
value = -18
ignorehitpause = 1
persistent = 0

[state 1020, end]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 1021

;----------------------------------
; Lands on feet
[statedef 1021]
type = S
movetype = I
physics = S
ctrl = 0
anim = 1025

[state 1021, removeexplod]
type = removeexplod
trigger1 = time = 0
id = 2030
id = 2031

[state 1021, turn]
type = turn
trigger1 = time = 0


[state 1021, skid]
type = velset
trigger1 = time = 0
y = 0

[state 1021, skid]
type = velmul
trigger1 = time = 0
x = 0.25

[state 1021, quake]
type = envshake
trigger1 = time = 0
time = ifelse (var(15)=0, 15, 20)
ampl = ifelse (var(15)=0, -15, -20)
freq = 100
phase = 100

[state 1001, fx]
type = explod
trigger1 = time = 0
anim = F61
pos = 0,0
scale = 3,2
ownpal = 1

[state 1021, snd]
type = playsnd
trigger1 = time = 0
value = S1,2


[state 1021, pos]
type = posset
trigger1 = time = 0
y = 0

[state 1021, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1

;-------------------------------------------------------------------------
;Butt Bump EX version 2nd hit
[Statedef 1022]
type = A
movetype = A
physics = N
sprpriority = 2
ctrl = 0
velset = 0,0

[State 1022, Blink Yellow]
type = PalFX
trigger1 = 1
time = 6
add = 32,16,0
sinadd = 64,32,5,3

[state 1022, animation]
type = changeanim
trigger1 = anim != 1022
value = 1022

[state 1022, unstoppable ass-more armor]
type = varadd
trigger1 = animelemtime(1) = 1
v = 20
value = 98
persistent = 0
ignorehitpause = 1

[state 1000, snd]
type = playsnd
trigger1 = animelem = 1
value = S1000,0
ignorehitpause

[state 1022, still take damage]
type = lifeadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) != 0
value = floor(-gethitvar(damage)*0.5)
persistent = 1

[state 1022, armor count down]
type = varadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) > 0
V = 20
value = - 1
persistent = 1

[state 1022, Unstoppable]
type = hitoverride
trigger1 = Life > 1
trigger1 = var(20) > 0
attr = SCA, AA, AP
stateno = 1022
time = 1
persistent = 1

[State 1022, flash red]
type = PalFX
trigger1 = Time = 0
trigger1 = gethitvar(damage) != 0
time = 7
add = 140,0,0
IgnoreHitPause = 1

[state 1022, explod]
type = explod
trigger1 = animelem = 2
anim = 1023
sprpriority = -1
bindtime = -1
id = 1023
ignorehitpause = 1
scale =  Const(size.xscale),Const(size.yscale)

[state 1020, velset]
type = velset
trigger1 = time = 0
y = -10

[state 1020, velset]
type = velset
trigger1 = time > 0
x = 18

[state 1020, brakes]
type = velset
trigger1 = time = 37
trigger1 = !movecontact
x = 0

[state 1020, slowdown impact]
type = velmul
trigger1 = movecontact
x = 0.8

[state 1022, gravity]
type = gravity
trigger1 = time > 1

[State 1022, 3]
type = HitDef
trigger1 = Time = 0
attr = A, SA
damage    = 110,33
persistent = 0
guardflag = MA
hitflag = MAF
priority = 4
getpower = 0
pausetime = 18,18
sparkno = 3
sparkxy = -10,-100
hitsound   = S240,0
guardsound = S120, 0
animtype = back
ground.type = High
ground.slidetime = 12
ground.hittime  = 20
ground.velocity = -40,-16
guard.hittime = 45
guard.velocity = -45
airguard.velocity = -30,-5
air.velocity = -40,-22
fall = ifelse(var(7) > 0,0,1)
fall.recover = 0
envshake.freq = 80
envshake.ampl = -15
envshake.time = 15
guard.dist = 335

[state 1022, wall bound]
type = targetstate
trigger1 = movehit
trigger1 = var(7) > 0
value = 670
ignorehitpause = 1

[state 1022, wall bounce count]
type = varadd
trigger1 = movehit
var(7) = -1 
persistent = 0
ignorehitpause = 1

[state 1022, removeexplod]
type = removeexplod
trigger1 = vel y > 0
trigger1 = pos y > -vel y
id = 1023

[state 1020, end]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 1023

;-------------------------------------------------------------------------
; Landing
[statedef 1023]
type = C
movetype = A
physics = C
ctrl = 0
anim = 1012

[state 1001, fx]
type = explod
trigger1 = time = 0
anim = F61
pos = 0,0
scale = 6,3
ownpal = 1

;Custom Dust
[state 651, explod]
type = explod
trigger1 = time = 0
anim = 2000
pos = 0,0
scale = const(size.xscale)*2.75,const(size.yscale)*1.5
ontop = 1
ownpal=1

[state 651, explod]
type = explod
trigger1 = time = 0
anim = 2001
pos = 0,0
scale = const(size.xscale)*2.75,const(size.yscale)*1.5
sprpriority = -4
ownpal=1


[state 1023, quake]
type = envshake
trigger1 = time = 0
time = 20
ampl = -15
freq = 100
phase = 100

[state 1023, velset]
type = velset
trigger1 = time = 0
y = 0

[State 1011, 3]
type = HitDef
trigger1 = Time = 0
trigger1 = !movecontact
attr = A, SA
damage    = 240
hitflag = FD
priority = 4
pausetime = 0,0
hitsound   = S240,0
guardsound = S120, 0
animtype = back
p2stateno = 660
ground.type = High
ground.slidetime = 30
ground.hittime  = 20
ground.velocity = 0,0
guard.hittime = 20
guard.velocity = -40
airguard.velocity = 0,0
air.velocity = 0,0

[state 1023, velset]
type = velmul
trigger1 = time = 0
x = 0.5

[state 1023, snd]
type = playsnd
trigger1 = time = 0
value = S1,2


[state 1023, pos]
type = posset
trigger1 = time = 0
y = 0

[state 1023, end]
type = changestate
trigger1 = time = 6
value = 1024
;---------------------------------------------------------------------------
;bounce
[statedef 1024]
type = A
movetype = I
physics = S
anim = 1013

[state 1024, velset]
type = velset
trigger1 = time = 0
y = -4

[state 1024, gravity]
type = gravity
trigger1 = time > 2

[state 1024, end]
type = changestate
triggerall = time > 2
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 1025
;-------------------------------------------------------------------------
;Land at rest
[statedef 1025]
type = S
movetype = I
physics = S
ctrl = 0
anim = 1004
velset = 0,0

[state 1025, quake]
type = envshake
trigger1 = time = 0
time = 12
ampl = -10
freq = 100
phase = 100

[state 1025, snd]
type = playsnd
trigger1 = time = 0
value = S1,2


[state 1025, pos]
type = posset
trigger1 = time = 0
y = 0

[state 1025, end]
type = changestate
trigger1 = animtime = 0
value = 657


;==========================================================================
; Pique Spin
;==========================================================================
[Statedef 1030]
type = S
movetype = A
physics = S
sprpriority = 2
ctrl = 0
velset = 0,0

[state 1030, anim]
type = changeanim
trigger1 = time = 0
value = 1030

[state 1030, velset]
type = velset
TRIGGERAll = command != "holdback"
trigger1 = animelem = 4
trigger2 = animelem = 5
x = 10

[state 1030, velset]
type = velset
TRIGGERAll = command = "holdback"
trigger1 = animelem = 4
trigger2 = animelem = 5
x = -2.5

[state 1030, spin power up counter]
type = varset
trigger1 = time = 0
var(26) = 0
ignorehitpause
persistent = 0

[state 1030, no fireballs]
type = nothitby
trigger1 = 1
value = ,AP
ignorehitpause = 1

[state 1030, poweradd]
type = poweradd
trigger1 = time = 0
value = 50

[state 1030, vel]
type = veladd
triggerall = ailevel = 0
trigger1 = command = "holdfwd"
x = 1.6

[state 1030, vel]
type = veladd
triggerall = ailevel > 0
trigger1 = p2bodydist x > 105
x = 1.6

[state 1030, vel]
type = veladd
triggerall = ailevel = 0
trigger1 = command = "holdback"
x = -1.6

[state 1030, vel]
type = veladd
triggerall = ailevel > 0
trigger1 = p2bodydist x < 95
x = -1.6

[State 1020, 3]
type = HitDef
trigger1 = Time = 0
trigger1 = var(12) > 0
attr = A, SA
damage    = 80,8
guardflag = MA
hitflag = MAF
priority = 3
pausetime = 12,12
sparkno = 3
sparkxy = -10,-180
hitsound   = 5,4
guardsound = S120, 0
animtype = back
ground.type = High
ground.slidetime = 32
ground.hittime  = 32
ground.velocity = -2,-22
air.velocity = -2,-18
fall = 1
fall.recover = 0
guard.velocity = -24      
guard.hittime = 22
guard.slidetime = 22
airguard.velocity = -6,-10
airguard.hittime = 34
guard.dist = 200

[State 1020, 3]
type = HitDef
trigger1 = Time = 0
trigger1 = var(12) <= 0
attr = A, SA
damage    = 80,8
guardflag = MA
hitflag = MAF
priority = 6
pausetime = 12,12
sparkno = 3
sparkxy = -10,-180
hitsound   = 5,4
guardsound = S120, 0
animtype = back
ground.type = High
ground.slidetime = 32
ground.hittime  = 32
ground.velocity = -2,-5
air.velocity = -2,-5
fall = 1
fall.recover = 0
guard.velocity = -8       
guard.hittime = 26
guard.slidetime = 32
airguard.velocity = -6,-10
airguard.hittime = 34
guard.dist = 200


[state 1030, spin launch limiter]
type = varadd
trigger1 = movehit
v = 12
value = -1
ignorehitpause = 1


[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -9
persistent = 0
ignorehitpause = 1

[state 1030, end]
type = changestate
trigger1 = animtime = 0
value = 1031

;-------------------------------------------------------------------------------------------
;Intitial Spin
[Statedef 1031]
type = S
movetype = I
physics = S
sprpriority = 2
ctrl = 0
velset = 0,0

[state 1031, spin plus]
type = varadd
trigger1 = time = 0
var(26) = 1

[state 1031, poweradd]
type = poweradd
trigger1 = time = 0
value = 50

[state 1031, playsnd]
type = playsnd
trigger1 = animelem = 2
value = S1030,0
ignorehitpause

[state 1031, anim]
type = changeanim
trigger1 = time = 0
value = 1031

[state 1031, nothitby]
type = nothitby
trigger1 = 1
value = ,AP
ignorehitpause = 1

[state 1030, vel]
type = veladd
triggerall = ailevel = 0
trigger1 = command = "holdfwd"
x = 1.6

[state 1030, vel]
type = veladd
triggerall = ailevel > 0
trigger1 = p2bodydist x > 105
x = 1.6

[state 1030, vel]
type = veladd
triggerall = ailevel = 0
trigger1 = command = "holdback"
x = -1.6

[state 1030, vel]
type = veladd
triggerall = ailevel > 0
trigger1 = p2bodydist x < 95
x = -1.6

[state 1033, end]
type = changestate
triggerall = animtime = 0
trigger1 = !ailevel
trigger1 = command != "aheld"  && command != "bheld"  && command != "cheld"
value = 0
ctrl = 1

[state 1033, AI end]
type = changestate
triggerall = !PlayerIdExist(helper(33333333),var(3)) && enemynear,numproj = 0
triggerall = AIlevel
trigger1 = p2bodydist x < 600
trigger1 = enemynear,ctrl = 1
trigger2 = p2bodydist x > 600  || p2bodydist x < 0
trigger3 = roundstate = 3
value = 0
ctrl = 1

[state 1032, Split Leg Drop]
type = changestate
triggerall = animtime >= -4
triggerall = command != "aheld"  && command != "bheld"  || command != "cheld"
trigger1 = ailevel = 0
trigger1 = command = "aheld"  && command != "bheld"
trigger1 = command != "holdback" || command != "holddown"
trigger2 = ailevel = 0
trigger2 = command = "bheld" && command != "aheld"
trigger2 = command != "holdback" || command != "holddown"
trigger3 = ailevel > 0
trigger3 = !inguarddist
trigger3 = enemy,statetype = C
value = 1042

[state 1032, clothesline]
type = changestate
triggerall = animtime >= -4
triggerall = var(26) >= 0 && var(26) <= 2
trigger1 = ailevel = 0
trigger1 = command = "xheld" 
trigger2 = ailevel = 0
trigger2 = command = "yheld"
trigger3 = ailevel > 0
trigger3 = !inguarddist
trigger3 = enemy,statetype != C || enemy,statetype != L
trigger3 = p2bodydist x < 160 && p2bodydist x > 0
value = 1035

[state 1032, clothesline]
type = changestate
triggerall = animtime >= -4
triggerall = var(26) > 2 && var(26) <= 4
trigger1 = ailevel = 0
trigger1 = command = "xheld" 
trigger2 = ailevel = 0
trigger2 = command = "yheld"
trigger3 = ailevel > 0
trigger3 = !inguarddist
trigger3 = enemy,statetype != C || enemy,statetype != L
trigger3 = p2bodydist x < 240 && p2bodydist x > 0
value = 1036

[state 1032, clothesline]
type = changestate
triggerall = animtime >= -4
triggerall = var(26) > 4 
trigger1 = ailevel = 0
trigger1 = command = "xheld" 
trigger2 = ailevel = 0
trigger2 = command = "yheld"
trigger3 = ailevel > 0
trigger3 = !inguarddist
trigger3 = enemy,statetype != C || enemy,statetype != L
trigger3 = p2bodydist x < 320 && p2bodydist x > 0
value = 1040

[state 1033, additional spins]
type = changestate
triggerall = animtime = 0
triggerall = roundstate = 2
trigger1 = ailevel = 0
trigger1 = command = "aheld"  && command = "bheld"  || command = "cheld"
trigger2 = ailevel > 0
;trigger2 = inguarddist
;trigger2 = p2bodydist x < var(40)
value = 1032




;---------------------------------------------------------------------------
;Additional spins, for variable time
[Statedef 1032]
type = S
movetype = I
physics = S
sprpriority = 2
ctrl = 0
velset = 0,0

[state 1031, poweradd]
type = poweradd
trigger1 = time = 0
value = 25

[state 651, fx]
type = explod
trigger1 = var(26) > 5
trigger1 = animelem = 4
anim = F61
pos = -40,0
scale = 2,1.5
ownpal = 1

[state 1031, anim]
type = changeanim
trigger1 = time = 0
trigger1 = var(26) < 10
value = ifelse(var(26) >= 4, 1049,1032)

[state 1031, anim]
type = changeanim
trigger1 = time = 0
trigger1 = var(26) >= 10
value = 1048

[State 1031, Blink red DANGER]
type = PalFX
trigger1 = var(26) >= 20
trigger1 = time%2
time = 1
add = 150,0,0 
sinadd = 64,32,5,3
ignorehitpause

[state 1036, earthquakes]
type = envshake
trigger1 = var(26) >= 30
time = 4
ampl = -8
freq = 40
phase = 40
persistent = 4

[state 1031, playsnd]
type = playsnd
trigger1 = animelem = 4
value = S1030,0
ignorehitpause

[State 1020, 3]
type = HitDef
trigger1 = animelem = 3
trigger2 = animelem = 7
attr = A, SA
damage    = 20,10
guardflag = MA
hitflag = MA
priority = 6
pausetime = 4,4
sparkno = 2
sparkxy = -10,-40
hitsound   = 5,4
guardsound = S120, 0
animtype = back
ground.type = High
ground.slidetime = 30
ground.hittime  = 16
guard.hittime = 8
ground.velocity = -2,0
guard.velocity = -6
airguard.velocity = -6,-2
air.velocity = -2,-1
fall = 0
air.fall = 1
fall.recover = 0

[state 1032, nothitby]
type = nothitby
trigger1 = 1
value = ,AP
ignorehitpause = 1

[state 1030, vel]
type = veladd
triggerall = ailevel = 0
trigger1 = command = "holdfwd"
x = 1.6

[state 1030, vel]
type = veladd
triggerall = ailevel > 0
trigger1 = p2bodydist x > 105
x = 1.6

[state 1030, vel]
type = veladd
triggerall = ailevel = 0
trigger1 = command = "holdback"
x = -1.6

[state 1030, vel]
type = veladd
triggerall = ailevel > 0
trigger1 = p2bodydist x < 95
x = -1.6

[state 1033, end]
type = changestate
triggerall = animtime = 0
trigger1 = ailevel = 0
trigger1 = command != "aheld"  && command != "bheld" && command != "cheld"
trigger2 = ailevel > 0
trigger2 = !inguarddist
trigger2 = enemynear,ctrl = 1
trigger2 = random < ailevel*32
trigger3 = ailevel > 0
trigger3 = p2bodydist x > 400 || p2bodydist x < 0
trigger3 = !inguarddist
trigger3 = random < ailevel * 48
trigger4 = roundstate = 3
value = 0
ctrl = 1

[state 1032, Split Leg Drop]
type = changestate
triggerall = (anim != 1031) ||  (anim = 1031 && animtime = -12)
triggerall = command != "aheld"  && command != "bheld"  || command != "cheld"
trigger1 = ailevel = 0
trigger1 = command = "aheld"  && command != "bheld"
trigger1 = command != "holdback" || command != "holddown"
trigger2 = ailevel = 0
trigger2 = command = "bheld" && command != "aheld"
trigger2 = command != "holdback" || command != "holddown"
trigger3 = ailevel > 0
trigger3 = !inguarddist
trigger3 = enemy,statetype = C
value = 1042

[state 1032, clothesline]
type = changestate
triggerall = (anim != 1031) ||  (anim = 1031 && animtime = -12)
triggerall = var(26) >= 0 && var(26) <= 2
trigger1 = ailevel = 0
trigger1 = command = "xheld" 
trigger2 = ailevel = 0
trigger2 = command = "yheld"
trigger3 = ailevel > 0
trigger3 = !inguarddist
trigger3 = enemy,statetype != C || enemy,statetype != L
trigger3 = p2bodydist x < 160 && p2bodydist x > 0
value = 1035

[state 1032, clothesline]
type = changestate
triggerall = (anim != 1031) ||  (anim = 1031 && animtime = -12)
triggerall = var(26) > 2 && var(26) <= 4
trigger1 = ailevel = 0
trigger1 = command = "xheld" 
trigger2 = ailevel = 0
trigger2 = command = "yheld"
trigger3 = ailevel > 0
trigger3 = !inguarddist
trigger3 = enemy,statetype != C || enemy,statetype != L
trigger3 = p2bodydist x < 240 && p2bodydist x > 0
value = 1036

[state 1032, clothesline]
type = changestate
triggerall = (anim != 1031) ||  (anim = 1031 && animtime = -12)
triggerall = var(26) > 4 
trigger1 = ailevel = 0
trigger1 = command = "xheld" 
trigger2 = ailevel = 0
trigger2 = command = "yheld"
trigger3 = ailevel > 0
trigger3 = !inguarddist
trigger3 = enemy,statetype != C || enemy,statetype != L
trigger3 = p2bodydist x < 320 && p2bodydist x > 0
value = 1040

[state 1033, additional spins]
type = changestate
triggerall = animtime = 0
triggerall = roundstate = 2
trigger1 = ailevel = 0
trigger1 = command = "aheld"  && command = "bheld"  || command = "cheld"
trigger2 = ailevel > 0
;trigger2 = inguarddist
;trigger2 = p2bodydist x < var(40)
value = 1033




;---------------------------------------------------------------------------
;Additional spins for variable time

[Statedef 1033]
type = S
movetype = I
physics = S
sprpriority = 2
ctrl = 0
velset = 0,0

[state 1031, spin plus]
type = varadd
trigger1 = time = 0
var(26) = 1

[state 651, fx]
type = explod
trigger1 = var(26) > 5
trigger1 = animelem = 4
anim = F61
pos = -40,0
scale = 2,1.5
ownpal = 1

[state 1031, playsnd]
type = playsnd
trigger1 = animelem = 4
value = S1030,0
ignorehitpause

[state 1031, poweradd]
type = poweradd
trigger1 = time = 0
value = 25

[State 1031, Blink red DANGER]
type = PalFX
trigger1 = var(26) >= 20
trigger1 = time%2
time = 1
add = 150,0,0 
sinadd = 64,32,5,3
ignorehitpause

[state 1036, earthquakes]
type = envshake
trigger1 = var(26) >= 30
time = 4
ampl = -8
freq = 40
phase = 40
persistent = 4

[state 1031, anim]
type = changeanim
trigger1 = time = 0
trigger1 = var(26) < 10
value = ifelse(var(26) >= 4, 1049,1032)

[state 1031, anim]
type = changeanim
trigger1 = time = 0
trigger1 = var(26) >= 10
value = 1048

[state 1033, nothitby]
type = nothitby
trigger1 = 1
value = ,AP
ignorehitpause = 1

[State 1020, 3]
type = HitDef
trigger1 = animelem = 3
trigger2 = animelem = 7
attr = A, SA
damage    = 20,10
guardflag = MA
hitflag = MA
priority = 6
pausetime = 4,4
sparkno = 2
sparkxy = -10,-40
hitsound   = 5,4
guardsound = S120, 0
animtype = back
ground.type = High
ground.slidetime = 30
ground.hittime  = 14
guard.hittime = 8
ground.velocity = -2,0
guard.velocity = -6
airguard.velocity = -6,-2
air.velocity = -2,-1
fall = ifelse (enemy,statetype = A, 1, 0)
fall.recover = 0

[state 1030, vel]
type = veladd
triggerall = ailevel = 0
trigger1 = command = "holdfwd"
x = 1.6

[state 1030, vel]
type = veladd
triggerall = ailevel > 0
trigger1 = p2bodydist x > 105
x = 1.6

[state 1030, vel]
type = veladd
triggerall = ailevel = 0
trigger1 = command = "holdback"
x = -1.6

[state 1030, vel]
type = veladd
triggerall = ailevel > 0
trigger1 = p2bodydist x < 95
x = -1.6

[state 1033, end]
type = changestate
triggerall = animtime = 0
trigger1 = ailevel = 0
trigger1 = command != "aheld"  && command != "bheld" && command != "cheld"
trigger2 = ailevel > 0
trigger2 = !inguarddist
trigger2 = enemynear,ctrl = 1
trigger2 = random < ailevel*32
trigger3 = ailevel > 0
trigger3 = p2bodydist x > 400 || p2bodydist x < 0
trigger3 = !inguarddist
trigger3 = random < ailevel * 48
value = 0
ctrl = 1

[state 1032, Split Leg Drop]
type = changestate
triggerall = (anim != 1031) ||  (anim = 1031 && animtime = -12)
triggerall = command != "aheld"  && command != "bheld"  || command != "cheld"
trigger1 = ailevel = 0
trigger1 = command = "aheld"  && command != "bheld"
trigger1 = command != "holdback" || command != "holddown"
trigger2 = ailevel = 0
trigger2 = command = "bheld" && command != "aheld"
trigger2 = command != "holdback" || command != "holddown"
trigger3 = ailevel > 0
trigger3 = !inguarddist
trigger3 = enemy,statetype = C
value = 1042

[state 1032, clothesline]
type = changestate
triggerall = (anim != 1031) ||  (anim = 1031 && animtime = -12)
triggerall = var(26) >= 0 && var(26) <= 2
trigger1 = ailevel = 0
trigger1 = command = "xheld" 
trigger2 = ailevel = 0
trigger2 = command = "yheld"
trigger3 = ailevel > 0
trigger3 = !inguarddist
trigger3 = enemy,statetype != C || enemy,statetype != L
trigger3 = p2bodydist x < 160 && p2bodydist x > 0
value = 1035

[state 1032, clothesline]
type = changestate
triggerall = (anim != 1031) ||  (anim = 1031 && animtime = -12)
triggerall = var(26) > 2 && var(26) <= 4
trigger1 = ailevel = 0
trigger1 = command = "xheld" 
trigger2 = ailevel = 0
trigger2 = command = "yheld"
trigger3 = ailevel > 0
trigger3 = !inguarddist
trigger3 = enemy,statetype != C || enemy,statetype != L
trigger3 = p2bodydist x < 240 && p2bodydist x > 0
value = 1036

[state 1032, clothesline]
type = changestate
triggerall = (anim != 1031) ||  (anim = 1031 && animtime = -12)
triggerall = var(26) > 4 
trigger1 = ailevel = 0
trigger1 = command = "xheld" 
trigger2 = ailevel = 0
trigger2 = command = "yheld"
trigger3 = ailevel > 0
trigger3 = !inguarddist
trigger3 = enemy,statetype != C || enemy,statetype != L
trigger3 = p2bodydist x < 320 && p2bodydist x > 0
value = 1040

[state 1033, additional spins]
type = changestate
triggerall = animtime = 0
trigger1 = ailevel = 0
trigger1 = command = "aheld"  && command = "bheld"  || command = "cheld"
trigger2 = ailevel > 0
;trigger2 = inguarddist
;trigger2 = p2bodydist x < var(40)
value = 1032



;--------------------------------------------------------------------------
;Light Clothesline
[Statedef 1035]
type = S
movetype = A
physics = S
sprpriority = -1
ctrl = 0

[state 1036, slide]
type = velset
trigger1 = animelem = 1 || animelem = 2 || animelem = 3
x = 1.6

[state 1035, velset]
type = velset
trigger1 = animelem = 4
x = 50
persistent = 1

[state 1035, anim]
type = changeanim
trigger1 = anim != 1035
value = 1035


[state 1035, armor counter]
type = varset
trigger1 = time = 0
trigger1 = Var(21) = 1
V = 20
value = 1

[state 1035, armor intiator turn off]
type = varset
trigger1 = time = 1
V = 21
value = 0


[state 1035, still take damage]
type = lifeadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) != 0
value = -gethitvar(damage)
persistent = 1
ignorehitpause

[state 1035, armor count down]
type = varadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) > 0
V = 20
value = - 1
persistent = 1
ignorehitpause

;determine what frame
[state 1035, remember frame]
type = varset
trigger1 = time <= 0
v = 22
value = animelemno(0)
ignorehitpause = 1

;delay effect
[state 1035, delay]
type = changeanim 
trigger1 = animelem != 4
trigger1 = var(31) < floor(gethitvar(hittime)*0.9)
value = anim
elem = var(22)
ignorehitpause = 1

[state 1035, freeze location]
type = posfreeze
trigger1 = animelem != 4
trigger1 = var(31) < floor(gethitvar(hittime)*0.9)
value = 1
ignorehitpause = 1
;--------------------------

[state 1035, Unstoppable]
type = hitoverride
triggerall = animelemtime(6) < 0
triggerall = Life > 1
trigger1 = Var(20) > 0
attr = SCA, AA, AP
stateno = 1035
time = 1
persistent = 1
ignorehitpause

[State 1035, flash red]
type = PalFX
trigger1 = Time = 0
trigger1 = gethitvar(damage) != 0
time = 7
add = 100,0,0
IgnoreHitPause = 1

[state 1035, projectile invun]
type = nothitby
trigger1 = animelemtime(4) < 0
value = ,AP

[State 1035, 3]
type = HitDef
trigger1 = time = 0
attr = A, SA
damage    = ifelse(enemy,movetype != H,160,140),20
guardflag = HA
hitflag = HAF
priority = 5,hit
pausetime = 16,0
guard.pausetime = 16,16
sparkno = 3
id = 1035
nochainid = 1035
p1sprpriority = -1
p2sprpriority = 1
p2facing = 1
sparkxy = -20,-210
hitsound   = 5,4
guardsound = S120, 0
animtype = up
ground.type = High
ground.slidetime = 18
ground.hittime  = 18
ground.velocity = 0,0
air.velocity = 0,0
fall = 1
fall.recover = 0
envshake.time = 20
envshake.ampl = 12
envshake.freq = 60
guard.velocity = -40       
guard.hittime = 28 ;-4
guard.slidetime = 28
airguard.velocity = -12,-4
airguard.hittime = 38
guard.dist = 320

[state 1035, screenbound]
type = screenbound
trigger1 = 1
value = 0
movecamera = 1,0
ignorehitpause = 1


[state 1035, targetstate]
type = targetstate
trigger1 = movehit = 1
value = 1045
ignorehitpause = 1
persistent = 1

[state 1035, targetbind]
type = targetbind
trigger1 = movehit = 1
pos = 50,-200
ignorehitpause = 1
persistent = 1
time = 1

[state 1035, playerpush]
type = playerpush
trigger1 = 1
value = 0
ignorehitpause = 1

[state 1035, explod]
type = explod
trigger1 = time = 0
anim = 1033
sprpriority = 2
bindtime = -1
id = 1033
ignorehitpause = 0
scale = const(size.xscale),const(size.yscale)
removetime = -2

[state 1035, removeexplod]
type = removeexplod
trigger1 = animelem = 6
id = 1033

[state x, armor over]
type = varset
trigger1 = animelem = 5
v = 20
value = 0
ignorehitpause

[state 1035, earthquakes]
type = envshake
trigger1 = animelem = 6
time = 15
ampl = -8
freq = 75
phase = 75
persistent = 0

[state 1035, snd]
type = playsnd
trigger1 = animelem = 6
value =S1,2
persistent = 0

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -3
persistent = 0
ignorehitpause = 1

[state 1035, slowdown]
type = velmul
trigger1 = animelem = 6
x = 0.5

[state 1035, end]
type = changestate
trigger1 = animtime = 0
value = 11
ctrl = 1
;------------------------------------------------------
;Heavy Clothesline
[Statedef 1036]
type = S
movetype = A
physics = S
sprpriority = -1
ctrl = 0

[state 1036, slide]
type = velset
trigger1 = animelem = 1 || animelem = 2 || animelem = 3
x = 1.6

[state 1036, velset]
type = velset
trigger1 = animelem = 4
x = 70
persistent = 1

[state 1035, anim]
type = changeanim
trigger1 = anim != 1036
value = 1036

[state 1036, armor counter]
type = varset
trigger1 = time = 0
trigger1 = Var(21) = 1
V = 20
value = 1

[state 1036, armor intiator turn off]
type = varset
trigger1 = time = 1
V = 21
value = 0

;determine what frame
[state 1035, remember frame]
type = varset
trigger1 = time <= 0
v = 22
value = animelemno(0)
ignorehitpause = 1

;delay effect
[state 1035, delay]
type = changeanim 
trigger1 = var(31) < floor(gethitvar(hittime)*0.9)
value = anim
elem = var(22)
ignorehitpause = 1

[state 1035, freeze location]
type = posfreeze
trigger1 = var(31) < floor(gethitvar(hittime)*0.9)
value = 1
ignorehitpause = 1
;--------------------------


[state 1036, still take damage]
type = lifeadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) != 0
value = -gethitvar(damage)
persistent = 1
ignorehitpause

[state 1036, armor count down]
type = varadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) > 0
V = 20
value = - 1
persistent = 1
ignorehitpause

[state 1036, Unstoppable]
type = hitoverride
triggerall = animelemtime(6) < 0
triggerall = Life > 1
trigger1 = Var(20) > 0
attr = SCA, AA, AP
stateno = 1036
time = 1
persistent = 1
ignorehitpause

[State 1036, flash red]
type = PalFX
trigger1 = Time = 0
trigger1 = gethitvar(damage) != 0
time = 7
add = 100,0,0
IgnoreHitPause = 1

[state 1035, projectile invun]
type = nothitby
trigger1 = animelemtime(4) < 0
value = ,AP

[State 1036, 3]
type = HitDef
trigger1 = Time = 0
attr = A, SA
damage    = ifelse(enemy,movetype != H,200,160),32
guardflag = HA
hitflag = HAF
priority = 5
pausetime = 16,0
guard.pausetime = 16,16
id = 1036
nochainid = 1036
sparkno = 3
p1sprpriority = -1
p2sprpriority = 1
sparkxy = -20,-210
hitsound   = 5,4
guardsound = S120, 0
animtype = up
ground.type = High
ground.slidetime = 12
ground.hittime  = 20
ground.velocity = 1,-22
airguard.velocity = -6,-2
air.velocity = 1,-22
fall = 1
p2facing = 1
fall.recover = 0
envshake.freq = 60
envshake.ampl = 14
envshake.time = 30
guard.velocity = -40       
guard.hittime = 34 ;-2
guard.slidetime = 34
airguard.velocity = -12,-4
airguard.hittime = 38
guard.dist = 320

[state 1036, targetstate]
type = targetstate
trigger1 = movehit = 1
value = 1045
ignorehitpause = 1
persistent = 1


[state 1036, targetbind]
type = targetbind
trigger1 = movehit = 1
pos = 50,-200
ignorehitpause = 1
time = 1
persistent = 1

[state 1036, playerpush]
type = playerpush
trigger1 = 1
value = 0
ignorehitpause = 1

[state 1036, explod]
type = explod
trigger1 = time = 0
anim = 1034
sprpriority = 2
bindtime = -1
id = 1034
ignorehitpause = 0
scale = const(size.xscale),const(size.yscale)
removetime = -2

[state 1036, removeexplod]
type = removeexplod
trigger1 = animelem = 6
id = 1034

[state 1036, earthquakes]
type = envshake
trigger1 = animelem = 6
time = 15
ampl = -8
freq = 75
phase = 75
persistent = 0


[state 1036, snd]
type = playsnd
trigger1 = animelem = 6
value =S1,2
persistent = 0

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -3
persistent = 0
ignorehitpause = 1

[state 1036, slowdown]
type = velmul
trigger1 = animelem = 6
x = 0.5

[state 1036, end]
type = changestate
trigger1 = animtime = 0
value = 11
ctrl = 1

;---------------------------------------------------------------------------
;EX clothesline
;Heavy Clothesline
[Statedef 1040]
type = S
movetype = A
physics = S
sprpriority = -1
ctrl = 0

[state 1040, slide]
type = velset
trigger1 = animelem = 1 || animelem = 2 || animelem = 3
x = 1.6

[state 1040, velset]
type = velset
trigger1 = animelem = 4
x = 110
persistent = 1

[state 1040, Guard Crush]
type = assertspecial
trigger1 = var(26) >= 30
flag = unguardable
persistent = 1
ignorehitpause

[state 1040, anim]
type = changeanim
trigger1 = anim != 1040
value = 1040

[state 1040, armor counter]
type = varset
trigger1 = time = 0
trigger1 = Var(21) = 1
V = 20
value = 1

[state 1040, armor intiator turn off]
type = varset
trigger1 = time = 1
V = 21
value = 0

[state 1040, still take damage]
type = lifeadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) != 0
value = -gethitvar(damage)
persistent = 1

[state 1040, armor count down]
type = varadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) > 0
V = 20
value = - 1
persistent = 1

[state 1040, Unstoppable]
type = hitoverride
triggerall = animelemtime(6) < 0
triggerall = Life > 1
trigger1 = Var(20) > 0
attr = SCA, AA, AP
stateno = 1040
time = 1
persistent = 1

;determine what frame
[state 1035, remember frame]
type = varset
trigger1 = time <= 0
v = 22
value = animelemno(0)
ignorehitpause = 1

;delay effect
[state 1035, delay]
type = changeanim 
trigger1 = var(31) < floor(gethitvar(hittime)*0.9)
value = anim
elem = var(22)
ignorehitpause = 1

[state 1035, freeze location]
type = posfreeze
trigger1 = var(31) < floor(gethitvar(hittime)*0.9)
value = 1
ignorehitpause = 1
;--------------------------

[State 1040, flash red]
type = PalFX
trigger1 = Time = 0
trigger1 = gethitvar(damage) != 0
time = 7
add = 100,0,0
IgnoreHitPause = 1

[State 1040, 3]
type = HitDef
trigger1 = Time = 0
trigger1 = var(26) < 20
attr = A, SA
damage    = ifelse(var(26) < 10, 240,320),ifelse(p2statetype = A,96,32)
guardflag = HA
hitflag = HA
getpower = 0
priority = 5
id = 1037
nochainid = 1037
pausetime = 18,0
guard.pausetime = 16,16
sparkno = 3
p1sprpriority = -1
p2sprpriority = 1
sparkxy = -20,-210
hitsound   = 5,4
guardsound = S120, 0
animtype = up
ground.type = High
ground.slidetime = 12
ground.hittime  = 20
ground.velocity = 1,-25
air.velocity = 1,-25
fall = 1
p2facing = 1
fall.recover = 0
guard.velocity = -48       
guard.hittime = 36 ;0
guard.slidetime = 36
airguard.velocity = -12,-4
airguard.hittime = 40
envshake.time = 30
envshake.ampl = 16
envshake.freq = 60
guard.dist = 480


[State 1040, 3]
type = HitDef
trigger1 = Time = 0
trigger1 = var(26) >= 20
attr = A, SA
damage    = ifelse(var(26) < 30, 450,600),ifelse(p2statetype = A,156,52)
guardflag = H
hitflag = HA
getpower = 0
priority = 5
id = 1038
nochainid = 1038
pausetime = 18,0
guard.pausetime = 16,16
sparkno = 3
p1sprpriority = -1
p2sprpriority = 1
sparkxy = -20,-210
hitsound   = 5,4
guardsound = S120, 0
animtype = up
ground.type = High
ground.slidetime = 12
ground.hittime  = 20
ground.velocity = 1,-25
air.velocity = 1,-25
fall = 1
fall.recover = 0
guard.velocity = -50       
guard.hittime = 38
guard.slidetime = 38
airguard.velocity = -32,-4
airguard.hittime = 42
envshake.time = 30
envshake.ampl = 16
envshake.freq = 60
guard.dist = 480

[state 1040, projectile invun]
type = nothitby
trigger1 = animelemtime(4) < 0
value = ,AP

[state 1040, envshake]
type = envshake
trigger1 = movehit = 1
time = 15
ampl = 5
freq = 60



[state 1035, targetstate]
type = targetstate
trigger1 = movehit = 1
value = 1045
ignorehitpause = 1
persistent = 1

[state 1035, targetbind]
type = targetbind
trigger1 = movehit = 1
pos = 50,-200
ignorehitpause = 1
persistent = 1
time = 1

[state 1040, playerpush]
type = playerpush
trigger1 = 1
value = 0
ignorehitpause = 1

[state 1040, explod]
type = explod
trigger1 = time = 0
anim = 1041
sprpriority = 2
bindtime = -1
id = 1041
ignorehitpause = 0
scale = const(size.xscale),const(size.yscale)
removetime = -2

[state 1040, removeexplod]
type = removeexplod
trigger1 = animelem = 6
id = 1041

[state 1040, earthquakes]
type = envshake
trigger1 = animelem = 6
time = 20
ampl = -12
freq = 75
phase = 75
persistent = 0

[state 1035, snd]
type = playsnd
trigger1 = animelem = 6
value =S1,2
persistent = 0

[state x, armor over]
type = varset
trigger1 = animelem = 5
v = 20
value = 0
ignorehitpause

[state x, combo damage score]
type = varadd
trigger1 = movehit
v = 18
value = -3
persistent = 0
ignorehitpause = 1

[state 1040, slowdown]
type = velmul
trigger1 = animelem = 6
x = 0.25

[state 1040, end]
type = changestate
trigger1 = animtime = 0
value = 11
ctrl = 1
;----------------------------------------------------------------------------
;Split Leg Drop
[statedef 1042]
type = A
movetype = A
physics = N
anim = 1042

[state 1042, jump]
type = velset
trigger1 = time = 0
y = -18
x = 4

[state 1042, width]
type = width
trigger1 = 1
value = -100,-100

[state 1035, nothitby]
type = nothitby
trigger1 = 1
value = C,AA,AP

[state 1035, spike down]
type = veladd
trigger1 = vel y  > 0
y = 3
persistent = 0

[state 1035, nothitby]
type = nothitby
trigger1 = movehit
value = SCA
time = 30

[state 1042, gravity]
type = gravity
trigger1 = pos y < -1

[State 1042, 3]
type = HitDef
trigger1 = vel y > 4
persistent = 6
attr = A, SA
damage    = ifelse(!movecontact, 240, 10),ifelse(!movecontact, 24, 1)
guardflag = HA
hitflag = MAF
priority = 4
pausetime = 12,12
sparkno = 3
sparkxy = 0,0
hitsound   = 5,4
guardsound = S120, 0
animtype = heavy
ground.type = high
ground.slidetime = 22
ground.hittime  = 22
ground.velocity = 0
air.velocity = 0,0
down.hittime = 60
guard.velocity = -50            
guard.hittime = 38
guard.slidetime = 38
airguard.velocity = -10,10
airguard.hittime = 35
guard.dist = 320

[state 1042, veladd]
type = veladd
trigger1 = vel y > 0
y = 0.35
persistent = 1


[state 1042, moveforward]
type = veladd
triggerall = vel x < 8
triggerall = ailevel = 0
trigger1 = command = "holdfwd"
x = 0.65

[state 1042, moveforward]
type = veladd
triggerall = vel x < 8
triggerall = ailevel > 0
trigger1 = p2bodydist x > 0
x = 0.65

[state 1042, movebackward]
type = veladd
triggerall = vel x > -8
triggerall = ailevel = 0
trigger1 = command = "holdback"
x = -0.65

[state 1042, movebackward]
type = veladd
triggerall = vel x > -8
triggerall = ailevel > 0
trigger1 = p2bodydist x < 0
x = -0.65

;---------

[state 650, enemy state]
type = targetstate
triggerall = vel y > 0
trigger1 = movehit
value = 660

;Ride down mechanic
[state 650, Ride down]
type = targetbind
trigger1 = movehit
pos = 0, -20

[state 650, state of ride down]
type = targetstate
trigger1 = movehit
value = 655
;--------

[state 1043, end]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 1043


;----------------------------------------------------------------------------
;Split Leg Drop Land
[statedef 1043]
type    = C
movetype= A
physics = N
poweradd= 30

[state 1043, anim]
type = changeanim
trigger1 = time = 0
value = 1043

;Custom Dust
[state 651, explod]
type = explod
trigger1 = time = 0
anim = 2000
pos = 30,0
scale = const(size.xscale)*3,const(size.yscale)*2
ontop = 1
ownpal = 1

[state 651, fx]
type = explod
trigger1 = time = 0
anim = F61
pos = 0,0
scale = 6,3
ownpal = 1


[state 651, explod]
type = explod
trigger1 = time = 0
anim = 2001
pos = 30,0
scale =  const(size.xscale)*3,const(size.yscale)*2
sprpriority = -4
ownpal = 1
; -------------------

[state 651, snd]
type = playsnd
trigger1 = time = 0
value =S1,1

[state 651, pos]
type = posset
trigger1 = time = 0
y = 0

[state 651, playerpush]
type = playerpush
trigger1 = 1
value = 0

[State 651, 3]
type = HitDef
trigger1 = Time = 0
attr = A, NA
damage    = 220 
guardflag = 
hitflag = FD
priority = 4
pausetime = 12,12
sparkno = 1
sparkxy = -10,-40
hitsound   = 5,3
guardsound = S120, 0
animtype = Med
p2stateno = 660
ground.type = High
ground.slidetime = 12
ground.hittime  = 15
ground.velocity = 0
air.velocity = 0,0

[state 651, vel]
type = velset
trigger1 = time = 0
y = 0
x = 0

[state 651, earthquakes]
type = envshake
trigger1 = time = 0
time = 40
ampl = -32
freq = 75
phase = 75

[state 651, end]
type = changestate
trigger1 = time = 45
value = 656

;--------------------------------------------------------------------------
;Bounce
[statedef 652]
type    = A
movetype= I
physics = N

[state 652, anim]
type = changeanim
trigger1 = time = 0
value = 652

[state 652, playerpush]
type = playerpush
trigger1 = 1
value = 0


[state 652, velset]
type = velset
trigger1 = time = 0
y = -8

[state 652, gravity]
type = gravity
trigger1 = time > 2

[state 652, end]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 653

;--------------------------------------------------------------------------
;Landing Rest
[statedef 653]
type    = C
movetype= I
physics = N

[state 653, anim]
type = changeanim
trigger1 = time = 0
value = 653

[state 653, posset]
type = posset
trigger1 = time = 0
y = 0

[state 653, playerpush]
type = playerpush
trigger1 = 1
value = 0


[state 653, velset]
type = velset
trigger1 = time = 0
y = 0
x = 0

[state 653, snd]
type = playsnd
trigger1 = time = 0
value =S1,1

[state 653, earthquakes]
type = envshake
trigger1 = time = 0
time = 15
ampl = 12
freq = 100
phase = 100

[state 653, end]
type = changestate
trigger1 = animtime = 0
value = 656



;---------------------------------------------------------------------------
;clothesline Victim
[statedef 1045]
type = A
movetype = H
physics = N
velset = 0,0

[state 1045, anim]
type = changeanim2
trigger1 = time = 0
value = 1045

[state 1045, velset]
type = velset
trigger1 = time = 5
y = -6
x = 4

[state 1045, gravity]
type = gravity
trigger1 = time > 7

[state 1045, end]
type = selfstate
trigger1 = pos y > 0
trigger1 = vel y > -pos y
value = 5100

[state 1045, end error]
type = selfstate
trigger1 = time > 180
value = 5050

;==========================================================
; Anti-Air Butt Bump  -3x chip damage if airborn
;==========================================================
;Light
[statedef 1050]
type = S
movetype = A
physics = N
velset = 0,0
ctrl = 0

[state 1050, snd]
type = playsnd
trigger1 = animelem = 7
value = S1050,0
ignorehitpause

[state 1050, no grabed]
type = null; nothitby
trigger1 = animelemtime(7) <= 2
value = A

;[state 1050, safe on hit] ;mostly for boss type characters
;type = nothitby
;trigger1 = movehit > 0
;value = SCA
;ignorehitpause = 1

;---armor----

[state 1050, anim]
type = changeanim
trigger1 = anim != 1050
value = 1050

[state 1000, armor counter]
type = varset
trigger1 = time = 0
trigger1 = Var(21) = 1
V = 20
value = 2

[state 1050, change]
type = statetypeset
trigger1 = pos y < -1
statetype = A
ignorehitpause = 1

[state 1000, armor intiator turn off]
type = varset
trigger1 = time = 1
V = 21
value = 0

[state 1000, still take damage]
type = lifeadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) != 0
value = floor(-gethitvar(damage)*0.5)
persistent = 1

[state 1000, armor count down]
type = varadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) > 0
V = 20
value = - 1
persistent = 1

[state 1050, Unstoppable]
type = hitoverride
trigger1 = Life > 1
trigger1 = Var(20) > 0
attr = SCA, AA, AP
stateno = 1050
time = 1
persistent = 1

[State 1050, flash red]
type = PalFX
trigger1 = Time = 0
trigger1 = gethitvar(damage) != 0
time = 7
add = 100,0,0
IgnoreHitPause = 1

;determine what frame
[state 1050, remember frame]
type = varset
trigger1 = time <= 0
v = 22
value = animelemno(0)
ignorehitpause = 1

;delay effect
[state 1050, delay]
type = changeanim 
trigger1 = var(31) < floor(gethitvar(hittime)*0.05)
value = anim
elem = var(22)

[state 1050, freeze location]
type = posfreeze
trigger1 = var(31) < floor(gethitvar(hittime)*0.05)
value = 1
;--------------------------

; --Armor end----

[state 1050, posadd]
type = posadd
trigger1 = animelem = 2
x = -80
persistent = 0

[state 1050, posadd]
type = posadd
trigger1 = animelem = 3
x = -30
persistent = 0

[state 1050, jump]
type = velset
trigger1 = animelem = 7
x = 8
y = -18

[state 1050, gravity]
type = gravity
trigger1 = pos y < -1

[State 1050, 3]
type = HitDef
trigger1 = movecontact = 0
attr = A, SA
damage    = 160,ifelse(enemy,statetype = A,48,16)
guardflag = MA
hitflag = MAF
priority = 4
pausetime = ifelse(!enemynear,ishelper,18,2),ifelse(!enemynear,ishelper,18,2)
sparkno = 3
id = 1050
nochainid = 1050
sparkxy = -10,-100
hitsound   = S240,0
guardsound = S120, 0
animtype = up
ground.type = High
ground.slidetime = 22
ground.hittime  = ifelse(!enemynear,ishelper,22,2)
ground.velocity = -4,-20
air.velocity = -4,-16
fall = 1
fall.recover = 1
fall.recovertime = 60
envshake.freq = 80
envshake.ampl = 8
envshake.time = 12
guard.velocity = -16       
guard.hittime = 22
guard.slidetime = 22
airguard.velocity = -4,-16
airguard.hittime = 26
guard.dist = 280

[State 1050, step dust]
type = explod
trigger1 = animelem = 4 
anim = 2040
pos = -55, 0
scale = 0.3,0.3
sprpriority = 2
persistent = 0

[State 1050, step dust]
type = explod
trigger1 = animelem = 4 
anim = 2040
pos = -145,0
scale = 0.3,0.3
sprpriority = 2
persistent = 0


[state 1050, earthquakes]
type = envshake
trigger1 = animelem = 4
time = 10
ampl = -8
freq = 100
phase = 100
persistent = 0

[state 1050, sound]
type = playsnd
trigger1 = animelem = 4
value = S1,2
persistent = 0

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -3
persistent = 0
ignorehitpause = 1

[state 1050, end]
type = changestate
trigger1 = vel y > 0
value = 1051

;---------------------------------------------------

;recovery
[statedef 1051]
type    = A
physics = N
movetype = I
ctrl = 0

[state 1051, removeX]
type = removeexplod
trigger1 = time = 0
id = 2035

[state 1051, velset]
type = velmul
trigger1 = time = 0
x = 0.5

[state 1051, velset]
type = velmul
trigger1 = time = 6
x = 0.1

[state 1051, velset]
type = velmul
trigger1 = time = 12
x = 0

[State 50, 2]
type = ChangeAnim
trigger1 = Time = 0
value = 1051

[state 1051, grav]
type = gravity
trigger1 = 1
;y = 0.6

[state 1051, landing]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 1059

;----------------------------------------------------------
;AA recovery Landing
[statedef 1059]
type = C
movetype = I
physics = C
anim = 1059
ctrl = 0

[state 1059, landing]
type = velset
trigger1 = time = 0
x = 0
y = 0

[state 1059, on ground]
type = posset
trigger1 = time = 0
y = 0

[state 1059, dust]
type = explod
trigger1 = time = 0
anim = 2040
pos = 120,0
scale = 0.75, 0.75
sprpriority = 2

[state 1059, dust]
type = explod
trigger1 = time = 0
anim = 2040
pos = -110,0
scale = 0.75, 0.75
sprpriority = 2


[state 1059, earthquakes]
type = envshake
trigger1 = time = 0
time = ifelse (var(15)=0, 18, 24)
ampl = ifelse (var(15)=0, -12, -18)
freq = 100
phase = 100

[state 1059, land fx]
type = explod
trigger1 = time = 0
trigger1 = var(15) = 1
anim = 2000
bindtime = 1
id = 2000
pos = 0, 10
removetime = -2
sprpriority = 2
scale = const(size.xscale)*2.5,const(size.yscale)*1
ownpal = 1

[state 1059, land fx]
type = explod
trigger1 = time = 0
trigger1 = var(15) = 1
anim = 2001
bindtime = 1
id = 2001
pos = 0, 10
removetime = -2
sprpriority = -2
scale = const(size.xscale)*2.5,const(size.yscale)*1
ownpal = 1


[state 1059, fx]
type = explod
trigger1 = time = 0
anim = F61
pos = 0,0
scale = 3,1.5
ownpal = 1
;---

[state 1059, sound1]
type = playsnd
trigger1 = time = 0
value = S1,2



[state 1059, end]
type = changestate
trigger1 = animtime = 0
value = 11
ctrl = 1


;----------------------------------------------------------
;heavy
[statedef 1060]
type = S
movetype = A
physics = N
velset = 0,0
ctrl = 0

[state 1060, nothitby]
type = null
trigger1 = animelemtime(7) < 2
value = A

;[state 1050, safe on hit] ;mostly for boss type characters
;type = nothitby
;trigger1 = movehit > 0
;value = SCA
;ignorehitpause = 1

[state 1060, snd]
type = playsnd
trigger1 = animelem = 7
value = S1050,0
ignorehitpause
;---armor----

[state 1060, anim]
type = changeanim
trigger1 = anim != 1060
value = 1060

[state 1060, armor counter]
type = varset
trigger1 = time = 0
trigger1 = Var(21) = 1
V = 20
value = 3

[state 1060, change]
type = statetypeset
trigger1 = pos y < -1
statetype = A
ignorehitpause = 1

[state 1060, armor intiator turn off]
type = varset
trigger1 = time = 1
V = 21
value = 0

[state 1060, still take damage]
type = lifeadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) != 0
value = floor(-gethitvar(damage)*0.5)
persistent = 1

[state 1060, armor count down]
type = varadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) > 0
V = 20
value = - 1
persistent = 1

[state 1060, Unstoppable]
type = hitoverride
trigger1 = Life > 1
trigger1 = Var(20) > 0
attr = SCA, AA, AP
stateno = 1060
time = 1
persistent = 1

[State 1060, flash red]
type = PalFX
trigger1 = Time = 0
trigger1 = gethitvar(damage) != 0
time = 7
add = 100,0,0
IgnoreHitPause = 1

;determine what frame
[state 1060, remember frame]
type = varset
trigger1 = time <= 0
v = 22
value = animelemno(0)
ignorehitpause = 1

;delay effect
[state 1060, delay]
type = changeanim 
trigger1 = var(31) < floor(gethitvar(hittime)*0.05)
value = anim
elem = var(22)

[state 1060, freeze location]
type = posfreeze
trigger1 = var(31) < floor(gethitvar(hittime)*0.05)
value = 1
;--------------------------


; --Armor end----

[state 1060, posadd]
type = posadd
trigger1 = animelem = 2
x = -80
persistent = 0

[state 1060, posadd]
type = posadd
trigger1 = animelem = 3
x = -30
persistent = 0

[state 1060, jump]
type = velset
trigger1 = animelem = 7
x = 9
y = -22

[state 1060, gravity]
type = gravity
trigger1 = pos y< -2

[State 1060, 3]
type = HitDef
trigger1 = movecontact = 0
attr = A, SA
damage    = 200,ifelse(enemy,statetype = A,60,20)
guardflag = MA
hitflag = MAF
priority = 4
id = 1060
nochainid = 1060
pausetime = ifelse(!enemynear,ishelper,18,2),ifelse(!enemynear,ishelper,18,2)
sparkno = 3
sparkxy = -10,-100
hitsound   = S240,0
guardsound = S120, 0
animtype = up
ground.type = High
ground.slidetime = 26
ground.hittime  = ifelse(!enemynear,ishelper,26,2)
ground.velocity = -6,-22
air.velocity = -6,-20
fall = 1
fall.recover = 1
fall.recovertime = 60
envshake.freq = 80
envshake.ampl = 8
envshake.time = 12
guard.velocity = -20      
guard.hittime = 22
guard.slidetime = 22
airguard.velocity = -4,-18
airguard.hittime = 26
guard.dist = 280

[state 1060, earthquakes]
type = envshake
trigger1 = animelem = 4
time = 10
ampl = -8
freq = 100
phase = 100
persistent = 0

[State 1050, step dust]
type = explod
trigger1 = animelem = 4 
anim = 2040
pos = -55, 0
scale = 0.3,0.3
sprpriority = 2
persistent = 0

[State 1050, step dust]
type = explod
trigger1 = animelem = 4 
anim = 2040
pos = -145,0
scale = 0.3,0.3
sprpriority = 2
persistent = 0

[state 1060, sound]
type = playsnd
trigger1 = animelem = 4
value = S1,2
persistent = 0

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -3
persistent = 0
ignorehitpause = 1

[state 1060, end]
type = changestate
trigger1 = vel y > 0
value = 1051
;----------------------------------------------------------
;EX
[statedef 1070]
type = S
movetype = A
physics = N
velset = 0,0
anim = 1070
ctrl = 0

[state 1070, snd]
type = playsnd
trigger1 = animelem = 7
value = S1050,0
ignorehitpause

[state 1070, nothitby]
type = nothitby
trigger1 = 1
value = SCA

[State 1020, Blink Yellow]
type = PalFX
trigger1 = time%2
time = 1
add = 150,75,0 ;32,16,0
sinadd = 64,32,5,3
ignorehitpause

[state 1020, poweradd]
type = poweradd
triggerall = prevstateno != 1070
trigger1 = time = 3
value = -500

[state 1060, change]
type = statetypeset
trigger1 = pos y < -1
statetype = A
ignorehitpause = 1


[state 1070, posadd]
type = posadd
trigger1 = animelem = 2
x = -80
persistent = 0

[state 1070, posadd]
type = posadd
trigger1 = animelem = 3
x = -30
persistent = 0

[state 1070, jump]
type = velset
trigger1 = animelem = 7
x = 10
y = -28

[state 1070, gravity]
type = gravity
trigger1 = pos y< -2

[State 1070, 3]
type = HitDef
trigger1 = Time = 0
attr = A, SA
damage    = 180,ifelse(enemy,statetype = A,54,18)
guardflag = MA
hitflag = MAFD
priority = 4
pausetime = ifelse(!enemynear,ishelper,18,2),ifelse(!enemynear,ishelper,18,2)
sparkno = 3
id = 1070
nochainid = 1070
getpower = 0
sparkxy = -10,-100
hitsound   = S240,0
guardsound = S120, 0
animtype = up
ground.type = High
ground.slidetime = 30
ground.hittime  = 40
ground.velocity = -4,-28
air.velocity = -4,-26
fall = 1
fall.recover = 1
fall.recovertime = 60
envshake.freq = 80
envshake.ampl = 8
envshake.time = 12
guard.velocity = -22       
guard.hittime = 26
guard.slidetime = 26
airguard.velocity = -24,-16
airguard.hittime = 30
guard.dist = 280

[state 1060, earthquakes]
type = envshake
trigger1 = animelem = 4
time = 10
ampl = -8
freq = 100
phase = 100
persistent = 0

[state 1070, explod]
type = explod
trigger1 = animelemtime(7) = 0
trigger1 = !numexplod(2035)
id = 2035
anim = 2035
postype = p1
sprpriority = 4
bindtime = -1
removetime = -1
removeongethit = 1
ignorehitpause = 1
scale = const(size.xscale),const(size.yscale)
trans = addalpha
alpha = 256, 192


[state 1060, sound]
type = playsnd
trigger1 = animelem = 4
value = S1,2
persistent = 0

[State 1050, step dust]
type = explod
trigger1 = animelem = 4 
anim = 2040
pos = -55, 0
scale = 0.3,0.3
sprpriority = 2
persistent = 0

[State 1050, step dust]
type = explod
trigger1 = animelem = 4 
anim = 2040
pos = -145,0
scale = 0.3,0.3
sprpriority = 2
persistent = 0

[state 1060, combo damage]
type = varadd
trigger1 = movehit
v = 18
value = -3
persistent = 0
ignorehitpause = 1

;[state 1060, butt drop option]
;type = changestate
;triggerall = command = "holddown"
;triggerall = pos y < -25
;trigger1 = command = "b" 
;trigger2 = command = "c"
;trigger3 = command = "a" && command = "b"
;value = 650

[state 1070, end]
type = changestate
trigger1 = vel y > 0
value = 1051


;==========================================================
; Leg Scissor Slam
;==========================================================

[statedef 1100]
movetype = A
type = S
physics = S
velset = 0,0
ctrl = 0

[state 1100, nothitby]  ; Not grabbable during her own command grabs; This may be too good so removing.
type = nothitby
trigger1 = animelemtime(3) < 0
value = ,AT

[State 1100, 1]
type = HitDef
Trigger1 = animelem = 2
trigger1 = p2stateno != [150,155]
persistent = 0
attr = S, ST          
hitflag = M-          
priority = 1, Miss    
sparkno = -1          
p1sprpriority = 1  
p2sprpriority = -1                        
p1facing = 1
p2facing = 1         
p1stateno = 1101       
p2stateno = 1105     
guard.dist = 0        
fall = 1 
fall.recover = 0

[State 1100, 1]
type = HitDef
triggerall = enemynear,anim = 5300
Trigger1 = animelem = 2
persistent = 0
attr = S, ST          
hitflag = M          
priority = 1, Miss    
sparkno = -1          
p1sprpriority = 1  
p2sprpriority = -1                        
p1facing = 1
p2facing = 1         
p1stateno = 1101       
p2stateno = 1105     
guard.dist = 0        
fall = 1 
fall.recover = 0

;If the move is fast it won't need armor.  Removing for balance
;===========
;Armor start
;===========
[state 1100, animation]
type = changeanim
trigger1 = anim != 1100
value = 1100

[state 1100, armor counter]
type = varset
trigger1 = time = 0
trigger1 = Var(21) = 2
V = 20
value = 2

[state 1100, excess armor check]
type = varset
trigger1 = var(20) > 2
var(20) = 2
persistent = 1
ignorehitpause = 1

[state x, armor over]
type = varset
trigger1 = animelem = 3
v = 20
value = 0
ignorehitpause 

[state 1100, armor intiator turn off]
type = varset
trigger1 = time = 1
V = 21
value = 0

;determine what frame
[state 1100, remember frame]
type = varset
trigger1 = time <= 0
v = 22
value = animelemno(0)
ignorehitpause = 1

;delay effect
[state 1100, delay]
type = changeanim 
trigger1 = var(31) < floor(gethitvar(hittime)*0.8)
value = anim
elem = var(22)

[state 1100, freeze location]
type = posfreeze
trigger1 = var(31) < floor(gethitvar(hittime)*0.8)
value = 1
;--------------------------

[state 1100, still take damage]
type = lifeadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) != 0
value = floor(-gethitvar(damage)*0.1)
persistent = 1

[state 1100, armor count down]
type = varadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) > 0
V = 20
value = - 1
persistent = 1

[state 1100, Unstoppable]
type = hitoverride
trigger1 = alive
trigger1 = Var(20) > 0
trigger1 = animelemtime(3) < 0
attr = SC, AA, AP
stateno = 1100
time = 1
persistent = 1

[State 1050, flash red]
type = PalFX
trigger1 = Time = 0
trigger1 = gethitvar(damage) != 0
time = 7
add = 100,0,0
IgnoreHitPause = 1
;-----------------------------------------------------------
 
[state 1100, Not Active]
type = statetypeset
trigger1 = animelemtime(3) = 0
movetype = I            

[state 1100, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1

;--------------------------------------------------------
;Leg Scissor animation
[statedef 1101]
movetype = A
type = A
physics = N
velset = 0,0

[state 1101, anim]
type = changeanim
trigger1 = time = 0
value = 1110

[state 1101, width]
type = width
trigger1 = 1
value = 260,80

[state 1101, sprite priority]
type = sprpriority
trigger1 = time > 23
value = -4

[state 1101, explod]
type = explod
trigger1 = time = 0
anim = 1111
sprpriority = 2
bindtime = -1
id = 1101
ignorehitpause = 0
scale =  Const(size.xscale),Const(size.yscale)
removetime = -2

[State 1101, Bind 1]
type = TargetBind
trigger1 = AnimElemTime(2) < 0
pos = 150, 0


[State 1101, Bind 2]
type = TargetBind
trigger1 = AnimElemTime(2) >= 0 && AnimElemTime(3) < 0
pos = 160, 0

[State 1101, Bind 3]
type = TargetBind
trigger1 = AnimElemTime(3) >= 0 && AnimElemTime(4) < 0
pos = 150, -180

[State 1101, Bind 4]
type = TargetBind
trigger1 = AnimElemTime(4) >= 0 && AnimElemTime(5) < 0
pos = 78, -205

[State 1101, Bind 5]
type = TargetBind
trigger1 = AnimElemTime(5) >= 0 && AnimElemTime(6) < 0
pos = 106, -174

[State 1101, Bind 6]
type = TargetBind
trigger1 = AnimElemTime(6) >= 0 
pos = 70, -185

[state 1101, Jump]
type = velset
trigger1 =time = 10
y = -12
x = 1

[state 1101, gravity]
type = gravity
trigger1 = time > 16




[state 1101, remove explod]
type = removeexplod
triggerall = time > 12
trigger1 = pos y > 0
trigger1 = vel y > -pos y
id = 1101

[State 1101, State End]
type = ChangeState
triggerall = time > 12
trigger1 = pos y > 0
trigger1 = vel y > -pos y
value = 1102

;--------------------------------------------------------
;Leg Scissor Landing
[statedef 1102]
movetype = A
type = S
physics = C
sprpriority = -3

[state 1101, width]
type = width
trigger1 = 1
value = 200,80

[state 1102, poweradd]
type = poweradd
trigger1 = time = 0
value = 200

[State 1102, Hurt 11]
type = TargetLifeAdd
trigger1 = time = 0
value = -180

[state 1102, snd]
type = playsnd
trigger1 = time = 0
value = S1,1

[state 1102, snd]
type = playsnd
trigger1 = time = 5
value = S1100,0

[state 1102, targetstate]
type = targetstate
trigger1 = time = 0
value = 1106

[state 1102, velset]
type = velset
trigger1 = time = 0
x = 0
y = 0

[state 1102, posset]
type = posset
trigger1 = time = 0
y = 0

[state 1102, anim]
type = changeanim
trigger1 = time = 0
value = 1115

[State 1102, Bind 1]
type = TargetBind
trigger1 = AnimElemtime(5) < 10 
pos = 60, -75

;Custom Dust
[state 1102, dust front]
type = explod
trigger1 = time = 0
anim = 2000
pos = 30,0
scale = const(size.xscale)*3,const(size.yscale)*1.5
ontop = 1
ownpal = 1

[state 1102, dustback]
type = explod
trigger1 = time = 0
anim = 2001
pos = 30,0
scale = const(size.xscale)*3,const(size.yscale)*1.5
sprpriority = -4
ownpal = 1

[state 651, fx]
type = explod
trigger1 = time = 0
anim = F61
pos = 0,0
scale = 4,1.5
ownpal = 1
;---

[state 1102, earthquakes]
type = envshake
trigger1 = time = 0
time = 30
ampl = -25
freq = 75
phase = 75

[state 1102, explod]
type = explod
trigger1 = time = 0
anim = 1116
sprpriority = 2
bindtime = -1
id = 1102
ignorehitpause = 0
scale =  Const(size.xscale),Const(size.yscale)
removetime = -2

[state 1102, end]
type = changestate
trigger1 = animtime = 0
value = 1103


;---------------------------------------------------------
;Jump Back
[statedef 1103]
movetype = I
type = A
physics = N
anim = 44

[state 1103, velset]
type = velset
trigger1 = time = 0
x = -10
y = -10

[state 1103, invun]
type = nothitby
trigger1 = 1
value = SCA

[state 1103, gravity]
type = gravity
trigger1 = time > 2

[state 1103, end]
type = changestate
trigger1 = pos y > 0
trigger1 = vel y > -pos y
value = 0
ctrl = 1



;========================================================
;Victim animation
;========================================================
;Air portion
[statedef 1105]
movetype = H
type = A
physics = N

[state 1105, poweradd]
type = poweradd
trigger1 = time = 0
value = 100

[state 1105, anim]
type = changeanim2
trigger1 = time = 0
value = 1117

[state 1105, selfstate]
type = selfstate
trigger1 = time > 300
value = 5050

;--------------------------------------------------------

;Air portion
[statedef 1106]
movetype = H
type = A
physics = N

[state 1106, anim]
type = changeanim2
trigger1 = time = 0
value = 1118

[state 1106, end]
type = changestate
trigger1 = time = 30
value = 1107

;----------------------------------------------------------------------------------
;fly back
[statedef 1107]
movetype = H
type = A
physics = N

[state 1107, vel]
type = velset
trigger1 = time = 0
x = -4
y = -6

[state 1107, gravity]
type = gravity
trigger1 = time > 2

[state 1107, turn]
type = turn
trigger1 = pos y > 0
trigger1 = vel y > -pos y

[state 1107, end]
type = selfstate
trigger1 = pos y > 0
trigger1 = vel y > -pos y
value = 5100
;-------------------------------------------------------
;Hard Leg Scissor Grab
[statedef 1110]
movetype = A
type = S
physics = S
velset = 0,0
ctrl = 0

[state 1110, nothitby] ; Over powered and unnessisary
type = nothitby
trigger1 = animelemtime(3) < 0
value = ,AT

[State 1100, 1]
type = HitDef
Trigger1 = animelem = 2
trigger1 = p2stateno != [150,155]
attr = S, ST          
hitflag = M-          
priority = 1, Miss    
sparkno = -1          
p1sprpriority = 1  
p2sprpriority = -1                        
p1facing = 1
p2facing = 1         
p1stateno = 1111       
p2stateno = 1105     
guard.dist = 0        
fall = 1        

[State 1100, 1]
type = HitDef
triggerall = enemynear,anim = 5300
Trigger1 = animelem = 2
attr = S, ST          
hitflag = M         
priority = 1, Miss    
sparkno = -1          
p1sprpriority = 1  
p2sprpriority = -1                        
p1facing = 1
p2facing = 1         
p1stateno = 1111       
p2stateno = 1105     
guard.dist = 0        
fall = 1    

;She doesn't need armor since I sped up the animation.  If I slow it down again that would merit armor.
;===========
;Armor start
;===========
[state 1110, animation]
type = changeanim
trigger1 = anim != 1101
value = 1101

[state 1110, armor counter]
type = varset
trigger1 = time = 0
trigger1 = Var(21) = 1
V = 20
value = 4

[state 1110, excess armor check]
type = varset
trigger1 = var(20) > 4
var(20) = 4
persistent = 1
ignorehitpause = 1

[state 1110, armor over]
type = varset
trigger1 = animelem = 3
v = 20
value = 0
ignorehitpause 

[state 1110, armor intiator turn off]
type = varset
trigger1 = time = 1
V = 21
value = 0

;determine what frame
[state 1110, remember frame]
type = varset
trigger1 = time <= 0
v = 22
value = animelemno(0)
ignorehitpause = 1

;delay effect
[state 1110, delay]
type = changeanim 
trigger1 = var(31) < floor(gethitvar(hittime)*0.8)
value = anim
elem = var(22)

[state 1110, freeze location]
type = posfreeze
trigger1 = var(31) < floor(gethitvar(hittime)*0.8)
value = 1
;--------------------------

[state 1110, still take damage]
type = lifeadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) != 0
value = floor(-gethitvar(damage)*0.1)
persistent = 1

[state 1110, armor count down]
type = varadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) > 0
V = 20
value = - 1
persistent = 1

[state 1110, Unstoppable]
type = hitoverride
trigger1 = Life > 1
trigger1 = Var(20) > 0
trigger1 = animelemtime(3) < 0
attr = SC, AA, AP
stateno = 1110
time = 1
persistent = 1

[State 1110, flash red]
type = PalFX
trigger1 = Time = 0
trigger1 = gethitvar(damage) != 0
time = 7
add = 100,0,0
IgnoreHitPause = 1   

[state 1110, Not Active]
type = statetypeset
trigger1 = animelemtime(3) = 0
movetype = I 

[state 1110, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1

;--------------------------------------------------------
;Leg Scissor animation
[statedef 1111]
movetype = A
type = A
physics = N
velset = 0,0

[state 1111, anim]
type = changeanim
trigger1 = time = 0
value = 1110

[state 1111, width]
type = width
trigger1 = 1
value = 260,80

[state 1111, sprite priority]
type = sprpriority
trigger1 = time > 23
value = -4

[state 1111, explod]
type = explod
trigger1 = time = 0
anim = 1111
sprpriority = 2
bindtime = -1
id = 1111
ignorehitpause = 0
scale =  Const(size.xscale),Const(size.yscale)
removetime = -2

[State 1111, Bind 1]
type = TargetBind
trigger1 = AnimElemTime(2) < 0
pos = 150, 0

[State 1111, Bind 2]
type = TargetBind
trigger1 = AnimElemTime(2) >= 0 && AnimElemTime(3) < 0
pos = 160, 0

[State 1111, Bind 3]
type = TargetBind
trigger1 = AnimElemTime(3) >= 0 && AnimElemTime(4) < 0
pos = 150, -180

[State 1111, Bind 4]
type = TargetBind
trigger1 = AnimElemTime(4) >= 0 && AnimElemTime(5) < 0
pos = 50, -140

[State 1111, Bind 5]
type = TargetBind
trigger1 = AnimElemTime(5) >= 0 && AnimElemTime(6) < 0
pos = 80, -190

[State 1111, Bind 6]
type = TargetBind
trigger1 = AnimElemTime(6) >= 0 
pos = 70, -185

[state 1111, Jump]
type = velset
trigger1 =time = 10
y = -16
x = 1

[state 1111, gravity]
type = gravity
trigger1 = time > 16

[state 1101, remove explod]
type = removeexplod
triggerall = time > 12
trigger1 = pos y > 0
trigger1 = vel y > -pos y
id = 1111

[State 1111, State End]
type = ChangeState
triggerall = time > 12
trigger1 = pos y > 0
trigger1 = vel y > -pos y
value = 1112

;--------------------------------------------------------
;Leg Scissor Landing
[statedef 1112]
movetype = A
type = S
physics = C

[State 1112, Hurt 11]
type = TargetLifeAdd
trigger1 = time = 0
value = -240

[state 1112, poweradd]
type = poweradd
trigger1 = time = 0
value = 250

[state 1112, snd]
type = playsnd
trigger1 = time = 0
value = S1,1

[state 1112, snd]
type = playsnd
trigger1 = time = 5
value = S1100,0

[state 1112, targetstate]
type = targetstate
trigger1 = time = 0
value = 1106

[state 1112, velset]
type = velset
trigger1 = time = 0
x = 0
y = 0

[state 1112, posset]
type = posset
trigger1 = time = 0
y = 0

[state 1112, anim]
type = changeanim
trigger1 = time = 0
value = 1115

[State 1102, Bind 1]
type = TargetBind
trigger1 = AnimElemtime(5) < 10 
pos = 60, -95

;Custom Dust
[state 1102, dust front]
type = explod
trigger1 = time = 0
anim = 2000
pos = 30,0
scale = const(size.xscale)*3,const(size.yscale)*1.75
ontop = 1
ownpal = 1

[state 1102, dustback]
type = explod
trigger1 = time = 0
anim = 2001
pos = 30,0
scale = const(size.xscale)*3,const(size.yscale)*1.75
sprpriority = -4
ownpal = 1

[state 651, fx]
type = explod
trigger1 = time = 0
anim = F61
pos = 0,0
scale = 6,1.5
ownpal = 1
;---

[state 1112, earthquakes]
type = envshake
trigger1 = time = 0
time = 30
ampl = -25
freq = 75
phase = 75

[state 1112, explod]
type = explod
trigger1 = time = 0
anim = 1116
sprpriority = 2
bindtime = -1
id = 1112
ignorehitpause = 0
scale =  Const(size.xscale),Const(size.yscale)
removetime = -2

[state 1112, end]
type = changestate
trigger1 = animtime = 0
value = 1113


;---------------------------------------------------------
;Jump Back
[statedef 1113]
movetype = I
type = A
physics = N
anim = 44

[state 1113, velset]
type = velset
trigger1 = time = 0
x = -4
y = -10

[state 1113, invun]
type = nothitby
trigger1 = 1
value = SCA

[state 1113, gravity]
type = gravity
trigger1 = time > 2

[state 1113, end]
type = changestate
trigger1 = pos y > 0
trigger1 = vel y > -pos y
value = 0
ctrl = 1

;-------------------------------------------------------
;EX Command Grab
[statedef 1120]
movetype = A
type = S
physics = S
velset = 0,0
ctrl = 0

[State 1120, Blink Yellow]
type = PalFX
trigger1 = time%2
time = 1
add = 150,75,0 ;32,16,0
sinadd = 64,32,5,3
ignorehitpause

[state 1120, velset]
type = velset
trigger1 = time = 0
x = 12

[state 1100, nothitby]
type = nothitby
trigger1 = animelemtime(3) < 0
value = SCA

[state 1120, Anim]
type = changeanim
trigger1 = time = 0
value = 1101

[state 1120, ex metere]
type = poweradd
triggerall = prevstateno != 1120
trigger1 = time = 1
value = -500

[State 1120, 1]
type = HitDef
Trigger1 = animelem = 2
trigger1 = enemynear,stateno != [150,155]
attr = S, ST          
hitflag = M  
getpower = 0       
priority = 1, Miss    
sparkno = -1          
p1sprpriority = 1  
p2sprpriority = -1                        
p1facing = 1
p2facing = 1         
p1stateno = 1121       
p2stateno = 1105     
guard.dist = 0        
fall = 1              

[state 1120, Not Active]
type = statetypeset
trigger1 = animelemtime(3) = 0
movetype = I

[state 1110, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1

;--------------------------------------------------------
;Leg Scissor animation
[statedef 1121]
movetype = A
type = A
physics = N
velset = 0,0

[state 1121, anim]
type = changeanim
trigger1 = time = 0
value = 1110

[state 1121, width]
type = width
trigger1 = 1
value = 260,80

[State 1020, Blink Yellow]
type = PalFX
trigger1 = time%2
time = 1
add = 150,75,0 ;32,16,0
sinadd = 64,32,5,3
ignorehitpause

[state 1121, sprite priority]
type = sprpriority
trigger1 = time > 23
value = -4

[state 1121, explod]
type = explod
trigger1 = time = 0
anim = 1111
sprpriority = 2
bindtime = -1
id = 1121
ignorehitpause = 0
scale =  Const(size.xscale),Const(size.yscale)
removetime = -2

[State 1121, Bind 1]
type = TargetBind
trigger1 = AnimElemTime(2) < 0
pos = 150, 0

[State 1121, Bind 2]
type = TargetBind
trigger1 = AnimElemTime(2) >= 0 && AnimElemTime(3) < 0
pos = 160, 0

[State 1121, Bind 3]
type = TargetBind
trigger1 = AnimElemTime(3) >= 0 && AnimElemTime(4) < 0
pos = 150, -180

[State 1121, Bind 4]
type = TargetBind
trigger1 = AnimElemTime(4) >= 0 && AnimElemTime(5) < 0
pos = 50, -140

[State 1121, Bind 5]
type = TargetBind
trigger1 = AnimElemTime(5) >= 0 && AnimElemTime(6) < 0
pos = 80, -190

[State 1121, Bind 6]
type = TargetBind
trigger1 = AnimElemTime(6) >= 0 
pos = 70, -185

[state 1121, Jump]
type = velset
trigger1 =time = 10
y = -20
x = 1

[state 1121, gravity]
type = gravity
trigger1 = time > 16

[state 1101, remove explod]
type = removeexplod
triggerall = time > 12
trigger1 = pos y > 0
trigger1 = vel y > -pos y
id = 1121

[State 1121, State End]
type = ChangeState
triggerall = time > 12
trigger1 = pos y > 0
trigger1 = vel y > -pos y
value = 1122

;--------------------------------------------------------
;Leg Scissor Landing
[statedef 1122]
movetype = A
type = S
physics = C

[State 1122, Blink Yellow]
type = PalFX
trigger1 = time%2
time = 1
add = 150,75,0 ;32,16,0
sinadd = 64,32,5,3
ignorehitpause

[State 1122, Hurt 11]
type = TargetLifeAdd
trigger1 = time = 0
value = floor(fvar(10)*-220)

[state 1122, snd]
type = playsnd
trigger1 = time = 0
value = S1,1

[state 1122, snd]
type = playsnd
trigger1 = time = 5
value = S1100,0

[state 1122, targetstate]
type = targetstate
trigger1 = time = 0
value = 1106

[state 1122, velset]
type = velset
trigger1 = time = 0
x = 0
y = 0

[state 1122, posset]
type = posset
trigger1 = time = 0
y = 0

[state 1122, anim]
type = changeanim
trigger1 = time = 0
value = 1115

[State 1102, Bind 1]
type = TargetBind
trigger1 = AnimElemtime(5) < 10 
pos = 60, -95

;Custom Dust
[state 1102, dust front]
type = explod
trigger1 = time = 0
anim = 2000
pos = 30,0
scale = const(size.xscale)*3.25,const(size.yscale)*1.75
ontop = 1
ownpal = 1

[state 1102, dustback]
type = explod
trigger1 = time = 0
anim = 2001
pos = 30,0
scale = const(size.xscale)*3.25,const(size.yscale)*1.75
sprpriority = -4
ownpal = 1

[state 651, fx]
type = explod
trigger1 = time = 0
anim = F61
pos = 0,0
scale = 6,1.5
ownpal = 1
;---

[state 1122, earthquakes]
type = envshake
trigger1 = time = 0
time = 30
ampl = -30
freq = 75
phase = 75

[state 1122, explod]
type = explod
trigger1 = time = 0
anim = 1116
sprpriority = 2
bindtime = -1
id = 1122
ignorehitpause = 0
scale =  Const(size.xscale),Const(size.yscale)
removetime = -2

[state 1122, end]
type = changestate
trigger1 = animtime = 0
value = 1123


;---------------------------------------------------------
;Jump Back
[statedef 1123]
movetype = I
type = A
physics = N
anim = 44

[State 1123, Blink Yellow]
type = PalFX
trigger1 = time%2
time = 1
add = 150,75,0 ;32,16,0
sinadd = 64,32,5,3
ignorehitpause

[state 1123, velset]
type = velset
trigger1 = time = 0
x = -8
y = -10

[state 1123, invun]
type = nothitby
trigger1 = 1
value = SCA

[state 1123, gravity]
type = gravity
trigger1 = time > 2

[state 1123, end]
type = changestate
trigger1 = pos y > 0
trigger1 = vel y > -pos y
value = 0
ctrl = 1


;--------------------------------------------------------
;===========================================================================
;  Hip Bump (Push Block)
;===========================================================================

[Statedef 1400]
type = S
movetype = I
physics = S
velset = 0,0
anim = 1400
facep2 = 1

[state 1400, poweradd]
type = poweradd
trigger1 = time = 0
value = -500

[state 1400, awareness pause]
type = pause
trigger1 = time = 0
time = 8
endcmdbuftime = 8

[state 1400, dim]
type = bgpalfx
trigger1 = time = 0
time = 8
mul = 200,200,200

[State 330, Spark]
type = Explod
trigger1 = AnimElem = 3
id = 1410
anim = 1410
postype = p1
pos = 155,-110
sprpriority = 4
bindtime = 1
scale = 3,3
ownpal = 1

[State 211, 2]
type = HitDef
trigger1 = 1
persistent = 0
attr = S, NA
animtype  = Heavy
damage    = 25
Hitflag = MA
guardflag = 
pausetime = 0,0
sparkno = -1
ground.Velocity = -5
air.Velocity = -5,0
fall = 1
fall.recover = 0
kill = 0
guard.kill = 0

[state 1400, moveforward]
type = velset
trigger1 = time = 0
x = 0

[state 1400, snd]
type = playsnd
trigger1 = time = 1
value = 1400,1

[State 1400, Push]
type = Helper
trigger1 = Time = 10
trigger2 = time = 12
ignorehitpause = 1
ID = 1401
name = "Shove"
pos = -20,0
postype = p1
stateno = 1401
keyctrl = 0
ownpal = 1
helpertype = normal

[state 1400, moveforward]
type = velset
trigger1 = time = 0
x = 5

[state 1400, HB]
Type = hitby
trigger1 = 1
value = SCA,AT

[state 1400, previous state]
type = varset
trigger1 = time = 0
v = 5
value = prevstateno


[State 1400, 3]
type = ChangeState
Trigger1 = AnimTime = 0
value = 0
ctrl = 1

;-----------------------------------------------------------------------------
; Pushing part
[Statedef 1401]
type    = A
movetype= I
physics = N
velset = 0,0
anim = 1401

[State 1440, Push]
type = posset
trigger1 = time = 0
y = 0

[State 1440, Push]
type = PlayerPush
trigger1 = 1
value = 1

[State 1440, NHB]
type = NotHitBy
Trigger1 = 1
value = SCA
Time = 1

[State 1440, Vel]
type = VelSet
trigger1 = Time >= 0
x = 30

[State 345, End]
type = DestroySelf
trigger1 = Time = 15




;=========================================================
; Super Combo
;=========================================================
; Base Damage 560

[Statedef 3000]
movetype = A
type = A
physics = N
ctrl = 0
velset = 0, 0

[state x, Minimum Super combo damage]
type = varset
trigger1 = time = 0
trigger1 = var(18) < 90
v = 18
value = 90

[state 3000, anim]
type = changeanim
trigger1 = time = 0
value = 3000

[state 3000, screenbound]
type = screenbound
trigger1 = 1
value = 0
movecamera = 1,0

[state 3000, width]
type = width
trigger1 = 1
edge = 120,-50
player = 0,0

[state 3000, playerpush]
type = playerpush
trigger1 = !moveguarded
value = 0
ignorehitpause =1 
persistent = 1

[state 3000, no bg]
type = assertspecial
trigger1 = animelemtime(5) = [0,60]
flag = nobg
ignorehitpause = 1

[state 1050, snd]
type = playsnd
trigger1 = animelem = 4
value = S1050,0
ignorehitpause

[state 3000, nothitby]
type = nothitby
trigger1 = 1
value = SCA
ignorehitpause = 1

[state 1050, posadd]
type = posadd
trigger1 = animelem = 2
x = -80
persistent = 0

[state 1050, posadd]
type = posadd
trigger1 = animelem = 3
x = -30
persistent = 0

[State 1050, step dust]
type = MakeDust
trigger1 = animelem = 4 
pos = -55, 0
pos2 = -145,0
spacing = 1
persistent = 0


[state 1050, earthquakes]
type = envshake
trigger1 = animelem = 4
time = 10
ampl = -8
freq = 100
phase = 100
persistent = 0

[state 1050, sound]
type = playsnd
trigger1 = animelem = 4
value = S1,2
persistent = 0

[state 3000, gravity]
type = gravity
trigger1 = time > 84

[State 3000, Super Pause]
type = SuperPause
trigger1 = animelemtime(1) = 0
sound = S3000, 0
poweradd = -3000
pos = 80,-80
time = 60
movetime = 60
unhittable = 1

[state 3000, Super Portrait]
type = explod
trigger1 = animelemtime(1) >= 0 && animelemtime(5) < 6
anim = 3100
postype = back
sprpriority = -3
supermovetime = 60
removetime = 1
pausemovetime = 60
scale = (3-(time*0.15))*(1),(3-(time*0.15))*(1)
pos = 0,60-time*5
ownpal = 1

[state 3000, Super Portrait]
type = explod
trigger1 = animelemtime(5) = 6
anim = 3100
postype = back
vel = -0.1,0
sprpriority = -3
supermovetime = 60
removetime = 45
pausemovetime = 60
pos = 0,0
scale = 1,1
ownpal = 1

[state 3000, velset]
type = velset
trigger1 = animelemtime(7) = 0
x = 20;26
y = -30

[state 1070, explod]
type = explod
trigger1 = animelemtime(7) = 0
trigger1 = !numexplod(2035)
id = 2035
anim = 2035
postype = p1
sprpriority = 4
bindtime = -1
removetime = -1
removeongethit = 1
ignorehitpause = 1
scale = const(size.xscale),const(size.yscale)


;[state 3000, velset]
;type = velset
;trigger1 = p2bodydist x < 15
;trigger1 = animelemtime(7) = 0
;x = 15


[state 3000, velstop]
type = velset
trigger1 = movehit
trigger1 = numtarget(3000)
x = 0

[state 651, fx]
type = explod
trigger1 = time = 70
anim = F61
pos = 0,0
scale = 2,2
ownpal = 1

[state 3000, playsnd]
type = playsnd
trigger1 = animelemtime(7) = 0
value = S41,0

[State 3000, 1]
type = HitDef
Trigger1 = time > 65
persistent = 0
attr = A, HA          
hitflag = MAF  
guardflag = MA  
id = 3000     
priority = 4, Miss    
sparkno = -1 
damage = 70,ifelse(p2statetype = A,21,7)
getpower = 0
givepower = 450
pausetime = 16,16
guard.pausetime = 12,12
sparkno = 3
p1facing = 1
p2facing = 1
sparkxy = -20,-210
hitsound   = 5,4
guardsound = S120, 0
ground.type = high
ground.slidetime = 30
ground.hittime  = 24
guard.hittime = 21
guard.slidetime = 21
guard.velocity = -30
ground.velocity = -15,-15
air.velocity = -16,-3
air.hittime = 24 
kill = 0 
guard.dist = 720

[State -2, Super Jump Indicator]
type = helper
triggerall = !numhelper(4000)
name = "WARNING"
helpertype = normal
trigger1 = time = 75
persistent = 0
stateno = 4000
ID = 4000
ownpal = 1



[state 3000, targetstate]
type = targetstate
trigger1 = movehit 
trigger1 = numtarget(3000)
trigger1 = hitpausetime = 1
id = 3000
value = 3010
ignorehitpause = 1
persistent = 0

[state 3000, movehit check]
type = varset
trigger1 = time = 0
var(34) = 0
ignorehitpause
persistent = 0

[state 3000, movehit check]
type = varset
trigger1 = movehit
var(34) =1
ignorehitpause
persistent = 0

[state 3000, Avoid push on meaties]
type = playerpush
trigger1 = 1
value = 0
ignorehitpause = 1



[state 3001, edge]
type = velmul
trigger1 = frontedgedist < 140
x = -0.5
persistent = 15

[state 3001, back edge]
type = velmul
trigger1 = backedgedist < 50
x = 0.5
persistent = 15

[state 3000, end]
type = changestate
trigger1 = vel y > 0
value = 3001

;--------------------------------------------------------
;Coming down
[statedef 3001]
movetype = A
type = A
physics = N


[state 3001, removeX]
type = removeexplod
trigger1 = time = 0
id = 2035

[state 3001, playsnd]
type = playsnd
trigger1 = enemy,movetype != H
trigger1 = time = 0
value = S3000,1
channel = 3

[state 3001, screenbound]
type = screenbound
trigger1 = 1
value = 0
movecamera = 1,0

[state 3001, edge]
type = velset
trigger1 = frontedgedist < 140
x = -4

[state 3001, back edge]
type = velset
trigger1 = backedgedist < 50
x = 4

[state 3000, width]
type = width
trigger1 = 1
edge = 250,50
player = 0,0

[state 3001, anim]
type = changeanim
trigger1 = time = 0
value = 3001

[state 3001, gravity]
type = gravity
trigger1 = time > 48

[state 3001, stop x]
type = velmul
trigger1 = time = 0
x = 0.05
y = 0.05
persistent = 0

;[state 3001, stop y]
;type = velmul
;trigger1 = time = 46
;y = 2

[state 3001, guide forward]
type = veladd
triggerall = vel x < 18
triggerall = var(34) != 1
trigger1 = command = "holdfwd"
trigger1 = ailevel = 0
trigger2 = ailevel > 0
trigger2 = p2bodydist x > 150
x = 0.45
persistent = 1

[state 3001, guide back]
type = veladd
triggerall = vel x > -18
triggerall = var(34) != 1
trigger1 = command = "holdback"
trigger1 = ailevel = 0
trigger2 = ailevel > 0
trigger2 = p2bodydist x < -150
x = -0.45
persistent = 1

[state 3001, explod]
type = explod
trigger1 = !numexplod(2300)
id = 2300
anim = 2300
postype = p1
sprpriority = 4
bindtime = -1
removetime = -1
removeongethit = 1
ignorehitpause = 1
scale = const(size.xscale),const(size.yscale)
trans = addalpha
alpha = 256, 192




[state 3001, position]
type = posset
triggerall = numtarget(3000)
trigger1 = time = 0
trigger1 = var(34) = 1
x = target(3000),pos x - (ifelse(facing = 1,160,-160))


[state 3001, playerpush]
type = playerpush
trigger1 = 1
value = 0

[state 3001, nothitby]
type = nothitby
trigger1 = 1 
value = ,AA,AP
ignorehitpause = 1

;Ride down mechanic
[state 3001, Ride down]
type = targetbind
trigger1 = movehit
trigger1 = enemy,statetype = A
trigger1 = p2life > 0
pos = 140, -20
id = 3001

[state 3001, state of ride down]
type = targetstate
trigger1 = movehit
trigger1 = enemy,statetype = A
trigger1 = p2life > 0
value = 654
id = 3001


[state 3001, end]
type = targetstate
trigger1 = pos y > -2
trigger1 = enemy,stateno = 655
value = 3020
id = 3001

[State 3000, 1]
type = HitDef
Trigger1 = time = 0
persistent = 1
attr = A, HA          
hitflag = MAF  
guardflag = MA        
priority = 6, Miss    
sparkno = -1 
damage = 420,126
getpower = 0
id = 3001
givepower = 450
pausetime = 4,12
guard.pausetime = 14,14
sparkno = 0
sparkxy = -150,-210
hitsound   = S1,3
guardsound = S120, 0
ground.type = High
ground.slidetime = 45
ground.hittime  = 12
guard.hittime = 45
guard.slidetime = 60
guard.velocity = -50
ground.velocity = -5,-10
air.velocity = -5,-10
air.hittime = 45  
;fall = 1
guard.dist = 640

[state 650, end]
type = targetstate
trigger1 = movehit
trigger1 = enemy, statetype = S || enemy,statetype = C
trigger1 = numtarget(3001)
value = 3020
id = 3001

[State 3001, end]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 3002

;--------------------------------------------------------
;Landing
[statedef 3002]
type = C
movetype = A
physics = N
sprpriority = 2

[state 3002, removeX]
type = removeexplod
trigger1 = time = 0
id = 2300

[state 3002, stopsnd]
type = stopsnd
trigger1 = time = 0
channel = 3

[state 3000, width]
type = width
trigger1 = 1
edge = 150,20
player = 0,0

[state 41, fx]
type = explod
trigger1 = time = 2
anim = F61
pos = 140,0
sprpriority = -2
scale = 6,3
ownpal=1


[state 3002, anim]
type = changeanim
trigger1 = time = 0
value = 3002

[state 3002, on ground]
type = posset
trigger1 = time = 0
y = 0

[state 3002, stop]
type = velset
trigger1 = time = 0
y = 0
x = 0

[state 3000, nothitby]
type = nothitby
trigger1 = animelem = 1
value = SCA

[state 3000, nothitby]
type = nothitby
trigger1 = numtarget(3000)
trigger1 = target(3000),stateno = 3020
value = SCA

;Custom Dust
[state 3002, explod]
type = explod
trigger1 = time = 2
anim = 2000
pos = 140,0
scale = const(size.xscale)*2.5,const(size.yscale)*3
ontop = 1
ownpal=1

[state 3002, explod]
type = explod
trigger1 = time = 2
anim = 2001
pos = 140,0
scale = const(size.xscale)*2.5,const(size.yscale)*3
sprpriority = -4
ownpal=1
; -------------------

[state 3002, playerpush]
type = playerpush
trigger1 = 1
value = 0

[state 1000, explod]
type = explod
trigger1 = time = 0
anim = 3012
sprpriority = -2
bindtime = -1
id = 3012
ignorehitpause = 0
scale =  Const(size.xscale),Const(size.yscale)

[State 3002, 1]
type = HitDef
Trigger1 = animelem = 2
persistent = 1
attr = C, HA          
hitflag = FD  
guardflag =         
priority = 4, Hit    
sparkno = -1 
damage = 530
getpower = 0
givepower = 450
pausetime = 30,30
guard.pausetime = 12,12
sparkno = 0
p2stateno = 3020
p2sprpriority = -1
sparkxy = -150,-210
hitsound   = S1100,0
guardsound = S120, 0
ground.type = High
ground.slidetime = 6
ground.hittime  = 12
guard.hittime = 45
guard.velocity = -35
airguard.velocity = -3,10
ground.velocity = 0,0
air.velocity = 0,0
air.hittime = 45  

[state 3002, targetstate]
type = targetstate
trigger1 = numtarget(3000)
trigger1 = target(3000),stateno = 3012
trigger1 = animelem = 2
value = 3020
id = 3000

[state 3002, playsnd]
type = playsnd
trigger1 = animelem = 2
trigger1 = numtarget(3000)
value = S1100,0
persistent = 0

[state 3002, targetlifeadd]
type = targetlifeadd
trigger1 = animelem = 2
value = Ceil(fvar(10) * -530)
persistent = 0
id = 3000

[STATE 3002, TARGETpoweradd]
type = targetpoweradd
trigger1 = animelem = 2
value = 550
persistent = 0
id = 3000

[state 3002, pause]
type = pause
trigger1 = animelemtime(2) = 0
trigger1 = numtarget(3000)
time = 30

[state 3002, targetbind]
type = targetbind
trigger1 = movehit
pos = 180, 0
ignorehitpause = 1

[state 3002, snd]
trigger1 = time = 0
type = playsnd
value = S1,1

[state 3002, snd]
trigger1 = time = 0
type = playsnd
value = S1,1

[state 651, earthquakes]
type = envshake
trigger1 = time = 2
time = 60
ampl = -40
freq = 75
phase = 75

[state 3002, end]
type = changestate
trigger1 = time = 8
value = 3003

;------------------------------------
;bounce
[statedef 3003]
movetype =I
type = A
physics = N

[state 3003, anim]
type = changeanim
trigger1 = time = 0
value = 3003

[state 3003, nothitby]
type = nothitby
trigger1 = numtarget(3000)
value = SCA

[state 3003, playerpush]
type = playerpush
trigger1 = enemy,stateno = 660 || enemy,stateno = 3020
value = 0

[state 3003, slow-mo]
type = pause
trigger1 = time > 0 && time < 18
trigger1 = enemy,stateno = 660 || enemy,stateno = 3020
time = 2
persistent = 1

[state 3003, velset]
type = velset
trigger1 = time = 0
y = -10

[state 3003, gravity]
type = gravity
trigger1 = time > 1

[state 3002, remove explod]
type = removeexplod
trigger1 = time > 2
trigger1 = vel y > 0
trigger1 = pos y > -vel y
id = 3012

[State 3001, end]
type = changestate
trigger1 = time > 2
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 3004

;--------------------------------------------------------
;at rest
;Landing
[statedef 3004]
type = C
movetype = I
physics = N

[state 3004, anim]
type = changeanim
trigger1 = time = 0
value = 3004

[state 3004, nothitby]
type = nothitby
trigger1 = numtarget(3001)
trigger1 = target(3001),stateno = 3021
value = SCA

[state 3004, width]
type = width
trigger1 = 1
edge = 200,-320
player = 140,-180

[state 3004, targetstate]
type = targetstate
trigger1 = time = 0
trigger1 = enemy,stateno = 3020
value = 3021

[state 3004, on ground]
type = posset
trigger1 = time = 0
y = 0

[state 3004, stop]
type = velset
trigger1 = time = 0
y = 0
x = 0

[state 3004, playerpush]
type = playerpush
trigger1 = enemy,stateno = 660 || enemy,stateno = 3020
value = 0

[state 3004, explod]
type = explod
trigger1 = time = 0
anim = 3013
sprpriority = -2
bindtime = -1
id = 3013
ignorehitpause = 1
scale =  Const(size.xscale),Const(size.yscale)

[state 3002, snd]
trigger1 = time = 2
type = playsnd
value = S1,1

[state 41, fx]
type = explod
trigger1 = time = 2
anim = F61
pos = 140,0
sprpriority = -2
scale = 4,3
ownpal=1

[state 3004, earthquakes]
type = envshake
trigger1 = time = 2
time = 20
ampl = -10
freq = 100
phase = 100

[state 3002, remove explod]
type = removeexplod
trigger1 = animtime = 0
id = 3013

[state 3004, end]
type = changestate
trigger1 = animtime = 0
value = 658


;-------------------------------------------------------
;Victim State
[statedef 3010]
movetype = H
type = U
physics = N

[State 3010, Stop moving]
type = PosFreeze
trigger1 = 1
x = 1
y = 1

[state 3010]
type = changeanim
trigger1 = time = 0
value = 5051
ignorehitpause = 1

[state 3010, changestate]
type = changestate
trigger1 = hitshakeover
value = 3011
;--------------------------------------------------------
;Launch up
[statedef 3011]
movetype = H
type = U
physics = N

[state 3011, velset]
type = velset
trigger1 = time = 1
x = gethitvar(xvel)*facing
y = gethitvar(yvel)
persistent = 0
ignorehitpause



[state 3010, turn]
type = turn
trigger1 = time = 2

[state 3010, set type]
type = statetypeset
trigger1 = time = 3
statetype = A



[state 3011,curve]
type = changeanim
trigger1 = vel y > 0
value = 5061
persistent = 0

[state 3011, gravity]
type = veladd
trigger1 = pos y < -1
y = const(movement.down.bounce.yaccel)

[state 3011, landing]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 3012

;---------------------------------------------------------------
; Lay down state
[statedef 3012]
movetype = H
type = L
physics = N
velset = 0,0

[state 3012, on ground]
type = posset
trigger1 = time = 0
y = 0

[state 3012, anim]
type =  changeanim
trigger1 = time = 0
value = 5100

[state 3012, nothitby]
type = nothitby
trigger1 = 1
value = SCA

[state 3012, anim]
type =  changeanim
trigger1 = anim = 5100 && animtime = 0
value = 5110

[state 3012, end]
type = selfstate
trigger1 = time > 150
value = 5110

;--------------------------------------------------------
;Face crushed victim
[statedef 3020]
type = L
movetype = H
physics = C
sprpriority = 1

[state 3020, changeanim]
type = changeanim2
trigger1 = time = 0
value = 3020

[state 3020, playerpush]
type = playerpush
trigger1 = 1
value = 0

[state 3020, rotate]
type = angledraw
trigger1 = 1

[state 3010, set]
type = angleset
trigger1 = time = 0
value = 0

[state 3020, rotate]
type = angleadd
trigger1 = time = 3
value = 35

[state 3020, rotate]
type = angleadd
trigger1 = time =6
value = 10

[state 3020, counterrotate]
type = angleadd
trigger1 = time = 20
value = -15

[state 3020, counterrotate]
type = angleadd
trigger1 = time = 26
value = -15


[state 3020, counterrotate]
type = angleadd
trigger1 = time = 33
value = -15



[state 3020, don't move]
type = posfreeze
trigger1 = 1
y = 1
x = 1

[state 3020, end]
type = selfstate
trigger1 = time = 200
value = 5110

;--------------------------------------------------------
;Face crushed victim
[statedef 3021]
type = L
movetype = H
physics = C

[state 3020, changeanim]
type = changeanim2
trigger1 = time = 0
value = 3020

[state 3020, playerpush]
type = playerpush
trigger1 = 1
value = 0

[state 3020, rotate]
type = angledraw
trigger1 = 1

[state 3010, set]
type = angleset
trigger1 = time = 0
value = 0

[state 3020, rotate]
type = angleadd
trigger1 = time = 3
value = 15
persistent = 1

[state 3020, rotate]
type = angleadd
trigger1 = time = 9
value = 10
persistent = 1

[state 3020, counterrotate]
type = angleadd
trigger1 = time = 22
value = -8
persistent =1

[state 3020, counterrotate]
type = angleadd
trigger1 = time = 27
value = -8
persistent =1

[state 3020, counterrotate]
type = angleadd
trigger1 = time = 32
value = -8
persistent =1

[state 3020, don't move]
type = posfreeze
trigger1 = 1
y = 1
x = 1

[state 3020, end]
type = selfstate
trigger1 = time = 116
value = 5110

;===============================================================
; Bionic Ass  Damage: 260 -> 300 -> 270
;===============================================================

;Bionic Ass
[Statedef 3040]
type = S
movetype = A
physics = N
sprpriority = 2
ctrl = 0
velset = 0,0

[state 3040, invun]
type = nothitby
trigger1 = animelemtime(6) < 3
value = SCA

[state 3040, playerpush]
type = playerpush
trigger1 = enemy,statetype = L
value = 0

[state 3040, playerpush]
type = playerpush
trigger1 = enemy,statetype != L
value = 1

[state 3040, animation]
type = changeanim
trigger1 = anim != 3040
value = 3040

[state 3040, armor counter]
type = varset
trigger1 = time = 0
trigger1 = Var(21) = 1
V = 20
value = 1

[state 3040, unstoppable ass-more armor]
type = varadd
trigger1 = animelemtime(4) = 1
v = 20
value = 2
persistent = 0
ignorehitpause = 1

[state 3040, change]
type = statetypeset
trigger1 = animelemtime(4) = 1
statetype = A

[state 3040, armor intiator turn off]
type = varset
trigger1 = time = 1
V = 21
value = 0

[state 3040, still take damage]
type = lifeadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) != 0
value = floor(-gethitvar(damage)*0.5)
persistent = 1

[state 3040, armor count down]
type = varadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) > 0
V = 20
value = - 1
persistent = 1

[state 3040, Unstoppable]
type = hitoverride
trigger1 = Life > 1
trigger1 = Var(20) > 0
attr = SCA, AA, AP
stateno = 3040
time = 1
persistent = 1

[State 3040, flash red]
type = PalFX
trigger1 = Time = 0
trigger1 = gethitvar(damage) != 0
time = 7
add = 100,0,0
IgnoreHitPause = 1

;determine what frame
[state 3040, remember frame]
type = varset
trigger1 = time <= 0
v = 22
value = animelemno(0)
ignorehitpause = 1

;delay effect
[state 3040, delay]
type = changeanim 
trigger1 = var(31) < floor(gethitvar(hittime)*0.75)
value = anim
elem = var(22)

[state 3040, freeze location]
type = posfreeze
trigger1 = var(31) < floor(gethitvar(hittime)*0.75)
value = 1
;--------------------------


[state 3000, no bg]
type = assertspecial
trigger1 = animelemtime(2) =[0, 60]
flag = nobg
ignorehitpause = 1

[State 3000, Super Pause]
type = SuperPause
trigger1 = animelemtime(2) =0
sound = S3000, 0
pos = 80,-80
time = 60
movetime = 60
persistent = 0
ignorehitpause = 1
unhittable = 1

[state 3040, meter loss]
type = poweradd
triggerall = prevstateno != 3040
trigger1 = animelemtime(2) = 0
value = -1000
persistent = 0
ignorehitpause = 1

[state 3000, Super Portrait]
type = explod
trigger1 = animelemtime(2) =[0, 14]
anim = 3100
postype = back
sprpriority = -3
supermovetime = 60
removetime = 1
pausemovetime = 60
scale = (3-(time*0.15))*(1),(3-(time*0.15))*(1)
pos = 0,60-time*5
ownpal = 1

[state 3000, Super Portrait]
type = explod
trigger1 = animelemtime(2) = 15
anim = 3100
postype = back
vel = -0.1,0
sprpriority = -3
supermovetime = 60
removetime = 45
pausemovetime = 60
pos = 0,0
scale = 1,1
ownpal = 1

[state 3040, snd]
type = playsnd
trigger1 = animelem = 4
value = S1000,0
ignorehitpause 

[state 3040, change]
type = statetypeset
trigger1 = pos y < -1
statetype = A

[state 3040, explod]
type = explod
trigger1 = animelem = 6
anim = 3041
sprpriority = -1
bindtime = -1
id = 3041
ignorehitpause = 0
scale =  Const(size.xscale),Const(size.yscale)


[state 1000, Aura Front]
type = explod
trigger1 = animelemtime(6) = 0
trigger1 = !numexplod(2030)
anim = 2030
sprpriority = 3
scale =  Const(size.xscale),Const(size.yscale)
id = 2030
bindtime = -1
removetime = -1
ignorehitpause = 1
trans = addalpha
alpha = 256, 192

[state 1000, Aura Back]
type = explod
trigger1 = animelemtime(6) = 0
trigger1 = !numexplod(2031)
anim = 2031
sprpriority = -2
scale =  Const(size.xscale),Const(size.yscale)
id = 2031
bindtime = -1
removetime = -1
ignorehitpause = 1
trans = addalpha
alpha = 256, 192

[state 3040, velset]
type = velset
trigger1 = animelem = 4
trigger2 = animelem = 5
y = -7
x = 40

;[state 3040, wind]
;type = explod
;trigger1 = animelem = 6
;anim = 2050
;pos = 180,-160
;postype = p1
;bindtime = -1
;removetime = 24
;scale = const(size.xscale)*2.5, const(size.yscale)*2.5
;sprpriority = 4
;ownpal = 1
;removeongethit = 1

[state 3040, no autoturn]
type = assertspecial
trigger1 = 1
flag = noautoturn

[state 3040, velset]
type = velset
trigger1 = animelemtime(6) >= 0
x = ifelse(moveguarded, 24,32)

[state 3040, gravity]
type = veladd
trigger1 = pos y < -1
y = 0.75


[state 3040, set]
type = statetypeset
trigger1 = pos y < -1
statetype = A

[State 3040, 3]
type = HitDef
trigger1 = animelem = 6
persistent = 0
attr = A, HA
damage    = 60,12
guardflag = MA
hitflag = MAF
priority = 4
getpower = 0
givepower = 50
pausetime = 6,8
sparkno = 3
sparkxy = -10,-100
hitsound   = S240,0
guardsound = S120, 0
animtype = back
ground.type = High
ground.slidetime = 35
ground.hittime  = 40
ground.velocity = -10,0
air.velocity = -10,ifelse(p2bodydist y < -120, 6, -6)
envshake.freq = 80
envshake.ampl = 4
envshake.time = 8
guard.velocity = -10        
guard.hittime = 46
guard.slidetime = 46
airguard.velocity = -10,-5
airguard.hittime = 50
guard.dist = 480
air.fall = 1
forcestand = 1
fall.recover = 0

[State 3040, 3]
type = HitDef
trigger1 = animelem = 7
persistent = 0
attr = A, HA
damage    = 60,12
guardflag = MA
hitflag = MAF
priority = 4
getpower = 0
givepower = 50
pausetime = 6,8
sparkno = 3
sparkxy = -10,-100
hitsound   = S240,0
guardsound = S120, 0
animtype = back
ground.type = High
ground.slidetime = 35
ground.hittime  = 40
ground.velocity = -10,0
air.velocity = -10,ifelse(p2bodydist y < -120, 6, -6)
envshake.freq = 80
envshake.ampl = 4
envshake.time = 8
guard.velocity = -10        
guard.hittime = 46
guard.slidetime = 46
airguard.velocity = -10,-5
airguard.hittime = 50
guard.dist = 480
air.fall = 1
forcestand = 1
fall.recover = 0

[State 3040, 3]
type = HitDef
trigger1 = animelem = 8
persistent = 0
attr = A, HA
damage    = 60,12
guardflag = MA
hitflag = MAF
priority = 4
getpower = 0
givepower = 50
pausetime = 6,8
sparkno = 3
sparkxy = -10,-100
hitsound   = S240,0
guardsound = S120, 0
animtype = back
ground.type = High
ground.slidetime = 35
ground.hittime  = 40
ground.velocity = -10,0
air.velocity = -10,ifelse(p2bodydist y < -120, 6, -6)
envshake.freq = 80
envshake.ampl = 4
envshake.time = 8
guard.velocity = -10        
guard.hittime = 46
guard.slidetime = 46
airguard.velocity = -10,-5
airguard.hittime = 50
guard.dist = 480
air.fall = 1
forcestand = 1
fall.recover = 0

[State 3040, 3]
type = HitDef
trigger1 = animelem = 9
persistent = 0
attr = A, HA
damage    = 60,12
guardflag = MA
hitflag = MAF
priority = 4
getpower = 0
givepower = 50
pausetime = 6,8
sparkno = 3
sparkxy = -10,-100
hitsound   = S240,0
guardsound = S120, 0
animtype = back
ground.type = High
ground.slidetime = 35
ground.hittime  = 40
ground.velocity = -10,0
air.velocity = -10,ifelse(p2bodydist y < -120, 6, -6)
envshake.freq = 80
envshake.ampl = 4
envshake.time = 8
guard.velocity = -10        
guard.hittime = 46
guard.slidetime = 46
airguard.velocity = -10,-5
airguard.hittime = 50
guard.dist = 480
air.fall = 1
forcestand = 1
fall.recover = 0

[State 3040, 3]
type = HitDef
trigger1 = animelem = 10
persistent = 0
attr = A, HA
damage    = 60,12
guardflag = MA
hitflag = MAF
id = 3040
priority = 4
getpower = 0
givepower = 50
pausetime = 22,20
sparkno = 3
sparkxy = -10,-100
hitsound   = S240,0
guardsound = S120, 0
animtype = back
ground.type = High
ground.slidetime = 35
ground.hittime  = 40
ground.velocity = -150,-30
air.velocity = -150,-25
fall = 1
fall.recover = 0
envshake.freq = 80
envshake.ampl = 16
envshake.time = 24
guard.velocity = -35        
guard.hittime = 46
guard.slidetime = 46
airguard.velocity = -15,-5
airguard.hittime = 50
guard.dist = 480

[state 3040, wall bound]
type = targetstate
triggerall = numtarget 
trigger1 = animelemtime(10) >= 0
trigger1 = movehit
trigger1 = hitpausetime = 19
value = 6750
ignorehitpause = 1
id = 3040

[state 3040, width]
type = width
trigger1 = animelem = 1 
trigger2 = animelem = 2
trigger3 = animelem = 3
value = 130,0

[state 3040, width]
type = width
trigger1 = animelem = 4 
trigger2 = animelem = 5
value = 110,0

[state 3040, width]
type = width
trigger1 = animelem = 6 
trigger2 = animelem = 7
value = 110,0

[state 3040, removeexplod]
type = removeexplod
trigger1 = vel y > 0
trigger1 = pos y > -vel y
id = 3041

[state 3040, combo damage score]
type = varset
trigger1 = var(18) < 80
v = 18
value = 80
persistent = 0
ignorehitpause = 1

[state 3040, end]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 3041
ignorehitpause

;----------------------------------0
; Landing
[statedef 3041]
type = S
movetype = A
physics = N
ctrl = 0
anim = 1002
movehitpersist = 1

[state 3041, removeexplod]
type = removeexplod
trigger1 = time = 0
id = 2030
ignorehitpause = 1

[state 3041, removeexplod]
type = removeexplod
trigger1 = time = 0
id = 2031
ignorehitpause = 1

[state 3041, fx]
type = explod
trigger1 = time = 0
anim = F61
pos = 0,0
scale = 4,2
ownpal = 1

;Custom Dust
[state 3041, explod]
type = explod
trigger1 = time = 0
anim = 2000
pos = 0,0
scale = const(size.xscale)*2.75,const(size.yscale)*1.5
ontop = 1
ownpal=1

[state 3041, explod]
type = explod
trigger1 = time = 0
anim = 2001
pos = 0,0
scale = const(size.xscale)*2.75,const(size.yscale)*1.5
sprpriority = -4
ownpal=1

[state 3041, playerpush]
type = playerpush
trigger1 = enemy, statetype = L
value = 0

[state 3041, playerpush]
type = playerpush
trigger1 = enemy, statetype != L
value = 1

[state 3041, width]
type = width
trigger1 = 1
value = 80,50

[State 3041, 3]
type = HitDef
trigger1 = Time = 0
trigger1 = !movecontact
attr = A, HA
damage    = 260
hitflag = FD
priority = 4
getpower = 0
pausetime = 0,0
hitsound   = S240,0
guardsound = S120, 0
animtype = back
p2stateno = 660
ground.type = High
ground.slidetime = 30
ground.hittime  = 20
ground.velocity = 0,0
guard.hittime = 20
guard.velocity = -40
airguard.velocity = 0,0
air.velocity = 0,0

[state 3041, quake]
type = envshake
trigger1 = time = 0
time = 18
ampl = -16
freq = 100
phase = 100

[state 3041, snd]
type = playsnd
trigger1 = time = 0
value = S1,1

[state 3041, skid]
type = velmul
trigger1 = time = 0
x = 0.25

[state 3041, vel]
type = velset
trigger1 = time = 0
y = 0

[state 3041, pos]
type = posset
trigger1 = time = 0
y = 0

[state 3041, end]
type = changestate
trigger1 = time = 4
value = 3042
;--------------------------------------------------------------------------
;bounce
[statedef 3042]
type = A
movetype = I
physics = N
anim = 1003
movehitpersist = 1

[state 3042, playerpush]
type = playerpush
trigger1 = enemy, statetype = L
value = 0

[state 3042, playerpush]
type = playerpush
trigger1 = enemy, statetype != L
value = 1

[state 3042, velset]
type = velset
trigger1 = time = 0
y = -6

[state 3042, gravity]
type = gravity
trigger1 = time > 2

[state 3042, end]
type = changestate
triggerall = time > 2
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 3043
;-------------------------------
; Landing
[statedef 3043]
type = S
movetype = I
physics = S
ctrl = 0
anim = 1004
movehitpersist = 1

[state 3043, playerpush]
type = playerpush
trigger1 = enemy, statetype = L
value = 0

[state 3043, playerpush]
type = playerpush
trigger1 = enemy, statetype != L
value = 1


[state 3043, quake]
type = envshake
trigger1 = time = 0
time = 12
ampl = -12
freq = 100
phase = 100

[state 3043, velset]
type = velset
trigger1 = time = 0
y = 0

;[state 3043, velset]
;type = velmul
;trigger1 = time = 0
;x = 2

[state 3043, snd]
type = playsnd
trigger1 = time = 0
value = S1,1


[state 3043, pos]
type = posset
trigger1 = time = 0
y = 0

[state 3043, end]
type = changestate
trigger1 = animtime = 0
value = 657


;---------------------------------------------------------------
; 3rd Super - Bionic ass downward 
; Damage: 320 & Invunerable
;---------------------------------------------------------------
;Butt Drop
[statedef 3080]
type    = A
movetype= A
physics = N
ctrl = 0
sprpriority = 2

[state 42, explod]
type = explod
trigger1 = animelemtime(4) = 0
bindtime = -1
anim = 8040
scale = 0.5,-1.5
id = 8040
postype = p1
pos = 10,-90
removeongethit = 1

[state 3080, combo damage]
type = varset
trigger1 = var(18) < 80
trigger1 = time = 0
v = 18
value = 80

[state 3080, playsnd]
type = playsnd
trigger1 = animelemtime(4) = 0
value = S1000,0
persistent = 0


[state 3000, no bg]
type = assertspecial
trigger1 = animelemtime(3) =[0, 60]
flag = nobg
ignorehitpause = 1

[State 3000, Super Pause]
type = SuperPause
trigger1 = animelemtime(3) =0
sound = S3000, 0
pos = 9.333,-70.667
time = 60
movetime = 60
persistent = 0
ignorehitpause = 1

[state 3000, Super Portrait]
type = explod
trigger1 = animelemtime(3) =[0, 14]
anim = 3100
postype = back
sprpriority = -3
supermovetime = 60
removetime = 1
pausemovetime = 60
scale = (3-(time*0.15))*(1),(3-(time*0.15))*(1)
pos = 0,60-time*5
ownpal = 1

[state 3000, Super Portrait]
type = explod
trigger1 = animelemtime(3) = 15
anim = 3100
postype = back
vel = -0.1,0
sprpriority = -3
supermovetime = 60
removetime = 45
pausemovetime = 60
pos = 0,0
scale = 1,1
ownpal = 1

[state 3000, posfreeze]
type = posfreeze
trigger1 = animelemtime(3) = [0,60]
x = 1
y = 1

[state 3080, animation]
type = changeanim
trigger1 = anim != 3080
value = 3080

[state 3080, armor counter]
type = varset
triggerall = prevstateno != 3080
trigger1 = time = 0
trigger1 = Var(21) = 1
V = 20
value = 10

[state 3080, poweradd]
type = poweradd
triggerall = prevstateno != 3080
trigger1 = time = 0
value = -1000
persistent = 0
ignorehitpause = 1

[state 3080, armor intiator turn off]
type = varset
trigger1 = time = 1
V = 21
value = 0

[state 3080, invun]
type = nothitby
trigger1 = time < 72
value = SCA

[state 640, armor count down]
type = varadd
trigger1 = gethitvar(damage) != 0
V = 20
value = -1
persistent = 1

[state 3080, still take damage]
type = lifeadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) != 0
value = floor(-gethitvar(damage)*0.5)
persistent = 1
ignorehitpause

[state 3080, Unstoppable]
type = hitoverride
trigger1 = alive
trigger1 = var(20) > 0
attr = SCA, AA, AP
stateno = 3080
time = 1
persistent = 1
ignorehitpause


[State 650, flash red]
type = PalFX
trigger1 = Time = 0
trigger1 = gethitvar(damage) != 0
time = 7
add = 150,0,0
IgnoreHitPause = 1

[State 650, 3]
type = HitDef
trigger1 = vel y > 0
trigger1 = !movecontact || !movereversed
persistent = 0
attr = A, HA
damage    = 320,64
guardflag = MA
hitflag = MAFD
priority = 4
id = 3080
nochainid = 3080,800
pausetime = 0,0
getpower = 0
givepower = 250
sparkno = 3
sparkxy = 0,0
hitsound   = 5,4
guardsound = S120, 0
animtype = heavy
ground.type = high
ground.slidetime = 22
ground.hittime  = 22
ground.velocity = 0
air.velocity = 0,0
down.hittime = 60
guard.velocity = -80            
guard.hittime = 30
guard.slidetime = 30
airguard.velocity = -60,10
airguard.hittime = 35
guard.dist = 360
ignorehitpause = 0

[state 3080, slow]
type = velmul
trigger1 = animelemtime(1) = 0
x = 0
y = 0
persistent = 0
ignorehitpause = 1


;determine what frame
[state 3080, remember frame]
type = varset
trigger1 = time <= 0
v = 22
value = animelemno(0)
ignorehitpause = 1

;delay effect
[state 3080, delay]
type = changeanim 
trigger1 = var(31) < floor(gethitvar(hittime)*0.6)
value = anim
elem = var(22)

[state 3080, freeze location]
type = posfreeze
trigger1 = var(31) < floor(gethitvar(hittime)*0.6)
value = 1
;--------------------------
;Ride down mechanic
[state 3080, Ride down]
type = targetbind
trigger1 = movehit
pos = 0, -20

[state 3080, state of ride down]
type = targetstate
trigger1 = movehit
value = 655
;----------------------------------------------

[state 3080, limiter]
type = varadd
trigger1 = movehit
trigger1 = enemy,statetype = A
trigger1 = p2bodydist x >= 30
var(8) = -1
ignorehitpause = 1
persistent = 0

[state 3080, fast fall]
type = veladd
trigger1 = animelemtime(4) = 0
y = 40

[state 3080, direction]
type = velset
trigger1 = animelemtime(4) = 0
x = (p2dist x * 0.02)

;[state 3080, aim]
;type = veladd
;trigger1 = animelemtime(4) = 0
;trigger1 = command = "holdfwd"
;trigger1 = ailevel = 0
;x = 8

;[state 3080, aim]
;type = veladd
;trigger1 = animelemtime(4) = 0
;trigger1 = command = "holdback"
;trigger1 = ailevel = 0
;x = -8

[state 3080, gravity]
type = gravity
trigger1 = animelemtime(4) > 0

[state 3080, playerpush]
type = playerpush
trigger1 = 1
value = 0

[state 3080, end]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 3081

;--------------------------------------------------------------------------
; 1st Landing
[statedef 3081]
type    = C
movetype= A
physics = N
poweradd= 30

[state 3081, removeexplod]
type = removeexplod
trigger1 = time = 0
id = 8040

[state 3081, anim]
type = changeanim
trigger1 = time = 0
value = 651

;Custom Dust
[state 3081, explod]
type = explod
trigger1 = time = 0
anim = 2000
pos = 30,0
scale = const(size.xscale)*3,const(size.yscale)*3
ontop = 1
ownpal = 1

[state 3081, fx]
type = explod
trigger1 = time = 0
anim = F61
pos = 0,0
scale = 6,3
ownpal = 1


[state 3081, explod]
type = explod
trigger1 = time = 0
anim = 2001
pos = 30,0
scale =  const(size.xscale)*3,const(size.yscale)*3
sprpriority = -4
ownpal = 1
; -------------------

[state 3081, snd]
type = playsnd
trigger1 = time = 0
value =S1,1

[state 3081, snd]
type = playsnd
trigger1 = time = 0
value =S1,1

[state 3081, snd]
type = playsnd
trigger1 = time = 0
value =S1,1



[state 3081, pos]
type = posset
trigger1 = time = 0
y = 0

[state 3081, playerpush]
type = playerpush
trigger1 = 1
value = 0

[State 3081, 3]
type = HitDef
trigger1 = Time = 0
attr = A, HA
damage    = 360 
guardflag = 
hitflag = FD
priority = 4
nochainid = 1400
pausetime = 12,12
sparkno = 1
sparkxy = -10,-40
hitsound   = 5,3
guardsound = S120, 0
animtype = Med
p2stateno = 660
ground.type = High
ground.slidetime = 12
ground.hittime  = 15
ground.velocity = 0
air.velocity = 0,0

[state 3081, vel]
type = velset
trigger1 = time = 0
y = 0
x = 0

[state 3081, nothitby]
type = nothitby
trigger1 = 1
value = SCA
ignorehitpause = 1

[state 3081, earthquakes]
type = envshake
trigger1 = time = 0
time = 48
ampl = -32
freq = 75
phase = 75


[state 3081, end]
type = changestate
trigger1 = animtime = 0
value = 3082

;--------------------------------------------------------------------------
;Bounce
[statedef 3082]
type    = A
movetype= I
physics = N

[state 3082, anim]
type = changeanim
trigger1 = time = 0
value = 652

[state 3082, playerpush]
type = playerpush
trigger1 = 1
value = 0

[state 3082, nothitby]
type = nothitby
trigger1 = 1
value = SCA
ignorehitpause = 1

[state 3082, velset]
type = velset
trigger1 = time = 0
y = -10

[state 3082, gravity]
type = gravity
trigger1 = time > 2

[state 3082, end]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 3083

;--------------------------------------------------------------------------
;Landing Rest
[statedef 3083]
type    = C
movetype= I
physics = N

[state 3083, anim]
type = changeanim
trigger1 = time = 0
value = 653

[state 3083, posset]
type = posset
trigger1 = time = 0
y = 0

[state 3083, playerpush]
type = playerpush
trigger1 = 1
value = 0

[state 3082, nothitby]
type = nothitby
trigger1 = time < 12
value = SCA
ignorehitpause = 1


[state 3083, velset]
type = velset
trigger1 = time = 0
y = 0
x = 0

[state 3083, snd]
type = playsnd
trigger1 = time = 0
value =S1,1

[state 3083, earthquakes]
type = envshake
trigger1 = time = 0
time = 15
ampl = 12
freq = 100
phase = 100

[state 3083, end]
type = changestate
trigger1 = animtime = 0
value = 656

;----------------------------------------------------------------
;butt drop cursor
[statedef 4000]
type = U
movetype = I
physics = N
anim = 4000


[state 4000, 1]
type = angledraw
trigger1 = 1
scale = const(size.xscale)*0.75,const(size.yscale)*0.75
ignorehitpause

[state 4000, turn]
type = turn
trigger1 = facing = -1


[state 4000, nothitby]
type = nothitby
trigger1 = 1
value = SCA

[state 4000, posset]
type = posset
trigger1 = 1
x = parent,pos x
y = -280
persistent = 1

[state 4000, destroyself]
type = destroyself
trigger1 = parent,pos y > -50

;==========================================================================
;[Info]
;author = "Inktrebuchet" 
;versiondate = 12/13/2018                  
;goal = Detect enemy's projectile (helper). For use with AI.
;       敵の発射物（helper）を検出する。 AIで使用する場合。
;==========================================================================
;                Notes
;==========================================================================
;notes:
;-Enemy's projectile now has a PlayerID use PlayerID(helper(33333333),var(3)) as a redirect.
;
;base examples of trigger use: 
;
;;Enemy's projectile helper's distance from character.
;trigger1 = PlayerIDExist(helper(33333333),var(3))
;trigger1 = PlayerID(helper(33333333),var(3)), p2bodydist x 
;
;;Enemy's projectile helper's velocity.
;trigger1 = PlayerIDExist(helper(33333333),var(3))
;trigger1 = PlayerID(helper(33333333),var(3)), Vel X
;
;==========================================================================
;                Helper var usage.
;==========================================================================
; numhelper(33333333) Variable usage:
; This is a record of the variables that are used
;
; var(0) - highest playerid + 1
; var(3) - projectile player id while it exists
; 
;==========================================================================
[Statedef 33333333]
type = A
movetype = I
physics = N
ctrl = 0
velset = 0, 0
 
;==========================================================================
;                Config Section
;==========================================================================
anim = 9741                   ; blank animation
 
;==========================================================================
 
[state 33333333, Clipboard] 
type = DisplayToClipboard
trigger1 = 1
text = "Highest Playerid = %d , Projectile helper's PlayerId = %d\nBy Inktrebuchet"
params = var(0)-1, var(3)
;==========================================================================
;                Detect Enemy's Projectile Helper
;==========================================================================
[State 33333333, 0]
type = Null
trigger1 = var(0) = 0
trigger1 = (var(0) := id)
ignorehitpause = 1
 
[state 33333333, 1] 
type = varadd
trigger1 = PlayerIdExist(var(0)) 
trigger2 = PlayerIdExist(var(0)+1) 
trigger3 = PlayerIdExist(var(0)+2) 
trigger4 = PlayerIdExist(var(0)+3) 
trigger5 = PlayerIdExist(var(0)+4) 
trigger6 = PlayerIdExist(var(0)+5) 
trigger7 = PlayerIdExist(var(0)+6) 
trigger8 = PlayerIdExist(var(0)+7) 
trigger9 = PlayerIdExist(var(0)+8) 
trigger10 = PlayerIdExist(var(0)+9) 
trigger11 = PlayerIdExist(var(0)+10) 
trigger12 = PlayerIdExist(var(0)+11) 
trigger13 = PlayerIdExist(var(0)+12) 
trigger14 = PlayerIdExist(var(0)+13) 
trigger15 = PlayerIdExist(var(0)+14) 
trigger16 = PlayerIdExist(var(0)+15) 
trigger17 = PlayerIdExist(var(0)+16) 
trigger18 = PlayerIdExist(var(0)+17) 
trigger19 = PlayerIdExist(var(0)+18) 
trigger20 = PlayerIdExist(var(0)+19) 
trigger21 = PlayerIdExist(var(0)+20) 
trigger22 = PlayerIdExist(var(0)+21) 
trigger23 = PlayerIdExist(var(0)+22) 
trigger24 = PlayerIdExist(var(0)+23) 
trigger25 = PlayerIdExist(var(0)+24) 
trigger26 = PlayerIdExist(var(0)+25) 
v = 0
value = 1
ignorehitpause = 1
 
[State 33333333, 2]
type = Null
triggerall = PlayerIdExist(Root,ID)
trigger1 = PlayerIdExist(var(0)-1)
trigger1 = cond(root,teamside = 1, PlayerID(var(0)-1),teamside = 2, PlayerID(var(0)-1),teamside = 1)
trigger1 = PlayerID(var(0)-1),hitdefattr = ASC, NP, SP, HP
trigger1 = var(3) := (var(0)-1)
trigger2 = PlayerIdExist(var(0)-2)
trigger2 = cond(root,teamside = 1, PlayerID(var(0)-2),teamside = 2, PlayerID(var(0)-2),teamside = 1)
trigger2 = PlayerID(var(0)-2),hitdefattr = ASC, NP, SP, HP
trigger2 = var(3) := (var(0)-2)
trigger3 = PlayerIdExist(var(0)-3)
trigger3 = cond(root,teamside = 1, PlayerID(var(0)-3),teamside = 2, PlayerID(var(0)-3),teamside = 1)
trigger3 = PlayerID(var(0)-3),hitdefattr = ASC, NP, SP, HP
trigger3 = var(3) := (var(0)-3)
trigger4 = PlayerIdExist(var(0)-4)
trigger4 = cond(root,teamside = 1, PlayerID(var(0)-4),teamside = 2, PlayerID(var(0)-4),teamside = 1)
trigger4 = PlayerID(var(0)-4),hitdefattr = ASC, NP, SP, HP
trigger4 = var(3) := (var(0)-4)
trigger5 = PlayerIdExist(var(0)-5)
trigger5 = cond(root,teamside = 1, PlayerID(var(0)-5),teamside = 2, PlayerID(var(0)-5),teamside = 1)
trigger5 = PlayerID(var(0)-5),hitdefattr = ASC, NP, SP, HP
trigger5 = var(3) := (var(0)-5)
trigger6 = PlayerIdExist(var(0)-6)
trigger6 = cond(root,teamside = 1, PlayerID(var(0)-6),teamside = 2, PlayerID(var(0)-6),teamside = 1)
trigger6 = PlayerID(var(0)-6),hitdefattr = ASC, NP, SP, HP
trigger6 = var(3) := (var(0)-6)
trigger7 = PlayerIdExist(var(0)-7)
trigger7 = cond(root,teamside = 1, PlayerID(var(0)-7),teamside = 2, PlayerID(var(0)-7),teamside = 1)
trigger7 = PlayerID(var(0)-7),hitdefattr = ASC, NP, SP, HP
trigger7 = var(3) := (var(0)-7)
trigger8 = PlayerIdExist(var(0)-8)
trigger8 = cond(root,teamside = 1, PlayerID(var(0)-8),teamside = 2, PlayerID(var(0)-8),teamside = 1)
trigger8 = PlayerID(var(0)-8),hitdefattr = ASC, NP, SP, HP
trigger8 = var(3) := (var(0)-8)
trigger9 = PlayerIdExist(var(0)-9)
trigger9 = cond(root,teamside = 1, PlayerID(var(0)-9),teamside = 2, PlayerID(var(0)-9),teamside = 1)
trigger9 = PlayerID(var(0)-9),hitdefattr = ASC, NP, SP, HP
trigger9 = var(3) := (var(0)-9)
trigger10 = PlayerIdExist(var(0)-10)
trigger10 = cond(root,teamside = 1, PlayerID(var(0)-10),teamside = 2, PlayerID(var(0)-10),teamside = 1)
trigger10 = PlayerID(var(0)-10),hitdefattr = ASC, NP, SP, HP
trigger10 = var(3) := (var(0)-10)
ignorehitpause = 1
 
[State 33333333, BindToRoot]
type = BindToRoot
trigger1 = PlayerIdExist(Root,ID)
time = 1
facing = 1
pos =0,-2
ignorehitpause = 1 







;---------------------------------------------------------------------------
; Override common states (use same number to override) :
;---------------------------------------------------------------------------

;---------------------------------------------------------------------------
; States that are always executed (use statedef -2)
;---------------------------------------------------------------------------
[statedef -2]

[State -2, Super Jump Indicator]
type = helper
triggerall = !numhelper(4000)
trigger1 = stateno = 3000 || stateno = 3001
persistent = 1
stateno = 4000
ID = 4000




;===========================================
;  Combo damage reduction
;===========================================

[State -2, attack scaling]
type = attackMulSet
trigger1 = 1
value = fvar (10)
ignorehitpause = 1

[state -2, combo points]
type = varset
trigger1 = numenemy
trigger1 = (enemynear, movetype != H)
trigger2 = !numenemy
ignorehitpause = 1
v = 18
value = 100

[state -2, gradual lowering]
type= varset
trigger1 =  var(18) >= 100
fvar(10) = 1

[state -2, gradual lowering]
type= varset
trigger1 = var(18) < 100 && var(18) >= 90
fvar(10) = 0.9

[state -2, gradual lowering]
type= varset
trigger1 = var(18) < 90 && var(18) >= 80
fvar(10) = 0.8

[state -2, gradual lowering]
type= varset
trigger1 = var(18) < 80 && var(18) >= 70
fvar(10) = 0.7

[state -2, gradual lowering]
type= varset
trigger1 = var(18) < 70 && var(18) >= 60
fvar(10) = 0.6

[state -2, gradual lowering]
type= varset
trigger1 = var(18) < 60 && var(18) >= 50
fvar(10) = 0.5

[state -2, gradual lowering]
type= varset
trigger1 = var(18) < 50 && var(18) >= 40
fvar(10) = 0.4

[state -2, gradual lowering]
type= varset
trigger1 = var(18) < 40 && var(18) >= 30
fvar(10) = 0.3

[state -2, gradual lowering]
type= varset
trigger1 = var(18) < 30 && var(18) >= 20
fvar(10) = 0.2

[state -2, gradual lowering]
type= varset
trigger1 = var(18) < 20 && var(18) >= 10
fvar(10) = 0.1

[state -2, gradual lowering]
type= varset
trigger1 = var(18) < 10
fvar(10) = 0.05

;-----------------------------------------------------


[state -2, Wall bounce limiter]
type = varset
triggerall = numenemy
trigger1 = (enemynear, movetype != H)
var(7) = 2
ignorehitpause = 1

[state -2, Ground Bounce limiter]
type = varset
triggerall = numenemy
trigger1 = (enemynear, movetype != H)
var(8) = 2
ignorehitpause = 1

[state -2, Stun Limiter]
type = varset
triggerall = numenemy
trigger1 = (enemynear, movetype != H)
var(13) = 2
ignorehitpause = 1

[state -2, Launcher limiter]
type = varset
triggerall = numenemy
trigger1 = (enemynear, movetype != H)
var(11) = 2
ignorehitpause = 1

[state -2, Spin Launch limiter]
type = varset
triggerall = numenemy
trigger1 = (enemynear,movetype != H)
var(12) = 2
ignorehitpause

[state -2, Jump infinite check]
type = varset
triggerall = numenemy
trigger1 = (enemynear, movetype != H)
var(29) = 1
ignorehitpause = 1

[state -2, Jumping Fierce limiter]
type = varset
triggerall = numenemy
trigger1 = (enemynear,movetype != H)
var(41) = 1
ignorehitpause

[state -2, clothesline distance]
type = varset
trigger1 = 1
v = 40
value = 80*var(26)
ignorehitpause 
;================================================================================
; Win Quotes
;================================================================================

[state -2, win quotes]
type = victoryquote
trigger1 = 1
value = 1+(random%7)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, Name = "Jumbo Elephant"
value = 8+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, Name = "Ana 'Jiggly' Bunny"
value = 11+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, Name = "Katrina Crocodile"
value = 14+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, Name = "Bertha Hippo"
value = 17+(random%3)
ignorehitpause
persistent = 1


[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, Name = "Leonardo M/TF"
trigger2 = enemy, Name = "Raphael M/TF"
trigger3 = enemy, Name = "Michaelangelo M/TF"
trigger4 = enemy, Name = "Donatello M/TF"
trigger5 = enemy, Name = "DcatLeonardo" || enemy,name = "DcatDonatello" || enemy,name = "DcatRaphael" ||  enemy,name = "DcatMichaelangelo"
value = 20
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, Name = "Ryu"
value = 21+(random%2)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, Name = "Chun-Li"
trigger2 = enemy, Name = "Chunli"
trigger3 = enemy, Name = "Chun Li"
trigger4 = enemy, Name = "ChunLi"
value = 24+(random%4)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, Name = "Zangief"
trigger2 = enemy, Name = "ZangiefHD"
trigger3 = enemy, Name = "Slamgief"
value = 28+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, Name = "Rainbow Mika"
trigger2 = enemy, Name = "R. Mika"
trigger3 = enemy, Name = "mika_mx"
value = 31+(random%2)
ignorehitpause
persistent = 1


[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, Name = "E. Honda"
trigger2 = enemy, Name = "EHonda"
trigger3 = enemy, Name = "E Honda"
trigger4 = enemy, Name = "Shadow SUMOU"
value = 36+(random%2)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, Name = "Deadpool"
value = 38+(random%2)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, Name = "Renamon"
value = 40
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, Name = "Lucario"
trigger1 = enemy, Authorname = "Moku" 
value = 41
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, Name = "Ryugen"
value = 42+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, Name = "SSJ Goku Z2"
trigger2 = enemy, name = "Goku Z2"
value = 45+(random%2)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, Name = "Piccolo Z2"
value = 47+(random%2)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, Name = "Hulk"
trigger2 = enemy, Name = "Savage Hulk"
value = 49+(random%2)
ignorehitpause
persistent = 1


[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, Name = "A Pair Of Jiggling Tits"
value = 51
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, Name = "Enorma Pig"
value = 52+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, Name = "Aroma Skunk"
value = 55+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, Name = "Lardo Rat"
value = 58+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, Name = "Zafta Giraffe"
value = 61+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy,name = "Makuyama"
value = 64+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy,name = "Pastilla Skunk"
value = 67+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy,name = "Jumba Elephant"
value = 70+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy,name = "Twiggi Bunny"
value = 73+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy,name = "Ra Lord"
value = 76+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy,name = "Violet 'Tyla' Bunny"
value = 79+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy,name = "Battu Tri-red"
value = 82+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy,name = "Julian Hippo"
value = 85+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy,name = "Rapid Bunny"
value = 88+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy,name = "Noah Sharker"
value = 91+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy,name = "Akai R. Panda"
value = 94+(random%3)
ignorehitpause
persistent = 1

[state -2, win quote]
type = victoryquote
triggerall = numenemy
trigger1 = enemy,name = "Andy Armadillo"
value = 97+(random%3)
ignorehitpause = 1
persistent = 1

[state -2, win quote]
type = victoryquote
triggerall = numenemy
trigger1 = enemy,name = "Montana Moth"
value = 49+(random%3)
ignorehitpause = 1
persistent = 1

[state -2, win quote]
type = victoryquote
triggerall = numenemy
trigger1 = enemy,name = "Texas Stanton"
value = 33+(random%3)
ignorehitpause = 1
persistent = 1


;===============================================================================
; Simple Counter
;===============================================================================

[state -2, counter]
type = varset
trigger1 = gethitvar(damage) != 0
v = 31
value = 0
ignorehitpause = 1

[state -2, count up]
type = varadd
trigger1 = var(31) < var(33)
v = 31
value = 1
ignorehitpause = 0

[state -2, delay conter set]
type = varset
trigger1 = 1
v = 33
value = 300

;Bertha Hippo is © Kazecat 2017
[state -2, distance check]
type = displaytoclipboard
trigger1 = 1
text = "distance Opp X: %d Y: %d, Position Y: %f, Armor: %d"
params = p2bodydist x, p2bodydist y, pos y, var(20)
;text = "Bertha Hippo is (c) Kazecat 2017



;Weight Detection
;If needed add or remove from this list those that have great strength to move her.
;All Grapplers/Power Archetypes should be allowed to Throw her and nothing else IMO.   
[state -2, Those strong enough to throw her]
type = varset
triggerall = numenemy
trigger1 = enemy,name = "Savage Hulk"
Trigger2 = enemy,name = "Superman"
Trigger3 = enemy,name = "Juggernaut"
trigger4 = enemy,name = "ZangiefHD"
trigger5 = enemy,name = "Kimala"
trigger6 = enemy,name = "Bertha Hippo"
trigger7 = enemy,name = "Goku Z2"
trigger8 = enemy,name = "Vegeta Z2"
trigger9 = enemy,name = "Gohan Z2"
trigger10 = enemy,name = "SSJ Goku Z2"
Trigger11 = enemy,name = "Hulk"
Trigger12 = enemy,name = "Colossus"
trigger13 = enemy,name = "Jumbo Elephant" || enemy,name = "Makuyama" || enemy,name = "Jumba Elephant"
trigger14 = enemy,name = "John Cena"
trigger15 = enemy,name = "Yokozuna"
trigger16 = enemy,name = "Zangief"
trigger17 = enemy,name = "Bowser"
trigger18 = enemy,name = "Wonder Woman"
trigger19 = enemy,name = "She Hulk"
trigger20 = enemy,name = "Blubberman"
trigger21 = enemy,name = "The-Mountain"
Trigger22 = enemy,name = "Shaq"
Trigger23 = enemy,name = "2DFM95 Kinnikuman"
trigger24 = enemy,name = "Haggar"
trigger25 = enemy,name = "Katrina Crocodile"
trigger26 = enemy,name = "Kazecat" || enemy,name = "Kaze Cat" || enemy,name = "Julian Hippo"
trigger27 = enemy,name = "Power Girl"
trigger28 = enemy,name = "Freeza Z2"
trigger29 = enemy,name = "Buu Z2"
trigger30 = enemy,name = "Majin Vegeta Z2"
trigger31 = enemy,name = "Thor" || enemy,name = "The Mighty Thor"
trigger32 = enemy,name = "Pastilla Skunk"
trigger33 = enemy,name = "Thanos"
trigger34 = enemy,name = "Lilly Star"
V = 10
value = 1

;------layered sprites----

[state -2, removeexplod]
type = removeexplod
trigger1 = stateno != 1000 
id = 1001

[state -2, removeexplod]
type = removeexplod
trigger1 = stateno != 1010 
id = 1011

[state -2, removeexplod]
type = removeexplod
trigger1 = stateno != 1020 
id = 1021

[state -2, removeexplod]
type = removeexplod
trigger1 = stateno != 1022 
id = 1023

[state -2, removeexplod]
type = removeexplod
trigger1 = stateno != 1035 
id = 1033

[state -2, removeexplod]
type = removeexplod
trigger1 = stateno != 1036
id = 1034

[state -2, removeexplod]
type = removeexplod
trigger1 = stateno != 1101
id = 1101

[state -2, removeexplod]
type = removeexplod
trigger1 = stateno != 1102
id = 1102

[state -2, removeexplod]
type = removeexplod
trigger1 = stateno != 1111
id = 1111

[state -2, removeexplod]
type = removeexplod
trigger1 = stateno != 1112
id = 1112

[state -2, removeexplod]
type = removeexplod
trigger1 = stateno != 1121
id = 1121

[state -2, removeexplod]
type = removeexplod
trigger1 = stateno != 1122
id = 1122

[state -2, removeexplod]
type = removeexplod
trigger1 = stateno != [3002, 3003]
id = 3012

[state -2, removeexplod]
type = removeexplod
trigger1 = stateno != 3004 
id = 3013


;---------------------------------------------------------------------------
; Cursed Stats
;---------------------------------------------------------------------------

;Earthquakes
[State -2, quakes]
type = envshake
triggerall = time = 1
trigger1 = stateno = 1521
trigger1 = prevstateno != 1523  
trigger2 = stateno = 1527 && time = 1
time = 15
ampl = -10

;Thuds
[State -2, sfx]
type = PlaySnd
triggerall = Time = 1
trigger1 = stateno = 1521
trigger1 = prevstateno != 1523   
trigger2 = stateno = 1527 && time = 1 
value = S1,2 

;Huge target, Defense buff
[state -2, Defense Up]
type = defencemulset
trigger1 = stateno = [1521,1549]
trigger1 = anim = [19030, 19040]
value = 1.25


[State -2, quakes]
type = envshake
triggerall = time = 1
trigger1 = anim = 5300
time = 25
ampl = -16
freq = 60
phase = 60

[State -2, Landing Sound]
type = PlaySnd
triggerall = Time = 1
trigger1 = anim = 5300
value = S1, 1


;-----------------------------------------------
;Armor out of state
;To prevent infinite armor from occurring

[state -2, unstoppable ass-more armor]
type = varadd
triggerall = stateno = 1000
trigger1 = animelemtime(4) = 2
v = 20
value = 2
persistent = 120
ignorehitpause = 1

[state -2, unstoppable ass-more armor]
type = varadd
triggerall = stateno = 1010
trigger1 = animelemtime(4) = 2
v = 20
value = 4
persistent = 120
ignorehitpause = 1

[state -2, unstoppable ass-more armor]
type = varadd
triggerall = stateno = 1020
trigger1 = animelemtime(4) = 2
v = 20
value = 2
persistent = 120
ignorehitpause = 1

;---------------------------------------------------------------------------
; States that are executed when in self's state file (use statedef -3)
;---------------------------------------------------------------------------

[Statedef -3]

[State -3, quakes]
type = envshake
triggerall = time = 1
trigger1 = stateno = 5100
time = 25
ampl = -16
freq = 60
phase = 60

[state -3, distance]
type = varset
trigger1 = numpartner
fvar(28) = screenpos x - partner,screenpos x
persistent = 1

;Weight Detection
[state -2, Can't be thrown]
type = Null;Nothitby
triggerall = time > 0
triggerall = numenemy
triggerall = Enemynear,authorname != "Kazecat"
trigger1 = Var(10) = 0
value = ,NT
ignorehitpause = 1
time = 1


;This controller plays a sound everytime KFM lands from a jump, or
;from his back-dash.
[State -3, Landing Sound]
type = PlaySnd
triggerall = Time = 1
trigger1 = stateno = 5100
value = S1, 1

[State -3, Landing Sound]
type = PlaySnd
triggerall = Time = 1
trigger1 = stateno = 52 ;Jump land
trigger2 = stateno = 106 ;Run-back land
value = S1, 2

[state -3, gravity]
type = gravity
trigger1 = stateno = 5620
trigger1 = time > 0

[state -3, land]
type = changestate
triggerall = stateno = 5620
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 52

[State -3, AssertSpecial]
type = AssertSpecial
trigger1 = ailevel
flag = nostandguard
flag2 = nocrouchguard
flag3 = noairguard
ignorehitpause = 1

;=======================AI Detect Projectile System==========================
[state -3, AI Detect Projectile System]
type = helper
trigger1 = ailevel ;M.U.G.E.N 1.0+
trigger1 = !numhelper(33333333)
name = "AI Detect Projectile System"
ID = 33333333
stateno = 33333333
postype = p1
ownpal = 1
keyctrl = 0
size.xscale = 1.0
size.yscale = 1.0
supermovetime = 2147483647
pausemovetime = 2147483647
ignorehitpause = 1
