; KFM's constants and state file.
; There are comments scattered through this file, so you may like to
; take a look if would like to learn more about the cns.

[Data]
;Amount of life to start with
life = 1100
power = 5000
;attack power (more is stronger)
attack = 100
;defensive power (more is stronger)
defence = 100
;Percentage to increase defense everytime player is knocked down
fall.defence_up = 50
;Time which player lies down for, before getting up
liedown.time = 60
;Number of points for juggling
airjuggle = 100
;Default hit spark number for HitDefs
sparkno = 2
;Default guard spark number
guard.sparkno = 40
;1 to enable echo on KO
KO.echo = 0
;Volume offset (negative for softer)
volume = 0
;Variables with this index and above will not have their values
;reset to 0 between rounds or matches. There are 60 int variables,
;indexed from 0 to 59, and 40 float variables, indexed from 0 to 39.
;If omitted, then it defaults to 60 and 40 for integer and float
;variables repectively, meaning that none are persistent, i.e. all
;are reset. If you want your variables to persist between matches,
;you need to override state 5900 from common1.cns.
IntPersistIndex = 60
FloatPersistIndex = 40

[Size]
xscale = .70          ;Horizontal scaling factor.
yscale = .70           ;Vertical scaling factor.
ground.back = 100    ;Player width (back, ground)
ground.front = 70   ;Player width (front, ground)
air.back = 100        ;Player width (back, air)
air.front = 80       ;Player width (front, air)
height = 305          ;Height of player (for opponent to jump over)
attack.dist = 300    ;Default attack distance
proj.attack.dist = 90 ;Default attack distance for projectiles
proj.doscale = 0     ;Set to 1 to scale projectiles too
head.pos = 40, -277   ;Approximate position of head
mid.pos = 6, -137    ;Approximate position of midsection
shadowoffset = 0     ;Number of pixels to vertically offset the shadow
draw.offset = 0,0    ;Player drawing offset in pixels (x, y). Recommended 0,0

[Velocity]
walk.fwd  = 3.5      ;Walk forward
walk.back = -3.5     ;Walk backward
run.fwd  = 14, 0    ;Run forward (x, y)
run.back = -8,-7 ;Hop backward (x, y)
jump.neu = 0,-22   ;Neutral jumping velocity (x, y)
jump.back = -6, -18    ;Jump back Speed (x, y)
jump.fwd = 6, -18       ;Jump forward Speed (x, y)
runjump.back = -2.55,-8.1 ;Running jump speeds (opt)
runjump.fwd = 12,-8.1      ;.
airjump.neu = 0,-8.1      ;.
airjump.back = -2.55 ;Air jump speeds (opt)
airjump.fwd = 2.5         ;.
air.gethit.groundrecover = -.15,-3.5  ;Velocity for ground recovery state (x, y) **MUGEN 1.0**
air.gethit.airrecover.mul = .5,.2     ;Multiplier for air recovery velocity (x, y) **MUGEN 1.0**
air.gethit.airrecover.add = 0,-4.5    ;Velocity offset for air recovery (x, y) **MUGEN 1.0**
air.gethit.airrecover.back = -1       ;Extra x-velocity for holding back during air recovery **MUGEN 1.0**
air.gethit.airrecover.fwd = 0         ;Extra x-velocity for holding forward during air recovery **MUGEN 1.0**
air.gethit.airrecover.up = -2         ;Extra y-velocity for holding up during air recovery **MUGEN 1.0**
air.gethit.airrecover.down = 1.5      ;Extra y-velocity for holding down during air recovery **MUGEN 1.0**

[Movement]
airjump.num = 0       ;Number of air jumps allowed (opt)
airjump.height = 35   ;Minimum distance from ground before you can air jump (opt)
yaccel = 1.0         ;Vertical acceleration
stand.friction = .78  ;Friction coefficient when standing
crouch.friction = .76 ;Friction coefficient when crouching
stand.friction.threshold = 2          ;If player's speed drops below this threshold while standing, stop his movement **MUGEN 1.0**
crouch.friction.threshold = .05       ;If player's speed drops below this threshold while crouching, stop his movement **MUGEN 1.0**
air.gethit.groundlevel = 25           ;Y-position at which a falling player is considered to hit the ground **MUGEN 1.0**
air.gethit.groundrecover.ground.threshold = -20 ;Y-position below which falling player can use the recovery command **MUGEN 1.0**
air.gethit.groundrecover.groundlevel = 10   ;Y-position at which player in the ground recovery state touches the ground **MUGEN 1.0**
air.gethit.airrecover.threshold = -1  ;Y-velocity above which player may use the air recovery command **MUGEN 1.0**
air.gethit.airrecover.yaccel = 1.0    ;Vertical acceleration for player in the air recovery state **MUGEN 1.0**
air.gethit.trip.groundlevel = 15      ;Y-position at which player in the tripped state touches the ground **MUGEN 1.0**
down.bounce.offset = 0, 20            ;Offset for player bouncing off the ground (x, y) **MUGEN 1.0**
down.bounce.yaccel = 1.2               ;Vertical acceleration for player bouncing off the ground **MUGEN 1.0**
down.bounce.groundlevel = 12          ;Y-position at which player bouncing off the ground touches the ground again **MUGEN 1.0**
down.friction.threshold = .05         ;If the player's speed drops below this threshold while lying down, stop his movement **MUGEN 1.0**

;Default language victory quotes (optional).  **MUGEN 1.0**
;If this section is included, the default language victory quotes must be in English.
[Quotes]
; Up to 100 victory quotes can be specified per language (victory0 - victory99)
; Generic Quotes
victory1 = "You must defeat my mass to stand a chance."
victory2 = "I didn't get this big by just eating bamboo if you were wondering."
victory3 = "Have you tried not angering the big ass bear?"
victory4 = "Not anyone can drop their ass like I do.  Its terrible damage in recoil to your spine unless you have significant 'padding'."
victory5 = "Being in my way isn't recommended unless you wanna be ran over and/or sat on."
victory6 = "I thoroughly enjoy sitting on foes like you."
victory7 = "Don't confuse me for another panda.  That really irritates me."

; Jumbo, ex-boyfriend
Victory8 = "Just because we have the size and strength doesn't mean we should be bullies."
Victory9 = "Suggesting you wear a mawashi was the best idea I came up with back then.  You fill out that spandex more now than when we were together."
victory10 = "You made me out to be an enforcer that bullied good people.  I couldn't live with that Jumbo."

; Jiggly, No relationship
Victory11 = "Your speed is annoying, but good work on the butt attacks."
Victory12 = "You really gotta invest in damage girl.  Those puny pokes are mearly annoying."
Victory13 = "Fast as you are if I get my paws on you its over."

; Bertha, similar size
victory14 = "For a second generation wrestler your techniques could use work."
victory15 = "You're really skilled at that weight shifting thing.  One moment I can lift you easy the next it feels like I'm under a mountain."
victory16 = "I think I've met your brother a few times.  I can see huge asses run in your family."

; Katrina, Huge boobs
Victory17 = "Be gone Thots!"
Victory18 = "Silly Crocs your boobs will not phase me."
Victory19 = "You have to have a strong spine"

;Enorma, WTF gunNo Pig, don't youse thoses
victory20 = "You're fire arms are only served to anger the bear that mauled you."
victory21 = "You may think guns are a good idea but when I get mad you'll regret it."
victory22 = "You try to zone me with your guns but I only have to get my paws on you once."

;Aroma, Gas is gross
Victory23 = "Your poison didn't save you this time and I know about baking soda."
Victory24 = "Damage over time isn't gonna go well for you with me.  My damage output is way higher than yours. "
Victory25 = "That gas is just gross I could smell you miles away."

;Lardo, former associate henchman
Victory26 = "You still working for Jumbo.  Do your own thing man."
victory27 = "You couldn't touch me then and you still can't now."
Victory28 = "Maybe you should get more than one outfit."

;Zafta, she's too tall
victory29 = "Bear vs Giraffe, pretty sure we'll know how this will end."
victory30 = "You may have a range advantage but I'm a bear."
Victory31 = "I don't have to out range you if I'm sure to outdamage you."

;Makuyama Himself
Victory32 = "Its so vain but I think I look really good."
Victory33 = "You may be my match in body but you gotta catch up in skill."
Victory34 = "Despite everything, its still you."

;Pastilla
Victory35 = "Magic? Poison? I don't care.  You're gonna get hurt if you fight me again."
Victory36 = "I'm not fond of you magic attacks at all."
Victory37 = "Spells aren't gonna help you worth a damn once I get my paws on you."

;Jumba
Victory38 = "Honestly, I much rather fight your brother."
Victory39 = "How's this for a mix up.  If you are on the ground, I will grab you.  If you are in the air, I will grab you."
victory40 = "Not sure being a ninja serves you well if I can still detect you."

;Twiggi
victory41 = "I have no desire to fight a woman as frail as you ever again."
victory42 = "Attacking one as frail as you just makes me feel guilty."
victory43 = "If you need a diet to help you bulk up I could help you."

;Ra Lord
Victory44 = "If we meet again I'm gonna tie you in a knot."
victory45 = "If I flatten you like that again others will confuse you for a belt."
victory46 = "Your range and combos are impressive but once I get my paws on you you're done!"

;Violet
victory47 = "What is with these obvious ninjas.  I'm not gonna miss a body like that."
victory48 = "Your speed, needles and vanish won't serve you well when I grab you."
victory49 = "You got some strong kicks but let me show you my damage output."

;Julian
victory50 = "Its such a pleasure to spar with such a handsome hippo."
victory51 = "Hey, let me help you up.  I hope I didn't hurt you too badly."
victory52 = "Remember that time we met up years ago. I don't think the hotel staff liked what we did to that room."

;Battu
victory53 = "That shape of yours reminds me of a panda I know."
victory54 = "Don't scamper all over the place like that.  It will just make you tired when I sit on you."
victory55 = "I didn't mean to beat you so badly but you are so small."

;Rapid 
Victory56 = "I feel bad for hitting someone as frail as you."
victory57 = "When I get my paws on you you are done."
victory58 = "I love the gasp from the  audience when I butt drop the small ones like you."

;Noah
victory66 = "I don't like feeling like a bully fighting small ones like you but then again your arrows are super annoying."
victory67 = "For annoying me with all those arrows I'm gonna use your chest as my seat cushion for a few hours."
victory68 = "For demons your strength isn't impressing me."

;Akai
Victory69 = "Your super speed may be impressive but if you think I can't handle your ass for a second you'd be wrong."
victory70 = "I'm more fond of bear hugging you with out the malicious intent."
victory71 = "I do miss what we had.  Consider not working for Jumbo in the future."

;Zangief
Victory60 = "You may wrestle bears but you never ran into one like me."
Victory61 = "All the bears you wrestled better have consented to combat or I'll make you stay down."
Victory62 = "Congrats on the new scars I gave you, They'll go great with the others."

;Dcat turtles
;Leonardo
Victory63 = "You sure do like cartwheeling around don't you.  Well you better stop since I'm not gonna get tired of throwing you."
Victory64 = "Well great I'm slower than a turtle.  Not that it matters though since I'm still way stronger."
Victory65 = "I could also out eat you in Pizza too."

;Vs Andy
Victory72= "Pretty sure I'll just overpower any armor you put infront of me."
victory73 = "Lets see what a few butt drops will do that durable armor of yours."
Victory74 = "You block so much it just makes sense to grab you."

;vs Montana
victory75 = "Being in the air is gonna give a nice introduction to this heavy belly of mine."
victory76 = "I can shrug off geting stung by a swarm of bees, what's a moth gonna do?"
Victory77 = "I don't exactly wear a lot of fabric for you to eat."

;vs Texas
Victory78 = "My criminal days are behind me.  But don't think I won't throw paws with you just because you're a sheriff."
Victory79 = "I don't know what you're doing round here, but if you're the only lawgirl then you're gonna need some serious help."
Victory80 = "Look, I don't like your chances.  I know you can handle fat ass outlaws, but if I can stop  you they are gonna do worst to you."



;Alternate language victory quotes (optional).
;0 or more alternate language sections may be added, preceded by the
;ISO 639-1 code followed by a ".", e.g. "[ja.Quotes]".
;See language setting in mugen.cfg.
[ja.Quotes]
victory1 = "カンフー突き手を破らぬ限り、お前に勝ち目はない！"
victory2 = "十年早いんだぞ"
victory3 = "お前は見覚えがあるな。テレビにでも…？"
victory4 = "お前の動きは見破りやすすぎる。　なに、カンフー突き手が覚えたいんだと？　素人には無理だぞ"
victory5 = "ふー。　いい汗だった"
victory6 = "もっと強い相手に挑戦したい"
victory7 = "なんだと！彼女はここにもいないと？"

;---------------------------------------------------------------------------
; Variable usage:
; This is a record of the variables that KFM uses. Keeping a record of your
; variable usage helps you avoid careless mistakes later.
; var(1)  - Used in kfm.cmd for combo condition (updated every tick)
; var(2)  - Used in Kung Fu Throw (state 800) to remember if fwd was being
;           held (remembered from state 800 through state 810).
; var(4) - Jab count
; var(14) - Butt Drop Damage
; var(15) - Super Jump check
; var(16) - Banzai drop Damage
; var(23) - Air Grab AI check
; var(26) - Bear Hug check

;---------------------------------------------------------------------------
; Lose by Time Over
; CNS difficulty: basic
[Statedef 170]
type = S
ctrl = 0
anim = 170
velset = 0,0

[State 170, 1]
type = NotHitBy
trigger1 = 1
value = SCA
time = 1

;---------------------------------------------------------------------------
; Win state decider
; CNS difficulty: basic
[Statedef 180]
type = S

[State 180, 1]
type = ChangeState
trigger1 = Time = 0
value = 181

;---------------------------------------------------------------------------
; Win Pose 1 - Laugh
; CNS difficulty: basic
[Statedef 181]
type = S
ctrl = 0
anim = 181
velset = 0,0
sprpriority = -3

[state 181, snd]
type = playsnd
trigger1 = animelem = 3
value = S181,0
persistent = 0

[state 181, spr priority]
type = sprpriority
trigger1 = 1
value = -3
persistent = 1

[state 181, announce]
type = playsnd
triggerall = teammode = single
trigger1 = time = 10
trigger1 = life != lifemax
value = S180,1

[state 181, announce]
type = playsnd
triggerall = teammode = single
trigger1 = time = 10
trigger1 = life = lifemax
value = S180,1

[State 181, 1]
type = NotHitBy
trigger1 = 1
value = SCA
time = 1

;---------------------------------------------------------------------------
; Introduction
; CNS difficulty: basic
[Statedef 191]
type = S
ctrl = 0
anim = 190
velset = 0,0

[state 191, version]
type = explod
trigger1 = time = 0
anim = ifelse(facing = -1,9101,9100)
scale = 0.5,0.5
postype = Back
pos = ifelse(facing =1, 20, 157),180 ; Nice!
ontop = 1

[state 191, posadd]
type = posadd
trigger1 = time = 0
x = -46.243

[State 191, 1] ;Freeze animation until PreIntro is over
type = ChangeAnim
trigger1 = RoundState = 0
value = 190

[state 191, playsnd]
type = playsnd
trigger1 = animelemtime(5) = 0
trigger2 = animelemtime(10) = 0
trigger3 = animelemtime(15) = 0
trigger4 = animelemtime(20) = 0
value = S190,1
persistent = 1

[state 191, playsnd]
type = playsnd
trigger1 = animelemtime(24) = 0
value = S190,0
persistent = 1

[state 191, explod]
type = explod
trigger1 = time =0
anim = 19001
id = 19001
postype = p1
pos = 0,0
sprpriority = 2
scale = const(size.xscale),const(size.yscale)
removetime = -1
persistent = 0

[state 191, remove temp]
type = removeexplod
trigger1 = numexplod(19000)=1
id = 19001


[state 191, explod]
type = explod
trigger1 = animelemtime(1)=1
anim = 19000
id = 19000
postype = p1
pos = 0,0
sprpriority = 2
scale = const(size.xscale),const(size.yscale)
removetime = -1
persistent = 0


[State 191, 2] ;Assert this until you want "round 1, fight" to begin
type = AssertSpecial
trigger1 = 1
flag = Intro

[State 191, 3] ;Change to stand state when done
type = ChangeState
trigger1 = time > 300
value = 19100

;-----------------------------------------------------------------------------------
; Get Up recovery
[statedef 19100]
type = C
movetype = I
physics = C
anim = 657

[state 191, explod]
type = removeexplod
trigger1 = time = 0
id = 19000

[state 657, playerpush]
type = playerpush
trigger1 = 1
value = 0


[State 191, 2] ;Assert this until you want "round 1, fight" to begin
type = AssertSpecial
trigger1 = 1
flag = Intro

[state 657, explod]
type = explod
trigger1 = time = 0
anim = 656
pos = 0,0
id = 657
scale = const(size.xscale),const(size.yscale)
postype = p1
bindtime = -1
ignorehitpause = 1
removetime = -2
sprpriority = 2
removeongethit = 1

[state 657, velset]
type = posadd
trigger1 = animelemtime(10) >= 0 && animelemtime(11) < 5
x = 4
persistent = 1

[state 657, sprpriority]
type = sprpriority
trigger1 = animelem = 3
value = -1

[state 657, end]
type = changestate
trigger1 = animtime = 0
value = 0
;---------------------------------------------------------------------------
; Taunt
; CNS difficulty: easy
[Statedef 195]
type = S
ctrl = 0
anim = 195
velset = 0,0
movetype = I
physics = S
sprpriority = 2

[State 195, 1]
type = CtrlSet
trigger1 = Time = 40
value = 1

[State 195, 2]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1


;---------------------------------------------------------------------------
; Stand Light Punch
; CNS difficulty: easy
[Statedef 200]
type    = S                      ;State-type: S-stand, C-crouch, A-air, L-liedown
movetype= A                      ;Move-type: A-attack, I-idle, H-gethit
physics = S                      ;Physics: S-stand, C-crouch, A-air
juggle  = 1                      ;Number of air juggle points move takes
;Commonly-used controllers:
velset = 0,0                     ;Set velocity (x,y) (Def: no change)
ctrl = 0                         ;Set ctrl (Def: no change)
anim = 200                       ;Change animation (Def: no change)
poweradd = 4                    ;Power to add (Def: 0)
sprpriority = 2                  ;Set p1's sprite layering priority to 2 (in front)

[State 200, 1]
type = HitDef
trigger1 = AnimElem = 3
attr = S, NA                     ;Attribute: Standing, Normal Attack
damage = ifelse(var(4)=4,30,20),3                   ;Damage that move inflicts, guard damage
animtype = medium                 ;Animation type: Light, Medium, Heavy, Back (def: Light)
guardflag = MA                   ;Flags on how move is to be guarded against
hitflag = MAF                    ;Flags of conditions that move can hit
priority = 3, Hit                ;Attack priority: 0 (least) to 7 (most), 4 default
;Hit/Miss/Dodge type (Def: Hit)
pausetime = 8, 8                 ;Time attacker pauses, time opponent shakes
sparkno = 0                      ;Spark anim no (Def: set above)
sparkxy = -10, -180               ;X-offset for the "hit spark" rel. to p2,
;Y-offset for the spark rel. to p1
hitsound = S5000, 1                  ;Sound to play on hit
guardsound = S120, 0                ;Sound to play on guard
ground.type = High               ;Type: High, Low, Trip (def: Normal)
ground.slidetime = 13             ;Time that the opponent slides back
ground.hittime  = 13             ;Time opponent is in hit state
ground.velocity = ifelse(var(4) = 1, -24,-8)             ;Velocity at which opponent is pushed
airguard.velocity = ifelse(var(4)=1,-12,-4),-1     ;Guard velocity in air (def: (air.xvel*1.5, air.yvel/2))
air.type = High                  ;Type: High, Low, Trip (def: same as ground.type)
air.velocity = ifelse(var(4)=1,-6,-3),-2           ;X-velocity at which opponent is pushed,
			   ;Y-velocity at which opponent is pushed
air.hittime = 15                 ;Time before opponent regains control in air
guard.dist = 340
guard.hittime = 13
guard.slidetime = 13
guard.velocity = ifelse(var(4) = 1, -27,-9)
guard.kill = 0
fall.recovertime = 20

[State 200, 2]
type = PlaySnd
trigger1 = Time = 1
value = 0, 0

[state 200, counter]
type = varadd
trigger1 = animelem = 3
var(4) = -1
persistent = 0
ignorehitpause = 1

;[state 200, movement]
;type = velset
;triggerall = ailevel = 0
;trigger1 = var(4) <= 2
;x = ifelse(command="holdfwd",1,0)

;[state 200, movement AI]
;type = velset
;triggerall = ailevel > 0
;trigger1 = var(4) <= 2
;x = 1

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = ifelse(var(4)=3, -9,-2)
persistent = 0
ignorehitpause = 1

[state 200, Not Active]
type = statetypeset
trigger1 = animelemtime(4) = 0
movetype = I



[State 200, 3]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1



;---------------------------------------------------------------------------
; Stand Light Punch
; CNS difficulty: easy
[Statedef 205]
type    = S                      ;State-type: S-stand, C-crouch, A-air, L-liedown
movetype= A                      ;Move-type: A-attack, I-idle, H-gethit
physics = S                      ;Physics: S-stand, C-crouch, A-air
juggle  = 1                      ;Number of air juggle points move takes
;Commonly-used controllers:
velset = 0,0                     ;Set velocity (x,y) (Def: no change)
ctrl = 0                         ;Set ctrl (Def: no change)
anim = 205                       ;Change animation (Def: no change)
poweradd = 4                    ;Power to add (Def: 0)
sprpriority = 2                  ;Set p1's sprite layering priority to 2 (in front)

[State 205, 1]
type = HitDef
trigger1 = AnimElem = 3
attr = S, NA                     ;Attribute: Standing, Normal Attack
damage = 20,2                ;Damage that move inflicts, guard damage
animtype = medium                 ;Animation type: Light, Medium, Heavy, Back (def: Light)
guardflag = MA                   ;Flags on how move is to be guarded against
hitflag = MAF                    ;Flags of conditions that move can hit
priority = 3, Hit                ;Attack priority: 0 (least) to 7 (most), 4 default
;Hit/Miss/Dodge type (Def: Hit)
pausetime = 8, 8                 ;Time attacker pauses, time opponent shakes
sparkno = 0                      ;Spark anim no (Def: set above)
sparkxy = -10, -180               ;X-offset for the "hit spark" rel. to p2,
;Y-offset for the spark rel. to p1
hitsound = S5000, 1                  ;Sound to play on hit
guardsound = S120, 0                ;Sound to play on guard
ground.type = High               ;Type: High, Low, Trip (def: Normal)
ground.slidetime = 13             ;Time that the opponent slides back
ground.hittime  = 13             ;Time opponent is in hit state
ground.velocity = ifelse(var(4) = 1, -24,-8)             ;Velocity at which opponent is pushed
airguard.velocity = ifelse(var(4)=1,-12,-4),-1     ;Guard velocity in air (def: (air.xvel*1.5, air.yvel/2))
air.type = High                  ;Type: High, Low, Trip (def: same as ground.type)
air.velocity = ifelse(var(4)=1,-9,-3),-2         ;X-velocity at which opponent is pushed,
			   ;Y-velocity at which opponent is pushed
air.hittime = 15                 ;Time before opponent regains control in air
guard.dist = 340
guard.hittime = 13
guard.slidetime = 13
guard.velocity = ifelse(var(4) = 1, -27,-9)
guard.kill = 0
fall.recovertime = 20

[State 205, 2]
type = PlaySnd
trigger1 = Time = 1
value = 0, 0

;[state 200, movement]
;type = velset
;triggerall = ailevel = 0
;trigger1 = var(4) <= 3
;x = ifelse(command="holdfwd",1,0)

;[state 200, movement AI]
;type = velset
;triggerall = ailevel > 0
;trigger1 = var(4) <= 3
;x = 1

[state 200, counter]
type = varadd
trigger1 = animelem = 3
var(4) = -1
persistent = 0
ignorehitpause = 1

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -2
persistent = 0
ignorehitpause = 1

[state 200, Not Active]
type = statetypeset
trigger1 = animelemtime(4) = 0
movetype = I

[State 205, 3]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1


;---------------------------------------------------------------------------
; Standing strong punch
; CNS difficulty: easy
; Note the width controller. It makes KFM's push box larger, so he doesn't
; stand so close to the opponent. Hit Ctrl-C and look at the red bar at his
; feet.
; The sprpriority for this state is at -1, instead of the usual 2 for
; attacks. This makes KFM appear behind the opponent initially.
; The SprPriority controller in [State 210, 4] brings KFM to the front when
; his arm has swung over.
; To stop KFM from pausing in his swing frame, there is a ChangeAnim in
; [State 210, 3] that detects if the hit has come in contact with the
; opponent during that frame, and switches to the next animation element
; (notice the elem=6 parameter). If you don't see what I mean, try commenting
; out that controller, then hit someone with this attack.
[Statedef 210]
type    = S
movetype= A
physics = S
juggle  = 4
poweradd= 10
ctrl = 0
velset = 0,0
anim = 210
sprpriority = -1

[State 210, 1]
type = PlaySnd
trigger1 = animelem = 2
value = S210, 0

[State 210, explod]
type = explod
trigger1 = time = 0
anim = 211
id = 211
sprpriority = 4
ownpal = 1
pos = 0,0
removetime = -2
scale = const(size.xscale),const(size.yscale)
removeongethit = 1
ignorehitpause = 0

[State 210, 1]
type = PlaySnd
trigger1 = animelem = 7
value = S210, 0

[state 210, remove explod]
type = removeexplod
trigger1 = movehit
id = 211
ignorehitpause = 0

[State 210, 2]
type = HitDef
trigger1 = AnimElem = 4
attr = S, NA
animtype  = Heavy
damage    = 90,9
persistent = 0
guardflag = MA
pausetime = 2,6
sparkno = 3
id = 210
sparkxy = -10,-140
hitsound   = S210,2
guardsound = S120, 0
ground.type = High
ground.slidetime = 22
ground.hittime  = 22
ground.velocity = -6
air.velocity = -4,-6
guard.dist = 420
guard.hittime = 14
guard.slidetime = 14
guard.velocity = -8
airguard.velocity = -2,-6
guard.kill = 0
fall.recovertime = 30


[State 210, 2]
type = HitDef
trigger1 = AnimElem = 8
attr = S, NA
animtype  = Heavy
damage    = ifelse(numtarget(210),90,90),9
guardflag = MA
persistent = 0
hitflag = MA
pausetime = 12,12
sparkno = 3
id = 211
sparkxy = -10,-200
hitsound   = S210,2
guardsound = S120, 0
ground.type = High
ground.slidetime = 18
ground.hittime  = 18
ground.velocity = -8,2
air.velocity = -6,2
air.fall = 1
guard.dist = 450
guard.hittime = 17
guard.slidetime = 17
guard.velocity = -16
airguard.velocity = -12,0
guard.kill = 0
fall = 1
fall.recovertime = 30

[state 210, sprpriority]
type = sprPriority
trigger1 = animelem = 9
value = -2

[state x, combo damage score]
type = varadd
triggerall = numtarget(210)
trigger1 = movehit
v = 18
value = -3
persistent = 0
ignorehitpause = 1

[state 210, Not Active]
type = statetypeset
trigger1 = animelemtime(9) = 0
movetype = I


[State 210, 5]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
;Shoulder Tackle
[Statedef 215]
type    = S
movetype= A
physics = N
poweradd= 20
ctrl = 0
anim = 215
sprpriority = -1

[state 215, velkeep]
type = velset
trigger1 = animelemtime(2) < 0
x = const(velocity.run.fwd.x)

[state 215, skid]
type = velmul
trigger1 = animelemtime(3) = 0
x = 0.5


[state 215, skid]
type = statetypeset
trigger1 = animelemtime(3) = 16
physics = S


;[State 215, 1]
;type = PlaySnd
;trigger1 = animelem = 2
;value = S210, 0

[State 215, 2]
type = HitDef
trigger1 = AnimElem = 2
attr = S, NA
animtype  = Heavy
damage    = 80,8
guardflag = MA
pausetime = 14,14
sparkno = 3
id = 210
sparkxy = -10,-140
hitsound = S5000, 2
guardsound = S120, 0
ground.type = High
ground.slidetime = 22
ground.hittime  = 22
ground.velocity = -30,-15
air.velocity = -30,-15
guard.dist = 420
guard.hittime = 16
guard.slidetime = 16
guard.velocity = -36
airguard.velocity = -24,-2
guard.kill = 0
fall.recovertime = 20

[state 215, Wall Bounce Limiter]
type = varadd
trigger1 = movehit
var(7) = -1
ignorehitpause = 1
persistent = 0

[state 215, targetstate]
type = targetstate
trigger1 = movehit
trigger1 = var(7) > 0
trigger1 = hitpausetime = 13
value = 675
ignorehitpause = 1
persistent = 0

[state x, combo damage score]
type = varadd
triggerall = numtarget(210)
trigger1 = movehit
v = 18
value = -3
persistent = 0
ignorehitpause = 1

[state 215, Not Active]
type = statetypeset
trigger1 = animelemtime(3) = 0
movetype = I


[State 215, 5]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
; Standing light kick
; CNS difficulty: easy
[Statedef 230]
type    = S
movetype= A
physics = S
poweradd= 5
ctrl = 0
velset = 0,0
anim = 230
sprpriority = 2

[State 230, 1]
type = PlaySnd
trigger1 = Time = 2
value = 0, 1

[State 230, 2]
type = HitDef
trigger1 = Time = 0
attr = S, NA
animtype  = Medium
damage    = 25
guardflag = MA
pausetime = 12,12
sparkno = 0
sparkxy = -10,-37
hitsound = S5000, 1
guardsound = S120, 0
ground.type = Low
ground.slidetime = 16
ground.hittime  = 16
ground.velocity = -5
air.velocity = -2.5,-3.5
guard.dist = 300
guard.hittime = 12
guard.slidetime = 12
guard.velocity = -6
forcestand = 1
fall.recovertime = 20

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -9
persistent = 0
ignorehitpause = 1

[state 200, Not Active]
type = statetypeset
trigger1 = animelemtime(4) = 0
movetype = I

[State 230, 3]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
; Standing strong kick
; CNS difficulty: easy
[Statedef 240]
type    = S
movetype= A
physics = S
juggle  = 5
poweradd= 30
ctrl = 0
velset = 0,0
anim = 240
sprpriority = 2

[State 240, 1]
type = PlaySnd
trigger1 = Time = 2
value = 0, 1

[State 240, 2]
type = HitDef
trigger1 = Time = 0
attr = S, NA
animtype  = Medium
damage    = 90,ifelse(enemy,statetype = A, 27,9)
guardflag = MA
pausetime = 14,14
sparkno = 3
sparkxy = -10,-200
hitsound = S5000, 2
guardsound = S120, 0
ground.type = High
ground.slidetime = 20
ground.hittime  = 20
ground.velocity = -1,-22
air.velocity = -1,-12
fall = 1
fall.recover = 0
guard.dist = 425
guard.hittime = 23
guard.slidetime = 23
guard.velocity = -16
airguard.hittime = 18
guard.kill = 0
fall.recovertime = 40

[state 240, small hop]
type = velset
trigger1 = animelem = 7
y = -3.5

[state 240, small hop]
type = statetypeset
trigger1 = animelem = 7
statetype = A

[state 240, gravity]
type = gravity
trigger1 = pos y < -1

[state 240, posset]
type = posset
trigger1 = pos y > 0
y = 0

[state 240, small hop]
type = statetypeset
trigger1 = time > 19
trigger1 = pos y = 0
statetype = S

[state 240, posset]
type = playsnd
trigger1 = pos y = 0
trigger1 = time > 19
value = S20,0
persistent = 0

[state 240, posset]
type = envshake
trigger1 = pos y = 0
trigger1 = time > 19
time = 18
ampl = -8
freq = 100
persistent = 0

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -9
persistent = 0
ignorehitpause = 1

[state 240, Not Active]
type = statetypeset
trigger1 = animelemtime(8) = 0
movetype = I


[State 240, 4]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
;Crouching light punch
; CNS difficulty: easy
; Description: Simple crouching attack. The HitDef's guardflag parameter
;     is set to "L", meaning that the move can only be guarded low
;     (crouching), and not by standing or jumping opponents.
;     Like for all light attacks, it's a good idea to keep the slidetime
;     and hittime parameters at a smaller number, so the opponent isn't
;     stunned for too long. For all crouching attacks you have to
;     remember to set the attr parameter to indicate that it is crouching
;     attack. In this case, "C, NA" stands for "crouching, normal attack".
;     The HitDef's priority is set at 3, instead of the default of 4,
;     so this attack has a lower priority than most others, meaning
;     KFM will get hit instead of trading hits with his opponent if
;     their attack collision boxes (Clsn1) intersect each other's Clsn2
;     boxes at the same time.
[Statedef 400]
type    = C
movetype= A
physics = C
juggle  = 5
poweradd= 4
ctrl = 0
anim = 400
sprpriority = 2

[State 400, 1]
type = PlaySnd
trigger1 = Time = 1
value = 0, 0

[State 400, 2]
type = HitDef
trigger1 = Time = 0
attr = C, NA
damage    = 28
priority  = 3
animtype  = medium
hitflag = MAF
guardflag = MA
pausetime = 8,8
sparkno = 0
sparkxy = -10,-100
hitsound = S5000, 0
guardsound = S120, 0
ground.type = Low
ground.slidetime = 13
ground.hittime  = 13
ground.velocity = -10
air.velocity = -6,-2
guard.hittime = 13
guard.slidetime = 13
guard.velocity = -8
fall.recovertime = 20

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -9
persistent = 0
ignorehitpause = 1

[state 400, Not Active]
type = statetypeset
trigger1 = animelemtime(4) = 0
movetype = I

[State 400, 4]
type = ChangeState
trigger1 = AnimTime = 0
value = 11
ctrl = 1

;---------------------------------------------------------------------------
;Crouching strong punch
; CNS difficulty: easy
; Description: This is a 2-hit move. It is done by having two HitDefs
;     triggered, one for each frame of animation that hits.
;     Notice how the first hit cannot be guarded by an opponent in the
;     air, because of the "M" in the guardflag, meaning it can only
;     be guarded "middle". The second hit has an "MA" guardflag, so
;     it can be guarded both on the ground and in the air.
[Statedef 410]
type    = C
movetype= A
physics = C
poweradd= 12
ctrl = 0
velset = 0,0
sprpriority = 2

;===========
;Armor start
;===========
[state 410, animation]
type = changeanim
trigger1 = anim != 410
value = 410

[state 410, armor counter]
type = varset
trigger1 = time = 0
trigger1 = Var(21) = 1
V = 20
value = 1

[state x, armor over]
type = varset
trigger1 = animelem = 4
v = 20
value = 0
ignorehitpause 

[state 410, armor intiator turn off]
type = varset
trigger1 = time = 1
V = 21
value = 0

;determine what frame
[state 410, remember frame]
type = varset
trigger1 = time <= 0
v = 22
value = animelemno(0)
ignorehitpause = 0

;delay effect
[state 410, delay]
type = changeanim 
trigger1 = var(31) < floor(gethitvar(hittime)*1.1)
value = anim
elem = var(22)
ignorehitpause = 1
persistent = 1


[state 410, freeze location]
type = posfreeze
trigger1 = var(31) < floor(gethitvar(hittime)*1.1)
value = 1
ignorehitpause = 1
persistent = 1

;--------------------------

[state 410, still take damage]
type = lifeadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) != 0
value = floor(-gethitvar(damage)*0.75)
persistent = 1

[state 410, armor count down]
type = varadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) > 0
V = 20
value = -1
persistent = 1

[state 410, Unstoppable]
type = hitoverride
trigger1 = Life > 1
trigger1 = Var(20) > 0
attr = SCA, AA, AP
stateno = 410
time = 1
persistent = 1

[State 410, flash red]
type = PalFX
trigger1 = Time = 0
trigger1 = gethitvar(damage) != 0
time = 7
add = 100,0,0
IgnoreHitPause = 1

;---
;Armor End
;---

[State 410, 1]
type = PlaySnd
trigger1 = Time = 1
value = 0, 0

[State 410, 1]
type = PlaySnd
trigger1 = animelem = 6
value = S210, 0

[state 410, slide]
type = velset
trigger1 = animelem = 3
x = 40

[state 410, brakes]
type = velset
trigger1 = animelem = 4
x = 0

;This is the first hit, triggered on the 3rd element of animation.
[State 410, 2]
type = HitDef
trigger1 = AnimElem = 3
attr = C, NA
damage    = 60
id = 410
nochainid = 410
persistent = 0
animtype  = back
hitflag = MAF
guardflag = MA
pausetime = 4,8
sparkno = 2
sparkxy = -10,-140
hitsound = S5000, 2
guardsound = S120, 0
ground.type = High
ground.slidetime = 18
ground.hittime  = 18
ground.velocity = -8
air.velocity = -2,-10
air.hittime = 34
guard.hittime = 14
guard.slidetime = 14
guard.velocity = -8
fall.recovertime = 30


;This is the second hit, triggered on the 4th element of animation.
[State 410, 3]
type = HitDef
trigger1 = AnimElem = 7
attr = C, NA
damage    = 60,ifelse(enemy,statetype = A, 21,7)
persistent = 0
animtype  = Medium
hitflag = MAF
guardflag = MA
id = 411
nochainid = 411
pausetime = 18,18
sparkno = 3
sparkxy = -10,-140
hitsound   = 5,4
guardsound = S120, 0
ground.type = High
ground.slidetime = 22
ground.hittime  = 22
air.hittime = 40
ground.velocity = -2,Ifelse(var(11)<=0,-8,-24)
air.velocity = -4,Ifelse(var(11)<=0,-6,-18)
guard.slidetime = 24
guard.hittime = 12 ;-8
guard.velocity = -12
airguard.velocity = -4,-6
airguard.hittime = 16
guard.kill = 0
fall.recovertime = 30

[state 410, jump out]
type = changestate
triggerall = movehit
triggerall = numtarget(411) > 0
triggerall = animelemtime(7) > 0
trigger1 = command = "holdup"
trigger2 = ailevel > 0
value = 42
ctrl = 0

[state 410, Launcher Limiter]
type = varadd
trigger1 = numtarget(411) != 0
var(11) = -1 
persistent = 0

[state x, combo damage score]
type = varadd
trigger1 = movehit
v = 18
value = -4
persistent = 0
ignorehitpause = 1

[state 410, Not Active]
type = statetypeset
trigger1 = animelemtime(8) = 0
movetype = I



[State 410, 4]
type = ChangeState
trigger1 = AnimTime = 0
value = 11
ctrl = 1

;---------------------------------------------------------------------------
;Crouching light kick
; CNS difficulty: easy
[Statedef 430]
type    = C
movetype= A
physics = C
juggle  = 15
poweradd= 5
ctrl = 0
anim = 430
sprpriority = 2

[State 430, 1]
type = PlaySnd
trigger1 = Time = 1
value = 0, 0

[State 430, 2]
type = HitDef
trigger1 = Time = 0
attr = C, NA
damage    = 25
animtype  = Light
hitflag = MAFD
guardflag = L
pausetime = 12,12
sparkno = 0
nochainid = 1400
sparkxy = -10,-8
hitsound = S5000, 1
guardsound = S120, 0
ground.type = Low
ground.slidetime = 15
ground.hittime  = 15
ground.velocity = -12
air.velocity = -8,-2
down.velocity = -5,0
down.hittime = 22
guard.hittime = 10
guard.slidetime = 10
guard.velocity = -8
fall.recovertime = 20

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -9
persistent = 0
ignorehitpause = 1

[state 430, Not Active]
type = statetypeset
trigger1 = animelemtime(4) = 0
movetype = I

[State 430, 3]
type = ChangeState
trigger1 = AnimTime = 0
value = 11
ctrl = 1

;---------------------------------------------------------------------------
;Crouch Hard Kick
[Statedef 440]
type    = C
movetype= A
physics = C
poweradd= 15
juggle = 15
ctrl = 0
anim = 440
sprpriority = 2

[State 440, 2]
type = PlaySnd
trigger1 = Time = 2
value = 0, 2

[State 440, 3]
type = HitDef
trigger1 = Time = 0
attr = C, NA
damage    = ifelse(p2statetype = L, 35,ifelse(p2statetype = A, 35, 70)),7
hitflag = MAFD
guardflag = L
pausetime = 12,12
sparkno = 1
sparkxy = -5,-10
nochainid = 1400
hitsound   = S5000,1
guardsound = S120, 0
ground.type = Trip
ground.slidetime = 16
ground.hittime  = 16
ground.velocity = -4,-10
air.velocity = -4,-10
down.velocity = -16,0
guard.velocity = -12
guard.hittime = 9 ;-10 Standard Sweep
guard.slidetime = 9
guard.velocity = -32
fall = 1
fall.recover = 0
guard.dist = 720
fall.recovertime = 40
guard.kill = 0

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -3
persistent = 0
ignorehitpause = 1

[state 440, Not Active]
type = statetypeset
trigger1 = animelemtime(4) = 0
movetype = I


[State 440, 4]
type = ChangeState
trigger1 = AnimTime = 0
value = 11
ctrl = 1

;---------------------------------------------------------------------------
;Jump Light Punch
; CNS difficulty: easy
[Statedef 600]
type    = A
movetype= A
physics = A
juggle  = 2
poweradd= 2
ctrl = 0
anim = 600
sprpriority = 2

[State 600, 1]
type = PlaySnd
trigger1 = Time = 1
value = 0, 0

[State 600, 2]
type = HitDef
trigger1 = Time = 0
attr = A, NA
damage    = 22
guardflag = HA
priority = 2
pausetime = 8,8
sparkno = 0
sparkxy = -10,-58
hitsound = S5000, 0
guardsound = S120, 0
ground.type = High
ground.slidetime = 12
ground.hittime  = 12
ground.velocity = -6
air.velocity = -2,-6
air.hittime = 12
guard.hittime = 6
guard.slidetime = 6
guard.velocity = -8
fall.recovertime = 20

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -9
persistent = 0
ignorehitpause = 1

[state 600, AI jab count]
type = varadd
trigger1 = movehit
var(24) = 1
persistent = 0
ignorehitpause = 1

[State 600, 3]
type = changestate
trigger1 = animtime = 0
value = 50
ctrl = 1

;---------------------------------------------------------------------------
;Jump Strong Punch
; CNS difficulty: easy
[Statedef 610]
type    = A
movetype= A
physics = A
juggle  = 4
poweradd= 15
ctrl = 0
anim = 610
sprpriority = 2

[State 610, 2]
type = PlaySnd
trigger1 = Time = 2
value = 0, 1

[state 610, bounce on hit]
type = veladd
trigger1 = movehit
trigger1 = enemy, statetype = A
y = ifelse(vel y >= 0, -20,-10)
persistent = 0

[State 610, 3]
type = HitDef
trigger1 = Time = 0
attr = A, NA
damage = 90,9
guardflag = HA
hitflag = MAF
priority = 4
pausetime = 14,12
sparkno = 3
sparkxy = -10,-105
hitsound   = 5,4
guardsound = S120, 0
animtype = Med
ground.type = High
ground.slidetime = 26
ground.hittime  = 26
ground.velocity = -16
air.velocity = 2,40
air.hittime = 50
air.fall = 1
down.bounce = 1
fall.recover = 0
fall.recovertime = 25
fall.yvelocity = -16
fall.xvelocity = -2
guard.dist = 400
guard.hittime = 17
guard.slidetime = 17
guard.velocity = -8
guard.kill = 0
envshake.ampl = -6
envshake.time = 8
fall.recovertime = 40

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -3
persistent = 0
ignorehitpause = 1

[state 610, Not Active]
type = statetypeset
trigger1 = animelemtime(6) = 0
movetype = I

[state 610, end]
type = changestate
trigger1 = animtime = 0
value = 50
ctrl = 1
;---------------------------------------------------------------------------
;Jump Light Kick
; CNS difficulty: easy
[Statedef 630]
type    = A
movetype= A
physics = A
juggle  = 3
poweradd= 5
ctrl = 0
anim = 630
sprpriority = 2

[State 630, 1]
type = PlaySnd
trigger1 = Time = 1
value = 0, 0

[State 630, 2]
type = HitDef
trigger1 = Time = 0
attr = A, NA
damage = 20
guardflag = HA
priority = 3
pausetime = 8,8
sparkno = 1
sparkxy = -5,-35
hitsound = S5000, 0
guardsound = S120, 0
ground.type = High
ground.slidetime = 16
ground.hittime  = 16
ground.velocity = -4
air.velocity = -2,-6
air.hittime = 20
guard.hittime = 12
guard.slidetime = 12
guard.velocity = -8
fall.recovertime = 20

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -9
persistent = 0
ignorehitpause = 1

[State 630, 3]
type = changestate
trigger1 = animtime = 0
value = 50
ctrl = 1

;---------------------------------------------------------------------------
;Jump Strong Kick
; CNS difficulty: easy
[Statedef 640]
type    = A
movetype= A
physics = A
juggle  = 4
poweradd= 15
ctrl = 0
anim = 640
sprpriority = 2

[State 640, 2]
type = PlaySnd
trigger1 = Time = 2
value = 0, 1

[State 640, 3]
type = HitDef
trigger1 = Time = 0
attr = A, NA
damage    = 75
guardflag = HA
priority = 4
pausetime = 14,14
sparkno = 3
sparkxy = -10,-70
hitsound   = 5,4
guardsound = S120, 0
animtype = Med
ground.type = High
ground.slidetime = 26
ground.hittime  = 26
ground.velocity = -16
air.velocity = -24,18
guard.hittime = 17
guard.slidetime = 17
guard.velocity = -18
airguard.velocity = -8, -4
air.fall = 1
fall.recover = 0
fall.yvelocity = -6
fall.xvelocity = -2
fall.recovertime = 40

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -3
persistent = 0
ignorehitpause = 1

[state 640, Not Active]
type = statetypeset
trigger1 = animelemtime(5) = 0
movetype = I

[State 640, 3]
type = changestate
trigger1 = animtime = 0
value = 50
ctrl = 1
;---------------------------------------------------------------------------
;Jump Butt Drop
; CNS difficulty: easy
[Statedef 645]
type    = A
movetype= A
physics = N
poweradd= 100
ctrl = 0
sprpriority = 2

[state x, combo damage score]
type = varadd
trigger1 = time = 0
v = 18
value = 6
persistent = 0
ignorehitpause = 1

[state 645, gravity]
type = gravity
trigger1 = 1

;=================================
;-      Damage Set
;=================================

;Out of range, moreso Max damage
;Out of Range
[state 650, damage set]
type = varset
trigger1 = ceil(pos y) <= -620
trigger1 = time = 0
var(16) = 1300

;Out of Range
[state 650, damage set]
type = varset
trigger1 = ceil(pos y) <= -550 && ceil(pos y) > -620
trigger1 = time = 0
var(16) = 480

; Peak Super Jump
[state 650, damage set]
type = varset
trigger1 = ceil(pos y) <= -340  && ceil(pos y) > -550
trigger1 = time = 0
var(16) = 240

; Super Jump
[state 650, damage set]
type = varset
trigger1 = ceil(pos y) <= -260 && ceil(pos y) > -340
trigger1 = time = 0
var(16) = 220

; Peak Normal Jump
[state 650, damage set]
type = varset
trigger1 = ceil(pos y) <= -200 && ceil(pos y) > -260
trigger1 = time = 0
var(16) = 200


; small Normal Jump
[state 650, damage set]
type = varset
trigger1 = ceil(pos y) <= 0 && ceil(pos y) > -200
trigger1 = time = 0
var(16) = 180

;-----------------------

;===========
;Armor start
;===========
[state 1020, animation]
type = changeanim
trigger1 = anim != 642
value = 642

[state 1020, armor counter]
type = varset
trigger1 = time = 0
trigger1 = Var(21) = 1
V = 20
value = 1

;[state x, armor over]
;type = varset
;trigger1 = animelem = 16
;v = 20
;value = 0
;ignorehitpause 

[state 1020, armor intiator turn off]
type = varset
trigger1 = time = 1
V = 21
value = 0

;determine what frame
[state 1020, remember frame]
type = varset
trigger1 = time <= 0
v = 22
value = animelemno(0)
ignorehitpause = 1

;delay effect
[state 1020, delay]
type = changeanim 
trigger1 = var(31) < floor(gethitvar(hittime)*1.25)
value = anim
elem = var(22)

[state 1020, freeze location]
type = posfreeze
trigger1 = var(31) < floor(gethitvar(hittime)*1.25)
value = 1
;--------------------------

[state 1020, still take damage]
type = lifeadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) != 0
value = floor(-gethitvar(damage))
persistent = 1

[state 1020, armor count down]
type = varadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) > 0
V = 20
value = - 1
persistent = 1

[state 1020, Unstoppable]
type = hitoverride
trigger1 = Life > 1
trigger1 = Var(20) > 0
attr = SCA, AA, AP
stateno = 645
time = 1
persistent = 1

[State 1020, flash red]
type = PalFX
trigger1 = Time = 0
trigger1 = gethitvar(damage) != 0
time = 7
add = 100,0,0
IgnoreHitPause = 1

;---
;Armor End
;---

[state 645, playerpush]
type = playerpush
trigger1 = 1
value = 0

[state 645, double gravity]
type = veladd
trigger1 = vel y > 0
y = 0.35
persistent = 1

[State 645, 3]
type = HitDef
trigger1 = vel y > 0
persistent = 0
attr = A, SA
damage = ifelse(p2movetype = H,floor(var(16)*0.75),var(16)), floor(var(16)*0.3)
hitflag = MAFD
getpower = floor(var(16) * 0.75)
givepower = floor(var(16))
guardflag = HA
priority = 2
pausetime = 2,2
guard.pausetime = 4,14
sparkno = 3
nochainid = 1400
sparkxy = -10,-70
hitsound   = 5,4
guardsound = S120, 0
animtype = Med
ground.type = High
ground.slidetime = 24
ground.hittime  = 24
ground.velocity = 0
air.velocity = 0,0
guard.hittime = 42
guard.slidetime = 42
guard.velocity = -90
airguard.velocity = -24, 10
air.fall = 1
fall.recover = 0


;--------------------------

[state 645, enemy state]
type = targetstate
triggerall = vel y > 0
trigger1 = movehit
trigger1 = enemy,statetype != A
value = 660

;Ride down mechanic
[state 645, Ride down]
type = targetbind
trigger1 = movehit
trigger1 = enemy,statetype = A
pos = 36, -37

[state 645, state of ride down]
type = targetstate
trigger1 = movehit
trigger1 = enemy,statetype = A
value = 655
;----------------------------------------------

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -3
persistent = 0
ignorehitpause = 1

[State 645, 3]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 646

;---------------------------------------------------------------------------
; 1st Landing
[statedef 646]
type    = C
movetype= A
physics = N
poweradd= 30

[state 646, anim]
type = changeanim
trigger1 = time = 0
value = 643

[state 646, height detection]
type = varset
trigger1 = time = 4
v = 15
value = 0

;Custom Dust
[state 646, explod]
type = explod
trigger1 = time = 0
anim = 2000
pos = 30,-20
scale = const(size.xscale)*3,const(size.yscale)*2.5
sprpriority  = 3
ownpal = 1

[state 646, fx]
type = explod
trigger1 = time = 0
anim = F61
pos = 0,0
scale = 6,3
ownpal = 1
sprpriority = -4


[state 646, explod]
type = explod
trigger1 = time = 0
anim = 2001
pos = 30,-20
scale =  const(size.xscale)*3,const(size.yscale)*2.5
sprpriority = -4
ownpal = 1
; -------------------

[state 646, snd]
type = playsnd
trigger1 = time = 0
value =S650,0

[state 646, snd]
type = playsnd
trigger1 = time = 0
value =S650,0

[state 646, pos]
type = posset
trigger1 = time = 0
y = 0

[state 646, playerpush]
type = playerpush
trigger1 = 1
value = 0

[State 646, 3]
type = HitDef
trigger1 = Time = 0
attr = A, NA
damage    = var(16)
guardflag = 
hitflag = FD
nochainid = 1400
priority = 4
pausetime = 12,12
sparkno = 1
sparkxy = -10,-40
hitsound = S5000, 2
guardsound = S120, 0
animtype = Med
p1sprpriority = 3
p2stateno = 660
ground.type = High
ground.slidetime = 12
ground.hittime  = 15
ground.velocity = 0
air.velocity = 0,0

[state 646, vel]
type = velset
trigger1 = time = 0
y = 0
x = 0

[state 646, earthquakes]
type = envshake
trigger1 = time = 0
time = 24
ampl = -16
freq = 75
phase = 75


[state 646, end]
type = changestate
trigger1 = time = 12
value = 647

;---------------------------------------------------------------------------
;Bounce
[statedef 647]
type    = A
movetype= I
physics = N
movehitpersist = 1

[state 652, playerpush]
type = playerpush
trigger1 = 1
value = 0

[state 652, velset]
type = velset
trigger1 = time = 0
y = -10

[state 652, gravity]
type = gravity
trigger1 = pos y < -1

[state 652, end]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 648

;--------------------------------------------------------------------------
;Landing Rest
[statedef 648]
type    = C
movetype= I
physics = N
movehitpersist = 1
sprpriority = 2

[state 653, anim]
type = changeanim
trigger1 = time = 0
value = 644

[state 653, posset]
type = posset
trigger1 = time = 0
y = 0

[state 653, playerpush]
type = playerpush
trigger1 = 1
value = 0

[state 653, velset]
type = velset
trigger1 = time = 0
y = 0
x = 0

[state 653, snd]
type = playsnd
trigger1 = time = 0
value =S650,0

[state 653, earthquakes]
type = envshake
trigger1 = time = 0
time = 15
ampl = 12
freq = 100
phase = 100

[state 653, snack]
type = changestate
triggerall = animelemtime(3) > 0
trigger1 = command = "x" || command = "y" || command = "holdx" || command = "holdy"
trigger2 = ailevel > 0
trigger2 = enemy,stateno = 660
value = 1300

[state 653, end]
type = changestate
trigger1 = animtime = 0
value = 657





;---------------------------------------------------------------------------
;Banzai Drop
[statedef 650]
type = A
movetype = A
physics = N
velset = 0,0
poweradd = 80
anim = 650
ctrl = 0

[state 650, explod]
type = explod
trigger1 = time = 0
anim = 647
pos = 0,0
id = 650
scale = const(size.xscale),const(size.yscale)
postype = p1
bindtime = -1
ignorehitpause = 1
removetime = -2
sprpriority = 2
removeongethit = 1

[state 650, gravity]
type = gravity
trigger1 = animelemtime(4) > 0

[state 650, double gravity]
type = veladd
trigger1 = animelemtime(4) > 0
trigger1 = vel y > 0
y = 0.35
persistent = 1

[state 650, playerpush]
type = playerpush
trigger1 = 1
value = 0

[state 650, edge]
type = width
trigger1 = 1
edge = 90,100

[state 650, velset]
type = velset
trigger1 = animelem = 4
x = const(velocity.jump.fwd.x)*1.2
y = const(velocity.jump.y)*0.75

[state 650, veladd]
type = veladd
triggerall = vel x < const(velocity.jump.fwd.x)*2
triggerall = animelemtime(5) > 0
trigger1 = command = "holdfwd"
trigger1 = ailevel = 0
trigger2 = ailevel > 0
trigger2 = p2bodydist x > 25
x =  const(velocity.jump.fwd.x)*0.1
persistent = 1

[state 650, veladd]
type = veladd
triggerall = vel x > const(velocity.jump.back.x)*2
triggerall = animelemtime(5) > 0
trigger1 = command = "holdback"
trigger1 = ailevel = 0
trigger2 = ailevel > 0
trigger2 = p2bodydist x < -50
x =  const(velocity.jump.back.x)*0.1
persistent = 1

[state 650, vel mul]
type = velmul
trigger1 = !ailevel
trigger1 = command != "holdfwd" && command != "holdback"
trigger2 = ailevel
trigger2 = p2bodydist x > 25 && p2bodydist x > -50
x = 0.8
persistent = 8


[State 650, 3]
type = HitDef
triggerall = p2bodydist y > 0
trigger1 = vel y > 0
trigger1 = !movecontact || !movereversed
persistent = 0
attr = A, SA
damage    = floor(var(16))
getpower = floor(var(16) * 0.75)
givepower = floor(var(16))
guardflag = 
hitflag = MAFD
priority = 2,miss
pausetime = 0,0
sparkno = -1
nochainid = 1400
sparkxy = 0,0
hitsound   = 5,4
guardsound = S120, 0
p1sprpriority = -2
animtype = heavy
ground.type = high
ground.slidetime = 22
ground.hittime  = 22
ground.velocity = 0
air.velocity = 0,0
down.hittime = 60
guard.velocity = -50            
guard.hittime = 45
guard.slidetime = 45
airguard.velocity = -28,10
airguard.hittime = 35
guard.dist = 0

; Ride Down
;--------------------------
[state 650, enemy state]
type = targetstate
triggerall = vel y > 0
trigger1 = movehit
trigger1 = enemy,statetype != A
value = 660

;Ride down mechanic
[state 650, Ride down]
type = targetbind
trigger1 = movehit
trigger1 = enemy,statetype = A
pos = 52, -21

[state 650, state of ride down]
type = targetstate
trigger1 = movehit
trigger1 = enemy,statetype = A
value = 655
;-------------------------------

[state 650, end]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 651


;--------------------------------------------------------------------------------
; 1st Landing
[statedef 651]
type    = C
movetype= A
physics = N
poweradd= 30

[state 651, anim]
type = changeanim
trigger1 = time = 0
value = 651

[state 650, explod]
type = explod
trigger1 = time = 0
anim = 648
pos = 0,0
id = 651
scale = const(size.xscale),const(size.yscale)
postype = p1
bindtime = -1
ignorehitpause = 1
removetime = -2
sprpriority = 2
removeongethit = 1

;Custom Dust
[state 651, explod]
type = explod
trigger1 = time = 0
anim = 2000
pos = 30,-20
scale = const(size.xscale)*3,const(size.yscale)*2.5
sprpriority = 4
ownpal = 1

[state 651, fx]
type = explod
trigger1 = time = 0
anim = F61
pos = 0,0
scale = 6,3
ownpal = 1
sprpriority = -4


[state 651, explod]
type = explod
trigger1 = time = 0
anim = 2001
pos = 30,-20
scale =  const(size.xscale)*3,const(size.yscale)*2.5
sprpriority = -4
ownpal = 1
; -------------------

[state 651, snd]
type = playsnd
trigger1 = time = 0
value =S650,0

[state 651, snd]
type = playsnd
trigger1 = time = 0
value =S650,0

[state 651, pos]
type = posset
trigger1 = time = 0
y = 0

[state 651, playerpush]
type = playerpush
trigger1 = 1
value = 0

[State 651, 3]
type = HitDef
trigger1 = Time = 0
attr = A, SA
damage    = var(16)
guardflag = 
hitflag = FD
nochainid = 1400
priority = 4
pausetime = 0,0
sparkno = 1
sparkxy = -10,-40
hitsound = S5000, 2
guardsound = S120, 0
animtype = Med
p1sprpriority = -2
p2stateno = 660
ground.type = High
ground.slidetime = 12
ground.hittime  = 15
ground.velocity = 0
air.velocity = 0,0

[state 651, vel]
type = velset
trigger1 = time = 0
y = 0
x = 0

[state 651, earthquakes]
type = envshake
trigger1 = time = 0
time = 48
ampl = -32
freq = 75
phase = 75


[state 651, end]
type = changestate
trigger1 = time = 12
value = 652

;---------------------------------------------------------------------------
;Bounce
[statedef 652]
type    = A
movetype= I
physics = N
movehitpersist = 1

[state 652, playerpush]
type = playerpush
trigger1 = 1
value = 0

[state 652, velset]
type = velset
trigger1 = time = 0
y = ifelse(prevstateno = 3007,-14,-10)

[state 652, gravity]
type = gravity
trigger1 = pos y < -1

[state 652, end]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 653

;--------------------------------------------------------------------------
;Landing Rest
[statedef 653]
type    = C
movetype= I
physics = N
movehitpersist = 1
sprpriority = -2
ctrl = 0

[state 653, anim]
type = changeanim
trigger1 = time = 0
value = 652

[state 650, explod]
type = explod
trigger1 = time = 0
anim = 649
pos = 0,0
id = 652
scale = const(size.xscale),const(size.yscale)
postype = p1
bindtime = -1
ignorehitpause = 1
removetime = -2
sprpriority = 2
removeongethit = 1

[state 653, posset]
type = posset
trigger1 = time = 0
y = 0

[state 653, playerpush]
type = playerpush
trigger1 = 1
value = 0


[state 653, velset]
type = velset
trigger1 = time = 0
y = 0
x = 0

[state 653, snd]
type = playsnd
trigger1 = time = 0
value =S650,0

[state 653, earthquakes]
type = envshake
trigger1 = time = 0
time = 15
ampl = 12
freq = 100
phase = 100

[state 653, snack]
type = changestate
triggerall = animelemtime(3) >= 0
trigger1 = command = "x" || command = "y" || command = "holdx" || command = "holdy"
trigger1 = !ailevel
trigger2 = ailevel 
trigger2 = movehit
value = 1310

[state 653, end]
type = changestate
trigger1 = animtime = 0
value = 658



;-----------------------------------------------------------------------------
;Rode down
[statedef 655]
type = A
movetype = H
physics = N

[state 655, anim]
type = changeanim2
trigger1 = time = 0
value = 655

[State 655, 2]
type = changeState
trigger1 = !gethitvar(isbound)
value = 660


;==========================================================================
; Recovery Animations
;==========================================================================
; Butt Drop recovery
[statedef 657]
type = C
movetype = I
physics = C
anim = 657

[state 657, playerpush]
type = playerpush
trigger1 = 1
value = 0

[state 657, explod]
type = explod
trigger1 = time = 0
anim = 656
pos = 0,0
id = 657
scale = const(size.xscale),const(size.yscale)
postype = p1
bindtime = -1
ignorehitpause = 1
removetime = -2
sprpriority = 2
removeongethit = 1

[state 657, velset]
type = velset
trigger1 = animelemtime(2) >= 0 && animelemtime(5) < 0
x = 4

[state 657, velset]
type = velset
trigger1 = animelem = 5
x = 0

[state 657, velset]
type = velset
trigger1 = animelemtime(10) >= 0 && animelemtime(11) < 6
x = -8

[state 657, sprpriority]
type = sprpriority
trigger1 = animelem = 3
value = -1

[state 657, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1
;--------------------------------------------------------------------------

; Banzai Drop recovery
[statedef 658]
type = C
movetype = I
physics = C
anim = 658

[state 658, explod]
type = explod
trigger1 = time = 0
anim = 659
pos = 0,0
id = 658
scale = const(size.xscale),const(size.yscale)
postype = p1
bindtime = -1
ignorehitpause = 1
removetime = -2
sprpriority = 2
removeongethit = 1

[state 658, turn]
type = turn
trigger1 = time = 0

[state 658, velset]
type = velset
trigger1 = animelem = 8
x = 25

[state 657, playerpush]
type = playerpush
trigger1 = 1
value = 0

[state 658, sprpriority]
type = sprpriority
trigger1 = animelem = 1
value = -1

[state 658, turn]
type = turn
trigger1 = animtime = 0
persistent = 0

[state 658, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1


;===========================================================================
;---------------------------Crushed State-----------------------------------
;===========================================================================
; Moderate Crushed State
[statedef 660]
type    = L
movetype= H
physics = N
ctrl = 0
velset = 0,0

[state 660, 1]
type = changeanim
trigger1 = time = 0
value = 5080

[State 660, flatten]
type = AngleDraw
trigger1 = time > 0
value = 0
scale = 1.3,0.1

[state 660, on ground]
type = posset
trigger1 = 1
y = 0

[state 660, passthrough]
type = playerpush
trigger1 = 1
value = 0


[State 660, Width]
type = Width
trigger1 = time > 0
value = 0,0

[state 660, invunerable]
type = nothitby
trigger1 = 1
value = SCA


[State 660, 1] ;For hit up/up-diag type (from state 5081)
type = ChangeAnim
persistent = 0
trigger1 = SelfAnimExist(5110 + (anim % 10))
trigger1 = anim = [5081,5089]
value = 5110 + (anim % 10)

[State 660, 2] ;Hit ground anim (normal)
type = ChangeAnim
triggerall = time = 0
triggerall = anim != [5110,5119] ;Not already changed anim
trigger1 = anim != [5161,5169]
trigger2 = !SelfAnimExist(5170 + (anim % 10))
value = 5170

[State 660, 3] ;Hit ground anim (for hit up)
type = ChangeAnim
triggerall = time = 0
triggerall = anim != [5110,5119] ;Not already changed anim
trigger1 = anim = [5161,5169]
trigger1 = SelfAnimExist(5170 + (anim % 10))
value = 5170 + (anim % 10)


[State 660, 5]
type = PosSet
trigger1 = Time = 0
y = 0

[State 660, 7]
type = GameMakeAnim
trigger1 = Time = 0
trigger1 = !SysVar(0)
value = 60 + (sysvar(1) > 5) + (sysvar(1) > 14)
pos = 0, 0
under = sysvar(1) <= 10

[State 660, 8]
type = VelSet
trigger1 = Time = 0
y = 0

[State 660, 9] ;For hit up type
type = ChangeAnim
persistent = 0
triggerall = anim = [5171,5179]
triggerall = SelfAnimExist(5110 + (anim % 10))
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground anim
value = 5110 + (anim % 10)

[State 660, 10] ;For normal
type = ChangeAnim
persistent = 0
triggerall = Anim != [5111,5119]
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground frame
value = 5110

[State 660, 11] ;If just died
type = ChangeState
triggerall = !alive && p2stateno = 0 && roundstate = 3
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground frame
trigger3 = Anim = [5110,5119]
value = 5150

;[State 660, 12]
;type = VarSet
;trigger1 = SysVar(0)
;trigger1 = Time = 0
;sysvar(0) = 0

[State 660, 13] ;Friction
type = VelMul
trigger1 = 1
x = 0.85

[State 660, 14]
type = ForceFeedback
trigger1 = alive
trigger1 = Time = 0
time = 8
ampl = 240
waveform = sine

[State 660, 15]
type = ForceFeedback
trigger1 = !alive
trigger1 = Time = 0
ampl = 200, 7, -.467
time = 30
waveform = sine

[state 1108, nothitby]
type = nothitby
trigger1 = time = 140
value = SCA
time = 4

[State 660, get up]
type = selfstate
trigger1 = life >= 1
trigger1 = time > 150;95
value = 5120

[state 660, flat death]
type = changestate
trigger1 = !alive
trigger1 = time > 40
value = 5150

;---------------------------------------------------------------------------
;Brief Crushed State
[statedef 661]
type    = L
movetype= H
physics = N
ctrl = 0
velset = 0,0

[state 661, 1]
type = changeanim
trigger1 = time = 0
value = 5110

[State 661, flatten]
type = AngleDraw
trigger1 = time > 0
value = 0
scale = 1.3,0.1

[state 661, on ground]
type = posset
trigger1 = 1
y = 0

[state 661, passthrough]
type = playerpush
trigger1 = 1
value = 0
time = 600

[State 661, Width]
type = Width
trigger1 = time > 0
value = 0,0


[State 661, 1] ;For hit up/up-diag type (from state 5081)
type = ChangeAnim
persistent = 0
trigger1 = SelfAnimExist(5110 + (anim % 10))
trigger1 = anim = [5081,5089]
value = 5110 + (anim % 10)

[State 661, 2] ;Hit ground anim (normal)
type = ChangeAnim
triggerall = time = 0
triggerall = anim != [5110,5119] ;Not already changed anim
trigger1 = anim != [5161,5169]
trigger2 = !SelfAnimExist(5170 + (anim % 10))
value = 5170

[State 661, 3] ;Hit ground anim (for hit up)
type = ChangeAnim
triggerall = time = 0
triggerall = anim != [5110,5119] ;Not already changed anim
trigger1 = anim = [5161,5169]
trigger1 = SelfAnimExist(5170 + (anim % 10))
value = 5170 + (anim % 10)


[State 661, 5]
type = PosSet
trigger1 = Time = 0
y = 0

;[State 661, Var] ;Get fall velocity
;type = VarSet
;trigger1 = Time = 0
;trigger1 = GetHitVar(fall.yvel) != 0
;sysvar(1) = floor(vel y)

;[State 661, 6]
;type = PlaySnd
;trigger1 = Time = 0
;trigger1 = !SysVar(0)
;value = F7, 0 ;Hit ground
;value = F7, (sysvar(1) > 5) + (sysvar(1) > 14)
;persistent = 0

[State 661, 7]
type = GameMakeAnim
trigger1 = Time = 0
trigger1 = !SysVar(0)
value = 60 + (sysvar(1) > 5) + (sysvar(1) > 14)
pos = 0, 0
under = sysvar(1) <= 10

[State 661, 8]
type = VelSet
trigger1 = Time = 0
y = 0

[State 661, 9] ;For hit up type
type = ChangeAnim
persistent = 0
triggerall = anim = [5171,5179]
triggerall = SelfAnimExist(5110 + (anim % 10))
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground anim
value = 5110 + (anim % 10)

[State 661, 10] ;For normal
type = ChangeAnim
persistent = 0
triggerall = Anim != [5111,5119]
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground frame
value = 5110

[State 661, 11] ;If just died
type = ChangeState
triggerall = !alive && p2stateno = 0 && roundstate = 3
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground frame
trigger3 = Anim = [5110,5119]
value = 5150

;[State 661, 12]
;type = VarSet
;trigger1 = SysVar(0)
;trigger1 = Time = 0
;sysvar(0) = 0

[State 661, 13] ;Friction
type = VelMul
trigger1 = 1
x = 0.85

[State 661, 14]
type = ForceFeedback
trigger1 = alive
trigger1 = Time = 0
time = 8
ampl = 240
waveform = sine

[State 661, 15]
type = ForceFeedback
trigger1 = !alive
trigger1 = Time = 0
ampl = 200, 7, -.467
time = 30
waveform = sine

[State 661, get up]
type = selfstate
triggerall = life >= 1
trigger1 = time > 60
value = 5120

[state 660, flat death]
type = changestate
trigger1 = !alive
trigger1 = time > 40
value = 5150

;---------------------------------------------------------------------------
;Super Crushed State
[statedef 662]
type    = L
movetype= H
physics = N
ctrl = 0
velset = 0,0

[state 661, 1]
type = changeanim
trigger1 = time = 0
value = 5080

[State 661, flatten]
type = AngleDraw
trigger1 = time > 0
value = 0
scale = 1.3,0.1

[state 661, on ground]
type = posset
trigger1 = 1
y = 0

[state 661, passthrough]
type = playerpush
trigger1 = 1
value = 0


[State 661, Width]
type = Width
trigger1 = time > 0
value = 0,0


[State 661, 1] ;For hit up/up-diag type (from state 5081)
type = ChangeAnim
persistent = 0
trigger1 = SelfAnimExist(5110 + (anim % 10))
trigger1 = anim = [5081,5089]
value = 5110 + (anim % 10)

[State 661, 2] ;Hit ground anim (normal)
type = ChangeAnim
triggerall = time = 0
triggerall = anim != [5110,5119] ;Not already changed anim
trigger1 = anim != [5161,5169]
trigger2 = !SelfAnimExist(5170 + (anim % 10))
value = 5170

[State 661, 3] ;Hit ground anim (for hit up)
type = ChangeAnim
triggerall = time = 0
triggerall = anim != [5110,5119] ;Not already changed anim
trigger1 = anim = [5161,5169]
trigger1 = SelfAnimExist(5170 + (anim % 10))
value = 5170 + (anim % 10)


[State 661, 5]
type = PosSet
trigger1 = Time = 0
y = 0

;[State 661, Var] ;Get fall velocity
;type = VarSet
;trigger1 = Time = 0
;trigger1 = GetHitVar(fall.yvel) != 0
;sysvar(1) = floor(vel y)

;[State 661, 6]
;type = PlaySnd
;trigger1 = Time = 0
;trigger1 = !SysVar(0)
;value = F7, 0 ;Hit ground
;value = F7, (sysvar(1) > 5) + (sysvar(1) > 14)
;persistent = 0

[State 661, 7]
type = GameMakeAnim
trigger1 = Time = 0
trigger1 = !SysVar(0)
value = 60 + (sysvar(1) > 5) + (sysvar(1) > 14)
pos = 0, 0
under = sysvar(1) <= 10

[State 661, 8]
type = VelSet
trigger1 = Time = 0
y = 0

[State 661, 9] ;For hit up type
type = ChangeAnim
persistent = 0
triggerall = anim = [5171,5179]
triggerall = SelfAnimExist(5110 + (anim % 10))
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground anim
value = 5110 + (anim % 10)

[State 661, 10] ;For normal
type = ChangeAnim
persistent = 0
triggerall = Anim != [5111,5119]
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground frame
value = 5110

[State 661, 11] ;If just died
type = ChangeState
triggerall = !alive && p2stateno = 0 && roundstate = 3
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground frame
trigger3 = Anim = [5110,5119]
value = 5150

;[State 661, 12]
;type = VarSet
;trigger1 = SysVar(0)
;trigger1 = Time = 0
;sysvar(0) = 0

[State 661, 13] ;Friction
type = VelMul
trigger1 = 1
x = 0.85

[State 662, 14]
type = ForceFeedback
trigger1 = alive
trigger1 = Time = 0
time = 8
ampl = 240
waveform = sine

[State 662, 15]
type = ForceFeedback
trigger1 = !alive
trigger1 = Time = 0
ampl = 200, 7, -.467
time = 30
waveform = sine

[state 662, hitby]
type = hitby
trigger1 = time > 0
value = SCA, AA
ignorehitpause = 1

[State 662, get up]
type = selfstate
trigger1 = life >= 1
trigger1 = time > 110;95
value = 5120

[state 660, flat death]
type = changestate
trigger1 = !alive
trigger1 = time > 80
value = 5150


;---------------------------------------------------------------------------
;Winning Crushed State
[statedef 665]
type    = L
movetype= H
physics = N
ctrl = 0
velset = 0,0

[state 665, 1]
type = changeanim
trigger1 = time = 0
value = 5110

[state 665, scream]
type = playsnd
trigger1 = 1
value = 11,0
persistent = 0


[State 665, flatten]
type = AngleDraw
trigger1 = time > 0  && time <25
value = 0
scale = 1.3,0.1

[state 665, on ground]
type = posset
trigger1 = 1
y = 0

[state 665, passthrough]
type = playerpush
trigger1 = 1
value = 0
time = 600

[State 665, Width]
type = Width
trigger1 = time > 0
value = 0,0

[State 665, 5]
type = PosSet
trigger1 = Time = 0
y = 0

;[State 661, Var] ;Get fall velocity
;type = VarSet
;trigger1 = Time = 0
;trigger1 = GetHitVar(fall.yvel) != 0
;sysvar(1) = floor(vel y)

;[State 665, 6]
;type = PlaySnd
;trigger1 = Time = 0
;trigger1 = !SysVar(0)
;value = F7, 0 ;Hit ground
;value = F7, (sysvar(1) > 5) + (sysvar(1) > 14)
;persistent = 0

[State 665, 7]
type = GameMakeAnim
trigger1 = Time = 0
trigger1 = !SysVar(0)
value = 60 + (sysvar(1) > 5) + (sysvar(1) > 14)
pos = 0, 0
under = sysvar(1) <= 10

[State 665, 8]
type = VelSet
trigger1 = Time = 0
y = 0

[State 665, 9] ;For hit up type
type = ChangeAnim
persistent = 0
triggerall = anim = [5171,5179]
triggerall = SelfAnimExist(5110 + (anim % 10))
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground anim
value = 5110 + (anim % 10)

[State 665, 10] ;For normal
type = ChangeAnim
persistent = 0
triggerall = Anim != [5111,5119]
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground frame
value = 5110

[State 665, 11] ;If just died
type = ChangeState
triggerall = !alive && p2stateno = 0 && roundstate = 3
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground frame
trigger3 = Anim = [5110,5119]
value = 5150

;[State 661, 12]
;type = VarSet
;trigger1 = SysVar(0)
;trigger1 = Time = 0
;sysvar(0) = 0

[State 665, 13] ;Friction
type = VelMul
trigger1 = 1
x = 0.85

[State 665, 14]
type = ForceFeedback
trigger1 = alive
trigger1 = Time = 0
time = 8
ampl = 240
waveform = sine

[State 665, 15]
type = ForceFeedback
trigger1 = !alive
trigger1 = Time = 0
ampl = 200, 7, -.467
time = 30
waveform = sine

[state 665, hitby]
type = hitby
trigger1 = time > 0
value = SCA, AA
ignorehitpause = 1

[State 665, get up]
type = selfstate
triggerall = life >= 1
trigger1 = time > 600
value = 5120


[state 660, flat death]
type = changestate
trigger1 = !alive
trigger1 = time > 40
value = 5150
;---------------------------------------------------------------------------
;---------------------------------------------------------------------------
;===========================================================================
;------------------------------Wall Bounce State
;===========================================================================
[statedef 670]
type = A
movetype = H
physics = N

[State 672, Stop moving]
type = PosFreeze
trigger1 = 1
x = 1
y = 1

[state 670]
type = changeanim
trigger1 = time = 0
value = 5030
ignorehitpause = 1

[state 670, changestate]
type = changestate
trigger1 = hitshakeover
value = 671
;------------------------------------------------------------------------

[statedef 671]
type    = A
movetype= H
physics = N

[state 671, anim]
type = changeanim
trigger1 = anim != 5030
value = 5030

[State 670, Velocity]
type = velset
trigger1 = Time = 0
x = facing * gethitvar(xvel)
y = gethitvar(yvel)

[State 670, Gravity]
type = veladd
trigger1 = 1
y = 0.44

;[State 670, No scroll]
;type = ScreenBound
;triggerall = Pos y < -15
;trigger1 = BackEdgeBodyDist < 65
;trigger2 = FrontEdgeBodyDist < 65
;value = 1
;movecamera = 0,1

[State 670, Hit wall]
type = ChangeState
triggerall = Pos y < 0
trigger1 = BackEdgeBodyDist <= 20
trigger2 = FrontEdgeBodyDist <= 20
value = 672

[State 670, Hit ground]
type = SelfState
trigger1 = (Vel y > 0) && (Pos y >= 0)
value = 5100

;---------------------------------------------------------------------------
;Hit wall - part 2 bounce off wall
[statedef 672]
type    = A
movetype= H
physics = N

[State 672, Turn]
type = Turn
trigger1 = (Time = 0) && (FrontEdgeBodyDist <= 30)

[State 672, Pos]
type = PosAdd
trigger1 = Time = 0
x = 15 - BackEdgeBodyDist

[State 672, Stop moving]
type = PosFreeze
trigger1 = 1
x = 1
y = 1

[State 672, No scroll]
type = ScreenBound
trigger1 = 1
value = 1
movecamera = 0,1

[State 672, Spark]
type = Explod
trigger1 = Time = 1
anim = F72
pos = 0,const(size.mid.pos.y)
postype = p1
sprpriority = 3
ownpal = 1

[state 672, anim]
type = changeanim
trigger1 = anim != 5030
value = 5030

[State 672, Sound]
type = PlaySnd
trigger1 = Time = 1
value = F7,0

[State 672, State]
type = ChangeState
trigger1 = time = 10
value = 673
;--------------------------------------------------------------------------
;wall bounce - part 3 fall toward ground
[Statedef 673]
type    = A
movetype= H
physics = N

[State 673, Vel Y]
type = VelSet
trigger1 = Time = 0
y = -14

[State 673, Vel X]
type = VelSet
trigger1 = Time = 0
x = ceil(p2dist x*0.02)

[State 673, Turn]
type = Turn
trigger1 = (Time = 0) && (BackEdgeDist < 30)

[State 672, Gravity]
type = VelAdd
trigger1 = 1
y = 1.05

;[state 673, gravity]
;type = gravity
;trigger1 = 1

[State 673, Anim 5050] ;Self falling animation
type = ChangeAnim
trigger1 = Time = 0
trigger1 = !SelfAnimExist(5052)
value = 5050

[State 673, Anim 5052] ;Self falling animation (diagup type)
type = ChangeAnim
trigger1 = Time = 0
trigger1 = SelfAnimExist(5052)
value = 5052

[State 673, Anim 5060] ;Coming down - normal
type = ChangeAnim
trigger1 = Vel Y > -2
trigger1 = Anim = 5050
trigger1 = SelfAnimExist(5060)
persistent = 0
value = 5060

[State 673, Anim 5062] ;Coming down - diagup type
type = ChangeAnim
trigger1 = Vel Y > -2
trigger1 = Anim = 5052
trigger1 = SelfAnimExist(5062)
persistent = 0
value = 5062

[State 673, Hit ground]
type = SelfState
trigger1 = (Vel y > 0) && (Pos y >= 0)
value = 5100
;----------------------------------------------------------------------------

;Wall Bounce Splat
[statedef 675]
type = A
movetype = H
physics = N

[State 675, Stop moving]
type = PosFreeze
trigger1 = 1
x = 1
y = 1

[state 675]
type = changeanim
trigger1 = time = 0
value = 5030
ignorehitpause = 1

[state 670, changestate]
type = changestate
trigger1 = hitshakeover
value = 676
;------------------------------------------------------------------------

[statedef 676]
type    = A
movetype= H
physics = N

[state 676, anim]
type = changeanim
trigger1 = anim != 5030
value = 5030

[State 676, Velocity]
type = velset
trigger1 = Time = 0
x = facing * gethitvar(xvel)
y = gethitvar(yvel)

[State 676, Gravity]
type = veladd
trigger1 = 1
y = 0.44

;[State 670, No scroll]
;type = ScreenBound
;triggerall = Pos y < -15
;trigger1 = BackEdgeBodyDist < 65
;trigger2 = FrontEdgeBodyDist < 65
;value = 1
;movecamera = 0,1

[State 676, Hit wall]
type = ChangeState
triggerall = Pos y < 0
trigger1 = BackEdgeBodyDist <= 20
trigger2 = FrontEdgeBodyDist <= 20
value = 677

[State 670, Hit ground]
type = SelfState
trigger1 = (Vel y > 0) && (Pos y >= 0)
value = 5100

;---------------------------------------------------------------------------
;Hit wall - part 2 bounce off wall
[statedef 677]
type    = A
movetype= H
physics = N

[State 677, Turn]
type = Turn
trigger1 = (Time = 0) && (FrontEdgeBodyDist <= 30)

[State 677, Pos]
type = PosAdd
trigger1 = Time = 0
x = 15 - BackEdgeBodyDist

[State 677, Stop moving]
type = PosFreeze
trigger1 = 1
x = 1
y = 1

[State 677, No scroll]
type = ScreenBound
trigger1 = 1
value = 1
movecamera = 0,1

[State 677, Spark]
type = Explod
trigger1 = Time = 1
anim = F72
pos = 0,const(size.mid.pos.y)
postype = p1
sprpriority = 3
ownpal = 1

[state 677, anim]
type = changeanim
trigger1 = anim != 5030
value = 5030

[State 677, Sound]
type = PlaySnd
trigger1 = Time = 1
value = F7,0

[State 677, State]
type = ChangeState
trigger1 = time = 10
value = 678
;--------------------------------------------------------------------------
;wall bounce - part 3 fall toward ground
[Statedef 678]
type    = A
movetype= H
physics = N

[State 678, Vel Y]
type = VelSet
trigger1 = Time = 0
y = -14

[State 678, Vel X]
type = VelSet
trigger1 = Time = 0
x = 4

[State 678, Turn]
type = Turn
trigger1 = (Time = 0) && (BackEdgeDist < 30)

[State 678, Gravity]
type = VelAdd
trigger1 = 1
y = 1.05

;[state 673, gravity]
;type = gravity
;trigger1 = 1

[State 678, Anim 5050] ;Self falling animation
type = ChangeAnim
trigger1 = Time = 0
trigger1 = !SelfAnimExist(5052)
value = 5050

[State 678, Anim 5052] ;Self falling animation (diagup type)
type = ChangeAnim
trigger1 = Time = 0
trigger1 = SelfAnimExist(5052)
value = 5052

[State 678, Anim 5060] ;Coming down - normal
type = ChangeAnim
trigger1 = Vel Y > -2
trigger1 = Anim = 5050
trigger1 = SelfAnimExist(5060)
persistent = 0
value = 5060

[State 678, Anim 5062] ;Coming down - diagup type
type = ChangeAnim
trigger1 = Vel Y > -2
trigger1 = Anim = 5052
trigger1 = SelfAnimExist(5062)
persistent = 0
value = 5062

[State 673, Hit ground]
type = SelfState
trigger1 = (Vel y > 0) && (Pos y >= 0)
value = 5100


;-----------------------------------------------------------------------------
;Ground Bounce
;-----------------------------------------------------------------------------
;Hit Freeze small
[statedef 680]
type = A
movetype = H
physics = N

[State 680, Stop moving]
type = PosFreeze
trigger1 = 1
x = 1
y = 1

[state 680, posadd]
type = posadd
trigger1 = time = 0
y = -20

[state 680]
type = changeanim
trigger1 = time = 0
value = 5035
ignorehitpause = 1

[state 680, changestate]
type = changestate
trigger1 = hitshakeover
value = 681

;-----------------------------------------------------------------------------
;Soft Ground bounce - Going down
[statedef 681]
;Custom Hit state, ground bounce
type = A
movetype = H
physics = N


[state 681, velocity]
type = velset ;hitvelset
trigger1 = time = 0
y = 60

[state 681, anim]
type = changeanim
trigger1 = time = 0
value = 5061


[state 681, stop x]
type = velmul
trigger1 = time = 0
x = 0.25


[state 681]
type = veladd
trigger1 = 1
y = 1.05

[state 681, changestate]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 682

;-----------------------------------------------------------------------------
;Ground Bounce - Impact / bouncing
[statedef 682]
type = A
movetype = H
physics = N
anim = 5100

[state 682, impact]
type = velset
trigger1 = time = 0
y = 0
x = 0

[State 682, 8]
type = Explod
trigger1 = Time = 0
anim = F62 
pos = 0, 0
ontop = 1
scale = 1.7, 0.5
persistent = 0
ownpal = 1
persistent = 0

[State 682, 10]
type = PlaySnd
trigger1 = Time = 0
value = F7,2
persistent = 0

[state 682, shake]
type = envshake
trigger1 = time = 0
ampl = 5
freq = 50
phase = 50
time = 10
persistent = 0

[state 682, impact 2]
type = posset
trigger1 = time = 0
y = 0

[state 682, end]
type = changestate
trigger1 = animtime = 0
value = 683
;-----------------------------------------------
[statedef 683]
movetype = H
physics = N
anim = 5160

[state 683, bounce]
type = velset
trigger1 = time = 1
y = -20

[state 683, gravity]
type = veladd
trigger1 = time > 1
y = 1.05

[state 683, down]
type = selfstate
trigger1 = time >= 2 
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 5110
;--------------------------------------------------------------------------


;Hit Freeze big
[statedef 685]
type = A
movetype = H
physics = N

[State 685, Stop moving]
type = PosFreeze
trigger1 = 1
x = 1
y = 1

[state 685]
type = changeanim
trigger1 = time = 0
value = 5030
ignorehitpause = 1

[state 685, changestate]
type = changestate
trigger1 = hitshakeover
value = 686
;---------------------------------------------------------------------------
;Hard Ground bounce - going down
[statedef 686]
;Custom Hit state, ground bounce
type = A
movetype = H
physics = N


[state 686, anim]
type = changeanim
trigger1 = time = 0
value = 5160

[state 686, velocity]
type = hitvelset
trigger1 = time = 0
y = 60
x = -8


[state 686, stop x]
type = velmul
trigger1 = time = 0
x = 0


[state 686]
type = veladd
trigger1 = 1
y = 1.05

[state 686, changestate]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 687

;-----------------------------------------------------------------------------
;Hard Ground Bounce - Impact/bounce
[statedef 687]
type = A
movetype = H
physics = N
anim = 5160

[state 687, impact]
type = velset
trigger1 = time = 0
y = 0

[State 687, 8]
type = Explod
trigger1 = Time = 0
anim = F62 
pos = 0, 0
ontop = 1
scale = 2, 1
persistent = 0
ownpal = 1

[State 687, 10]
type = PlaySnd
trigger1 = Time = 0
value = F7,2
persistent = 0

[state 687, shake]
type = envshake
trigger1 = time = 0
ampl = 5
freq = 50
phase = 50
time = 10

[state 687, impact 2]
type = posset
trigger1 = time = 0
y = 0

[state 687, bounce]
type = velset
trigger1 = time = 1
y = -20

[state 687, gravity]
type = veladd
trigger1 = time > 1
y = 1.05

[state 687, down]
type = selfstate
trigger1 = time >= 2 
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 5100

;---------------------------------------------------------------------------




;---------------------------------------------------------------------------
; Throw Down

[Statedef 800]
type    = S
movetype= A
physics = S
juggle  = 0
velset = 0,0
ctrl = 0
anim = 800
poweradd = 15
sprpriority = 2

[State 800, 1]
type = HitDef
triggerall = p2movetype != A
Trigger1 = Time = 0
attr = S, NT          
hitflag = M-          
priority = 1, Miss   
sparkno = -1         
p1sprpriority = 2                 
p1facing = 1
p2facing = 1          
p1stateno = 810       
p2stateno = 820       
guard.dist = 0
id = 800        
fall = 1             
fall.recover = 0
fall.recovertime = 60
fall.yvelocity = -12
fall.xvelocity = -2

[State 800, 1]
type = HitDef
triggerall = p2movetype = A
Trigger1 = Time = 0
attr = S, NT          
hitflag = M-          
priority = 1, Miss   
sparkno = -1         
p1sprpriority = 2                 
p1facing = 1
p2facing = 1          
p1stateno = 810       
p2stateno = 822       
guard.dist = 0
id = 800        
fall = 1             
fall.recover = 0
fall.recovertime = 60
fall.yvelocity = -12
fall.xvelocity = -2

[State 800, 2]
type = ChangeState
Trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
;Grab Escape - p2
[statedef 805]
type = A
movetype = H
physics = S
ctrl = 0
facep2 = 1
sprpriority = 4

[state 805, anim]
type = changeanim
trigger1 = time = 0
trigger1 = SelfAnimExist(805)
value = 805

[state 805, anim]
type = changeanim
trigger1 = time = 0
trigger1 = !selfanimexist(805)
value = 120

;[state 1400, dim]
;type = bgpalfx
;trigger1 = time = 0
;time = 8
;mul = 200,200,200

;[state 805, freeze]
;type = pause
;trigger1 = time = 0
;time = 8
;endcmdbuftime = 8

;[state 805, sound]
;type = playsnd
;trigger1 = time = 0
;value = S805,0

[state 805, pos y]
type = posset
trigger1 = time = 0
y = 0

[state 805, velset]
type = velset
trigger1 = time = 10
x= -24

[state 805, nothitby]
type = nothitby
trigger1 = 1
value = SCA

[state 805, end]
type = selfstate
trigger1 = time = 35
value = 0
ctrl = 1

;---------------------------------------------------------------------------
;Grab Escape - p1
[statedef 806]
type = A
movetype = H
physics = S
ctrl = 0

[state 805, anim]
type = changeanim
trigger1 = time = 0
trigger1 = SelfAnimExist(130)
value = 130

[state 805, anim]
type = changeanim
trigger1 = time = 0
trigger1 = !selfanimexist(805)
value = 130

[state 1400, dim]
type = bgpalfx
trigger1 = time = 0
time = 8
mul = 200,200,200

[state 805, freeze]
type = pause
trigger1 = time = 0
time = 12
endcmdbuftime = 8

[state 805, sound]
type = playsnd
trigger1 = time = 0
value = S805,0

[state 805, pos y]
type = posset
trigger1 = time = 0
y = 0

[state 805, turn]
type = turn
trigger1 = prevstateno = 820
trigger1 = time = 0
persistent = 0
ignorehitpause

[state 805, velset]
type = velset
trigger1 = time = 10
x= -24

[state 805, nothitby]
type = nothitby
trigger1 = 1
value = SCA

[state 805, end]
type = selfstate
trigger1 = time = 35
value = 0
ctrl = 1
;---------------------------------------------------------------------------
;Kung Fu Throw - Throwing the opponent
[Statedef 810]
type    = S
movetype= A
physics = S
anim = 810
poweradd = 0

[State 810, Grab Sound]
type = PlaySnd
trigger1 = AnimElem = 2
value = 1, 1

[State 810, Holding Direction?]
type = VarSet
trigger1 = Time = 0
var(2) = command = "holdback"

[state 810, tech]
type = changestate
triggerall = numtarget
trigger1 = target(800),stateno = 805
value = 806
persistent = 1

[State 810, all]
type = Width
trigger1 = 1
edge = 230,160

[State 810, Throw Sound]
type = PlaySnd
trigger1 = AnimElem = 7
value = 800, 0

[State 810, Bind 1]
type = TargetBind
trigger1 = AnimElemTime(2) < 0
pos = 180, 0

[State 810, Bind 2]
type = TargetBind
trigger1 = AnimElemTime(2) >= 0 && AnimElemTime(3) < 0
pos = 180, 10

[State 810, Bind 3]
type = TargetBind
trigger1 = AnimElemTime(3) >= 0 && AnimElemTime(4) < 0
pos = 140, -40

[state 810, vel]
type = velset
trigger1 = animelem = 3
x = 10

[state 810, sprpriority]
type = sprpriority
trigger1 = animelem = 3
value = -2

[State 810, Bind 4]
type = TargetBind
trigger1 = AnimElemTime(4) >= 0 && AnimElemTime(5) < 0
pos = 0, -220

[State 810, Bind 5]
type = TargetBind
trigger1 = AnimElemTime(5) >= 0 && AnimElemTime(6) < 0
pos = -60, -230

[State 810, holdfwd - Turn 6] ;If was holding fwd before, turn now
type = Turn
trigger1 = var(2)
trigger1 = AnimElem = 6

[State 810, holdfwd - Pos 6] ;If was holding fwd before, move a little
type = PosAdd
trigger1 = var(2)
trigger1 = AnimElemtime(6) = 6
x = -37

[State 810, holdfwd - Turn Target 6] ;If was holding fwd before, turn target too
type = TargetFacing
trigger1 = var(2)
trigger1 = AnimElem = 6
value = -1


[State 810, Bind 6]
type = TargetBind
trigger1 = AnimElemTime(6) >= 0 && AnimElemTime(7) < 0
pos = -60, -250

[State 810, Bind 7]
type = TargetBind
trigger1 = AnimElemTime(7) >= 0 && AnimElemTime(8) < 0
pos = 30, -180

[State 810, Bind 8]
type = TargetBind
trigger1 = AnimElemTime(8) >= 0 && AnimElemTime(9) < 0
pos = 200, -40

[State 810, Hurt 11]
type = TargetLifeAdd
trigger1 = AnimElem = 8
value = -140

[State 810, Hurt 11]
type = TargetpowerAdd
trigger1 = AnimElem = 8
persistent = 0
value = 100

[state x, combo damage score]
type = varadd
trigger1 = animelem = 9
v = 18
value = -18
persistent = 0
ignorehitpause = 1

[State 810, Throw 11]
type = TargetState
trigger1 = AnimElem = 9
value = 821

[state 821, ground shake]
type = envshake
trigger1 = enemy,vel y > 0
trigger1 = enemy,pos y > -vel y
time = 18
ampl = -10
persistent = 60


[state 821, playsnd]
type = playsnd
trigger1 = enemy,vel y > 0
trigger1 = enemy,pos y > -vel y
value = S650,0

[state x, combo dampener]
type = varadd
trigger1 = animtime = 0
v = 18
value = -18
persistent = 0
ignorehitpause =1 

[State 810, State End]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
;Techable
[Statedef 820]
type    = A
movetype= H
physics = N
velset = 0,0

[state 820, tech throw]
type = changestate
triggerall = time < 12
trigger1 = ailevel = 0
trigger1 = command = "holdfwd" || command = "holdback"
trigger1 = command = "y" || command = "b" || command = "z" || command = "c"
trigger2 = command = "x" && command = "a"
trigger3 = ailevel > 4 
trigger3 = random < ailevel * ifelse(ailevel>6,1,3)
value = 805

[State 820, 1]
type = ChangeAnim2
Trigger1 = Time = 0
value = 820

[state 810, screenbound]
type = screenbound
trigger1 = 1
movecamera = 1,0
value = 0

[State 820, 2]
type = SelfState
trigger1 = !gethitvar(isbound)
value = 5050

;---------------------------------------------------------------------------
;Untechable
[Statedef 822]
type    = A
movetype= H
physics = N
velset = 0,0

[State 820, 1]
type = ChangeAnim2
Trigger1 = Time = 0
value = 820

[state 810, screenbound]
type = screenbound
trigger1 = 1
movecamera = 1,0
value = 0

[State 820, 2]
type = SelfState
trigger1 = !gethitvar(isbound)
value = 5050

;---------------------------------------------------------------------------
;Thrown by Kung Fu Throw - thrown into the air
; (a custom gethit state)
; Description: This state has the opponent flying through the air and
;     falling down onto the ground. The SelfState controller sets the
;     opponent back using to his own state file when he his the ground.
;     Controllers 821,2 and 821,3 allow the opponent to recover by
;     hitting his recovery command when he is falling.
[Statedef 821]
type    = A
movetype= H
physics = N
velset = -14,24
poweradd = 40

[State 821, 1] ;Gravity
type = VelAdd
Trigger1 = 1
y = .4

;[state 821, ground shake]
;type = envshake
;trigger1 = vel y > 0
;trigger1 = pos y > -vel y
;time = 18
;ampl = -8
;freq = 100
;phase = 100

;[state 821, playsnd]
;type = playsnd
;trigger1 = vel y > 0
;trigger1 = pos y > -vel y
;value = S20,0

[State 821, 2] ; Recover near ground (use ChangeState)
type = ChangeState
triggerall = Vel Y > 0
triggerall = Pos Y >= -20
triggerall = alive
triggerall = CanRecover
trigger1 = Command = "recovery"
value = 5200 ;HITFALL_RECOVER

[State 821, 3] ; Recover in mid air (use SelfState)
type = SelfState
triggerall = Vel Y > 0
triggerall = alive
triggerall = CanRecover
trigger1 = Command = "recovery"
value = 5210 ;HITFALL_AIRRECOVER

[State 821, 4] ;Hit ground
type = SelfState
trigger1 = Vel Y > 0
trigger1 = Pos Y >= 0
value = 5100 ;Hit ground

;===========================================================================
; Special Moves
;===========================================================================
;Sumo Palms L
[statedef 1000]
type = S
movetype = A
physics = S
velset = 0,0
poweradd = 65
ctrl = 0

[state 1000, no autoturn]
type = assertspecial
trigger1 = 1
flag = noautoturn
ignorehitpause

;===========
;Armor start
;===========
[state 410, animation]
type = changeanim
trigger1 = anim != 1000
value = 1000

[state 1000, armor counter]
type = varset
trigger1 = time = 0
trigger1 = Var(21) = 1
V = 20
value = 2

[state x, armor over]
type = varset
trigger1 = animelem = 8
v = 20
value = 0
ignorehitpause = 1

[state 1000, armor intiator turn off]
type = varset
trigger1 = time = 1
V = 21
value = 0

;determine what frame
[state 1000, remember frame]
type = varset
trigger1 = time <= 0
v = 22
value = animelemno(0)
ignorehitpause = 1

;delay effect
[state 1000, delay]
type = changeanim 
trigger1 = var(31) < floor(gethitvar(hittime)*1.1)
value = anim
elem = var(22)
ignorehitpause

[state 1000, freeze location]
type = posfreeze
trigger1 = var(31) < floor(gethitvar(hittime)*1.1)
value = 1
ignorehitpause
;--------------------------

[state 1000, still take damage]
type = lifeadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) != 0
value = floor(-gethitvar(damage))
persistent = 1

[state 1000, armor count down]
type = varadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) > 0
V = 20
value = - 1
persistent = 1

[state 1000, Unstoppable]
type = hitoverride
trigger1 = Life > 1
trigger1 = Var(20) > 0
trigger1 = animelemtime(2) >= 0 && animelemtime(8) < 0
attr = SCA, AA, AP
stateno = 1000
time = 1
persistent = 1

[State 1000, flash red]
type = PalFX
trigger1 = Time = 0
trigger1 = gethitvar(damage) != 0
time = 7
add = 100,0,0
IgnoreHitPause = 1

;---
;Armor End
;---

[state 1000, velset]
type = velset
trigger1 = animelemtime(8) < 0
x = 5
persistent = 1
ignorehitpause = 1

[state 1000, quake]
type = envshake
trigger1 = animelemtime(3) = 1
trigger2 = animelemtime(7) = 1
time = 10
ampl = 4
freq = 80
phase = 100

[state 20, sound1]
type = playsnd
trigger1 = animelemtime(3) = 1
trigger2 = animelemtime(7) = 1
value = S20,0


[State 1000, 2]
type = HitDef
trigger1 = AnimElem = 3
persistent = 0
attr = S, SA
animtype  = Heavy
damage    = 40,4
guardflag = MA
hitflag = MAF
id = 1000
nochainid = 1000
pausetime = 4,4
sparkno = 1
sparkxy = -40,-200
hitsound   = S5000,1
guardsound = S120, 0
ground.type = High
ground.slidetime = 30
ground.hittime  = 30
ground.velocity = -12
air.velocity = -4,-7
air.hittime = 27
guard.dist = 420
guard.hittime = 25
guard.slidetime = 25
guard.velocity = -14
guard.kill = 0
fall.recover = 0

[State 1000, 2]
type = HitDef
trigger1 = AnimElem = 7
persistent = 0
attr = S, SA
animtype  = Heavy
damage    = 40,4
guardflag = MA
hitflag = MAF
id = 1001
nochainid = 1001
guard.pausetime = 8,8
pausetime = 12,12
envshake.ampl = 8
envshake.time = 14
sparkno = 1
sparkxy = -40,-200
hitsound   = S5000,1
guardsound = S120, 0
ground.type = High
ground.slidetime = 25
ground.hittime  = 25
air.hittime = 27
ground.velocity = -12
air.velocity = -4,-7
guard.dist = 420
guard.hittime = 29
guard.slidetime = 29
guard.velocity = -15
guard.kill = 1
fall.recover = 0
fall.recovertime = 60

[state x, combo damage score]
type = varadd
trigger1 = movehit
v = 18
value = -6
persistent = 0
ignorehitpause = 1

[state 1000, next part]
type = changestate
triggerall = command != "Super"
trigger1 = command = "holdx" || command = "holdy"
trigger1 = animelemtime(8) > 0
value = 1003
persistent = 1

[state 1000, next part]
type = changestate
trigger1 = command = "holda" || command = "holdb"
trigger1 = animelemtime(8) > 0
value = 1005
persistent = 1

[state 1000, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1
;---------------------------------------------------------------------------
;Follow Up Part  Overhead
[statedef 1003]
type = S
movetype = A
physics = S
ctrl = 0
anim = 1003

[state 1003, snd]
type = playsnd
trigger1 = time = 4
value = 0,2

[state 1003, velocity]
type = velset
trigger1 = animelemtime(4) < 0
x = 15

[State 1003, 2]
type = HitDef
trigger1 = AnimElem = 4
persistent = 0
attr = S, SA
animtype  = Heavy
damage    = 100,ifelse(enemy,statetype = A,30,20)
guardflag = HA
Hitflag = MAF
pausetime = 12,ifelse(enemy,name="Bertha Hippo",16,12)
sparkno = 3
sparkxy = -40,-170
hitsound = S5000, 2
guardsound = S120, 0
ground.type = Low
ground.slidetime = 20
ground.hittime  = 20
ground.velocity = -5,30
air.velocity = -1,30
guard.dist = 420
guard.hittime = 16
guard.slidetime = 16
guard.velocity = -14
airguard.hittime = 20
airguard.velocity = -10,4
guard.kill = 1
Fall = 1
fall.recovertime = 30
fall.recover = 1
down.bounce = 1
fall.yvelocity = -10
fall.xvelocity = -2

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -6
persistent = 0
ignorehitpause = 1

[state 1003, Not Active]
type = statetypeset
trigger1 = animelemtime(5) = 0
movetype = I

[state 1003, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1

;--------------------------------------------------------------------------
;Sweep
[Statedef 1005]
type    = S
movetype= A
physics = N
poweradd= 7
ctrl = 0
anim = 1005


[State 1005, 2]
type = PlaySnd
trigger1 = Time = 2
value = 0, 2

[state 1005, velset]
type = velset
trigger1 = animelemtime(2) > 0 && animelemtime(5) < 0
x = 20

[state 1005, velset]
type = statetypeset
trigger1 = animelem = 5
physics = S

[State 1005, 3]
type = HitDef
trigger1 = Time = 0
attr = S, SA
damage    = 60,6
hitflag = MAFD
guardflag = L
pausetime = 12,12
sparkno = 1
sparkxy = -5,-10
hitsound   = S5000,1
guardsound = S120, 0
ground.type = Trip
ground.slidetime = 16
ground.hittime  = 16
ground.velocity = -9,-6
air.velocity = -9,-6
down.velocity = -16,-8
guard.velocity = -12
guard.hittime = 18
guard.slidetime = 18
guard.velocity = -8
fall = 1
fall.recover = 0

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -6
persistent = 0
ignorehitpause = 1

[state 1005, Not Active]
type = statetypeset
trigger1 = animelemtime(6) = 0
movetype = I

[State 1005, 4]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
;Sumo Palms H
[statedef 1010]
type = S
movetype = A
physics = S
velset = 0,0
poweradd = 65
ctrl = 0

[state 1010, no autoturn]
type = assertspecial
trigger1 = 1
flag = noautoturn
ignorehitpause = 1
persistent = 1

;===========
;Armor start
;===========
[state 1010, animation]
type = changeanim
trigger1 = anim != 1010
value = 1010

[state 1010, armor counter]
type = varset
trigger1 = time = 0
trigger1 = Var(21) = 1
V = 20
value = 2

[state x, armor over]
type = varset
trigger1 = animelem = 16
v = 20
value = 0
ignorehitpause = 1 

[state 1010, armor intiator turn off]
type = varset
trigger1 = time = 1
V = 21
value = 0

;determine what frame
[state 1010, remember frame]
type = varset
trigger1 = time <= 0
v = 22
value = animelemno(0)
ignorehitpause = 1


;delay effect
[state 1010, delay]
type = changeanim 
trigger1 = var(31) < floor(gethitvar(hittime)*0.9)
value = anim
elem = var(22)

[state 1010, freeze location]
type = posfreeze
trigger1 = var(31) < floor(gethitvar(hittime)*0.9)
value = 1


;--------------------------

[state 1010, still take damage]
type = lifeadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) != 0
value = floor(-gethitvar(damage))
persistent = 1

[state 1010, armor count down]
type = varadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) > 0
V = 20
value = - 1
persistent = 1

[state 1010, Unstoppable]
type = hitoverride
trigger1 = Life > 1
trigger1 = Var(20) > 0
trigger1 = animelemtime(2) >= 0 && animelemtime(16) < 0
attr = SCA, AA, AP
stateno = 1010
time = 1
persistent = 1

[State 1010, flash red]
type = PalFX
trigger1 = Time = 0
trigger1 = gethitvar(damage) != 0
time = 7
add = 100,0,0
IgnoreHitPause = 1

;---
;Armor End
;---



[state 1010, velset]
type = velset
trigger1 = animelemtime(16) < 0
x = 7
persistent = 1
ignorehitpause = 1

[state 1010, quake]
type = envshake
trigger1 = animelemtime(3) = 0
trigger2 = animelemtime(7) = 0
trigger3 = animelemtime(11) = 0
trigger4 = animelemtime(15) = 0
time = 10
ampl = 4
freq = 80
phase = 100

[state 1010, sound1]
type = playsnd
trigger1 = animelemtime(3) = 0
trigger2 = animelemtime(7) = 0
trigger3 = animelemtime(11) = 0
trigger4 = animelemtime(15) = 0
value = S20,0


[State 1010, 2]
type = HitDef
trigger1 = animelem = 3
attr = S, SA
animtype  = Heavy
persistent = 0
damage    = 30,3
id = 1010
nochainid = 1010
guardflag = MA
hitflag = MAF
pausetime = 4,4
sparkno = 1
sparkxy = -40,-200
hitsound   = S5000,1
guardsound = S120, 0
ground.type = High
ground.slidetime = 30
ground.hittime  = 30
ground.velocity = -12
air.velocity = -4,-7
air.hittime = 27
guard.dist = 420
guard.hittime = 25
guard.slidetime = 25
guard.velocity = -14
guard.kill = 0
fall.recover = 0

[State 1000, 2]
type = HitDef
trigger1 = animelem = 7
persistent = 0
attr = S, SA
animtype  = Heavy
damage    = 30,3
id = 1011
nochainid = 1011
guardflag = MA
hitflag = MAF
pausetime = 4,4
sparkno = 1
sparkxy = -40,-200
hitsound   = S5000,1
guardsound = S120, 0
ground.type = High
ground.slidetime = 30
ground.hittime  = 30
air.hittime = 36
ground.velocity = -12
air.velocity = -4,-7
guard.dist = 420
guard.hittime = 25
guard.slidetime = 25
guard.velocity = -14
guard.kill = 0

[State 1000, 2]
type = HitDef
trigger1 = animelem = 11
attr = S, SA
animtype  = Heavy
persistent = 0
damage    = 30,3
id = 1012
nochainid = 1012
guardflag = MA
hitflag = MAF
pausetime = 4,4
sparkno = 1
sparkxy = -40,-200
hitsound   = S5000,1
guardsound = S120, 0
ground.type = High
ground.slidetime = 30
ground.hittime  = 30
air.hittime = 36
ground.velocity = -12
air.velocity = -4,-7
guard.dist = 420
guard.hittime = 25
guard.slidetime = 25
guard.velocity = -14
guard.kill = 0

[State 1010, 2]
type = HitDef
trigger1 = AnimElem = 15
attr = S, SA
animtype  = Heavy
persistent = 0
damage    = 30,3
id = 1013
nochainid = 1013
guardflag = MA
hitflag = MAF
guard.pausetime = 8,8
pausetime = 12,12
envshake.ampl = 8
envshake.time = 14
sparkno = 1
sparkxy = -40,-200
hitsound   = S5000,1
guardsound = S120, 0
ground.type = High
ground.slidetime = 28
ground.hittime  = 28
air.hittime = 27
ground.velocity = -12
air.velocity = -4,-7
guard.dist = 420
guard.hittime = 32
guard.slidetime = 32
guard.velocity = -14
guard.kill = 1
fall.recover = 0
fall.recovertime = 60

[state x, combo damage score]
type = varadd
trigger1 = movehit
v = 18
value = -6
persistent = 0
ignorehitpause = 1

[state 1010, next part]
type = changestate
triggerall = command != "Super"
trigger1 = command = "holdx" || command = "holdy"
trigger1 = animelemtime(16) > 0
value = 1013
persistent = 1

[state 1010, next part]
type = changestate
trigger1 = command = "holda" || command = "holdb"
trigger1 = animelemtime(16) > 0
value = 1015
persistent = 1

[state 1010, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
;2nd Part
[statedef 1013]
type = S
movetype = A
physics = S
ctrl = 0
anim = 1013

[state 1013, snd]
type = playsnd
trigger1 = time = 4
value = 0,2

[state 1013, velocity]
type = velset
trigger1 = animelemtime(4) < 0
x = 20

[State 1013, 2]
type = HitDef
trigger1 = AnimElem = 4
persistent = 0
attr = S, SA
animtype  = Heavy
damage    =  100,ifelse(enemy,statetype = A,30,20)
guardflag = HA
Hitflag = MAF
pausetime = 12,ifelse(enemy,name="Bertha Hippo",16,12)
sparkno = 3
sparkxy = -10,-170
hitsound = S5000, 2
guardsound = S120, 0
ground.type = Low
ground.slidetime = 20
ground.hittime  = 20
ground.velocity = -15,30
air.velocity = -10,30
guard.dist = 420
guard.hittime = 16
guard.slidetime = 16
guard.velocity = -14
airguard.hittime = 28
airguard.velocity = -10,-4
guard.kill = 1
Fall = 1
fall.recover = 1
fall.recovertime = 30
fall.yvelocity = -10
fall.xvelocity = -2

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -6
persistent = 0
ignorehitpause = 1

[state 1013, Not Active]
type = statetypeset
trigger1 = animelemtime(5) = 0
movetype = I

[state 1013, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1


;---------------------------------------------------------------------------
[Statedef 1015]
type    = C
movetype= A
physics = C
ctrl = 0
anim = 1015


[State 1015, 2]
type = PlaySnd
trigger1 = Time = 2
value = 0, 2

[state 1015, velset]
type = velset
trigger1 = animelemtime(2) > 0 && animelemtime(5) < 0
x = 24

[state 1015, velset]
type = statetypeset
trigger1 = animelem = 5
physics = S

[State 1015, 3]
type = HitDef
trigger1 = Time = 0
attr = S, SA
damage    = 60,6
hitflag = MAFD
guardflag = L
pausetime = 12,12
sparkno = 1
sparkxy = -5,-10
hitsound   = S5000,1
guardsound = S120, 0
ground.type = Trip
ground.slidetime = 16
ground.hittime  = 16
ground.velocity = -9,-6
air.velocity = -9,-6
down.velocity = -16,-8
guard.velocity = -12
guard.hittime = 20
guard.slidetime = 20
guard.velocity = -8
fall = 1
fall.recover = 0

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -6
persistent = 0
ignorehitpause = 1

[state 1015, Not Active]
type = statetypeset
trigger1 = animelemtime(6) = 0
movetype = I

[State 1015, 4]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
;Sumo Palms EX
[statedef 1020]
type = S
movetype = A
physics = S
ctrl = 0
velset = 0,0

[State 1020, Blink Yellow]
type = PalFX
trigger1 = time%2
time = 1
add = 150,75,0 ;32,16,0
sinadd = 64,32,5,3
ignorehitpause

[state 1020, no autoturn]
type = assertspecial
trigger1 = 1
flag = noautoturn
ignorehitpause

[state 1020, invun]
type = nothitby
trigger1 = time < 12
value = SCA


;===========
;Armor start
;===========
[state 1020, animation]
type = changeanim
trigger1 = anim != 1020
value = 1020

[state 1020, armor counter]
type = varset
trigger1 = time = 0
trigger1 = Var(21) = 1
trigger1 = prevstateno != 1020
V = 20
value = 3

[state 1020, poweradd]
type = poweradd
trigger1 = time = 1
trigger1 = prevstateno != 1020
value = -500
persistent = 0

[state x, armor over]
type = varset
trigger1 = animelem = 16
v = 20
value = 0
ignorehitpause 

[state 1020, armor intiator turn off]
type = varset
trigger1 = time = 1
V = 21
value = 0

;determine what frame
[state 1020, remember frame]
type = varset
trigger1 = time <= 0
v = 22
value = animelemno(0)
ignorehitpause = 1

;delay effect
[state 1020, delay]
type = changeanim 
trigger1 = var(31) < floor(gethitvar(hittime)*0.9)
value = anim
elem = var(22)
ignorehitpause

[state 1020, freeze location]
type = posfreeze
trigger1 = var(31) < floor(gethitvar(hittime)*0.9)
value = 1
ignorehitpause
;--------------------------

[state 1020, still take damage]
type = lifeadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) != 0
value = floor(-gethitvar(damage))
persistent = 1

[state 1020, armor count down]
type = varadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) > 0
V = 20
value = - 1
persistent = 1

[state 1020, Unstoppable]
type = hitoverride
trigger1 = Life > 1
trigger1 = Var(20) > 0
trigger1 = animelemtime(2) >= 0 && animelemtime(8) < 0
attr = SCA, AA, AP
stateno = 1020
time = 1
persistent = 1

[State 1020, flash red]
type = PalFX
trigger1 = Time = 0
trigger1 = gethitvar(damage) != 0
time = 7
add = 100,0,0
IgnoreHitPause = 1

;---
;Armor End
;---



[state 1020, velset]
type = velset
trigger1 = animelemtime(8) < 0
x = 9
persistent = 1
ignorehitpause = 1

[state 1020, quake]
type = envshake
trigger1 = animelemtime(3) = 0
trigger2 = animelemtime(7) = 0
time = 10
ampl = 4
freq = 80
phase = 100

[state 1020, sound1]
type = playsnd
trigger1 = animelemtime(3) = 0
trigger2 = animelemtime(7) = 0
value = S20,0


[State 1020, 2]
type = HitDef
trigger1 = animelem = 3
persistent = 0
attr = S, SA
animtype  = Heavy
damage    = 30,3
id = 1020
nochainid = 1020
getpower = 0
guardflag = MA
hitflag = MAF
pausetime = 4,4
sparkno = 2
sparkxy = -40,-200
hitsound = S5000, 2
guardsound = S120, 0
ground.type = High
ground.slidetime = 28
ground.hittime  = 28
ground.velocity = -12
air.velocity = -4,-6
guard.dist = 420
guard.hittime = 25
guard.slidetime = 25
guard.velocity = -14
guard.kill = 0
fall.recover = 0

[State 1020, 2]
type = HitDef
trigger1 = animelem = 7
persistent = 0
attr = S, SA
animtype  = Heavy
damage    = 30,3
id = 1021
nochainid = 1021
getpower = 0
guardflag = MA
hitflag = MAF
guard.pausetime = 8,8
pausetime = 12,9
envshake.ampl = 8
envshake.time = 14
sparkno = 2
sparkxy = -40,-200
hitsound = S5000, 2
guardsound = S120, 0
ground.type = High
ground.slidetime = 28
ground.hittime  = 28
ground.velocity = -12
air.velocity = -4,-6
guard.dist = 420
guard.hittime = 30
guard.slidetime = 30
guard.velocity = -14
guard.kill = 0
fall.recover = 0


[state x, combo damage score]
type = varadd
trigger1 = time = 0
v = 18
value = -9
persistent = 0
ignorehitpause = 1

[state 1020, next part]
type = changestate
trigger1 = command = "holdx" || command = "holdy"
trigger1 = animelemtime(8) > 0
value = 1023
persistent = 1

[state 1010, next part]
type = changestate
trigger1 = command = "holda" || command = "holdb"
trigger1 = animelemtime(8) > 0
value = 1025
persistent = 1

[state 1020, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
;2nd Part  OVERHEAD
[statedef 1023]
type = S
movetype = A
physics = S
ctrl = 0
anim = 1023

[state 1003, snd]
type = playsnd
trigger1 = time = 4
value = 0,2

[state 1003, velocity]
type = velset
trigger1 = animelemtime(4) < 0
x = 25

[State 1020, Blink Yellow]
type = PalFX
trigger1 = time%2
time = 1
add = 150,75,0 ;32,16,0
sinadd = 64,32,5,3
ignorehitpause

[state 1020, no autoturn]
type = assertspecial
trigger1 = 1
flag = noautoturn

[State 1023, 2]
type = HitDef
trigger1 = AnimElem = 4
persistent = 0
attr = S, SA
animtype  = Heavy
damage    =  100,ifelse(enemy,statetype = A,30,20)
guardflag = HA
Hitflag = MAF
getpower = 0
pausetime = 12,ifelse(enemy,name="Bertha Hippo",16,12)
sparkno = 3
sparkxy = -10,-170
hitsound = S5000, 2
guardsound = S120, 0
id = 1023
ground.type = Low
ground.slidetime = 18
ground.hittime  = 18
ground.velocity = -1,30
air.velocity = -1,30
guard.dist = 420
guard.hittime = 21
guard.slidetime = 21
guard.velocity = -14
airguard.hittime = 20
airguard.velocity = -12,4
guard.kill = 1
down.bounce = 1
fall.xvelocity = -1
fall.yvelocity = -9
Fall = 1
fall.recover = 1
fall.recovertime = 30

[state 1023, targetstate]
type = targetstate
triggerall = var(8) > 0
trigger1 = movehit
trigger1 = hitpausetime = 11
value = 680
ignorehitpause = 1

[state 1023, varadd]
type = varadd
trigger1 = movehit
var(8) = -1
ignorehitpause = 1
persistent = 0

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -9
persistent = 0
ignorehitpause = 1

[state 1023, Not Active]
type = statetypeset
trigger1 = animelemtime(5) = 0
movetype = I

[state 1000, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
;2ND PART sweep
[Statedef 1025]
type    = C
movetype= A
physics = C
ctrl = 0
anim = 1025

[State 1025, 2]
type = PlaySnd
trigger1 = Time = 2
value = 0, 2

[State 1020, Blink Yellow]
type = PalFX
trigger1 = time%2
time = 1
add = 150,75,0 ;32,16,0
sinadd = 64,32,5,3
ignorehitpause

[state 1020, no autoturn]
type = assertspecial
trigger1 = 1
flag = noautoturn

[state 1015, velset]
type = velset
trigger1 = animelemtime(2) > 0 && animelemtime(5) < 0
x = 27

[state 1015, velset]
type = statetypeset
trigger1 = animelem = 5
physics = S


[State 1025, 3]
type = HitDef
trigger1 = Time = 0
attr = S, SA
damage    = 60,6
hitflag = MAFD
guardflag = L
getpower = 0
pausetime = 12,12
sparkno = 1
sparkxy = -5,-10
hitsound   = S5000,1
guardsound = S120, 0
ground.type = Trip
ground.slidetime = 20
ground.hittime  = 20
ground.velocity = ifelse(var(6) > 1,0,-8),ifelse(var(6) > 1, -16, -4)
air.velocity = ifelse(var(6) > 1,0,-8),ifelse(var(6) > 1, -16, -4)
down.velocity = 0,-24
guard.velocity = -12
guard.hittime = 19
guard.slidetime = 19
guard.velocity = -8
fall = 1
fall.recover = 0
guard.dist = 640

[state 1023, varadd]
type = varadd
trigger1 = movehit
var(6) = -1
ignorehitpause = 1
persistent = 0

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -9
persistent = 0
ignorehitpause = 1

[state 1025, Not Active]
type = statetypeset
trigger1 = animelemtime(6) = 0
movetype = I

[State 1025, 4]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;===========================================================================
;  Bear Hug
;===========================================================================
[Statedef 1100]
type = C
movetype = I
physics = N
poweradd = 50
ctrl = 0
velset = 0,0

[state 1101, nothitby]
type = nothitby
trigger1 = 1
value = ,AP

[state 1101, sprpriority]
type = sprpriority
trigger1 = 1
value = ifelse(p2bodydist x > -10, -1, 2)
persistent = 1

;===========
;Armor start
;===========
[state 1100, animation]
type = changeanim
trigger1 = anim != 1100
value = 1100

[state 1100, armor counter]
type = varset
trigger1 = time = 0
trigger1 = Var(21) = 1
V = 20
value = 1

[state 410, armor intiator turn off]
type = varset
trigger1 = time = 1
V = 21
value = 0

[state 1100, power]
type = poweradd
trigger1 = time%10
value = 2

;determine what frame
[state 410, remember frame]
type = varset
trigger1 = time <= 0
v = 22
value = animelemno(0)
ignorehitpause = 1

;delay effect
[state 1100, delay]
type = changeanim 
trigger1 = var(31) < floor(gethitvar(hittime)*0.75)
value = anim
elem = var(22)

[state 1100, freeze location]
type = posfreeze
trigger1 = var(31) < floor(gethitvar(hittime)*0.75)
value = 1
;--------------------------

[state 1100, still take damage]
type = lifeadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) != 0
value = floor(-gethitvar(damage)*0.75)
persistent = 1

[state 1100, armor count down]
type = varadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) > 0
V = 20
value = - 1
persistent = 1

[state 1100, Unstoppable]
type = hitoverride
trigger1 = Life > 1
trigger1 = Var(20) > 0
attr = SC, AA, AP
stateno = 1100
time = 1
persistent = 1

[State 410, flash red]
type = PalFX
trigger1 = Time = 0
trigger1 = gethitvar(damage) != 0
time = 7
add = 100,0,0
IgnoreHitPause = 1

;---
;Armor End
;---


[State 1101, 1]
type = HitDef
Trigger1 = 0;animelem = 2
attr = S, ST          
hitflag = M-        
priority = 1, Miss   
sparkno = -1         
p1sprpriority = -2
p2sprpriority = 1                
p1facing = 1
p2facing = 1          
p1stateno = 1102       
p2stateno = 1130       
guard.dist = 0        
fall = 1             
fall.recover = 0
fall.recovertime = 60
fall.yvelocity = -12
fall.xvelocity = -2

[state 1100, end]
type = changestate
triggerall = animelemtime(4) >= 0 
trigger1 = ailevel = 0
trigger1 = command != "holdx" && command != "holdy" && command != "holdz"
trigger2 = ailevel > 0
trigger2 = var(26)=1
value = 1101
persistent = 1


[state 1100, cancel]
type = changestate
triggerall = animelemtime(4) >= 0 
trigger1 = command = "a" || command = "b"
trigger1 = ailevel = 0
trigger2 = ailevel > 0
trigger2 = var(26) = 2
trigger3 = roundstate = 3
trigger4 = time > 600
value = 1109


;---------------------------------------------------------------------------
[statedef 1101]
type = S
movetype = A
physics = N
anim = 1101
velset = 0,0

[State 1101, 4]
type = EnvShake
trigger1 = time = 0
time = 12
ampl = -4
freq = 100
phase = 100

[state 1101, nothitby]
type = nothitby
trigger1 = animelemtime(2) < 0
value = ,AP
ignorehitpause

[state 1101, playerpush off]
type = null
trigger1 = animelemtime(2) > 0 && animelemtime(5) < 0
value = 0

[state 1101, playerpush on]
type = playerpush
trigger1 = animelem = 5
value = 1


[state 1121, nothitby]
type = nothitby
trigger1 = animelemtime(2) >= 0 && animelemtime(5) < 0
value = ,AT
ignorehitpause = 1

[state 1101, velset]
type = velset
trigger1 = animelem = 2
trigger2 = animelem = 3
x = 16

[state 1101, skid]
type = statetypeset
trigger1 = animelem = 4
physics = S

[state 1101, 4]
type = playsnd
trigger1 = time = 1
value = S20,0
volume = 50

[state 1101, 4]
type = playsnd
trigger1 = animelem = 2
value = S1100,1
volume = 100

[State 1101, 1]
type = HitDef
Trigger1 = animelem = 3
trigger1 = p2stateno != [150,155]
attr = S, ST          
hitflag = M- 
persistent = 0           
priority = 1, Miss   
sparkno = -1         
p1sprpriority = -2
p2sprpriority = 1                
p1facing = 1
p2facing = 1          
p1stateno = 1102       
p2stateno = 1130       
guard.dist = 0        
fall = 1             
fall.recover = 0
fall.recovertime = 60
fall.yvelocity = -12
fall.xvelocity = -2

[state 1101, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
;Bear Hug
[statedef 1102]
type = S
movetype = A
physics = S
velset = 0,0
anim = 1102
poweradd = 125
ctrl = 0

[state 1102, confirm hit sndfx]
type = playsnd
trigger1 = time = 0
value = S1100,2

[state 1102, confirm hit sndfx]
type = playsnd
trigger1 = time = 0
value = S1100,2

[state 1102, explod]
type = explod
trigger1 = time = 0
anim = 1103
pos = 0,0
id = 1100
scale = const(size.xscale),const(size.yscale)
postype = p1
bindtime = -1
ignorehitpause = 1
removetime = -2
sprpriority = 2
removeongethit = 1


[State 810, Lift frame 1]
type = TargetBind
trigger1 = AnimElemTime(2) < 0
pos = 140, -40

[State 810, Lift Frame 2]
type = TargetBind
trigger1 = AnimElemTime(2) >= 0 && AnimElemTime(3) < 0
pos = 140, -20

[State 810, Bear Hug start frame 3]
type = TargetBind
trigger1 = AnimElemTime(3) >= 0 && AnimElemTime(4) < 0
pos = 60, -220

[State 810, bear hug frame 4]
type = TargetBind
trigger1 = AnimElemTime(4) >= 0 && AnimElemTime(5) < 0
pos = 45, -220

[State 810, bear hug frame 5]
type = TargetBind
trigger1 = AnimElemTime(5) >= 0 && AnimElemTime(6) < 0
pos = 30, -220

[State 810, bear hug frame 6]
type = TargetBind
trigger1 = AnimElemTime(6) >= 0 && AnimElemTime(7) < 0
pos = 45, -220

[State 810, Bind 7]
type = TargetBind
trigger1 = AnimElemTime(7) >= 0 && AnimElemTime(8) < 0
pos = 60, -220

[State 810, Bind 8]
type = TargetBind
trigger1 = AnimElemTime(8) >= 0 && AnimElemTime(9) < 0
pos = 45, -220

[State 810, Bind 9]
type = TargetBind
trigger1 = AnimElemTime(9) >= 0 && AnimElemTime(10) < 0
pos = 30, -220

[State 810, Bind 10]
type = TargetBind
trigger1 = AnimElemTime(10) >= 0 && AnimElemTime(11) < 0
pos = 30, -220

[State 810, Bind 11]
type = TargetBind
trigger1 = AnimElemTime(11) >= 0 && AnimElemTime(12) < 0
pos = 30, -140


[State 810, Hurt 11]
type = TargetLifeAdd
trigger1 = AnimElemtime(5) > 0 && AnimElemtime(6) < 0
persistent = 2
value = ceil(ifelse(prevstateno=1100,-15,-15)*fvar(10))
kill = 0

[state 1102, hitcount add]
type = hitadd
trigger1 = animelem = 5
trigger2 = animelem = 9
value = 1

[State 810, Hurt 11]
type = TargetLifeAdd
trigger1 = AnimElemtime(9) > 0 && AnimElemtime(10) < 0
persistent = 2
value = ceil(ifelse(prevstateno=1100,-15,-15)*fvar(10))
kill = 0

[State 810, Hurt 11]
type = TargetLifeAdd
trigger1 = AnimElemtime(10) = 1
value = ceil(ifelse(prevstateno=1100,-20,-20)*fvar(10))

[State 810, Hurt 11]
type = TargetpowerAdd
trigger1 = AnimElemtime(10) = 1
persistent = 0
value = 200


[state  1102, snd]
type = playsnd
trigger1 = animelem = 5
trigger2 = animelem = 9
persistent = 1
value = S1100,0


[State 1102, Throw 11]
type = TargetState
trigger1 = Animelem =12
value = 1131

[state 1102, slide back]
type = velset
triggerall = frontedgebodydist < 130
trigger1 = animelemtime(13) > 0 && animelemtime(17) < 0
x = -30

[state 1102, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1


;---------------------------------------------------------------------------
;Bear Hug Cancel
[statedef 1109]
type = C
movetype = I
physics = C
anim = 1109
ctrl = 0

[state 1109, nothitby]
type = nothitby
trigger1 = 1
value = ,AP

[state 1109, power refund]
type = poweradd
trigger1 = time = 0
trigger1 = prevstateno = 1120
value = 400
persistent = 0

[State 1020, Blink Yellow]
type = PalFX
trigger1 = time%2
time = 1
add = 100,100,100 ;32,16,0
sinadd = 64,64,64,3
ignorehitpause

[state 1109, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1
;---------------------------------------------------------------------------
;Heavy Bear Hug
[Statedef 1110]
type = C
movetype = I
physics = N
poweradd = 50
ctrl = 0
velset = 0,0

[state 1101, nothitby]
type = nothitby
trigger1 = 1
value = ,AP
ignorehitpause = 1

[state 1100, power]
type = poweradd
trigger1 = time%10
value = 2

[state 1101, sprpriority]
type = sprpriority
trigger1 = 1
value = ifelse(p2bodydist x > -10, -1, 2)
persistent = 1

;===========
;Armor start
;===========
[state 1100, animation]
type = changeanim
trigger1 = anim != 1110
value = 1110

[state 1100, armor counter]
type = varset
trigger1 = Var(21) = 1
trigger1 = time = 0
V = 20
value = 2

[state 1100, armor intiator turn off]
type = varset
trigger1 = time = 1
V = 21
value = 0

;determine what frame
[state 1100, remember frame]
type = varset
trigger1 = time <= 0
v = 22
value = animelemno(0)
ignorehitpause = 1

;delay effect
[state 1100, delay]
type = changeanim 
trigger1 = var(31) < floor(gethitvar(hittime)*0.5)
value = anim
elem = var(22)

[state 1100, freeze location]
type = posfreeze
trigger1 = var(31) < floor(gethitvar(hittime)*0.5)
value = 1
;--------------------------

[state 1100, still take damage]
type = lifeadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) != 0
value = floor(-gethitvar(damage)*0.75)
persistent = 1

[state 1100, armor count down]
type = varadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) > 0
V = 20
value = - 1
persistent = 1

[state 1100, Unstoppable]
type = hitoverride
trigger1 = Life > 1
trigger1 = Var(20) > 0
attr = SC, AA, AP
stateno = 1110
time = 1
persistent = 1

[State 1100, flash red]
type = PalFX
trigger1 = Time = 0
trigger1 = gethitvar(damage) != 0
time = 7
add = 100,0,0
IgnoreHitPause = 1

;---
;Armor End
;---

[State 1111, 1]
type = HitDef
Trigger1 = 0;animelem = 2
attr = S, ST          
hitflag = M-          
priority = 1, Miss   
sparkno = -1         
p1sprpriority = -2
p2sprpriority = 1                
p1facing = 1
p2facing = 1          
p1stateno = 1112       
p2stateno = 1132       
guard.dist = 0        
fall = 1             
fall.recover = 0
fall.recovertime = 60
fall.yvelocity = -12
fall.xvelocity = -2

[state 1100, end]
type = changestate
triggerall = animelemtime(4) >= 0 
trigger1 = command != "holdx" && command != "holdy" && command != "holdz"
trigger1 = ailevel = 0
trigger2 = ailevel > 0
trigger2 = var(26) = 1
value = 1111


[state 1100, cancel]
type = changestate
triggerall = animelemtime(4) >= 0 
trigger1 = command = "a" || command = "b"
trigger1 = ailevel = 0
trigger2 = ailevel > 0
trigger2 = var(26) = 2
trigger3 = roundstate = 3
trigger4 = time > 600
value = 1109

;---------------------------------------------------------------------------
[statedef 1111]
type = S
movetype = A
physics = N
anim = 1111
velset = 0,0

[State 1101, 4]
type = EnvShake
trigger1 = time = 0
time = 12
ampl = -4
freq = 100
phase = 100

[state 1111, nothitby]
type = nothitby
trigger1 = animelemtime(2) < 0
value = ,AP
ignorehitpause

[state 1121, nothitby]
type = null
trigger1 = animelemtime(2) >= 0 && animelemtime(5) < 0
value = ,AT
ignorehitpause = 1

[state 1101, playerpush off]
type = playerpush
trigger1 = animelemtime(2) > 0 && animelemtime(5) < 0
value = 0

[state 1101, playerpush on]
type = playerpush
trigger1 = animelem = 5
value = 1

[state 1111, velset]
type = velset
trigger1 = animelem = 2
trigger2 = animelem = 3
x = 20

[state 1111, skid]
type = statetypeset
trigger1 = animelem = 4
physics = S

[state 1111, 4]
type = playsnd
trigger1 = time = 0
value = S20,0
volume = 50

[state 1111, 4]
type = playsnd
trigger1 = animelem = 2
value = S1100,1
volume = 100

[State 1111, 1]
type = HitDef
Trigger1 = animelem = 3
trigger1 = (p2stateno != [150,155])
attr = S, ST          
hitflag = M-
persistent = 0           
priority = 1, Miss   
sparkno = -1         
p1sprpriority = -2
p2sprpriority = 1                
p1facing = 1
p2facing = 1          
p1stateno = 1112       
p2stateno = 1132       
guard.dist = 0        
fall = 1             
fall.recover = 0
fall.recovertime = 60
fall.yvelocity = -12
fall.xvelocity = -2

[state 1111, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
;Bear Hug
[statedef 1112]
type = S
movetype = A
physics = S
velset = 0,0
poweradd = 125
anim = 1112
ctrl = 0

[state 1102, confirm hit sndfx]
type = playsnd
trigger1 = time = 0
value = S1100,2

[state 1102, confirm hit sndfx]
type = playsnd
trigger1 = time = 0
value = S1100,2

[state 1112, explod]
type = explod
trigger1 = time = 0
anim = 1113
pos = 0,0
id = 1110
scale = const(size.xscale),const(size.yscale)
postype = p1
bindtime = -1
ignorehitpause = 1
removetime = -2
sprpriority = 2
removeongethit = 1


[State 810, Lift frame 1]
type = TargetBind
trigger1 = AnimElemTime(2) < 0
pos = 140, -40

[State 810, Lift Frame 2]
type = TargetBind
trigger1 = AnimElemTime(2) >= 0 && AnimElemTime(3) < 0
pos = 140, -20

[State 810, Bear Hug start frame 3]
type = TargetBind
trigger1 = AnimElemTime(3) >= 0 && AnimElemTime(4) < 0 ;3
trigger2 = AnimElemTime(8) >= 0 && AnimElemTime(9) < 0 ;8
trigger3 = animelemtime(13) >= 0 && animelemtime(14) < 0 ;13
pos = 60, -220
persistent = 1

[State 810, bear hug frame 4]
type = TargetBind
trigger1 = AnimElemTime(4) >= 0 && AnimElemTime(5) < 0 ;4
trigger2 = AnimElemTime(7) >= 0 && AnimElemTime(8) < 0 ;7
trigger3 = AnimElemTime(9) >= 0 && AnimElemTime(10) < 0 ;9
trigger4 = animelemtime(12) >= 0 && animelemtime(13) < 0 ;12
trigger5 = animelemtime(11) >= 0 && animelemtime(12) < 0 ;11
trigger6 = animelemtime(14) >= 0 && animelemtime(15) < 0 ;14
pos = 45, -220
persistent = 1

[State 810, bear hug frame 5]
type = TargetBind 
trigger1 = AnimElemTime(5) >= 0 && AnimElemTime(7) < 0 ;5-7
trigger2 = AnimElemTime(10) >= 0 && AnimElemTime(12) < 0 ;10-12
trigger3 = animelemtime(15) >= 0 && animelemtime(17) < 0 ;15-17
pos = 30, -220
persistent = 1

[State 810, Bind 11]
type = TargetBind
trigger1 = AnimElemtime(17) >= 0 && animelemtime(18) < 0
pos = 30, -120
persistent = 1


[State 810, Hurt 11]
type = TargetLifeAdd
trigger1 = AnimElemtime(5) > 0 && AnimElemtime(6) < 0
persistent = 2
value = ceil(ifelse(prevstateno=1110,-10,-10)*fvar(10))
kill = 0

[State 810, Hurt 11]
type = TargetLifeAdd
trigger1 = AnimElemtime(10) > 0 && AnimElemtime(11) < 0
persistent = 2
value = ceil(ifelse(prevstateno=1110,-10,-10)*fvar(10))
kill = 0

[State 810, Hurt 11]
type = TargetLifeAdd
trigger1 = AnimElemtime(15) > 0 && AnimElemtime(16) < 0
persistent = 2
value = ceil(ifelse(prevstateno=1110,-10,-10)*fvar(10))
kill = 0

[State 810, Hurt 11]
type = TargetLifeAdd
trigger1 = AnimElemtime(17) = 1 
value = ceil(ifelse(prevstateno=1110,-50,-50)*fvar(10))

[State 810, Hurt 11]
type = TargetpowerAdd
trigger1 = AnimElemtime(17) = 1
persistent = 0
value = 250

[state 1102, hitcount add]
type = hitadd
trigger1 = animelem = 5
trigger2 = animelem = 10
trigger3 = animelem = 15
value = 1

[state  1102, snd]
type = playsnd
trigger1 = animelem = 5
trigger2 = animelem = 10
trigger3 = animelem = 15
persistent = 1
value = S1100,0

[state 1102, slide back]
type = velset
triggerall = frontedgebodydist < 130
trigger1 = animelemtime(18) > 0 && animelemtime(22) < 0
x = -20


[State 1102, Throw 18]
type = TargetState
trigger1 = Animelem = 18
value = 1133

[state 1102, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1


;---------------------------------------------------------------------------
;EX Bear Hug, Wall Bounce
[Statedef 1120]
type = C
movetype = I
physics = N
poweradd = -500
ctrl = 0
velset = 0,0

[State 1020, Blink Yellow]
type = PalFX
trigger1 = time%2
time = 1
add = 150,75,0 ;32,16,0
sinadd = 64,32,5,3
ignorehitpause

[state 1120, nothitby]
type = nothitby
trigger1 = 1
value = ,AP,AT

[state 1120, sprpriority]
type = sprpriority
trigger1 = 1
value = ifelse(p2bodydist x > -10, -1, 2)
persistent = 1

;===========
;Armor start
;===========
[state 1120, animation]
type = changeanim
trigger1 = anim != 1100
value = 1100

[state 1120, armor counter]
type = varset
trigger1 = time = 0
trigger1 = Var(21) = 1
V = 20
value = 1

[state 1120, armor intiator turn off]
type = varset
trigger1 = time = 1
V = 21
value = 0

[state 1120, power]
type = poweradd
trigger1 = time%10
value = 2

;determine what frame
[state 1120, remember frame]
type = varset
trigger1 = time <= 0
v = 22
value = animelemno(0)
ignorehitpause = 1

;delay effect
[state 1120, delay]
type = changeanim 
trigger1 = var(31) < floor(gethitvar(hittime)*0.75)
value = anim
elem = var(22)

[state 1120, freeze location]
type = posfreeze
trigger1 = var(31) < floor(gethitvar(hittime)*0.75)
value = 1
;--------------------------

[state 1120, still take damage]
type = lifeadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) != 0
value = floor(-gethitvar(damage)*0.75)
persistent = 1

[state 1120, armor count down]
type = varadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) > 0
V = 20
value = - 1
persistent = 1

[state 1120, Unstoppable]
type = hitoverride
trigger1 = Life > 1
trigger1 = Var(20) > 0
attr = SC, AA, AP
stateno = 1120
time = 1
persistent = 1

[State 1120, flash red]
type = PalFX
trigger1 = Time = 0
trigger1 = gethitvar(damage) != 0
time = 7
add = 100,0,0
IgnoreHitPause = 1

;---
;Armor End
;---


[State 1120, 1]
type = HitDef
Trigger1 = 0;animelem = 2
attr = S, ST          
hitflag = M-          
priority = 1, Miss   
sparkno = -1  
getpower = 0       
p1sprpriority = -2
p2sprpriority = 1                
p1facing = 1
p2facing = 1          
p1stateno = 1122       
p2stateno = 1130       
guard.dist = 0        
fall = 1             
fall.recover = 0
fall.recovertime = 60
fall.yvelocity = -12
fall.xvelocity = -2


[state 1120, end]
type = changestate
triggerall = animelemtime(4) >= 0 
trigger1 = ailevel = 0
trigger1 = command != "holdx" && command != "holdy" && command != "holdz"
trigger2 = ailevel > 0
trigger2 = var(26) = 1
value = 1121
persistent = 1


[state 1120, cancel]
type = changestate
triggerall = animelemtime(4) >= 0 
trigger1 = command = "a" || command = "b" || command = "c"
trigger1 = ailevel = 0
trigger2 = ailevel > 0
trigger2 = var(26) = 2
trigger3 = roundstate = 3
trigger4 = time > 600
value = 1109


;---------------------------------------------------------------------------
[statedef 1121]
type = S
movetype = A
physics = N
anim = 1101
velset = 0,0

[State 1121, 4]
type = EnvShake
trigger1 = time = 0
time = 12
ampl = -4
freq = 100
phase = 100

[State 1120, Blink Yellow]
type = PalFX
trigger1 = time%2
time = 1
add = 150,75,0 ;32,16,0
sinadd = 64,32,5,3
ignorehitpause

[state 1121, nothitby]
type = nothitby
trigger1 = animelemtime(2) < 0
value = ,AP,AT
ignorehitpause

[state 1121, nothitby]
type = nothitby
trigger1 = animelemtime(2) >= 0 && animelemtime(5) < 0
value = ,AT
ignorehitpause = 1

[state 1101, playerpush off]
type = null
trigger1 = animelemtime(2) > 0 && animelemtime(5) < 0
value = 0

[state 1101, playerpush on]
type = playerpush
trigger1 = animelem = 5
value = 1

[state 1101, velset]
type = velset
trigger1 = animelem = 2
trigger2 = animelem = 3
x = 24

[state 1121, skid]
type = statetypeset
trigger1 = animelem = 4
physics = S

[state 1121, 4]
type = playsnd
trigger1 = time = 1
value = S20,0
volume = 50

[state 1121, 4]
type = playsnd
trigger1 = animelem = 2
value = S1100,1
volume = 100

[State 1121, 1]
type = HitDef
Trigger1 = animelem = 3
trigger1 = p2stateno != [150,155]
attr = S, ST          
hitflag = M
persistent = 0           
priority = 1, Miss   
sparkno = -1  
id = 1120       
p1sprpriority = -2
p2sprpriority = 1                
p1facing = 1
p2facing = 1          
p1stateno = 1122       
p2stateno = 1130       
guard.dist = 0        
fall = 1             
fall.recover = 0
fall.recovertime = 60
fall.yvelocity = -12
fall.xvelocity = -2

[state 1121, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
;Bear Hug
[statedef 1122]
type = S
movetype = A
physics = S
velset = 0,0
anim = 1102
ctrl = 0

[State 1122, Blink Yellow]
type = PalFX
trigger1 = time < 12
time = 1
add = 150,75,0 ;32,16,0
sinadd = 64,32,5,3
ignorehitpause
persistent = 2

[state 1122, confirm hit sndfx]
type = playsnd
trigger1 = time = 0
value = S1100,2

[state 1122, confirm hit sndfx]
type = playsnd
trigger1 = time = 0
value = S1100,2

[state 1122, explod]
type = explod
trigger1 = time = 0
anim = 1103
pos = 0,0
id = 1100
scale = const(size.xscale),const(size.yscale)
postype = p1
bindtime = -1
ignorehitpause = 1
removetime = -2
sprpriority = 2
removeongethit = 1


[State 1122, Lift frame 1]
type = TargetBind
trigger1 = AnimElemTime(2) < 0
pos = 140, -40

[State 1122, Lift Frame 2]
type = TargetBind
trigger1 = AnimElemTime(2) >= 0 && AnimElemTime(3) < 0
pos = 140, -20

[State 1122, Bear Hug start frame 3]
type = TargetBind
trigger1 = AnimElemTime(3) >= 0 && AnimElemTime(4) < 0
pos = 60, -220

[State 1122, bear hug frame 4]
type = TargetBind
trigger1 = AnimElemTime(4) >= 0 && AnimElemTime(5) < 0
pos = 45, -220

[State 1122, bear hug frame 5]
type = TargetBind
trigger1 = AnimElemTime(5) >= 0 && AnimElemTime(6) < 0
pos = 30, -220

[State 1122, bear hug frame 6]
type = TargetBind
trigger1 = AnimElemTime(6) >= 0 && AnimElemTime(7) < 0
pos = 45, -220

[State 1122, Bind 7]
type = TargetBind
trigger1 = AnimElemTime(7) >= 0 && AnimElemTime(8) < 0
pos = 60, -220

[State 1122, Bind 8]
type = TargetBind
trigger1 = AnimElemTime(8) >= 0 && AnimElemTime(9) < 0
pos = 45, -220

[State 1122, Bind 9]
type = TargetBind
trigger1 = AnimElemTime(9) >= 0 && AnimElemTime(10) < 0
pos = 30, -220

[State 1122, Bind 10]
type = TargetBind
trigger1 = AnimElemTime(10) >= 0 && AnimElemTime(11) < 0
pos = 30, -220

[State 1122, Bind 11]
type = TargetBind
trigger1 = AnimElemTime(11) >= 0 && AnimElemTime(12) < 0
pos = 30, -140


[State 1122, Hurt 11]
type = TargetLifeAdd
trigger1 = AnimElemtime(5) > 0 && AnimElemtime(6) < 0
persistent = 2
value = ceil(ifelse(prevstateno=1120,-15,-15)*fvar(10))
kill = 0

[state 1122, hitcount add]
type = hitadd
trigger1 = animelem = 5
trigger2 = animelem = 9
value = 1

[State 1122, Hurt 11]
type = TargetLifeAdd
trigger1 = AnimElemtime(9) > 0 && AnimElemtime(10) < 0
persistent = 2
value = ceil(ifelse(prevstateno=1120,-15,-15)*fvar(10))
kill = 0

[State 1122, Hurt 11]
type = TargetLifeAdd
trigger1 = AnimElemtime(10) = 1
value = ceil(ifelse(prevstateno=1120,0,-40)*fvar(10))

[State 1122, Hurt 11]
type = TargetpowerAdd
trigger1 = AnimElemtime(10) = 1
persistent = 0
value = 200


[state 1122, snd]
type = playsnd
trigger1 = animelem = 5
trigger2 = animelem = 9
persistent = 1
value = S1100,0

[state x, combo damage score]
type = varadd
trigger1 = time = 0
v = 18
value = -18
persistent = 0
ignorehitpause = 1


[state 1122, hitdef for throw distance]
type = hitdef
trigger1 = 1
attr = S,ST
ground.velocity = -30,-10


[State 1122, Throw 11]
type = TargetState
trigger1 = Animelem =12
value = 1135

[state 1122, slide back]
type = velset
triggerall = frontedgebodydist < 130
trigger1 = animelemtime(13) > 0 && animelemtime(17) < 0
x = -30

[state 1122, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1







;---------------------------------------------------------------------------
;Light Bear Hugged
[Statedef 1130]
type    = A
movetype= H
physics = N
velset = 0,0

[State 1130, 1]
type = ChangeAnim2
Trigger1 = Time = 0
value = 1130

[state 810, screenbound]
type = screenbound
trigger1 = 1
movecamera = 1,0
value = 0

[State 810, Bind 2]
type = angledraw
trigger1 = AnimElemTime(3) >= 0 && AnimElemTime(5) < 0
trigger2 = AnimElemTime(6) >= 0 && AnimElemTime(9) < 0
value = -15

[State 810, Bind 2]
type = angledraw
trigger1 = AnimElemTime(5) >= 0 && AnimElemTime(6) < 0
trigger2 = AnimElemTime(9) >= 0 && AnimElemTime(11) < 0
value = -30

[State 1130, 2]
type = SelfState
trigger1 = !gethitvar(isbound)
value = 5050

;---------------------------------------------------------------------------
;Thrown Light
[Statedef 1131]
type    = A
movetype= H
physics = N
velset = -28,10
poweradd = 40

[State 1131, 1] ;Gravity
type = VelAdd
Trigger1 = 1
y = 0.44

[state 810, screenbound]
type = screenbound
trigger1 = 1
movecamera = 1,0
value = 0

[State 1131, 2] 
type = ChangeState
triggerall = Vel Y > 0
triggerall = Pos Y >= -20
triggerall = alive
triggerall = CanRecover
trigger1 = Command = "recovery"
value = 5200 

[State 1131, 3] 
type = SelfState
triggerall = Vel Y > 0
triggerall = alive
triggerall = CanRecover
trigger1 = Command = "recovery"
value = 5210 

[State 1131, 4] ;Hit ground
type = SelfState
trigger1 = Vel Y > 0
trigger1 = Pos Y >= 0
value = 5100 
;---------------------------------------------------------------------------
;Heavy Bear Hugged
[Statedef 1132]
type    = A
movetype= H
physics = N
velset = 0,0

[State 1130, 1]
type = ChangeAnim2
Trigger1 = Time = 0
value = 1132

[state 810, screenbound]
type = screenbound
trigger1 = 1
movecamera = 1,0
value = 0

[State 810, Bind 2]
type = angledraw
trigger1 = AnimElemTime(3) >= 0 && AnimElemTime(5) < 0
trigger2 = AnimElemTime(6) >= 0 && AnimElemTime(9) < 0
value = -15

[State 810, Bind 2]
type = angledraw
trigger1 = AnimElemTime(5) >= 0 && AnimElemTime(6) < 0
trigger2 = AnimElemTime(9) >= 0 && AnimElemTime(10) < 0
trigger3 = AnimElemTime(13) >= 0 && AnimElemTime(14) < 0
value = -30

[State 1130, 2]
type = SelfState
trigger1 = !gethitvar(isbound)
value = 5050

;---------------------------------------------------------------------------
;Hard Thrown
[Statedef 1133]
type    = A
movetype= H
physics = N
velset = -24,10
poweradd = 40

[State 1131, 1] ;Gravity
type = VelAdd
Trigger1 = 1
y = 0.4

[State 1131, 2] 
type = ChangeState
triggerall = Vel Y > 0
triggerall = Pos Y >= -20
triggerall = alive
triggerall = CanRecover
trigger1 = Command = "recovery"
value = 5200 

[State 1131, 3] 
type = SelfState
triggerall = Vel Y > 0
triggerall = alive
triggerall = CanRecover
trigger1 = Command = "recovery"
value = 5210 

[State 1131, 4] ;Hit ground
type = SelfState
trigger1 = Vel Y > 0
trigger1 = Pos Y >= 0
value = 5100 

;---------------------------------------------------------------------------
;ex thrown
[Statedef 1134]
type    = A
movetype= H
physics = N
velset = 0,0

[State 1134, 1]
type = ChangeAnim2
Trigger1 = Time = 0
value = 1132

[State 810, Bind 2]
type = angledraw
trigger1 = AnimElemTime(3) >= 0 && AnimElemTime(5) < 0
trigger2 = AnimElemTime(6) >= 0 && AnimElemTime(9) < 0
value = -15

[State 810, Bind 2]
type = angledraw
trigger1 = AnimElemTime(5) >= 0 && AnimElemTime(6) < 0
trigger2 = AnimElemTime(9) >= 0 && AnimElemTime(10) < 0
trigger3 = AnimElemTime(13) >= 0 && AnimElemTime(14) < 0
value = -30

[State 810, Bind 3]
type = angledraw
trigger1 = AnimElemTime(14) >= 0 && AnimElemTime(15) < 0
trigger2 = AnimElemTime(15) >= 0 && AnimElemTime(16) < 0
value = 45

[State 1130, 2]
type = SelfState
trigger1 = !gethitvar(isbound)
value = 5050
;===========================================================================
[Statedef 1135]
type = A
movetype = H
physics = N
anim = 5030
velset = -30,-10

[state 1135, gravity]
type = veladd
trigger1 = 1
y = 0.44

[state 1135, camera]
type = screenbound
trigger1 = 1
value = 1
movecamera = 0,1


[State 670, Hit wall]
type = ChangeState
triggerall = Pos y < 0
trigger1 = BackEdgeBodyDist <= 20
trigger2 = FrontEdgeBodyDist <= 20
value = 672

[State 670, Hit ground]
type = SelfState
trigger1 = (Vel y > 0) && (Pos y >= 0)
value = 5100



;[State 1135, 2]
;type = SelfState
;trigger1 = !gethitvar(isbound)
;value = 5050



;===========================================================================
; Air Grab Belly Flop
;===========================================================================
[Statedef 1140]
type    = A
movetype= A
physics = N
poweradd= 100
ctrl = 0
sprpriority = 2
anim = 1140

[state 1140, gravity]
type = gravity
trigger1 = 1

[state 1140, playerpush]
type = playerpush
trigger1 = 1
value = 0
ignorehitpause = 1

[state 1140, removeexplod]
type = removeexplod
trigger1 = time = 0
id = 1151

[state 1140, double gravity]
type = veladd
trigger1 = vel y > 0
y = 0.35
persistent = 1

[State 1140, 3]
type = HitDef
trigger1 = vel y > 0
persistent = 0
attr = A, SA
damage = ifelse(prevstateno = 1171,105,155)
givepower = 155
hitflag = MAFD
guardflag = HA
priority = 2
pausetime = 2,2
sparkno = 3
sparkxy = -10,-70
hitsound   = 5,4
guardsound = S120, 0
animtype = Med
ground.type = High
ground.slidetime = 24
ground.hittime  = 24
ground.velocity = 0
air.velocity = 0,0
guard.hittime = 24
guard.slidetime = 30
guard.velocity = -30
airguard.velocity = -24, 10
fall.recover = 0


;--------------------------

[state 1140, enemy state]
type = targetstate
triggerall = vel y > 0
trigger1 = movehit
trigger1 = enemy,statetype != A
value = 660

;Ride down mechanic
[state 1140, Ride down]
type = targetbind
trigger1 = movehit
trigger1 = enemy,statetype = A
pos = 0, 100

[state 1140, state of ride down]
type = targetstate
trigger1 = movehit
trigger1 = enemy,statetype = A
value = 655
;----------------------------------------------

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -3
persistent = 0
ignorehitpause = 1

[State 1140, 3]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 1141

;---------------------------------------------------------------------------
; 1st Landing
[statedef 1141]
type    = C
movetype= A
physics = N
poweradd= 30
sprpriority = 2

[state 1141, anim]
type = changeanim
trigger1 = time = 0
value = 1141

[state 1141, height detection]
type = varset
trigger1 = time = 4
v = 15
value = 0

;Custom Dust
[state 1141, explod]
type = explod
trigger1 = time = 0
anim = 2000
pos = 30,-20
scale = const(size.xscale)*3,const(size.yscale)*2.5
sprpriority  = 3
ownpal = 1

[state 1141, fx]
type = explod
trigger1 = time = 0
anim = F61
pos = 0,0
scale = 6,3
ownpal = 1
sprpriority = -4


[state 1141, explod]
type = explod
trigger1 = time = 0
anim = 2001
pos = 30,-20
scale =  const(size.xscale)*3,const(size.yscale)*2.5
sprpriority = -4
ownpal = 1
; -------------------

[state 1141, snd]
type = playsnd
trigger1 = time = 0
value =S650,0

[state 1141, snd]
type = playsnd
trigger1 = time = 0
value =S650,0

[state 1141, pos]
type = posset
trigger1 = time = 0
y = 0

[state 1141, playerpush]
type = playerpush
trigger1 = 1
value = 0
ignorehitpause = 1

[State 1141, 3]
type = HitDef
trigger1 = Time = 0
attr = A, NA
damage    = 155
guardflag = 
hitflag = FD
priority = 4
pausetime = 2,2
sparkno = 1
sparkxy = -10,-40
hitsound = S5000, 2
guardsound = S120, 0
animtype = Med
p1sprpriority = 2
p2stateno = 660
ground.type = High
ground.slidetime = 12
ground.hittime  = 15
ground.velocity = 0
air.velocity = 0,0

[state 1141, vel]
type = velset
trigger1 = time = 0
y = 0
x = 0

[state 1141, earthquakes]
type = envshake
trigger1 = time = 0
time = 24
ampl = -16
freq = 75
phase = 75


[state 1141, end]
type = changestate
trigger1 = time = 9
value = 1142

;---------------------------------------------------------------------------
;Bounce
[statedef 1142]
type    = A
movetype= I
physics = N
movehitpersist = 1

[state 652, playerpush]
type = playerpush
trigger1 = 1
value = 0

[state 652, velset]
type = velset
trigger1 = time = 0
y = -8

[state 652, gravity]
type = gravity
trigger1 = pos y < -1

[state 652, end]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 1143

;--------------------------------------------------------------------------
;Landing Rest
[statedef 1143]
type    = C
movetype= I
physics = N
movehitpersist = 1
sprpriority = 2

[state 653, anim]
type = changeanim
trigger1 = time = 0
value = 1142

[state 653, posset]
type = posset
trigger1 = time = 0
y = 0

[state 653, playerpush]
type = playerpush
trigger1 = 1
value = 0

[state 653, velset]
type = velset
trigger1 = time = 0
y = 0
x = 0

[state 653, snd]
type = playsnd
trigger1 = time = 0
value =S650,0

[state 653, earthquakes]
type = envshake
trigger1 = time = 0
time = 15
ampl = 12
freq = 100
phase = 100

[state 653, end]
type = changestate
trigger1 = animtime = 0
value = 1144

;---------------------------------------------------------------------------
;Jump Off
[statedef 1144]
type = A
movetype = I
physics = N
anim = 41
velset = -6,-12

[state 1144, gravity]
type = gravity
trigger1 = pos y < -1

[state 1144, anim]
type = changeanim
trigger1 = vel y >= 0
value = 44

[state 1144, nothitby]
type = nothitby
trigger1 = 1
value = SCA

[state 1144, end]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 52
ctrl = 1



;===========================================================================
; Air Grab
;===========================================================================
; Light version
[Statedef 1150]
type = S
movetype = A
physics = N
anim = 1150
velset = 0,0
ctrl = 0

[state 1150, velset]
type = velset
trigger1 = animelem = 3
x = 6
y = -17

[state 1150, statetypeset]
type = statetypeset
trigger1 = animelemtime(3) = 0
statetype = A

[state 1150, playsnd]
type = playsnd
trigger1 = animelem = 3
value = S1100,1

[state 1150, nothitby]
type = nothitby
trigger1 = animelemtime(3) < 6
value = A

[state 1150, gravity]
type = gravity
trigger1 = pos y < -1

[State 1150, 1]
type = HitDef
Trigger1 = Time = 0
attr = S, ST          
hitflag = A-
guardflag =           
priority = 1, Miss   
sparkno = -1         
p1sprpriority = 2                 
p1facing = 1
p2facing = 1          
p1stateno = 1151       
p2stateno = 1180       
guard.dist = 300 
guard.velocity = -4
airguard.velocity = -4,-2
guard.hittime = 16       
fall = 1             
fall.recover = 0
fall.recovertime = 60
fall.yvelocity = -12
fall.xvelocity = 0

[state 1150, change anim]
type = changeanim
trigger1 = pos y != 0
trigger1 = vel y > 0
trigger1 = anim!= 1154
value = 1154

[state 1150, velset]
type = velmul
trigger1 = vel Y > 0
x = 0.75
persistent = 0

[state 1150, velset]
type = velmul
trigger1 = vel Y > 20
x = 0.1
persistent = 0

[state 1150, velset]
type = veladd
trigger1 = moveguarded
x = -4
y = -8
persistent = 0

[state x, combo damage score]
type = varadd
trigger1 = movehit = 1
v = 18
value = -9
persistent = 0
ignorehitpause = 1

[state 1150, end]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 1155
;---------------------------------------------------------------------------
; Air Grab Animation
[Statedef 1151]
type    = A
movetype= A
physics = N
anim = 1151
poweradd = 0
velset = 0,0
sprpriority = -2

[state 1151, playerpush]
type = playerpush
trigger1 = 1
value = 0
ignorehitpause 

[state 650, explod]
type = explod
trigger1 = time = 0
anim = 11510
pos = 0,0
id = 1151
scale = const(size.xscale),const(size.yscale)
postype = p1
bindtime = -1
ignorehitpause = 1
removetime = -2
sprpriority = 2
removeongethit = 1

[state 810, sprpriority]
type = sprpriority
trigger1 = animelem = 4
value = 2

[state 810, sprpriority]
type = sprpriority
trigger1 = animelem = 5
value = -2

[State 1151, Grab Sound]
type = PlaySnd
trigger1 = AnimElem = 2
value = 1, 1

[state 1151, velset]
type = velset
trigger1 = animelem = 5
x = 0
y = -16

[state 1151, gravity]
type = gravity
trigger1 = animelemtime(5) > 1

[State 1151, all]
type = Width
trigger1 = 1
edge = 230,160

[State 1151, Throw Sound]
type = PlaySnd
trigger1 = AnimElem = 5
value = 800, 0

[State 1151, Bind 1]
type = TargetBind
trigger1 = AnimElemTime(2) < 0
pos = 180, -280

[State 810, Bind 2]
type = TargetBind
trigger1 = AnimElemTime(2) >= 0 && AnimElemTime(3) < 0
pos = 140, -340

[State 810, Bind 3]
type = TargetBind
trigger1 = AnimElemTime(3) >= 0 && AnimElemTime(4) < 0
pos = 60, -360



[State 810, Bind 4]
type = TargetBind
trigger1 = AnimElemTime(4) >= 0 && AnimElemTime(5) < 0
pos = 90, -180

[State 810, Bind 5]
type = TargetBind
trigger1 = AnimElemTime(5) >= 0 && AnimElemTime(5) < 2
pos = 60, 20



[State 810, Hurt 5]
type = TargetLifeAdd
trigger1 = AnimElem = 5
value = floor(ifelse(var(11)=1,-69,-19)*fvar(10))

[State 810, Hurt 5]
type = TargetpowerAdd
trigger1 = AnimElem = 5
persistent = 0
value = 100

[state x, combo damage score]
type = varadd
trigger1 = animelem = 4
v = 18
value = -18
persistent = 0
ignorehitpause = 1

[State 810, Throw 5]
type = TargetState
trigger1 = AnimElemtime(5) = 2
value = 1181


[State -1, Belly flop]
type = ChangeState
value = 1140
triggerall = animelemtime(5) > 2
trigger1 = command = "b"  || command = "a"  || command = "c"  || command = "x" || command = "y" ||command = "z"
trigger2 = ailevel > 0 


[state 821, ground shake]
type = envshake
trigger1 = enemy,vel y > 0
trigger1 = enemy,pos y > -vel y
time = 24
ampl = -10
freq = 80
phase = 80

[state 821, playsnd]
type = playsnd
trigger1 = enemy,vel y > 0
trigger1 = enemy,pos y > -vel y
value = S650,0

[state 1151, ai butt drop]
type = varset
trigger1 = time = 0
var(23) = 1
ignorehitpause

[State 810, State End]
type = ChangeState
trigger1 = AnimTime = 0
value = 50
ctrl = 1

;---------------------------------------------------------------------------
; Landing
[Statedef 1155]
type    = S
physics = S
ctrl = 0
anim = 1155

[State 52, 1]
type = VelSet
trigger1 = Time = 0
y = 0

[state 52, height detection]
type = varset
trigger1 = time = 2
v = 15
value = 0

[State 52, 2]
type = PosSet
trigger1 = Time = 0
y = 0

[State 52, 4]
type = EnvShake
trigger1 = time = 0
time = 18
ampl = -12
freq = 100
phase = 100

[state 52, 4]
type = playsnd
trigger1 = time = 0
value = S20,0

[state 52, land fx]
type = explod
trigger1 = time = 0
trigger1 = var(15) = 1
anim = 2000
bindtime = 1
id = 1500
pos = 0, 10
removetime = -2
sprpriority = 4
scale = const(size.xscale)*2,const(size.yscale)*1.5

[state 52, land fx]
type = explod
trigger1 = time = 0
trigger1 = var(15) = 1
anim = 2001
bindtime = 1
id = 1500
pos = 0, 10
removetime = -2
sprpriority = -3
scale = const(size.xscale)*2,const(size.yscale)*1.5

[State 52, 4]
type = VelSet
trigger1 = abs(vel x) < Const(movement.stand.friction.threshold)
x = 0

[State 52, 5]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1
;-------------------------------------------------------------------------
;Hard version
[Statedef 1160]
type = S
movetype = A
physics = N
anim = 1160
velset = 0,0
ctrl = 0

[state 1160, velset]
type = velset
trigger1 = animelem = 3
x = 9
y = -22

[state 1150, statetypeset]
type = statetypeset
trigger1 = animelemtime(3) = 0
statetype = A

[state 1150, nothitby]
type = nothitby
trigger1 = animelemtime(3) < 2
value = A

[state 1160, playsnd]
type = playsnd
trigger1 = animelem = 3
value = S1100,1

[state 1160, gravity]
type = gravity
trigger1 = pos y < -1

[State 1160, 1]
type = HitDef
Trigger1 = Time = 0
attr = S, ST          
hitflag = A          
priority = 1, Miss   
sparkno = -1         
p1sprpriority = 2                 
p1facing = 1
p2facing = 1          
p1stateno = 1161       
p2stateno = 1180       
guard.dist = 0        
fall = 1             
fall.recover = 0
fall.recovertime = 60
fall.yvelocity = -12
fall.xvelocity = 0

[state 1161, change anim]
type = changeanim
trigger1 = pos y != 0
trigger1 = vel y > 0
trigger1 = anim!= 1154
value = 1154

[state 1161, velset]
type = velmul
trigger1 = vel Y > 0
x = 0.75
persistent = 0

[state 1150, velset]
type = velmul
trigger1 = vel Y > 20
x = 0.1
persistent = 0

[state 1161, end]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 1165
;---------------------------------------------------------------------------
; Air Grab Animation
[Statedef 1161]
type    = A
movetype= A
physics = N
anim = 1151
poweradd = 0
velset = 0,0
sprpriority = -2

[state 1161, playerpush]
type = playerpush
trigger1 = 1
value = 0
ignorehitpause 

[state 1161, explod]
type = explod
trigger1 = time = 0
anim = 11510
pos = 0,0
id = 1151
scale = const(size.xscale),const(size.yscale)
postype = p1
bindtime = -1
ignorehitpause = 1
removetime = -2
sprpriority = 2
removeongethit = 1

[state 1161, sprpriority]
type = sprpriority
trigger1 = animelem = 4
value = 2

[state 1161, sprpriority]
type = sprpriority
trigger1 = animelem = 5
value = -2

[State 1161, Grab Sound]
type = PlaySnd
trigger1 = AnimElem = 2
value = 1, 1

[state 1161, velset]
type = velset
trigger1 = animelem = 5
x = 0
y = -16

[state 1161, gravity]
type = gravity
trigger1 = animelemtime(5) > 1

[State 1161, all]
type = Width
trigger1 = 1
edge = 230,160

[State 1161, Throw Sound]
type = PlaySnd
trigger1 = AnimElem = 5
value = 800, 0

[State 1161, Bind 1]
type = TargetBind
trigger1 = AnimElemTime(2) < 0
pos = 180, -280

[State 810, Bind 2]
type = TargetBind
trigger1 = AnimElemTime(2) >= 0 && AnimElemTime(3) < 0
pos = 140, -340

[State 810, Bind 3]
type = TargetBind
trigger1 = AnimElemTime(3) >= 0 && AnimElemTime(4) < 0
pos = 60, -360



[State 810, Bind 4]
type = TargetBind
trigger1 = AnimElemTime(4) >= 0 && AnimElemTime(5) < 0
pos = 90, -180

[State 810, Bind 5]
type = TargetBind
trigger1 = AnimElemTime(5) >= 0 && AnimElemTime(5) < 2
pos = 60, 20



[State 810, Hurt 5]
type = TargetLifeAdd
trigger1 = AnimElem = 5
value = ifelse(var(11)=1,-76,-36)

[State 810, Hurt 5]
type = TargetpowerAdd
trigger1 = AnimElem = 5
persistent = 0
value = 50

[state x, combo damage score]
type = varadd
trigger1 = animelem = 4
v = 18
value = -18
persistent = 0
ignorehitpause = 1

[State 810, Throw 5]
type = TargetState
trigger1 = AnimElemtime(5) = 2
value = 1181

[State -1, Belly flop]
type = ChangeState
value = 1140
triggerall = animelemtime(5) > 2
trigger1 = command = "b"  || command = "a"  || command = "c"  || command = "x" || command = "y" ||command = "z"
trigger2 = ailevel > 0 

[state 821, ground shake]
type = envshake
trigger1 = enemy,vel y > 0
trigger1 = enemy,pos y > -vel y
time = 24
ampl = -10
freq = 80
phase = 80

[state 821, playsnd]
type = playsnd
trigger1 = enemy,vel y > 0
trigger1 = enemy,pos y > -vel y
value = S650,0

[state 1161, ai butt drop]
type = varset
trigger1 = time = 0
var(23) = 1
ignorehitpause

[State 810, State End]
type = ChangeState
trigger1 = AnimTime = 0
value = 50
ctrl = 1

;---------------------------------------------------------------------------
; Landing
[Statedef 1165]
type    = S
physics = S
ctrl = 0
anim = 1165

[State 52, 1]
type = VelSet
trigger1 = Time = 0
y = 0

[state 52, height detection]
type = varset
trigger1 = time = 2
v = 15
value = 0

[State 52, 2]
type = PosSet
trigger1 = Time = 0
y = 0

[State 52, 4]
type = EnvShake
trigger1 = time = 0
time = 18
ampl = -12
freq = 100
phase = 100

[state 52, 4]
type = playsnd
trigger1 = time = 0
value = S20,0

[state 52, land fx]
type = explod
trigger1 = time = 0
trigger1 = var(15) = 1
anim = 2000
bindtime = 1
id = 1500
pos = 0, 10
removetime = -2
sprpriority = 4
scale = const(size.xscale)*2,const(size.yscale)*1.5

[state 52, land fx]
type = explod
trigger1 = time = 0
trigger1 = var(15) = 1
anim = 2001
bindtime = 1
id = 1500
pos = 0, 10
removetime = -2
sprpriority = -3
scale = const(size.xscale)*2,const(size.yscale)*1.5

[State 52, 4]
type = VelSet
trigger1 = abs(vel x) < Const(movement.stand.friction.threshold)
x = 0

[State 52, 5]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1
;-------------------------------------------------------------------------
;EX Air Grab
[Statedef 1170]
type = S
movetype = A
physics = N
anim = 1170
poweradd = -500
velset = 0,0
ctrl = 0

[State 1170, Blink Yellow]
type = PalFX
trigger1 = time%2
time = 1
add = 150,75,0 ;32,16,0
sinadd = 64,32,5,3
ignorehitpause

[state 1170, nothitby]
type = nothitby
trigger1 = 1
value = SCA

[state 1150, statetypeset]
type = statetypeset
trigger1 = animelemtime(3) = 0
statetype = A

[state 1170, playsnd]
type = playsnd
trigger1 = animelem = 3
value = S1100,1

[state 1170, velset]
type = velset
trigger1 = animelem = 3
x = 12
y = -20

[state 1170, gravity]
type = gravity
trigger1 = pos y < -1

[State 1170, 1]
type = HitDef
Trigger1 = Time = 0
attr = S, ST          
hitflag = AF         
priority = 1, Miss   
sparkno = -1         
p1sprpriority = 2                 
p1facing = 1
p2facing = 1          
p1stateno = 1171       
p2stateno = 1180       
guard.dist = 0        
fall = 1             
fall.recover = 0
fall.recovertime = 60
fall.yvelocity = -12
fall.xvelocity = 0

[state 1171, change anim]
type = changeanim
trigger1 = pos y != 0
trigger1 = vel y > 0
trigger1 = anim!= 1154
value = 1154

[state 1171, velset]
type = velmul
trigger1 = vel Y > 0
x = 0.75
persistent = 0

[state 1170, velset]
type = velmul
trigger1 = vel Y > 20
x = 0.1
persistent = 0

[state 1171, end]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 1175
;---------------------------------------------------------------------------
; Air Grab Animation
[Statedef 1171]
type    = A
movetype= A
physics = N
anim = 1151
poweradd = 0
velset = 0,0
sprpriority = -2

[state 1171, playerpush]
type = playerpush
trigger1 = 1
value = 0
ignorehitpause 

[state 1171, ai butt drop]
type = varset
trigger1 = time = 0
var(23) = 1
ignorehitpause

[state 1161, explod]
type = explod
trigger1 = time = 0
anim = 11510
pos = 0,0
id = 1151
scale = const(size.xscale),const(size.yscale)
postype = p1
bindtime = -1
ignorehitpause = 1
removetime = -2
sprpriority = 2
removeongethit = 1

[state 1161, sprpriority]
type = sprpriority
trigger1 = animelem = 4
value = 2

[state 1161, sprpriority]
type = sprpriority
trigger1 = animelem = 5
value = -2

[State 1161, Grab Sound]
type = PlaySnd
trigger1 = AnimElem = 2
value = 1, 1

[state 1161, velset]
type = velset
trigger1 = animelem = 5
x = 0
y = -16

[state 1161, gravity]
type = gravity
trigger1 = animelemtime(5) > 1

[State 1161, all]
type = Width
trigger1 = 1
edge = 230,160

[State 1161, Throw Sound]
type = PlaySnd
trigger1 = AnimElem = 5
value = 800, 0

[State 1161, Bind 1]
type = TargetBind
trigger1 = AnimElemTime(2) < 0
pos = 180, -280

[State 810, Bind 2]
type = TargetBind
trigger1 = AnimElemTime(2) >= 0 && AnimElemTime(3) < 0
pos = 140, -340

[State 810, Bind 3]
type = TargetBind
trigger1 = AnimElemTime(3) >= 0 && AnimElemTime(4) < 0
pos = 60, -360



[State 810, Bind 4]
type = TargetBind
trigger1 = AnimElemTime(4) >= 0 && AnimElemTime(5) < 0
pos = 90, -180

[State 810, Bind 5]
type = TargetBind
trigger1 = AnimElemTime(5) >= 0 && AnimElemTime(5) < 6
pos = 60, 20



[State 810, Hurt 5]
type = TargetLifeAdd
trigger1 = AnimElem = 5
value = floor(ifelse(var(11)=1,-106,-66)*fvar(10))

[State 810, Hurt 5]
type = TargetpowerAdd
trigger1 = AnimElem = 5
persistent = 0
value = 75

[state 810, varadd]
type = varadd
trigger1 = animelem = 5
var(8) = -1
persistent = 0
ignorehitpause = 1

[state x, combo damage score]
type = varadd
trigger1 = animelem = 4
v = 18
value = -9
persistent = 0
ignorehitpause = 1

[State 810, Throw 5]
type = TargetState
trigger1 = AnimElemtime(5) = 6
value = ifelse(var(8) > 0,681,1181);1181

[State -1, Belly flop]
type = ChangeState
value = 1140
triggerall = animelemtime(5) > 6
trigger1 = command = "b"  || command = "a"  || command = "c"  || command = "x" || command = "y" ||command = "z"
trigger1 = ailevel = 0
trigger2 = ailevel > 0
trigger2 = 0

[state 821, ground shake]
type = envshake
trigger1 = enemy,vel y > 0
trigger1 = enemy,pos y > -vel y
time = 24
ampl = -10
freq = 80
phase = 80

[state 821, playsnd]
type = playsnd
trigger1 = enemy,vel y > 0
trigger1 = enemy,pos y > -vel y
value = S650,0



[State 810, State End]
type = ChangeState
trigger1 = AnimTime = 0
value = 50
ctrl = 1

;---------------------------------------------------------------------------
; Landing
[Statedef 1175]
type    = S
physics = S
ctrl = 0
anim = 1175

[State 52, 1]
type = VelSet
trigger1 = Time = 0
y = 0

[state 52, height detection]
type = varset
trigger1 = time = 2
v = 15
value = 0

[State 52, 2]
type = PosSet
trigger1 = Time = 0
y = 0

[State 52, 4]
type = EnvShake
trigger1 = time = 0
time = 18
ampl = -12
freq = 100
phase = 100

[state 52, 4]
type = playsnd
trigger1 = time = 0
value = S20,0

[state 52, land fx]
type = explod
trigger1 = time = 0
trigger1 = var(15) = 1
anim = 2000
bindtime = 1
id = 1500
pos = 0, 10
removetime = -2
sprpriority = 4
scale = const(size.xscale)*2,const(size.yscale)*1.5

[state 52, land fx]
type = explod
trigger1 = time = 0
trigger1 = var(15) = 1
anim = 2001
bindtime = 1
id = 1500
pos = 0, 10
removetime = -2
sprpriority = -3
scale = const(size.xscale)*2,const(size.yscale)*1.5

[State 52, 4]
type = VelSet
trigger1 = abs(vel x) < Const(movement.stand.friction.threshold)
x = 0

[State 52, 5]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1





;--------------------------------------------------------------------------
;Air Grab State
[statedef 1180]
type    = A
movetype= H
physics = N
velset = 0,0

[State 810, Bind 2]
type = angledraw
trigger1 = AnimElemTime(2) >= 0 && AnimElemTime(3) < 0
value = -15

[State 810, Bind 2]
type = angledraw
trigger1 = AnimElemTime(3) >= 0 && AnimElemTime(4) < 0
value = -45

[State 1180, 1]
type = ChangeAnim2
Trigger1 = Time = 0
value = 1180

[State 1180, 2]
type = SelfState
trigger1 = !gethitvar(isbound)
value = 5050

;---------------------------------------------------------------------------
[Statedef 1181]
type    = A
movetype= H
physics = N
velset = 6,20
poweradd = 40

[State 1181, 1] ;Gravity
type = VelAdd
Trigger1 = 1
y = .4

[State 1181, 4] ;Hit ground
type = changestate
trigger1 = Vel Y > 0
trigger1 = Pos Y >= 0
value = 1182 ;Hit ground

;------------------------------------------------------------------------------
;Laydown wait for crushing
[statedef 1182]
type = L
movetype = H
physics = N
velset = 0,0

[state 1181, screenshake]
type = envshake
trigger1 = time = 1
time = 18
ampl = -12
freq = 100
phase = 100

[State 1182, 8]
type = Explod
trigger1 = Time = 1
anim = F(60 + (sysvar(1) > Const720p(20)) + (sysvar(1) > Const720p(56)))
postype = p1
pos = 0, 0
scale = 3,1.5
facing = facing
sprpriority = ifelse (sysvar(1) <= Const720p(56), -10, 10)

[State 1182, 10]
type = PlaySnd
trigger1 = Time = 1
value = F7, (sysvar(1) > Const720p(20)) + (sysvar(1) > Const720p(56))

[state 1182, posset]
type = posset
trigger1 = time = 0
y = 0

[state 3022, changeanim]
type = changeanim
value = 5170
trigger1 = time = 0

[state 3022, changeanim]
type = changeanim
value = 5110
trigger1 = time = 6



[state 3022, end]
type = selfstate
trigger1 = time > 32
value = 5120









;===========================================================================
;  Shove
;===========================================================================

[Statedef 1400]
type = S
movetype = I
physics = S
velset = 0,0
anim = 1400

[state 1400, poweradd]
type = poweradd
trigger1 = time = 0
value = -500

[state 1400, awareness pause]
type = pause
trigger1 = time = 0
time = 8
endcmdbuftime = 8

[state 1400, dim]
type = bgpalfx
trigger1 = time = 0
time = 8
mul = 200,200,200

[State 330, Spark]
type = Explod
trigger1 = AnimElem = 4
id = 1410
anim = 1410
postype = p1
pos = 155,-180
sprpriority = 3
bindtime = 1
scale = 2.2,2.2
ownpal = 1

[State 211, 2]
type = HitDef
trigger1 = 1
persistent = 0
attr = S, NA
animtype  = Heavy
damage    = 25
Hitflag = MA
guardflag = 
pausetime = 0,0
sparkno = -1
ground.Velocity = -5
air.Velocity = -5,0
fall = 1
fall.recover = 0
kill = 0
guard.kill = 0

[state 1400, moveforward]
type = velset
trigger1 = time = 0
x = 0

[state 1400, snd]
type = playsnd
trigger1 = time = 11
value = 1400,0

[State 1400, Push]
type = Helper
trigger1 = Time = 11
trigger2 = time = 13
ignorehitpause = 1
ID = 1401
name = "Shove"
pos = -20,0
postype = p1
stateno = 1401
keyctrl = 0
ownpal = 1
helpertype = normal

[state 1400, HB]
Type = hitby
trigger1 = 1
value = SCA,AT

[state 1400, previous state]
type = varset
trigger1 = time = 0
v = 5
value = prevstateno


[State 1400, 3]
type = ChangeState
Trigger1 = AnimTime = 0
value = 0
ctrl = 1

;-----------------------------------------------------------------------------
; Pushing part
[Statedef 1401]
type    = A
movetype= I
physics = N
velset = 0,0
anim = 1401

[State 1440, Push]
type = posset
trigger1 = time = 0
y = 0

[State 1440, Push]
type = PlayerPush
trigger1 = 1
value = 1

[State 1440, NHB]
type = NotHitBy
Trigger1 = 1
value = SCA
Time = 1

[State 1440, Vel]
type = VelSet
trigger1 = Time >= 0
x = 30

[State 345, End]
type = DestroySelf
trigger1 = Time = 15


;--------------------------------------------------------------------------
;Bamboo Break
[statedef 1300]
type = C
movetype = I
physics = C
anim = 1300
ctrl = 0

[state 1300, explod]
type = explod
trigger1 = time = 0
anim = 1305
postype = p1
pos = 0,0
sprpriority = 3
scale = const(size.xscale),const(size.yscale)
removetime = -2
bindtime = -1
removeongethit = 1

[state 1300, snd]
type = playsnd
trigger1 = animelemtime(4) = 0
value = S190,0

[state 1300, snd]
type = playsnd
trigger1 = animelemtime(8) = 0
trigger2 = animelemtime(12) = 0
value = S190,1

[state 1300, poweradd]
type = poweradd
trigger1 = animelemtime(4)=0
value = 100

[state 1300, poweradd]
type = poweradd
trigger1 = animelemtime(8)=0
value = 100

[state 1300, poweradd]
type = poweradd
trigger1 = animelemtime(12)=0
value = 300

[state 1300, life add only if power is full]
type = lifeadd
;triggerall = power >= 3000
trigger1 = animelemtime(4)=0
value = ifelse(power = powermax, 30,20)

[state 1300, life add only if power is full]
type = lifeadd
;triggerall = power >= 3000
trigger1 = animelemtime(8)=0
value = ifelse(power = powermax, 30,20)

[state 1300, More life add if power is full]
type = lifeadd
;triggerall = power >= 3000
trigger1 = animelemtime(12)=0
value = ifelse(power = powermax, 30,20)

[state 1300, end]
type = changestate
trigger1 = animtime = 0
value = 657

;--------------------------------------------------------------------------
;Bamboo Snack Backfacing
[statedef 1310]
type = C
movetype = I
physics = C
anim = 1310
sprpriority = 2
ctrl = 0

[state 1310, removeexplod]
type = removeexplod
trigger1 = numexplod(652)
id = 652

[state 1310, explod]
type = explod
trigger1 = time = 0
anim = 1315
postype = p1
pos = 0,0
sprpriority = 3
scale = const(size.xscale),const(size.yscale)
removetime = -2
bindtime = -1
removeongethit = 1

[state 1310, snd]
type = playsnd
trigger1 = animelemtime(3) = 0
value = S190,0

[state 1310, snd]
type = playsnd
trigger1 = animelemtime(6) = 0
value = S190,1

[state 1300, poweradd]
type = poweradd
trigger1 = animelemtime(3)=0
value = 250

[state 1300, poweradd]
type = poweradd
trigger1 = animelemtime(6)=0
value = 250


[state 1300, life add only if power is full]
type = lifeadd
;triggerall = power >= 3000
trigger1 = animelemtime(3)=0
value = ifelse(power = powermax, 45,30)

[state 1300, life add only if power is full]
type = lifeadd
;triggerall = power >= 3000
trigger1 = animelemtime(6)=0
value = ifelse(power = powermax, 45,30)

[state 1300, end]
type = changestate
trigger1 = animtime = 0
value = 658





;==========================================================================
;Super
;==========================================================================
; Hop into Position

;Damage:  580

[statedef 3000]
type = A
movetype = A
physics = N
anim = 3000
ctrl = 0

[state x, combo damage score]
type = varset
trigger1 = time = 0
trigger1 = var(18) < 90
v = 18
value = 90
persistent = 0
ignorehitpause = 1

[state 3000, velset]
type = velset
trigger1 = animelemtime(3) = 0
y = -4
x = -2

[state 3000, gravity]
type = gravity
trigger1 = pos y < -1



[state 3000, nothitby]
type = nothitby
trigger1 = 1
value = SCA

[state 3000, landing]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y 
value = 3001

;----------------------------------------------------------------------------
; Super Pause, Squat Pose
[statedef 3001]
type = C
movetype = A
Physics = N
anim = 3001
velset = 0,0

[State 52, 4]
type = EnvShake
trigger1 = time = 0
time = 18
ampl = -12
freq = 100
phase = 100

[state 52, 4]
type = playsnd
trigger1 = time = 0
value = S20,0

[state 3001, posset]
type = posset
trigger1 = time = 0
y = 0

[state 3000, no bg]
type = assertspecial
trigger1 = animelemtime(2) = [0,60]
flag = nobg
ignorehitpause = 1

[state 3000, nothitby]
type = nothitby
trigger1 = 1
value = SCA

[state 3001, Super Portrait]
type = explod
trigger1 = animelemtime(2) =[0, 14]
anim = 3100
postype = back
sprpriority = -3
supermovetime = 60
removetime = 1
pausemovetime = 60
scale = (3-(time*0.15))*(1),(3-(time*0.15))*(1)
pos = 0,60-time*5
ownpal = 1

[state 3001, Super Portrait]
type = explod
trigger1 = animelemtime(2) = 15
anim = 3100
postype = back
vel = -0.1,0
sprpriority = -3
supermovetime = 60
removetime = 43
pausemovetime = 60
pos = 0,0
scale = 1,1
ownpal = 1


[State 3000, Super Pause]
type = SuperPause
trigger1 = animelemtime(2) = 0
sound = S3000, 0
poweradd = -3000
pos = -100,-100
time = 60
movetime = 60

[state 3000, changestate]
type = changestate
trigger1 = animtime = 0
value = 3002

;---------------------------------------------------------------------
; Hand Slap
[statedef 3002]
type = S
movetype = A
Physics = N
anim = 3002

[state 3000, nothitby]
type = nothitby
trigger1 = time < 12
value = SCA

[state 3002, nothitby]
type = nothitby
trigger1 = time >= 12 && time < 36  
value = ,AP

[state 3002, no autoturn]
type = assertspecial
trigger1 = 1
flag = noautoturn


;===========
;Armor start
;===========
[state 3002, animation]
type = changeanim
trigger1 = anim != 3002
value = 3002

[state 3002, armor counter]
type = varset
trigger1 = time = 0
trigger1 = Var(21) = 1
V = 20
value = 10

[state x, armor over]
type = varset
trigger1 = animelem = 16
v = 20
value = 0
ignorehitpause 

[state 3002, armor intiator turn off]
type = varset
trigger1 = time = 1
V = 21
value = 0

;determine what frame
[state 3002, remember frame]
type = varset
trigger1 = time <= 0
v = 22
value = animelemno(0)
ignorehitpause = 1

;delay effect
[state 3002, delay]
type = changeanim 
trigger1 = var(31) < floor(gethitvar(hittime)*1.1)
value = anim
elem = var(22)

[state 3002, freeze location]
type = posfreeze
trigger1 = var(31) < floor(gethitvar(hittime)*1.1)
value = 1
;--------------------------

[state 3002, still take damage]
type = lifeadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) != 0
value = floor(-gethitvar(damage))
persistent = 1

[state 3002, armor count down]
type = varadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) > 0
V = 20
value = - 1
persistent = 1

[state 3002, Unstoppable]
type = hitoverride
trigger1 = Life > 1
trigger1 = Var(20) > 0
trigger1 = gethitvar(groundtype) != 3
attr = SCA, AA, AP
stateno = 3002
time = 1
persistent = 1

[State 3002, flash red]
type = PalFX
trigger1 = Time = 0
trigger1 = gethitvar(damage) != 0
time = 7
add = 100,0,0
IgnoreHitPause = 1

;---
;Armor End
;---

[state 3002, velset]
type = velset
trigger1 = animelemtime(32) < 0
x = 9
persistent = 1
ignorehitpause = 1

[state 3002, velset]
type = velset
trigger1 = animelemtime(34) = 0
x = 0
persistent = 1
ignorehitpause = 1

[state 3002, quake]
type = envshake
trigger1 = animelemtime(3) = 0
trigger2 = animelemtime(7) = 0
trigger3 = animelemtime(11) = 0
trigger4 = animelemtime(15) = 0
trigger5 = animelemtime(19) = 0
trigger6 = animelemtime(23) = 0
trigger7 = animelemtime(27) = 0
trigger8 = animelemtime(31) = 0
time = 10
ampl = 4
freq = 80
phase = 100

[state 3002, sound1]
type = playsnd
trigger1 = animelemtime(3) = 0
trigger2 = animelemtime(7) = 0
trigger3 = animelemtime(11) = 0
trigger4 = animelemtime(15) = 0
trigger5 = animelemtime(19) = 0
trigger6 = animelemtime(23) = 0
trigger7 = animelemtime(27) = 0
trigger8 = animelemtime(31) = 0
value = S20,0

[state 3002, no energy GOLDEN FREEZA only] ;Sorry but teleporting out of combos is a BS annoyance so this will reduce his ability to do so.
type = targetpoweradd
triggerall = enemy,name = "Freeza Z2"
triggerall = movehit
trigger1 = animelem = 3
trigger2 = animelem = 7
trigger3 = animelem = 11
trigger4 = animelem = 15
trigger5 = animelem = 19
trigger6 = animelem = 23
trigger7 = animelem = 27
trigger8 = animelem = 31
value = -200
persistent = 1
ignorehitpause 




[State 3002, 1]
type = HitDef
trigger1 = animelem = 3
attr = S, HA
animtype  = Heavy
persistent = 0
damage    = 20,10
guardflag = MA
hitflag = MAF
pausetime = 2,2
getpower = 0
givepower = 62
sparkno = 1
sparkxy = -40,-200
hitsound   = S5000,1
guardsound = S120, 0
ground.type = High
ground.slidetime = 28
ground.hittime  = 28
ground.velocity = -12
air.velocity = -4,-6
guard.dist = 420
guard.hittime = 25
guard.slidetime = 25
guard.velocity = -14
guard.kill = 1
kill = 0

[State 1000, 2]
type = HitDef
trigger1 = animelem = 7
persistent = 0
attr = S, HA
animtype  = Heavy
damage    = 20,10
guardflag = MA
hitflag = MAF
pausetime = 2,2
getpower = 0
givepower = 62
sparkno = 1
sparkxy = -40,-200
hitsound   = S5000,1
guardsound = S120, 0
ground.type = High
ground.slidetime = 28
ground.hittime  = 28
ground.velocity = -12
air.hittime = 28
air.velocity = -6,-4
guard.dist = 420
guard.hittime = 25
guard.slidetime = 25
guard.velocity = -14
guard.kill = 1
kill = 0

[State 3002, 3]
type = HitDef
trigger1 = animelem = 11
attr = S, HA
animtype  = Heavy
persistent = 0
damage    = 20,10
guardflag = MA
hitflag = MAF
pausetime = 2,2
getpower = 0
givepower = 62
sparkno = 1
sparkxy = -40,-200
hitsound   = S5000,1
guardsound = S120, 0
ground.type = High
ground.slidetime = 28
ground.hittime  = 28
ground.velocity = -12
air.hittime = 28
air.velocity = -6,-4
guard.dist = 420
guard.hittime = 25
guard.slidetime = 25
guard.velocity = -14
guard.kill = 1
kill = 0

[State 3002, 4]
type = HitDef
trigger1 = AnimElem = 15
attr = S, HA
animtype  = Heavy
persistent = 0
damage    = 20,10
guardflag = MA
hitflag = MAF
pausetime = 4,4
getpower = 0
givepower = 62
sparkno = 1
sparkxy = -40,-200
hitsound   = S5000,1
guardsound = S120, 0
ground.type = High
ground.slidetime = 18
ground.hittime  = 18
ground.velocity = -12
air.hittime = 28
air.velocity = -6,-4
guard.dist = 420
guard.hittime = 13
guard.slidetime = 13
guard.velocity = -14
guard.kill = 1
kill = 0
fall.recover = 0
fall.recovertime = 60

[State 3002, 5]
type = HitDef
trigger1 = animelem = 19
attr = S, HA
animtype  = Heavy
persistent = 0
damage    = 20,10
guardflag = MA
hitflag = MAF
pausetime = 2,2
getpower = 0
givepower = 62
sparkno = 1
sparkxy = -40,-200
hitsound   = S5000,1
guardsound = S120, 0
ground.type = High
ground.slidetime = 28
ground.hittime  = 28
ground.velocity = -12
air.hittime = 28
air.velocity = -6,-4
guard.dist = 420
guard.hittime = 25
guard.slidetime = 25
guard.velocity = -14
guard.kill = 1
kill = 0

[State 1000, 6]
type = HitDef
trigger1 = animelem = 23
persistent = 0
attr = S, HA
animtype  = Heavy
damage    = 20,10
guardflag = MA
hitflag = MAF
pausetime = 2,2
getpower = 0
givepower = 62
sparkno = 1
sparkxy = -40,-200
hitsound   = S5000,1
guardsound = S120, 0
ground.type = High
ground.slidetime = 28
ground.hittime  = 28
ground.velocity = -12
air.hittime = 28
air.velocity = -6,-4
guard.dist = 420
guard.hittime = 25
guard.slidetime = 25
guard.velocity = -14
guard.kill = 1
kill = 0

[State 3002, 7]
type = HitDef
trigger1 = animelem = 27
attr = S, HA
animtype  = Heavy
persistent = 0
damage    = 20,10
guardflag = MA
hitflag = MAF
pausetime = 2,2
getpower = 0
givepower = 62
sparkno = 1
sparkxy = -40,-200
hitsound   = S5000,1
guardsound = S120, 0
ground.type = High
ground.slidetime = 28
ground.hittime  = 28
ground.velocity = -12
air.hittime = 28
air.velocity = -6,-4
guard.dist = 420
guard.hittime = 25
guard.slidetime = 25
guard.velocity = -14
guard.kill = 1
kill = 0

[State 3002, 8]
type = HitDef
trigger1 = animelem = 31
persistent = 0
attr = S, HA
animtype  = Heavy
damage    = 20,10
getpower = 0
givepower = 62
guardflag = MA
hitflag = MAF
id = 3000
pausetime = 2,2
sparkno = 1
sparkxy = -40,-200
hitsound   = S5000,1
guardsound = S120, 0
ground.type = High
ground.slidetime = 28
ground.hittime  = 28
ground.velocity = -12
air.hittime = 28
air.velocity = -6,-4
guard.dist = 420
guard.hittime = 25
guard.slidetime = 25
guard.velocity = -14
guard.kill = 1
kill = 0

[State 3002, Grab Ending]
type = HitDef
Trigger1 = animelem = 34
attr = S, HT          
hitflag = MAF
guardflag = MA 
getpower = 0   
id = 3000      
priority = 1, Miss   
sparkno = -1         
p1sprpriority = 2                 
p1facing = 1
p2facing = 1          
p1stateno = 3003       
p2stateno = 3020       
guard.dist = 480                   
fall.recover = 0
fall.recovertime = 60
fall.yvelocity = -12
fall.xvelocity = -2

[state 3002, Not Active]
type = statetypeset
trigger1 = animelemtime(35) = 0
movetype = I


[state 3002, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
;grab Portion
[statedef 3003]
type = S
movetype = A
physics = N
anim = 3003
velset = 0,0

[State 3003, Grab Sound]
type = PlaySnd
trigger1 = AnimElem = 2
value = 1, 1

[State 3003, all]
type = Width
trigger1 = 1
edge = 230,160

[State 3003, Throw Sound]
type = PlaySnd
trigger1 = AnimElem = 7
value = 800, 0

[State 3003, Bind 1]
type = TargetBind
trigger1 = AnimElemTime(2) < 0
pos = 180, 0

[State 3003, Bind 2]
type = TargetBind
trigger1 = AnimElemTime(2) >= 0 && AnimElemTime(3) < 0
pos = 180, 10

[State 3003, Bind 3]
type = TargetBind
trigger1 = AnimElemTime(3) >= 0 && AnimElemTime(4) < 0
pos = 140, -40

[state 3003, vel]
type = velset
trigger1 = animelem = 3
x = 10

[state 3003, vel]
type = velset
trigger1 = animelem = 5
x = 0

[state 3003, sprpriority]
type = sprpriority
trigger1 = animelem = 3
value = -2

[State 3003, Bind 4]
type = TargetBind
trigger1 = AnimElemTime(4) >= 0 && AnimElemTime(5) < 0
pos = 0, -220

[State 3003, Bind 5]
type = TargetBind
trigger1 = AnimElemTime(5) >= 0 && AnimElemTime(6) < 0
pos = -60, -230

[State 3003, holdfwd - Turn 6] ;If was holding fwd before, turn now
type = Turn
trigger1 = AnimElem = 6

[State 3003, holdfwd - Pos 6] ;If was holding fwd before, move a little
type = PosAdd
trigger1 = AnimElemtime(6) = 6
x = -37

[State 3003, holdfwd - Turn Target 6] ;If was holding fwd before, turn target too
type = TargetFacing
trigger1 = AnimElem = 6
value = -1


[State 3003, Bind 6]
type = TargetBind
trigger1 = AnimElemTime(6) >= 0 && AnimElemTime(7) < 0
pos = -60, -250

[State 3003, Bind 7]
type = TargetBind
trigger1 = AnimElemTime(7) >= 0 && AnimElemTime(8) < 0
pos = 30, -180

[State 810, Bind 8]
type = TargetBind
trigger1 = AnimElemTime(8) >= 0 && AnimElemTime(9) < 0
pos = 200, -40

[State 3003, Hurt 11]
type = TargetLifeAdd
trigger1 = AnimElem = 8
value = -100
kill = 0

[State 3003, Throw 11]
type = TargetState
trigger1 = AnimElem = 9
value = 3021

[state 3003, ground shake]
type = envshake
trigger1 = enemy,stateno = 3022
time = 24
ampl = -10
freq = 80
phase = 80
persistent = 0

[state 821, playsnd]
type = playsnd
trigger1 = enemy,stateno = 3022
value = S650,0
persistent = 0

[State 810, State End]
type = ChangeState
trigger1 = AnimTime = 0
value = 3004
;---------------------------------------------------------------------------
; Super Jump
[Statedef 3004]
type = A
movetype = A
physics = N
anim = 40
velset = 0,0

[state 3004, screenbound]
type = screenbound
trigger1 = 1
value = 1
movecamera = 0,1

[State 3004, 4]
type = VelSet
trigger1 = anim = 40
trigger1 = animtime = 0
x = -(backedgebodydist * 0.045);const(velocity.jump.back.x)*2
y = const(velocity.jump.y)*0.75

[state 3004, anim]
type = changeanim
trigger1 = anim = 40
trigger1 = animtime = 0
value = 43

[state 3004, gravity]
type = gravity
trigger1 = pos y < -1

[state 3004, end]
type = changestate
trigger1 = backedgebodydist < 35
trigger1 = pos y < -25
value = 3005

[state 3004, end alt]
type = poweradd
trigger1 = anim = 43
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 1500

[state 3004, nothitby]
type = nothitby
trigger1 = 1
value = SCA

[state 3004, notpush]
type = playerpush
trigger1 = 1
value = 0



[state 3004, end alt]
type = changestate
trigger1 = anim = 43
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 52

;---------------------------------------------------------------------------
;Wall Cling
[Statedef 3005]
type    = A
physics = N
movetype = I
anim = 3005
ctrl = 0
velset = 0,0
sprpriority = 1

[state 3005, width]
type= width
trigger1 = 1
player  = 40,57 ;60 works
edge = 5,50

[state 3004, screenbound]
type = screenbound
trigger1 = 1
value = 1
movecamera = 0,1

[state 3005,dekho]
type=turn
trigger1=frontedgebodydist<=40
trigger1=time=0

[state 3005, playsnd]
type = playsnd
trigger1 = time = 8
value = 1,2

[state 3005, posset]
type = posset
trigger1 = time = 0
x=((140+pos x)-screenpos x)*facing

[state 3005, posfreeze]
type = posfreeze
trigger1 = 1
x = 1
y = 1

[state 3004, nothitby]
type = nothitby
trigger1 = 1
value = SCA

[state 3004, notpush]
type = playerpush
trigger1 = 1
value = 0


[State 3005, 6]
type = ChangeState
trigger1 = time > 28
value = 3006

;---------------------------------------------------------------------------
;Super Banzai Drop
[statedef 3006]
type = A
movetype = A
physics = N
velset = 0,0
anim = 3006

[state 3004, screenbound]
type = screenbound
trigger1 = time < 15
value = 1
movecamera = 0,1

[state 3006, explod]
type = explod
trigger1 = time = 0
anim = 30061
pos = 0,0
id = 3006
scale = const(size.xscale),const(size.yscale)
postype = p1
bindtime = -1
ignorehitpause = 1
removetime = -2
sprpriority = 2
removeongethit = 1


[state 3006, gravity]
type = gravity
trigger1 = time > 27

[state 3006, double gravity]
type = veladd
trigger1 = vel y > 0
y = 1.6
persistent = 1

[state 3006, playerpush]
type = playerpush
trigger1 = 1
value = 0

[state 3006, edge]
type = width
trigger1 = 1
edge = 90,100

[state 3006, velset]
type = velset
trigger1 = animelem = 4
x = (p2bodydist x * 0.025) ;const(velocity.jump.fwd.x)*1.25
y = const(velocity.jump.y)*0.75

;[STATE 3006, stop vel]
;type = velset
;trigger1 = animelemtime(4) > 0
;trigger1 = p2bodydist x < enemy,const(size.height)*-0.33
;x = 0

[State 3006, 3]
type = HitDef
trigger1 = vel y > 0
trigger1 = !movecontact || !movereversed
persistent = 0
attr = A, HA
damage    = 100
getpower = 0
givepower = 504
guardflag = 
hitflag = MA
priority = 4
pausetime = 0,0
sparkno = -1
sparkxy = 0,0
hitsound   = 5,4
guardsound = S120, 0
p1sprpriority = -2
animtype = heavy
ground.type = high
ground.slidetime = 22
ground.hittime  = 22
ground.velocity = 0
air.velocity = 0,0
down.hittime = 60
guard.velocity = -30            
guard.hittime = 30
guard.slidetime = 30
airguard.velocity = -28,10
airguard.hittime = 35
guard.dist = 0

; Ride Down
;--------------------------
[state 650, enemy state]
type = targetstate
triggerall = vel y > 0
trigger1 = movehit
trigger1 = enemy,statetype != A
value = 660

;Ride down mechanic
[state 650, Ride down]
type = targetbind
trigger1 = movehit
trigger1 = enemy,statetype = A
pos = 0, 150

[state 650, state of ride down]
type = targetstate
trigger1 = movehit
trigger1 = enemy,statetype = A
value = 655
;-------------------------------

[state 3004, nothitby]
type = nothitby
trigger1 = 1
value = SCA

[state 3004, notpush]
type = playerpush
trigger1 = 1
value = 0

[state 650, end]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 3007


;--------------------------------------------------------------------------------
; 1st Landing
[statedef 3007]
type    = C
movetype= A
physics = N
poweradd= 0
sprpriority = -3

[state 3007, anim]
type = changeanim
trigger1 = time = 0
value = 3007

[state 3007, explod]
type = explod
trigger1 = time = 0
anim = 30071
pos = 0,0
id = 3007
scale = const(size.xscale),const(size.yscale)
postype = p1
bindtime = -1
ignorehitpause = 1
removetime = -2
sprpriority = 3
removeongethit = 1

;Custom Dust
[state 3007, explod]
type = explod
trigger1 = time = 0
anim = 2000
pos = 30,-20
scale = const(size.xscale)*3.5,const(size.yscale)*3
sprpriority = 4
ownpal = 1

[state 3007, fx]
type = explod
trigger1 = time = 0
anim = F61
pos = 0,0
scale = 6,3
ownpal = 1
sprpriority = -4


[state 3007, explod]
type = explod
trigger1 = time = 0
anim = 2001
pos = 30,-20
scale =  const(size.xscale)*3.5,const(size.yscale)*3
sprpriority = -4
ownpal = 1
; -------------------

[state 3007, snd]
type = playsnd
trigger1 = time = 0
value =S650,0

[state 3007, snd]
type = playsnd
trigger1 = time = 0
value =S650,0

[state 3007, pos]
type = posset
trigger1 = time = 0
y = 0

[state 3007, playerpush]
type = playerpush
trigger1 = 1
value = 0

[State 3007, 3]
type = null;HitDef
trigger1 = Time = 0
attr = A, HA
damage    = 320
guardflag = 
hitflag = FD
getpower = 0
givepower = 504
priority = 4
pausetime = 0,0
sparkno = 1
sparkxy = -10,-40
hitsound = S5000, 2
guardsound = S120, 0
animtype = Med
p1sprpriority = -2
p2stateno = 662
ground.type = High
ground.slidetime = 12
ground.hittime  = 15
ground.velocity = 0
air.velocity = 0,0

[state 3007, targetstate]
type = targetstate
trigger1 = time = 0
value = 662
id = 3000

[state 3007, targetlifeadd]
type = targetlifeadd
trigger1 = time = 0
value = ceil(fvar(10) * -320)
id = 3000

[state 3007, playsnd]
type = playsnd
trigger1 = time = 0
value = S5000,2

[state 3007, vel]
type = velset
trigger1 = time = 0
y = 0
x = 0

[state 3004, nothitby]
type = nothitby
trigger1 = 1
value = SCA

[state 3004, notpush]
type = playerpush
trigger1 = 1
value = 0

[state 3007, earthquakes]
type = envshake
trigger1 = time = 0
time = 50
ampl = -35
freq = 75
phase = 75


[state 3007, end]
type = changestate
trigger1 = time = 12
value = 652



;===========================================================================
;Victim Grab states
[statedef 3020]
type    = A
movetype= H
physics = N
velset = 0,0

[State 820, 1]
type = ChangeAnim2
Trigger1 = Time = 0
value = 3020

[State 820, 2]
type = SelfState
trigger1 = !gethitvar(isbound)
value = 5050

;---------------------------------------------------------------------------
; thrown
[Statedef 3021]
type    = A
movetype= H
physics = N
velset = -14,12
poweradd = 40

[state 3021, turn]
type = turn
trigger1 = time = 1


[State 3021, 1] ;Gravity
type = VelAdd
Trigger1 = 1
y = .4

[State 3021, 4] ;Hit ground
type = changeState
trigger1 = Vel Y > 0
trigger1 = Pos Y > -vel y
value = 3022

;--------------------------------------------------------------------------
[statedef 3022]
type = A
movetype = H
physics = N
velset = 0,0

[state 3022, anim]
type = changeanim
trigger1 = time = 0
value = 5100

[state 3022, posset]
type = posset
trigger1 = time = 0
y = 0

[state 3022, anim]
type = changeanim
trigger1 = time = 4
value = 5160

[state 3022, bounce]
type = velset
trigger1 = time = 4
y = -16

[state 3022, gravity]
type = gravity
trigger1 = pos y < -1

[State 3022, 4] ;Hit ground
type = changeState
trigger1 = Vel Y > 0
trigger1 = Pos Y > -vel y
value = 3023

;---------------------------------------------------------
;Laydown wait for crushing
[statedef 3023]
type = L
movetype = H
physics = N
velset = 0,0

[state 3022, changeanim]
type = changeanim
value = 5170
trigger1 = time = 0

[state 3022, changeanim]
type = changeanim
value = 5110
trigger1 = time = 6

[state 3023, nothitby]
type = nothitby
trigger1 = 1
value = SCA



[state 3022, end]
type = selfstate
trigger1 = time > 420
value = 5120

;---------------------------------------------------------------------------
; Super 2
; Bearhug  & Belly Splash
;---------------------------------------------------------------------------

;Bear Hug Cancel XX
[statedef 3039]
type = C
movetype = I
physics = C
anim = 12
ctrl = 0

[State 3039, Blink Yellow]
type = PalFX
trigger1 = time%2
time = 1
add = 100,100,100 ;32,16,0
sinadd = 64,64,64,3
ignorehitpause

[state 3039, poweradd]
type = poweradd
trigger1 = time = 0
value = 750
persistent = 0

[state 3039, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1


;---------------------------------------------------------------------------
;Super Bear hug
[Statedef 3040]
type = C
movetype = A
physics = N
ctrl = 0
poweradd = 0
velset = 0,0

[state 3040, nothitby]
type = nothitby
trigger1 = animelemtime(3) < 0
value = SCA

[state 3000, no bg]
type = assertspecial
trigger1 = animelemtime(2) = [0,60]
flag = nobg
ignorehitpause = 1

[state 3001, Super Portrait]
type = explod
trigger1 = animelemtime(2) =[0, 14]
anim = 3100
postype = back
sprpriority = -3
supermovetime = 60
removetime = 1
pausemovetime = 60
scale = (3-(time*0.15))*(1),(3-(time*0.15))*(1)
pos = 0,60-time*5
ownpal = 1

[state 3001, Super Portrait]
type = explod
trigger1 = animelemtime(2) = 15
anim = 3100
postype = back
vel = -0.1,0
sprpriority = -3
supermovetime = 60
removetime = 45
pausemovetime = 60
pos = 0,0
scale = 1,1
ownpal = 1


[State 3000, Super Pause]
type = SuperPause
trigger1 = animelemtime(2) = 0
sound = S3000, 0
poweradd = -1000
pos = -100,-100
time = 60
movetime = 60

[state 3040, nothitby]
type = nothitby
trigger1 = 1
value = ,AP,AT
ignorehitpause = 1

[state 3040, sprpriority]
type = sprpriority
trigger1 = 1
value = ifelse(p2bodydist x > -10, -1, 2)
persistent = 1

;===========
;Armor start
;===========
[state 3040, animation]
type = changeanim
trigger1 = anim != 3040
value = 3040

[state 3040, armor counter]
type = varset
trigger1 = time = 0
trigger1 = Var(21) = 1
V = 20
value = 3

[state 3040, armor intiator turn off]
type = varset
trigger1 = time = 1
V = 21
value = 0

;determine what frame
[state 3040, remember frame]
type = varset
trigger1 = time <= 0
v = 22
value = animelemno(0)
ignorehitpause = 1

;delay effect
[state 3040, delay]
type = changeanim 
trigger1 = var(31) < floor(gethitvar(hittime)*0.5)
value = anim
elem = var(22)

[state 3040, freeze location]
type = posfreeze
trigger1 = var(31) < floor(gethitvar(hittime)*0.5)
value = 1
;--------------------------

[state 3040, still take damage]
type = lifeadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) != 0
value = floor(-gethitvar(damage))
persistent = 1

[state 3040, armor count down]
type = varadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) > 0
V = 20
value = -1
persistent = 1

[state 3040, Unstoppable]
type = hitoverride
trigger1 = Life > 1
trigger1 = Var(20) > 0
attr = SC, AA, AP
stateno = 3040
time = 1
persistent = 1

[State 3040, flash red]
type = PalFX
trigger1 = Time = 0
trigger1 = gethitvar(damage) != 0
time = 7
add = 100,0,0
IgnoreHitPause = 1

;---
;Armor End
;---

[State 3040, 1]
type = HitDef
Trigger1 = 0;animelem = 3
attr = S, HT          
hitflag = M- 
guardflag =          
priority = 1, Miss   
sparkno = -1    
getpower = 0     
p1sprpriority = -2
p2sprpriority = 1                
p1facing = 1
p2facing = 1          
p1stateno = 3042      
p2stateno = 3050      
guard.dist = 0        
fall = 1             
fall.recover = 0
fall.recovertime = 60
fall.yvelocity = -12
fall.xvelocity = -2

[state 3040, end]
type = changestate
triggerall = animelemtime(4) >= 0 
trigger1 = command != "holdx" && command != "holdy" && command != "holdz"
trigger1 = ailevel = 0
trigger2 = ailevel > 0
trigger2 = var(26) = 1
trigger2 = p2bodydist x < 360
value = 3041

[state 3040, cancel]
type = changestate
triggerall = animelemtime(4) >= 0 
trigger1 = command = "a" || command = "b"
trigger1 = ailevel = 0
trigger2 = ailevel > 0
trigger2 = var(26) =2
trigger2 = p2bodydist x >= 360
trigger3 = roundstate = 3
value = 3039


;---------------------------------------------------------------------------
[statedef 3041]
type = S
movetype = A
physics = N
velset = 0,0

;===========
;Armor start
;===========
[state 3041, animation]
type = changeanim
trigger1 = anim != 1121
value = 1121

;determine what frame
[state 3041, remember frame]
type = varset
trigger1 = time <= 0
v = 22
value = animelemno(0)
ignorehitpause = 1

[state x, armor over]
type = varset
trigger1 = animelemtime(4) >= 0
v = 20
value = 0
ignorehitpause 

;delay effect
[state 3041, delay]
type = changeanim 
trigger1 = var(31) < floor(gethitvar(hittime)*0.5)
value = anim
elem = var(22)

[state 3041, freeze location]
type = posfreeze
trigger1 = var(31) < floor(gethitvar(hittime)*0.5)
value = 1
;--------------------------

[state 3041, still take damage]
type = lifeadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) != 0
value = floor(-gethitvar(damage))
persistent = 1

[state 3041, armor count down]
type = varadd
trigger1 = gethitvar(damage) != 0
trigger1 = var(20) > 0
V = 20
value = -1
persistent = 1

[state 3041, Unstoppable]
type = hitoverride
trigger1 = Life > 1
trigger1 = Var(20) > 0
attr = SC, AA, AP
stateno = 3041
time = 1
persistent = 1

[State 3041, flash red]
type = PalFX
trigger1 = Time = 0
trigger1 = gethitvar(damage) != 0
time = 7
add = 100,0,0
IgnoreHitPause = 1

;---
;Armor End
;---


[State 3041, 4]
type = EnvShake
trigger1 = time = 0
time = 12
ampl = -4
freq = 100
phase = 100

[state 3041, nothitby]
type = nothitby
trigger1 = animelemtime(2) < 0
value = ,AP

[state 3041, nothitby]
type = nothitby
trigger1 = animelemtime(2) >= 0 && animelemtime(5) < 1
value = ,AT

[state 3041, velset]
type = velset
trigger1 = animelem = 2
trigger2 = animelem = 3
x = 30

[state 3041, skid]
type = statetypeset
trigger1 = animelem = 4
physics = S

[state 3041, 4]
type = playsnd
trigger1 = time = 0
value = S20,0
volume = 50

[state 3041, 4]
type = playsnd
trigger1 = animelem = 2
value = S1100,1
volume = 100

[State 3041, 1]
type = HitDef
Trigger1 = animelem = 3
trigger1 = p2stateno != [150,155]
attr = S, HT          
hitflag = M- 
guardflag = 
persistent = 0         
priority = 1, Miss   
sparkno = -1    
getpower = 0     
p1sprpriority = -2
p2sprpriority = 1                
p1facing = 1
p2facing = 1          
p1stateno = 3042      
p2stateno = 3050       
guard.dist = 0        
fall = 1             
fall.recover = 0
fall.recovertime = 60
fall.yvelocity = -12
fall.xvelocity = -2

[state 3041, end]
type = changestate
trigger1 = animtime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
;Bear Hug
[statedef 3042]
type = S
movetype = A
physics = N
velset = 0,0
anim = 1122
ctrl = 0

[state 3042, confirm hit sndfx]
type = playsnd
trigger1 = time = 0
value = S1100,2

[state 3042, confirm hit sndfx]
type = playsnd
trigger1 = time = 0
value = S1100,2

[state 3042, explod]
type = explod
trigger1 = time = 0
anim = 1123
pos = 0,0
id = 1120
scale = const(size.xscale),const(size.yscale)
postype = p1
bindtime = -1
ignorehitpause = 1
removetime = -2
sprpriority = 2
removeongethit = 1


[State 3042, Lift frame 1]
type = TargetBind
trigger1 = AnimElemTime(2) < 0
pos = 140, -40

[State 3042, Lift Frame 2]
type = TargetBind
trigger1 = AnimElemTime(2) >= 0 && AnimElemTime(3) < 0
pos = 140, -20

[State 3042, Bear Hug start frame 3]
type = TargetBind
trigger1 = AnimElemTime(3) >= 0 && AnimElemTime(4) < 0 ;3
trigger2 = AnimElemTime(8) >= 0 && AnimElemTime(9) < 0 ;8
trigger3 = animelemtime(13) >= 0 && animelemtime(14) < 0 ;13
pos = 60, -220
persistent = 1

[State 3042, bear hug frame 4]
type = TargetBind
trigger1 = AnimElemTime(4) >= 0 && AnimElemTime(5) < 0 ;4
trigger2 = AnimElemTime(7) >= 0 && AnimElemTime(8) < 0 ;7
trigger3 = AnimElemTime(9) >= 0 && AnimElemTime(10) < 0 ;9
trigger4 = animelemtime(12) >= 0 && animelemtime(13) < 0 ;12
trigger5 = animelemtime(11) >= 0 && animelemtime(12) < 0 ;11
trigger6 = animelemtime(14) >= 0 && animelemtime(15) < 0 ;14
pos = 45, -220
persistent = 1

[State 3042, bear hug frame 5]
type = TargetBind 
trigger1 = AnimElemTime(5) >= 0 && AnimElemTime(7) < 0 ;5-7
trigger2 = AnimElemTime(10) >= 0 && AnimElemTime(12) < 0 ;10-12
trigger3 = animelemtime(15) >= 0 && animelemtime(17) < 0 ;15-17
pos = 30, -220
persistent = 1

[State 3042, Bind 11]
type = TargetBind
trigger1 = AnimElemtime(17) >= 0 && animelemtime(18) < 0
pos = 90, 20
persistent = 1

[State 3042, Bind 11]
type = sprpriority
trigger1 = AnimElemtime(17) = 0
value = 3
persistent = 1

[State 3042, Bind 11]
type = TargetBind
trigger1 = AnimElemtime(18) >= 0 
pos = 80, 40
persistent = 1


[State 3042, Hurt 11]
type = TargetLifeAdd
trigger1 = AnimElemtime(5) > 0 && AnimElemtime(6) < 0
persistent = 2
value = -7
kill = 0

[State 3042, Hurt 11]
type = TargetLifeAdd
trigger1 = AnimElemtime(10) > 0 && AnimElemtime(11) < 0
persistent = 2
value = -7
kill = 0

[State 3042, Hurt 11]
type = TargetLifeAdd
trigger1 = AnimElemtime(15) > 0 && AnimElemtime(16) < 0
persistent = 2
value = -7
kill = 0

[State 3042, Hurt 11]
type = TargetLifeAdd
trigger1 = AnimElemtime(17) = 1 
value = -13
kill = 0

[State 3042, Hurt 11]
type = TargetpowerAdd
trigger1 = AnimElemtime(17) = 1
persistent = 0
value = 230

[state 3042, velset]
type = velset
trigger1 = animelem = 17
y = -18
x = 6

[state 3042, width]
type = velset
triggerall= animelemtime(17) > 0
trigger1 = frontedgebodydist < 80
x = -6

[state 3042, gravity]
type = gravity
trigger1 = pos y < -1


[state 3042, hitcount add]
type = hitadd
trigger1 = animelem = 5
trigger2 = animelem = 10
trigger3 = animelem = 15
value = 1

[state  3042, snd]
type = playsnd
trigger1 = animelem = 5
trigger2 = animelem = 10
trigger3 = animelem = 15
persistent = 1
value = S1100,0

[state 3042, end]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 3045


;---------------------------------------------------------------------------
; Ex bear hug landing
[statedef 3045]
type = C
movetype = H
physics = N
velset = 0,0
anim = 1125
sprpriority = 2

[state 3045, posset]
type = posset
trigger1= time = 0
y = 0

[state 3045, playerpush]
type = playerpush
trigger1 = 1
value = 0
ignorehitpause = 1

[state 3045, hitadd]
type = hitadd
trigger1 = time = 0
value = 1

[state 3045, targetstate]
type = targetstate
trigger1 = time = 0
value = 660

[state 3045, targetlifeadd]
type = targetlifeadd
trigger1 = time = 0
value = -190

[state 3045, earthquakes]
type = envshake
trigger1 = time = 0
time = 28
ampl = -12
freq = 75
phase = 75

;Custom Dust
[state 3045, explod]
type = explod
trigger1 = time = 0
anim = 2000
pos = 30,-20
scale = const(size.xscale)*3,const(size.yscale)*2.5
sprpriority  = 4
ownpal = 1

[state 3045, fx]
type = explod
trigger1 = time = 0
anim = F61
pos = 0,0
scale = 6,3
ownpal = 1
sprpriority = -4

[state 3045, explod]
type = explod
trigger1 = time = 0
anim = 2001
pos = 30,-20
scale =  const(size.xscale)*3,const(size.yscale)*2.5
sprpriority = -3
ownpal = 1

[state 3045, snd]
type = playsnd
trigger1 = time = 0
value =S650,0

[state 3045, end]
type = changestate
trigger1 = time = 11
value = 3046


;--------------------
;Bounce
[statedef 3046]
type = A
movetype = I
physics = N

[state 3046, bounce]
type = velset
trigger1 = time = 0
y = -6

[state 3046, gravity]
type = gravity
trigger1 = pos y < -1

[state 3046, bounce]
type = changestate
triggerall = time > 2
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 3047


;---------------------------------------------------------------------------
; Ex bear hug landing 2nd
[statedef 3047] 
type = C
movetype = H
physics = N
velset = 0,0
anim = 1127
sprpriority = 3

[state 3047, posset]
type = posset
trigger1= time = 0
y = 0

[state 3047, earthquakes]
type = envshake
trigger1 = time = 0
time = 12
ampl = -6
freq = 75
phase = 75

[state 3047, snd]
type = playsnd
trigger1 = time = 0
value =S650,0

[state 3047, end]
type = changestate
trigger1 = animtime = 0
value = 3048

;---------------------------------------------------------------------------
;Jump Off
[statedef 3048]
type = A
movetype = I
physics = N
anim = 41
velset = -6,-12

[state 3048, gravity]
type = gravity
trigger1 = pos y < -1

[state 3048, anim]
type = changeanim
trigger1 = vel y >= 0
value = 44

[state 3048, nothitby]
type = nothitby
trigger1 = 1
value = SCA

[state 3048, end]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 52
ctrl = 1

;-------------------------------------------------------------------------
; Victim States
;Super Bear Hugged
[Statedef 3050]
type    = A
movetype= H
physics = N
velset = 0,0

[State 3050, 1]
type = ChangeAnim2
Trigger1 = Time = 0
value = 1132

[state 3050, screenbound]
type = screenbound
trigger1 = 1
movecamera = 1,0
value = 0

[State 3050, Bind 2]
type = angledraw
trigger1 = AnimElemTime(3) >= 0 && AnimElemTime(5) < 0
trigger2 = AnimElemTime(6) >= 0 && AnimElemTime(9) < 0
value = -15

[State 3050, Bind 2]
type = angledraw
trigger1 = AnimElemTime(5) >= 0 && AnimElemTime(6) < 0
trigger2 = AnimElemTime(9) >= 0 && AnimElemTime(10) < 0
trigger3 = AnimElemTime(13) >= 0 && AnimElemTime(14) < 0
value = -30

[State 3050, 2]
type = SelfState
trigger1 = !gethitvar(isbound)
value = 5050


;===========================================================================
; Super 2 Anti Air Belly Flop - 350 damage
;===========================================================================

[Statedef 3080]
type = A
movetype = A
physics = N
anim = 3080
velset = 0,0
ctrl = 0


[state 3080, nothitby]
type = nothitby
trigger1 = 1
value = A

[state 3080, no bg]
type = assertspecial
trigger1 = animelemtime(1) >= 0 && animelemtime(4) < 0
trigger1 = anim = 3080
flag = nobg
ignorehitpause = 1

[state 3080, Super Portrait]
type = explod
trigger1 = animelemtime(1) >= 0 && animelemtime(2) < 7
trigger1 = anim = 3080
anim = 3100
postype = back
sprpriority = -3
supermovetime = 60
removetime = 1
pausemovetime = 60
scale = (3-(time*0.15))*(1),(3-(time*0.15))*(1)
pos = 0,60-time*5
ownpal = 1

[state 3080, Super Portrait]
type = explod
trigger1 = animelemtime(2) = 8
trigger1 = anim = 3080
anim = 3100
postype = back
vel = -0.1,0
sprpriority = -3
supermovetime = 60
removetime = 45
pausemovetime = 60
pos = 0,0
scale = 1,1
ownpal = 1


[State 3080, Super Pause]
type = SuperPause
trigger1 = animelemtime(1) = 0
trigger1 = anim = 3080
sound = S3000, 0
poweradd = -1000
pos = -100,-100
time = 60
movetime = 60

[state 3080, velset]
type = velset
trigger1 = animelem = 4
x = 18
y = -24

[state 3080, playsnd]
type = playsnd
trigger1 = animelem = 4
value = S1100,1

[state 3080, gravity]
type = gravity
trigger1 = pos y < -1

[State 3080, 1]
type = HitDef
Trigger1 = Time = 0
attr = S, HT          
hitflag = AF
guardflag =           
priority = 1, Miss   
sparkno = -1         
p1sprpriority = 2                 
p1facing = 1
p2facing = 1          
p1stateno = 3081       
p2stateno = 3090      
guard.dist = 0 
guard.velocity = -4
airguard.velocity = -4,-2
guard.hittime = 16       
fall = 1             
fall.recover = 0
fall.recovertime = 60
fall.yvelocity = -12
fall.xvelocity = 0

[state 3080, change anim]
type = changeanim
trigger1 = pos y != 0
trigger1 = vel y > 0
trigger1 = anim!= 1154
value = 1154


[state 3080, velset]
type = veladd
trigger1 = moveguarded
x = -4
y = -8
persistent = 0

[state x, combo damage score]
type = varadd
trigger1 = numtarget(1120)
trigger1 = time = 0
v = 18
value = 9
persistent = 0
ignorehitpause = 1

[state x, combo damage score]
type = varset
trigger1 = var(18) < 70
trigger1 = time = 1
v = 18
value = 70
persistent = 0
ignorehitpause = 1

[state 3080, end]
type = changestate
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 3085
;---------------------------------------------------------------------------
; Air Grab Animation
[Statedef 3081]
type    = A
movetype= A
physics = N
anim = 3081
poweradd = 0
velset = 0,0
sprpriority = 2

[state 3081, playerpush]
type = playerpush
trigger1 = 1
value = 0
ignorehitpause 

[state 3081, width]
type = width
trigger1 = 1
edge = 120,120


[State 3081, Grab Sound]
type = PlaySnd
trigger1 = time = 0
value = 1, 1

[state 3081, velset]
type = velset
trigger1 = time = 12
y = ifelse(pos y >-200,-32, -16)
x = 4

[state 3081, width]
type = velset
triggerall= animelemtime(2) > 0
trigger1 = frontedgebodydist < 80
x = -6

[state 3081, gravity]
type = gravity
trigger1 = animelemtime(2) > 1

[State 3081, Bind 1]
type = TargetBind
trigger1 = AnimElemTime(2) < 0
pos = 106, -53

[State 3081, Bind 2]
type = TargetBind
trigger1 = AnimElemTime(2) >= 0 
pos = 21, -41


[State 3081, Throw 5]
type = TargetState
trigger1 = AnimElemtime(5) = 2
value = 1181


[state 3081, ai butt drop]
type = varset
trigger1 = time = 0
var(23) = 1
ignorehitpause

[State 3081, State End]
type = ChangeState
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 3082



;--------------------------------------------------------------------------
; Ex bear hug landing
[statedef 3082]
type = C
movetype = H
physics = N
velset = 0,0
anim = 1125
sprpriority = 2

[state 3082, posset]
type = posset
trigger1= time = 0
y = 0

[state 3082, playerpush]
type = playerpush
trigger1 = 1
value = 0
ignorehitpause = 1


[state 3082, hitadd]
type = hitadd
trigger1 = time = 0
value = 1

[state 3082, targetstate]
type = targetstate
trigger1 = time = 0
value = 660

[state 3082, targetlifeadd]
type = targetlifeadd
trigger1 = time = 0
value = ceil(-350*fvar(10))

[state 3082, earthquakes]
type = envshake
trigger1 = time = 0
time = 28
ampl = -12
freq = 75
phase = 75

;Custom Dust
[state 3082, explod]
type = explod
trigger1 = time = 0
anim = 2000
pos = 30,-20
scale = const(size.xscale)*3,const(size.yscale)*2.5
sprpriority  = 4
ownpal = 1

[state 3082, fx]
type = explod
trigger1 = time = 0
anim = F61
pos = 0,0
scale = 6,3
ownpal = 1
sprpriority = -4

[state 3082, explod]
type = explod
trigger1 = time = 0
anim = 2001
pos = 30,-20
scale =  const(size.xscale)*3,const(size.yscale)*2.5
sprpriority = -3
ownpal = 1

[state 3082, snd]
type = playsnd
trigger1 = time = 0
value =S650,0

[state 3082, end]
type = changestate
trigger1 = time = 11
value = 3083


;--------------------
;Bounce
[statedef 3083]
type = A
movetype = I
physics = N

[state 3083, bounce]
type = velset
trigger1 = time = 0
y = -6

[state 3083, gravity]
type = gravity
trigger1 = pos y < -1

[state 3083, bounce]
type = changestate
triggerall = time > 2
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 3084


;---------------------------------------------------------------------------
; Ex bear hug landing 2nd
[statedef 3084] 
type = C
movetype = H
physics = N
velset = 0,0
anim = 1127
sprpriority = 3

[state 3084, posset]
type = posset
trigger1= time = 0
y = 0

[state 3084, earthquakes]
type = envshake
trigger1 = time = 0
time = 12
ampl = -6
freq = 75
phase = 75

[state 3084, snd]
type = playsnd
trigger1 = time = 0
value =S650,0

[state 3084, end]
type = changestate
trigger1 = animtime = 0
value = 3048



;---------------------------------------------------------------------------
; Landing
[Statedef 3085]
type    = S
physics = S
ctrl = 0
anim = 3085

[State 3085, 1]
type = VelSet
trigger1 = Time = 0
y = 0

[state 3085, height detection]
type = varset
trigger1 = time = 2
v = 15
value = 0

[State 3085, 2]
type = PosSet
trigger1 = Time = 0
y = 0

[State 3085, 4]
type = EnvShake
trigger1 = time = 0
time = 18
ampl = -14
freq = 100
phase = 100

[state 3085, 4]
type = playsnd
trigger1 = time = 0
value = S20,0

[state 3085, land fx]
type = explod
trigger1 = time = 0
trigger1 = var(15) = 1
anim = 2000
bindtime = 1
id = 1500
pos = 0, 10
removetime = -2
sprpriority = 4
scale = const(size.xscale)*2,const(size.yscale)*1.5

[state 3085, land fx]
type = explod
trigger1 = time = 0
trigger1 = var(15) = 1
anim = 2001
bindtime = 1
id = 1500
pos = 0, 10
removetime = -2
sprpriority = -3
scale = const(size.xscale)*2,const(size.yscale)*1.5

[State 3085, 4]
type = VelSet
trigger1 = abs(vel x) < Const(movement.stand.friction.threshold)
x = 0

[State 3085, 5]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;--------------------------------------------------------------------------
; Victim States
[Statedef 3090]
type    = A
movetype= H
physics = N
velset = 0,0

[State 3050, 1]
type = ChangeAnim2
Trigger1 = Time = 0
value = 3090

[state 3050, screenbound]
type = screenbound
trigger1 = 1
movecamera = 1,0
value = 080


[State 3050, 2]
type = SelfState
trigger1 = !gethitvar(isbound)
value = 5050


;==========================================================================
;[Info]
;author = "Inktrebuchet" 
;versiondate = 12/13/2018                  
;goal = Detect enemy's projectile (helper). For use with AI.
;       敵の発射物（helper）を検出する。 AIで使用する場合。
;==========================================================================
;                Notes
;==========================================================================
;notes:
;-Enemy's projectile now has a PlayerID use PlayerID(helper(33333333),var(3)) as a redirect.
;
;base examples of trigger use: 
;
;;Enemy's projectile helper's distance from character.
;trigger1 = PlayerIDExist(helper(33333333),var(3))
;trigger1 = PlayerID(helper(33333333),var(3)), p2bodydist x 
;
;;Enemy's projectile helper's velocity.
;trigger1 = PlayerIDExist(helper(33333333),var(3))
;trigger1 = PlayerID(helper(33333333),var(3)), Vel X
;
;==========================================================================
;                Helper var usage.
;==========================================================================
; numhelper(33333333) Variable usage:
; This is a record of the variables that are used
;
; var(0) - highest playerid + 1
; var(3) - projectile player id while it exists
; 
;==========================================================================
[Statedef 33333333]
type = A
movetype = I
physics = N
ctrl = 0
velset = 0, 0
 
;==========================================================================
;                Config Section
;==========================================================================
anim = 9741                   ; blank animation
 
;==========================================================================
 
[state 33333333, Clipboard] 
type = DisplayToClipboard
trigger1 = 1
text = "Highest Playerid = %d , Projectile helper's PlayerId = %d\nBy Inktrebuchet"
params = var(0)-1, var(3)
;==========================================================================
;                Detect Enemy's Projectile Helper
;==========================================================================
[State 33333333, 0]
type = Null
trigger1 = var(0) = 0
trigger1 = (var(0) := id)
ignorehitpause = 1
 
[state 33333333, 1] 
type = varadd
trigger1 = PlayerIdExist(var(0)) 
trigger2 = PlayerIdExist(var(0)+1) 
trigger3 = PlayerIdExist(var(0)+2) 
trigger4 = PlayerIdExist(var(0)+3) 
trigger5 = PlayerIdExist(var(0)+4) 
trigger6 = PlayerIdExist(var(0)+5) 
trigger7 = PlayerIdExist(var(0)+6) 
trigger8 = PlayerIdExist(var(0)+7) 
trigger9 = PlayerIdExist(var(0)+8) 
trigger10 = PlayerIdExist(var(0)+9) 
trigger11 = PlayerIdExist(var(0)+10) 
trigger12 = PlayerIdExist(var(0)+11) 
trigger13 = PlayerIdExist(var(0)+12) 
trigger14 = PlayerIdExist(var(0)+13) 
trigger15 = PlayerIdExist(var(0)+14) 
trigger16 = PlayerIdExist(var(0)+15) 
trigger17 = PlayerIdExist(var(0)+16) 
trigger18 = PlayerIdExist(var(0)+17) 
trigger19 = PlayerIdExist(var(0)+18) 
trigger20 = PlayerIdExist(var(0)+19) 
trigger21 = PlayerIdExist(var(0)+20) 
trigger22 = PlayerIdExist(var(0)+21) 
trigger23 = PlayerIdExist(var(0)+22) 
trigger24 = PlayerIdExist(var(0)+23) 
trigger25 = PlayerIdExist(var(0)+24) 
trigger26 = PlayerIdExist(var(0)+25) 
v = 0
value = 1
ignorehitpause = 1
 
[State 33333333, 2]
type = Null
triggerall = PlayerIdExist(Root,ID)
trigger1 = PlayerIdExist(var(0)-1)
trigger1 = cond(root,teamside = 1, PlayerID(var(0)-1),teamside = 2, PlayerID(var(0)-1),teamside = 1)
trigger1 = PlayerID(var(0)-1),hitdefattr = ASC, NP, SP, HP
trigger1 = var(3) := (var(0)-1)
trigger2 = PlayerIdExist(var(0)-2)
trigger2 = cond(root,teamside = 1, PlayerID(var(0)-2),teamside = 2, PlayerID(var(0)-2),teamside = 1)
trigger2 = PlayerID(var(0)-2),hitdefattr = ASC, NP, SP, HP
trigger2 = var(3) := (var(0)-2)
trigger3 = PlayerIdExist(var(0)-3)
trigger3 = cond(root,teamside = 1, PlayerID(var(0)-3),teamside = 2, PlayerID(var(0)-3),teamside = 1)
trigger3 = PlayerID(var(0)-3),hitdefattr = ASC, NP, SP, HP
trigger3 = var(3) := (var(0)-3)
trigger4 = PlayerIdExist(var(0)-4)
trigger4 = cond(root,teamside = 1, PlayerID(var(0)-4),teamside = 2, PlayerID(var(0)-4),teamside = 1)
trigger4 = PlayerID(var(0)-4),hitdefattr = ASC, NP, SP, HP
trigger4 = var(3) := (var(0)-4)
trigger5 = PlayerIdExist(var(0)-5)
trigger5 = cond(root,teamside = 1, PlayerID(var(0)-5),teamside = 2, PlayerID(var(0)-5),teamside = 1)
trigger5 = PlayerID(var(0)-5),hitdefattr = ASC, NP, SP, HP
trigger5 = var(3) := (var(0)-5)
trigger6 = PlayerIdExist(var(0)-6)
trigger6 = cond(root,teamside = 1, PlayerID(var(0)-6),teamside = 2, PlayerID(var(0)-6),teamside = 1)
trigger6 = PlayerID(var(0)-6),hitdefattr = ASC, NP, SP, HP
trigger6 = var(3) := (var(0)-6)
trigger7 = PlayerIdExist(var(0)-7)
trigger7 = cond(root,teamside = 1, PlayerID(var(0)-7),teamside = 2, PlayerID(var(0)-7),teamside = 1)
trigger7 = PlayerID(var(0)-7),hitdefattr = ASC, NP, SP, HP
trigger7 = var(3) := (var(0)-7)
trigger8 = PlayerIdExist(var(0)-8)
trigger8 = cond(root,teamside = 1, PlayerID(var(0)-8),teamside = 2, PlayerID(var(0)-8),teamside = 1)
trigger8 = PlayerID(var(0)-8),hitdefattr = ASC, NP, SP, HP
trigger8 = var(3) := (var(0)-8)
trigger9 = PlayerIdExist(var(0)-9)
trigger9 = cond(root,teamside = 1, PlayerID(var(0)-9),teamside = 2, PlayerID(var(0)-9),teamside = 1)
trigger9 = PlayerID(var(0)-9),hitdefattr = ASC, NP, SP, HP
trigger9 = var(3) := (var(0)-9)
trigger10 = PlayerIdExist(var(0)-10)
trigger10 = cond(root,teamside = 1, PlayerID(var(0)-10),teamside = 2, PlayerID(var(0)-10),teamside = 1)
trigger10 = PlayerID(var(0)-10),hitdefattr = ASC, NP, SP, HP
trigger10 = var(3) := (var(0)-10)
ignorehitpause = 1
 
[State 33333333, BindToRoot]
type = BindToRoot
trigger1 = PlayerIdExist(Root,ID)
time = 1
facing = 1
pos =0,-2
ignorehitpause = 1 

;---------------------------------------------------------------------------
; Override common states (use same number to override) :
;---------------------------------------------------------------------------

;---------------------------------------------------------------------------
; States that are always executed (use statedef -2)
;---------------------------------------------------------------------------
[statedef -2]

;=======================AI Detect Projectile System==========================
[state -2, AI Detect Projectile System]
type = helper
trigger1 = ailevel ;M.U.G.E.N 1.0+
trigger1 = !numhelper(33333333)
name = "AI Detect Projectile System"
ID = 33333333
stateno = 33333333
postype = p1
ownpal = 1
keyctrl = 0
size.xscale = 1.0
size.yscale = 1.0
supermovetime = 2147483647
pausemovetime = 2147483647
ignorehitpause = 1

[state -2, Jab Limiter]
type = varset
trigger1 = stateno != 200 && stateno != 205
var(4) = 4
ignorehitpause = 1

[state -2, Sweep Launch limiter]
type = varset
triggerall = numenemy
trigger1 = (enemynear, movetype != H)
var(6) = 2
ignorehitpause = 1

[state -2, Wall bounce limiter]
type = varset
triggerall = numenemy
trigger1 = (enemynear, movetype != H)
var(7) = 2
ignorehitpause = 1

[state -2, Ground Bounce limiter]
type = varset
triggerall = numenemy
trigger1 = (enemynear, movetype != H)
var(8) = 2
ignorehitpause = 1

[state -2, Launcher limiter]
type = varset
triggerall = numenemy
trigger1 = (enemynear, movetype != H)
trigger1 = (enemynear,statetype != A)
var(11) = 1
ignorehitpause = 1

[state -2, Jump infinite check]
type = varset
triggerall = numenemy
trigger1 = (enemynear, movetype != H)
var(29) = 1
ignorehitpause = 1

[state -2, AI air grab check]
type = varset
trigger1 = statetype != A
var(23) = 0
ignorehitpause = 1

[state -2, AI jab combo check]
type = varset
trigger1 = statetype != A
var(24) = 0
ignorehitpause = 1


;===============================================================================
; Remove Explods
;===============================================================================

[state -2, removeexplod]
type = removeexplod
trigger1 = stateno != 210
id = 211
ignorehitpause = 1

[state -2, removeexplod]
type = removeexplod
trigger1 = stateno != 650
id = 650
ignorehitpause = 1


[state -2, removeexplod]
type = removeexplod
trigger1 = stateno != 3006
id = 3006
ignorehitpause = 1

[state -2, removeexplod]
type = removeexplod
trigger1 = stateno != 3007
id = 3007
ignorehitpause = 1

[state -2, removeexplod]
type = removeexplod
trigger1 = stateno != 191
id = 19000
ignorehitpause = 1

[state -2, removeexplod]
type = removeexplod
trigger1 = stateno != 191
id = 19001
ignorehitpause = 1




;===============================================================================
; Simple Counter
;===============================================================================

[state -2, counter]
type = varset
triggerall = numenemy
trigger1 = gethitvar(damage) != 0
v = 31
value = 0
ignorehitpause = 1

[state -2, count up]
type = varadd
trigger1 = var(31) < var(33)
v = 31
value = 1
ignorehitpause = 0

[state -2, delay conter set]
type = varset
trigger1 = 1
v = 33
value = 90

;===========================================
;  Combo damage reduction
;===========================================

[State -2, attack scaling]
type = attackMulSet
trigger1 = 1
value = fvar (10)
ignorehitpause = 1

[state -2, combo points]
type = varset
trigger1 = numenemy
trigger1 = (enemynear, movetype != H)
trigger2 = !numenemy
ignorehitpause = 1
persistent = 1
v = 18
value = 100

[state -2, gradual lowering]
type= varset
trigger1 =  var(18) >= 100
fvar(10) = 1

[state -2, gradual lowering]
type= varset
trigger1 = var(18) < 100 && var(18) >= 90
fvar(10) = 0.9

[state -2, gradual lowering]
type= varset
trigger1 = var(18) < 90 && var(18) >= 80
fvar(10) = 0.8

[state -2, gradual lowering]
type= varset
trigger1 = var(18) < 80 && var(18) >= 70
fvar(10) = 0.7

[state -2, gradual lowering]
type= varset
trigger1 = var(18) < 70 && var(18) >= 60
fvar(10) = 0.6

[state -2, gradual lowering]
type= varset
trigger1 = var(18) < 60 && var(18) >= 50
fvar(10) = 0.5

[state -2, gradual lowering]
type= varset
trigger1 = var(18) < 50 && var(18) >= 40
fvar(10) = 0.4

[state -2, gradual lowering]
type= varset
trigger1 = var(18) < 40 && var(18) >= 30
fvar(10) = 0.3

[state -2, gradual lowering]
type= varset
trigger1 = var(18) < 30 && var(18) >= 20
fvar(10) = 0.2

[state -2, gradual lowering]
type= varset
trigger1 = var(18) < 20 && var(18) >= 10
fvar(10) = 0.1

[state -2, gradual lowering]
type= varset
trigger1 = var(18) < 10
fvar(10) = 0.05

;==========================================================================
; victory Quotes
;==========================================================================

[state -2, win quotes]
type = victoryquote
trigger1 = 1
value = 1+(random%7)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, Name = "Jumbo Elephant"
value = 8+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, Name = "Ana 'Jiggly' Bunny"
value = 11+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, Name = "Bertha Hippo"
value = 14+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, Name = "Katrina Crocodile"
value = 17+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, Name = "Enorma Pig"
value = 20+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, Name = "Aroma Skunk"
value = 23+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, Name = "Lardo Rat"
value = 26+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, Name = "Zafta Giraffe"
value = 29+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, Name = "Makuyama"
value = 32+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, Name = "Pastilla Skunk"
value = 35+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, Name = "Jumba Elephant"
value = 38+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, name = "Twiggi Bunny"
value = 41+(random%3)
ignorehitpause =1
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, Name = "Ra Lord"
value = 44+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, Name = "Violet 'Tyla' Bunny"
value = 47+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, Name = "Julian Hippo"
value = 50+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, Name = "Battu Tri-red"
value = 53+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, Name = "Zangief"
value = 60+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, Name = "Rapid Bunny"
value = 56+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, Name = "Noah Sharker"
value = 66+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, Name = "Akai R. Panda"
value = 69+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, Name = "Andy Armadillo"
value = 72+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, Name = "Montana Moth"
value = 75+(random%3)
ignorehitpause
persistent = 1

[state -2, win quotes]
type = victoryquote
triggerall = numenemy
trigger1 = enemy, Name = "Texas Stanton"
value = 78+(random%3)
ignorehitpause
persistent = 1



;---------------------------------------------------------------
; Bear Hug check
;---------------------------------------------------------------
[state -2, bearhug check - Approval to Lunge]
type = varset
triggerall = numenemy
triggerall = stateno = 1100 || stateno = 1110 || stateno = 1120 || stateno = 3040
triggerall = enemynear,hitdefattr != SCA,NP,SP,HP
triggerall = p2bodydist x =[0, 800]
triggerall = p2stateno != 5120
;triggerall = random < ailevel*32
trigger1 = p2bodydist y = [-80,0]
trigger1 = enemynear, vel y > 0
trigger1 = enemynear,hitfall = 0
trigger2 = p2statetype != A
trigger2 = enemynear,ctrl = 0
trigger3 = p2statetype != A
trigger3 = enemynear,ctrl = 1
trigger3 = random < (ailevel*8)
trigger4 = enemynear,ctrl = 0
trigger4 = enemynear,animtime > -12
trigger4 = p2statetype != A
trigger5 = enemynear,vel x = 0
trigger5 = p2statetype != A
trigger5 = random < (ailevel*8)
trigger6 = p2bodydist x = [0,200]
trigger6 = p2statetype = S || p2statetype = C
v = 26
value = 1

[state -2, bearhug check - Reasons to Cancel]
type = varset
triggerall = numenemy
triggerall = stateno = 1100 || stateno = 1110 || stateno = 1120 || stateno = 3040
;triggerall = random < ailevel*32
trigger1 = p2statetype = A
trigger2 = enemynear,movetype = A
trigger2 = enemynear,hitdefattr = SCA,HA
trigger3 = p2bodydist x < 0
trigger4 = p2stateno = 0
trigger4 = enemynear,ctrl = 1
trigger4 = random < (ailevel*12)
trigger4 = p2bodydist x > 700
v = 26
value = 2

[state -2, bearhug check - neutral]
type = varset
triggerall = numenemy
trigger1 = time = 0
trigger1 = stateno = 1100 || stateno = 1110 || stateno = 1120 || stateno = 3040
trigger2 = enemynear,hitdefattr = SCA,NP,SP,HP
trigger3 = p2stateno = [5100,5120]
trigger4 = numhelper(33333333)
trigger4 = PlayerIDExist(helper(33333333),var(3))
trigger4 = inguarddist
trigger5 = p2stateno = [660,669]
v = 26
value = 0

[state -2, distance check]
type = displaytoclipboard
trigger1 = 1
text = "distance Opp X: %d Y: %d, Position Y: %d,Combo scaling: %d  Wall Dist: %d "
params = p2bodydist x, p2bodydist y, pos y, var(18), backedgebodydist
;text = "Bertha Hippo is (c) Kazecat 2017



;Earthquakes
[State -2, quakes]
type = envshake
triggerall = time = 1
trigger1 = stateno = 1521
trigger1 = prevstateno != 1523  
trigger2 = stateno = 1527 && time = 1
time = 12
ampl = -8
;---------------------------------------------------------------------------
; States that are executed when in self's state file (use statedef -3)
;---------------------------------------------------------------------------

[Statedef -3]

;Working Healing factor
[state -3, mild healing factor]
type = null
triggerall = movetype != H
triggerall = roundstate = 2
trigger1 = life < floor(lifemax *0.25)
trigger1 = (gametime%60)=0
trigger1 = power > 1000
value = 10

[state -3, healing factor consumes meter]
type = null
triggerall = movetype != H
triggerall = roundstate = 2
trigger1 = life < floor(lifemax * 0.25)
trigger1 = (gametime%60)=0
trigger1 = power > 1000
value = -10

[State -3, quakes]
type = envshake
triggerall = time = 1
trigger1 = stateno = 5100
time = 18
ampl = -12
freq = 100
phase = 100

[state -3, gravity]
type = gravity
trigger1 = stateno = 5620
trigger1 = time > 0

[state -3, land]
type = changestate
triggerall = stateno = 5620
trigger1 = vel y > 0
trigger1 = pos y > -vel y
value = 52



[State -3, Landing Sound]
type = PlaySnd
triggerall = Time = 1
trigger1 = stateno = 5100
value = S20, 0
;This controller plays a sound everytime KFM lands from a jump, or
;from his back-dash.

[State -3, Landing Sound]
type = PlaySnd
triggerall = Time = 1
trigger1 = stateno = 106 ;Run-back land
value = S20, 0
